<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√áarkƒ±felek √ñƒürenci Se√ßici v7</title>
    <style>
        /* (CSS kodlarƒ± v6 ile aynƒ±, deƒüi≈üiklik yok) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .selected-section {
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #667eea;
            margin-bottom: 20px;
        }

        .selected-section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .wheel-container {
            position: relative;
            width: 350px;
            height: 350px;
            margin: 30px auto;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            background: conic-gradient(
                #FF6B6B, #FF8E72, #FFC75F, #F9F871, #845EC2, #D65DB1, #FF6B9D,
                #C34A36, #FF6B6B, #FF8E72, #FFC75F, #F9F871, #845EC2, #D65DB1
            );
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-origin: center;
        }

        .wheel.spinning {
            animation: spin 4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes spin {
            from {
                transform: rotateZ(0deg);
            }
            to {
                transform: rotateZ(1800deg);
            }
        }

        .wheel-center {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            z-index: 10;
        }

        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #FFD700;
            z-index: 20;
            filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.3));
        }

        .controls-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 500px;
        }

        .control-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .control-group.hidden {
            display: none;
        }

        .control-group label {
            font-weight: 700;
            color: #333;
            font-size: 1em;
        }

        .control-group select {
            padding: 10px 15px;
            border: 3px solid #667eea;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            font-weight: 600;
            color: #333;
        }

        .button {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .button:active:not(:disabled) {
            transform: scale(0.98);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-spin {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            font-size: 1.2em;
            padding: 15px 40px;
            width: 100%;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        #initial-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #next-steps {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .remaining-section {
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #764ba2;
            margin-top: 20px;
        }

        .remaining-section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #764ba2;
        }

        .remaining-controls {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .remaining-controls select {
            padding: 8px 12px;
            border: 2px solid #764ba2;
            border-radius: 8px;
            font-size: 0.95em;
            background: white;
            cursor: pointer;
            font-weight: 600;
        }

        .remaining-controls button {
            padding: 8px 20px;
            font-size: 0.95em;
        }

        .student-list {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .student-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9em;
            animation: slideInFromWheel 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            opacity: 0.2; 
        }

        .student-card.new {
            opacity: 1; 
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
            transform: scale(1.1);
        }

        .student-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .student-card.new:hover {
            transform: scale(1.15);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }

        .student-card.selected-for-action {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%) !important;
            opacity: 1 !important;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8) !important;
        }

        .student-name {
            background: #f0f0f0;
            color: #333;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9em;
        }

        @keyframes slideInFromWheel {
            0% {
                opacity: 0;
                transform: translate(0, 300px) scale(0.5);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
        }

        .student-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            animation: menuSlideIn 0.3s ease;
        }

        @keyframes menuSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .menu-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            min-width: 150px;
        }

        .delete-btn {
            background: linear-gradient(135deg, #f5576c 0%, #ff6b9d 100%);
            color: white;
        }

        .delete-btn:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .return-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .return-btn:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .groups-section {
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #f093fb;
            margin-top: 20px;
        }
        .group-controls {
            margin-bottom: 20px;
            text-align: center;
        }
        .group-controls h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #f5576c;
        }
        
        .group-mode-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 12px;
        }
        .group-mode-toggle label {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #555;
        }
        .group-mode-toggle input {
            display: none;
        }
        .group-mode-toggle input:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.4);
        }


        .groups-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .group-box {
            flex-basis: 220px; 
            flex-grow: 1;
            max-width: 300px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .group-box h4 {
            color: #764ba2;
            border-bottom: 2px solid #764ba2;
            padding-bottom: 8px;
            margin-bottom: 10px;
            font-size: 1.1em;
            text-align: center;
        }
        .group-box ul {
            list-style: none;
            padding-left: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .group-box li.student-in-group {
            background: white;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            color: #333;
            border: 1px solid #eee;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .student-in-group:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border-color: #764ba2;
        }
        
        .student-in-group.selected-for-swap {
            background: #FFD700;
            color: #333;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 217, 0, 0.5);
        }


        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            .content {
                padding: 20px;
            }
            .wheel-container {
                width: 280px;
                height: 280px;
            }
            .button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            .remaining-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé° √áARKIFELEK √ñƒûRENCƒ∞ SE√áƒ∞Cƒ∞</h1>
            <p>D√∂nd√ºr ve Kazanan Belirle! üéâ</p>
        </div>

        <div class="content">
            <div class="selected-section">
                <h3>‚ú® SE√áƒ∞LENLER ‚ú®</h3>
                <ul id="selected-list" class="student-list"></ul>
            </div>

            <div class="controls-section">
                
                <div class="control-group">
                    <label for="select-count">Ka√ß ki≈üi se√ßilsin?</label>
                    <select id="select-count">
                        <option value="1">1 √∂ƒürenci</option>
                        <option value="2">2 √∂ƒürenci</option>
                        <option value="3">3 √∂ƒürenci</option>
                        <option value="4">4 √∂ƒürenci</option>
                        <option value="5">5 √∂ƒürenci</option>
                        <option value="6">6 √∂ƒürenci</option>
                        <option value="8">8 √∂ƒürenci</option>
                        <option value="12">12 √∂ƒürenci</option>
                    </select>
                </div>
                
                <div id="initial-controls">
                    <button id="spin-button" class="button btn-spin">üé≤ √áARKI √áEVIR! üé≤</button>
                </div>

                <div id="next-steps">
                    <button id="select-remaining-button" class="button btn-secondary">√áARKI YENIDEN √áEVIR</button>
                    <button id="reset-button" class="button btn-secondary">SIFIRLA</button>
                </div>
            </div>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="wheel">
                    <div class="wheel-center">üéØ</div>
                </div>
            </div>

            <div class="remaining-section">
                <h3>üìã KALANLAR (<span id="remaining-count">0</span>)</h3>
                <div class="remaining-controls">
                    <select id="remaining-select-count">
                        <option value="1">1 √∂ƒürenci</option>
                        <option value="2">2 √∂ƒürenci</option>
                        <option value="3">3 √∂ƒürenci</option>
                        <option value="4">4 √∂ƒürenci</option>
                        <option value="5">5 √∂ƒürenci</option>
                        <option value="6">6 √∂ƒürenci</option>
                        <option value="8">8 √∂ƒürenci</option>
                        <option value="12">12 √∂ƒürenci</option>
                    </select>
                    <button id="remaining-spin-button" class="button" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; width: auto;">KALANLARDAN SE√á</button>
                </div>
                <ul id="remaining-list" class="student-list"></ul>
            </div>

            <div class="groups-section">
                <div class="group-controls">
                    <h3>üë• GRUPLAR OLU≈ûTUR</h3>
                    
                    <div class="group-mode-toggle">
                        <input type="radio" name="group-mode" id="mode-by-count" value="count" checked>
                        <label for="mode-by-count">Grup Sayƒ±sƒ±na G√∂re</label>
                        
                        <input type="radio" name="group-mode" id="mode-by-size" value="size">
                        <label for="mode-by-size">Grup B√ºy√ºkl√ºƒü√ºne G√∂re</label>
                    </div>

                    <div id="controls-by-count" class="control-group">
                        <label for="group-count">Grup Sayƒ±sƒ±:</label>
                        <select id="group-count">
                            <option value="2">2 gruba ayƒ±r</option>
                            <option value="3">3 gruba ayƒ±r</option>
                            <option value="4">4 gruba ayƒ±r</option>
                            <option value="5">5 gruba ayƒ±r</option>
                            <option value="6">6 gruba ayƒ±r</option>
                            <option value="8">8 gruba ayƒ±r</option>
                            <option value="12">12 gruba ayƒ±r</option>
                        </select>
                    </div>

                    <div id="controls-by-size" class="control-group hidden">
                        <label for="group-size">Grup B√ºy√ºkl√ºƒü√º:</label>
                        <select id="group-size">
                            <option value="2">2 ki≈üilik gruplar</option>
                            <option value="3">3 ki≈üilik gruplar</option>
                            <option value="4">4 ki≈üilik gruplar</option>
                            <option value="5">5 ki≈üilik gruplar</option>
                            <option value="6">6 ki≈üilik gruplar</option>
                            <option value="8">8 ki≈üilik gruplar</option>
                            <option value="12">12 ki≈üilik gruplar</option>
                        </select>
                    </div>

                    <div class="control-group" style="margin-top: 15px;">
                        <button id="create-groups-button" class="button" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; width: auto;">GRUPLAR OLU≈ûTUR</button>
                        <button id="redistribute-button" class="button" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; width: auto; display: none;">RASTGELE DAƒûIT</button>
                    </div>

                </div>
                <div id="groups-container" class="groups-container"></div>
            </div>

        </div>
    </div>

    <script>
        const tumOgrenciler = [
            "HAKAN AKDENƒ∞Z", "H√úSEYƒ∞N √áAƒûAN G√úRGAH", "AHMET ARIN AƒûT√úRK",
            "DENƒ∞Z G√úNEY", "ƒ∞Dƒ∞L DEMƒ∞RCƒ∞", "DURU AYKANAT", "DENƒ∞Z Kƒ∞MYON",
            "KADƒ∞R BERKTA≈û", "DOƒûA BORA", "AHMET CEVDET KORKMAZ", "G√úLNƒ∞HAL KARAKA≈û",
            "Nƒ∞L Tƒ∞RYAKƒ∞", "MASAL DEFNE TEL", "EYL√úL AFAT", "ELƒ∞F ADA KEKE√á",
            "EYL√úL MUTAF", "ƒ∞PEK Mƒ∞MAROƒûLU", "YEKTA URAS DEMƒ∞RER", "HAMZA KAAN √áEVEN",
            "BEYZA DAƒûDELEN", "NAZ KARABAƒûLI", "AYNUR BUDAK", "DURU B√úK√úN", "WAFA MAKANSSI"
        ];

        let kalanOgrenciler = [];
        let secilenOgrenciler = [];
        let isSpinning = false;

        // √áark Elementleri
        const selectCount = document.getElementById('select-count');
        const spinButton = document.getElementById('spin-button');
        const selectRemainingButton = document.getElementById('select-remaining-button');
        const resetButton = document.getElementById('reset-button');
        const wheel = document.getElementById('wheel');
        const selectedList = document.getElementById('selected-list');
        const remainingList = document.getElementById('remaining-list');
        const remainingCountSpan = document.getElementById('remaining-count');
        const initialControls = document.getElementById('initial-controls');
        const nextSteps = document.getElementById('next-steps');
        const remainingSelectCount = document.getElementById('remaining-select-count');
        const remainingSpinButton = document.getElementById('remaining-spin-button');

        // Grup olu≈üturma elementleri
        const groupModeRadios = document.querySelectorAll('input[name="group-mode"]');
        const controlsByCount = document.getElementById('controls-by-count');
        const controlsBySize = document.getElementById('controls-by-size');
        const groupCountSelect = document.getElementById('group-count');
        const groupSizeSelect = document.getElementById('group-size');
        const createGroupsButton = document.getElementById('create-groups-button');
        const redistributeButton = document.getElementById('redistribute-button');
        const groupsContainer = document.getElementById('groups-container');

        // ƒ∞stenmeyen e≈üle≈üme i√ßin kural
        const constrainedStudent1 = "DURU B√úK√úN";
        const constrainedStudent2 = "EYL√úL MUTAF";
        
        let currentGroups = [];
        let firstSelectedStudent = null;
        

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // --- √áark Fonksiyonlarƒ± ---

        function renderLists() {
            remainingList.innerHTML = '';
            kalanOgrenciler.forEach(student => {
                const li = document.createElement('li');
                li.textContent = student;
                li.className = 'student-name';
                remainingList.appendChild(li);
            });
            remainingCountSpan.textContent = kalanOgrenciler.length;
            checkButtons();
        }

        // ************************************
        // *** G√úNCELLENEN renderSelectedList FONKSƒ∞YONU ***
        // (Vurgu d√ºzeltmesi v6'dan)
        // ************************************
        function renderSelectedList(lastCount = 0) {
            selectedList.innerHTML = '';

            secilenOgrenciler.forEach((student, index) => {
                const li = document.createElement('li');
                li.textContent = student;
                li.className = 'student-card';
                
                const isNew = index >= secilenOgrenciler.length - lastCount;
                
                if (isNew) {
                    li.classList.add('new');
                }
                
                li.style.animationDelay = `${index * 0.15}s`;
                li.addEventListener('click', (e) => {
                    e.stopPropagation();
                    li.classList.add('selected-for-action');
                    showStudentMenu(student, li);
                });
                selectedList.appendChild(li);
            });
        }


        function showStudentMenu(student, element) {
            const existingMenu = document.querySelector('.student-menu');
            if (existingMenu) existingMenu.remove();

            const menu = document.createElement('div');
            menu.className = 'student-menu';
            menu.innerHTML = `
                <button class="menu-btn delete-btn">üóëÔ∏è Sil</button>
                <button class="menu-btn return-btn">‚Ü©Ô∏è Kalanlar'a G√∂nder</button>
            `;

            menu.querySelector('.delete-btn').addEventListener('click', () => {
                secilenOgrenciler = secilenOgrenciler.filter(s => s !== student);
                element.style.opacity = '0';
                element.style.transform = 'scale(0)';
                setTimeout(() => {
                    renderSelectedList(0); 
                    menu.remove();
                }, 300);
            });

            menu.querySelector('.return-btn').addEventListener('click', () => {
                secilenOgrenciler = secilenOgrenciler.filter(s => s !== student);
                kalanOgrenciler.push(student);
                kalanOgrenciler.sort();
                element.style.opacity = '0';
                element.style.transform = 'scale(0)';
                setTimeout(() => {
                    renderSelectedList(0); 
                    renderLists();
                    menu.remove();
                }, 300);
            });

            document.body.appendChild(menu);
        }

        function spinWheel(isFromRemainingButton = false) {
            if (isSpinning) return;
            
            // D√ºzeltme: "Kalanlardan Se√ß" butonu 'remaining-select-count'u,
            // diƒüer t√ºm √ßark √ßevirmeler (ilk ve yeniden) 'select-count'u kullanƒ±r.
            const countToSelect = isFromRemainingButton ? 
                                 parseInt(remainingSelectCount.value) : 
                                 parseInt(selectCount.value);

            const actualCount = Math.min(countToSelect, kalanOgrenciler.length);

            if (actualCount === 0) return;

            isSpinning = true;
            spinButton.disabled = true;
            selectRemainingButton.disabled = true;
            remainingSpinButton.disabled = true; 

            const randomSpins = Math.floor(Math.random() * 360) + 1800;
            
            // Sadece ana √ßark butonlarƒ± (ilk ve yeniden) √ßarkƒ± d√∂nd√ºr√ºr
            if (!isFromRemainingButton) {
                wheel.style.transform = `rotateZ(${randomSpins}deg)`;
                wheel.classList.add('spinning');
                
                setTimeout(() => {
                    performSelection(actualCount); 
                    initialControls.style.display = 'none'; // ƒ∞lk butonu gizle
                    nextSteps.style.display = 'flex'; // Yeniden √ßevir/sƒ±fƒ±rla'yƒ± g√∂ster
                    isSpinning = false;
                    checkButtons(); 
                }, 4000); 
            } else {
                // "Kalanlardan Se√ß" butonu √ßarkƒ± D√ñND√úRMEZ, anƒ±nda se√ßer
                performSelection(actualCount); 
                isSpinning = false;
                checkButtons();
            }
        }
        
        // (Vurgu d√ºzeltmesi v6'dan)
        function performSelection(actualCount) {
             const karistirilmis = shuffleArray(kalanOgrenciler);
            const secilenBuSefer = karistirilmis.slice(0, actualCount);

            secilenBuSefer.forEach(ogrenci => {
                const index = kalanOgrenciler.indexOf(ogrenci);
                if (index > -1) {
                    kalanOgrenciler.splice(index, 1);
                }
                secilenOgrenciler.push(ogrenci);
            });

            renderSelectedList(actualCount); // Se√ßilen sayƒ±sƒ±nƒ± yolla
            renderLists();
        }

        function selectFromRemaining() {
            spinWheel(true); // 'isFromRemainingButton' = true
        }

        function sistemiSifirla() {
            wheel.style.transform = 'rotateZ(0deg)';
            kalanOgrenciler = [...tumOgrenciler];
            secilenOgrenciler = [];
            selectedList.innerHTML = ''; 
            renderLists();
            
            // HTML yapƒ±sƒ± deƒüi≈ütiƒüi i√ßin JS de deƒüi≈üti:
            initialControls.style.display = 'flex'; // "√áarkƒ± √áevir" butonunu g√∂ster
            nextSteps.style.display = 'none'; // "Yeniden √áevir" butonlarƒ±nƒ± gizle
            
            isSpinning = false;
            spinButton.disabled = false;
            
            groupsContainer.innerHTML = '';
            createGroupsButton.style.display = 'inline-block';
            redistributeButton.style.display = 'none';
            
            currentGroups = [];
            clearSwapSelection();
        }

        function checkButtons() {
            const hasRemaining = kalanOgrenciler.length > 0;
            spinButton.disabled = !hasRemaining || isSpinning;
            selectRemainingButton.disabled = !hasRemaining || isSpinning;
            remainingSpinButton.disabled = !hasRemaining || isSpinning;
        }

        // --- Grup Fonksiyonlarƒ± ---

        function toggleGroupControls(e) {
            if (e.target.value === 'count') {
                controlsByCount.classList.remove('hidden');
                controlsBySize.classList.add('hidden');
            } else {
                controlsByCount.classList.add('hidden');
                controlsBySize.classList.remove('hidden');
            }
        }

        function createGroups() {
            clearSwapSelection(); 
            const mode = document.querySelector('input[name="group-mode"]:checked').value;
            let groups = [];

            if (mode === 'count') {
                groups = createGroupsByCount();
            } else {
                groups = createGroupsBySize();
            }
            
            renderGroups(groups); 
            
            createGroupsButton.style.display = 'none';
            redistributeButton.style.display = 'inline-block';
        }

        function createGroupsByCount() {
            const groupCount = parseInt(groupCountSelect.value);
            let studentsToGroup = [...tumOgrenciler];
            
            let student1Exists = false;
            let student2Exists = false;

            const index1 = studentsToGroup.indexOf(constrainedStudent1);
            if (index1 > -1) {
                studentsToGroup.splice(index1, 1);
                student1Exists = true;
            }
            
            const index2 = studentsToGroup.indexOf(constrainedStudent2);
            if (index2 > -1) {
                studentsToGroup.splice(index2, 1);
                student2Exists = true;
            }
            
            const shuffledStudents = shuffleArray(studentsToGroup);
            
            let groups = [];
            for (let i = 0; i < groupCount; i++) {
                groups.push([]);
            }

            let currentGroupIndex = 0;
            shuffledStudents.forEach(student => {
                groups[currentGroupIndex].push(student);
                currentGroupIndex = (currentGroupIndex + 1) % groupCount;
            });

            if (student1Exists || student2Exists) {
                groups.sort((a, b) => a.length - b.length);
                if (student1Exists) {
                    groups[0].push(constrainedStudent1);
                }
                if (student2Exists) {
                    if (groups.length > 1) {
                        groups[1].push(constrainedStudent2);
                    } else {
                        groups[0].push(constrainedStudent2); 
                    }
                }
            }
            return groups;
        }

        
        // (Grup B√ºy√ºkl√ºƒü√º hatasƒ± v5'ten d√ºzeltildi)
        function createGroupsBySize() {
            const groupSize = parseInt(groupSizeSelect.value);
            let shuffledStudents = shuffleArray([...tumOgrenciler]);
            let groups = [];

            while (shuffledStudents.length > 0) {
                groups.push(shuffledStudents.splice(0, groupSize));
            }

            const badGroupIndex = groups.findIndex(g => g.includes(constrainedStudent1) && g.includes(constrainedStudent2));

            if (badGroupIndex > -1) {
                let swapGroupIndex = 0;
                if (badGroupIndex === 0) {
                    swapGroupIndex = 1;
                }
                
                if (groups.length > 1 && groups[swapGroupIndex]) {
                    const studentA_Name = constrainedStudent2;
                    const indexA = groups[badGroupIndex].indexOf(studentA_Name);
                    
                    let indexB = 0;
                    let studentB_Name = groups[swapGroupIndex][indexB];
                    
                    if((studentB_Name === constrainedStudent1 || studentB_Name === constrainedStudent2) && groups[swapGroupIndex].length > 1) {
                        indexB = 1;
                        studentB_Name = groups[swapGroupIndex][indexB];
                    }

                    const studentA = groups[badGroupIndex].splice(indexA, 1)[0];
                    const studentB = groups[swapGroupIndex].splice(indexB, 1)[0];
                    
                    groups[badGroupIndex].push(studentB);
                    groups[swapGroupIndex].push(studentA);
                }
            }
            return groups;
        }


        function renderGroups(groups) {
            groupsContainer.innerHTML = '';
            
            currentGroups = groups; 

            groups.forEach((group, groupIndex) => {
                const groupElement = document.createElement('div');
                groupElement.className = 'group-box';
                
                const h4 = document.createElement('h4');
                h4.textContent = `Grup ${groupIndex + 1}`;
                groupElement.appendChild(h4);

                const ul = document.createElement('ul');
                
                const shuffledGroupMembers = shuffleArray(group);
                
                shuffledGroupMembers.forEach(studentName => {
                    const li = document.createElement('li');
                    li.className = 'student-in-group';
                    li.textContent = studentName;
                    
                    li.dataset.groupIndex = groupIndex;
                    li.dataset.studentName = studentName; 

                    li.addEventListener('click', handleGroupStudentClick);
                    ul.appendChild(li);
                });
                
                groupElement.appendChild(ul);
                groupsContainer.appendChild(groupElement);
            });
        }
        
        function handleGroupStudentClick(event) {
            const clickedElement = event.currentTarget;
            const studentName = clickedElement.dataset.studentName;
            const groupIndex = parseInt(clickedElement.dataset.groupIndex);

            if (!firstSelectedStudent) {
                firstSelectedStudent = { element: clickedElement, name: studentName, group: groupIndex };
                clickedElement.classList.add('selected-for-swap');
            } else {
                
                if (firstSelectedStudent.name === studentName) {
                    clearSwapSelection();
                    return;
                }
                
                if (firstSelectedStudent.group === groupIndex) {
                    clearSwapSelection();
                    return;
                }

                // KURAL KONTROL√ú
                const firstIsConstrained = (firstSelectedStudent.name === constrainedStudent1 || firstSelectedStudent.name === constrainedStudent2);
                const secondIsConstrained = (studentName === constrainedStudent1 || studentName === constrainedStudent2);

                if (firstIsConstrained) {
                    if (currentGroups[groupIndex].includes(constrainedStudent1) || currentGroups[groupIndex].includes(constrainedStudent2)) {
                        alert("Hata: Duru B√ºk√ºn ve Eyl√ºl Mutaf aynƒ± grupta olamaz!");
                        clearSwapSelection();
                        return;
                    }
                } else if (secondIsConstrained) {
                     if (currentGroups[firstSelectedStudent.group].includes(constrainedStudent1) || currentGroups[firstSelectedStudent.group].includes(constrainedStudent2)) {
                        alert("Hata: Duru B√ºk√ºn ve Eyl√ºl Mutaf aynƒ± grupta olamaz!");
                        clearSwapSelection();
                        return;
                    }
                }

                // --- Deƒüi≈üim ƒ∞≈ülemi ---
                
                const indexInGroup1 = currentGroups[firstSelectedStudent.group].indexOf(firstSelectedStudent.name);
                currentGroups[firstSelectedStudent.group].splice(indexInGroup1, 1);
                
                const indexInGroup2 = currentGroups[groupIndex].indexOf(studentName);
                currentGroups[groupIndex].splice(indexInGroup2, 1);

                currentGroups[firstSelectedStudent.group].push(studentName);
                currentGroups[groupIndex].push(firstSelectedStudent.name);

                renderGroups(currentGroups);

                clearSwapSelection();
            }
        }

        function clearSwapSelection() {
            if (firstSelectedStudent) {
                const oldElement = document.querySelector(`.student-in-group[data-student-name="${firstSelectedStudent.name}"]`);
                if(oldElement) {
                    oldElement.classList.remove('selected-for-swap');
                }
            }
            firstSelectedStudent = null;
            
            document.querySelectorAll('.student-in-group.selected-for-swap').forEach(el => {
                el.classList.remove('selected-for-swap');
            });
        }
        

        // --- Olay Dinleyicileri ---

        // (HTML yapƒ±sƒ± deƒüi≈ütiƒüi i√ßin bu dinleyiciler g√ºncellendi)
        spinButton.addEventListener('click', () => spinWheel(false)); // ƒ∞lk √ßevirme
        selectRemainingButton.addEventListener('click', () => spinWheel(false)); // Yeniden √ßevirme
        remainingSpinButton.addEventListener('click', selectFromRemaining); // Kalanlardan se√ß
		resetButton.addEventListener('click', sistemiSifirla);

        document.addEventListener('click', (e) => {
            const menu = document.querySelector('.student-menu');
            const card = e.target.closest('.student-card');
            if (menu && !menu.contains(e.target) && !card) {
                menu.remove();
                document.querySelectorAll('.student-card.selected-for-action').forEach(c => {
                    c.classList.remove('selected-for-action');
                });
            }
            
            const isStudentInGroup = e.target.closest('.student-in-group');
            if (firstSelectedStudent && !isStudentInGroup) {
                clearSwapSelection();
            }
        });
        
        groupModeRadios.forEach(radio => radio.addEventListener('change', toggleGroupControls));
        createGroupsButton.addEventListener('click', createGroups);
        redistributeButton.addEventListener('click', createGroups);

        document.addEventListener('DOMContentLoaded', sistemiSifirla);
    </script>
</body>
</html>
