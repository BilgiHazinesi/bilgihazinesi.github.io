<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fen Bilimleri: Mƒ±knatƒ±s Ustasƒ± (V16 Final - D√ºzeltildi)</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --n-color: #ff0000; /* Tam Kƒ±rmƒ±zƒ± */
            --s-color: #0044ff; /* Tam Mavi */
            --bg-color: #f0f2f5;
            --unknown-color: #b2bec3;
        }

        body {
            font-family: 'Comic Neue', cursive;
            background-color: var(--bg-color);
            margin: 0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            touch-action: none;
        }

        /* --- MEN√ú --- */
        .nav-container {
            display: flex; gap: 5px; margin-bottom: 5px; flex-wrap: wrap; justify-content: center; width: 100%;
        }
        .nav-btn {
            padding: 8px 15px; border: none; border-radius: 20px; cursor: pointer;
            font-size: 0.9rem; font-weight: bold; color: #555; background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.2s; min-width: 90px;
        }
        .nav-btn.active { background: #2c3e50; color: white; transform: scale(1.05); }

        /* --- PANELLER --- */
        .panel { display: none; width: 100%; max-width: 900px; height: 90vh; animation: fadeIn 0.3s; }
        .panel.active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        .card {
            background: white; border-radius: 15px; height: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative;
            border: 2px solid #ccc; overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        .header {
            background: #dfe6e9; padding: 10px; text-align: center; 
            font-size: 1.1rem; font-weight: bold; color: #2d3436; border-bottom: 2px solid #b2bec3;
        }

        .workspace {
            flex: 1; position: relative; overflow: hidden;
            background-image: radial-gradient(#b2bec3 2px, transparent 2px);
            background-size: 20px 20px;
            touch-action: none;
        }

        /* --- MIKNATIS STƒ∞LLERƒ∞ --- */
        .pole { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            height: 100%; width: 100%; color: white; font-size: 1.2rem; 
            text-shadow: 1px 1px 2px black;
        }
        .pole.n { background: var(--n-color); border-right: 1px solid white; }
        .pole.s { background: var(--s-color); border-left: 1px solid white; }
        
        /* Lab Mƒ±knatƒ±sƒ± */
        .lab-mag {
            position: absolute; display: flex; width: 140px; height: 40px;
            border-radius: 4px; border: 2px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: bold; cursor: grab; z-index: 10;
            /* Donanƒ±m hƒ±zlandƒ±rma i√ßin */
            transform: translate3d(0,0,0);
        }

        /* Soru Mƒ±knatƒ±slarƒ± (Gizlenebilir) */
        .q-mag {
            position: absolute; display: flex; border: 2px solid #555;
            font-weight: bold; color: white; border-radius: 4px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .q-mag.vertical { width: 60px; height: 90px; flex-direction: column; }
        .q-mag.horizontal { width: 90px; height: 35px; flex-direction: row; }
        
        .hidden-mag .pole { background: var(--unknown-color) !important; color: #636e72; text-shadow: none; border:none; }
        .hidden-mag .pole::after { content: '?'; font-size: 1.5rem; }
        .hidden-mag .pole.n, .hidden-mag .pole.s { content: ''; } 

        /* Kontrol Paneli (Sorular ƒ∞√ßin) */
        .control-board {
            background: #eee; padding: 10px; border-top: 3px solid #b2bec3;
            display: flex; flex-direction: column; gap: 8px; z-index: 20;
        }
        .ctrl-row {
            display: flex; align-items: center; justify-content: center; gap: 5px; flex-wrap: wrap;
        }
        .ctrl-label { font-weight: bold; font-size: 0.85rem; min-width: 60px; text-align: right; }
        .pole-btn {
            padding: 5px 10px; border: 2px solid #aaa; border-radius: 6px; cursor: pointer;
            font-size: 0.8rem; font-weight: bold; background: white;
        }
        .pole-btn.active { background: #2d3436; color: white; border-color: #333; }
        
        /* Lab Kontrolleri */
        .lab-controls { padding: 10px; background: #eee; display: flex; justify-content: center; gap: 10px; }
        .l-btn { padding: 8px 15px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }

        /* Yay ve ƒ∞p */
        #spring-path { fill: none; stroke: #2d3436; stroke-width: 4; stroke-linecap: round; stroke-linejoin: round; }
        .pendulum {
            position: absolute; top: 0; width: 40px; height: 220px;
            transform-origin: top center; display: flex; justify-content: center;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: grab;
        }
        .pendulum-string { width: 3px; height: 100%; background: #2d3436; pointer-events: none; }
        .drag-handle {
            position: absolute; top: 0; width: 40px; height: 40px; background: rgba(0,0,0,0.05); 
            border-radius: 50%; cursor: ew-resize; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: #555;
        }
        
        /* Galeri */
        .gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; overflow-y: auto; }
        .gallery-item { text-align: center; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

    </style>
</head>
<body>

    <div class="nav-container">
        <button class="nav-btn active" onclick="showTab(1)">1. Lab</button>
        <button class="nav-btn" onclick="showTab(2)">2. Yay Sorusu</button>
        <button class="nav-btn" onclick="showTab(3)">3. ƒ∞p Sorusu</button>
        <button class="nav-btn" onclick="showTab(4)">4. √áe≈üitler</button>
    </div>

    <div id="tab1" class="panel active">
        <div class="card">
            <div class="header">Serbest Deney Alanƒ± (U√ß Uca Yapƒ±≈üma)</div>
            <div class="workspace" id="lab-space"></div>
            <div class="lab-controls">
                <button class="l-btn" style="background:#27ae60" onclick="labAdd()">‚ûï Ekle</button>
                <button class="l-btn" id="btn-break" style="background:#f39c12" onclick="labToggleBreak()">üî® Kƒ±r</button>
                <button class="l-btn" id="btn-del" style="background:#c0392b" onclick="labToggleDel()">üóëÔ∏è Sil</button>
                <button class="l-btn" style="background:#7f8c8d" onclick="labClear()">Temizle</button>
            </div>
        </div>
    </div>

    <div id="tab2" class="panel">
        <div class="card">
            <div class="header">Yay Sorusu</div>
            <div class="workspace" id="spring-space">
                <svg width="60" height="600" style="position:absolute; left:50%; transform:translateX(-50%); overflow:visible;">
                    <path id="spring-path" d="" />
                </svg>
                <div id="s-top" class="q-mag vertical" style="top:50px; left:50%; transform:translateX(-50%);">
                    <div class="pole s">S</div><div class="pole n">N</div>
                </div>
                <div id="s-bot" class="q-mag vertical" style="top:300px; left:50%; transform:translateX(-50%); cursor:ns-resize;">
                    <div class="pole s">S</div><div class="pole n">N</div>
                </div>
            </div>
            
            <div class="control-board">
                <div class="ctrl-row">
                    <span class="ctrl-label">1. Mƒ±knatƒ±s:</span>
                    <button class="pole-btn" id="btn-st-ns" onclick="setSpringState('top', 'ns')">N-S</button>
                    <button class="pole-btn" id="btn-st-sn" onclick="setSpringState('top', 'sn')">S-N</button>
                    <button class="pole-btn" id="btn-st-hide" onclick="setSpringState('top', 'hide')">Gƒ∞ZLE</button>
                </div>
                <div class="ctrl-row">
                    <span class="ctrl-label">2. Mƒ±knatƒ±s:</span>
                    <button class="pole-btn" id="btn-sb-ns" onclick="setSpringState('bot', 'ns')">N-S</button>
                    <button class="pole-btn" id="btn-sb-sn" onclick="setSpringState('bot', 'sn')">S-N</button>
                    <button class="pole-btn" id="btn-sb-hide" onclick="setSpringState('bot', 'hide')">Gƒ∞ZLE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab3" class="panel">
        <div class="card">
            <div class="header">3'l√º Sarka√ß Sorusu</div>
            <div class="workspace" id="string-space">
                <div style="width:100%; height:15px; background:#2d3436;"></div>
                
                <div id="p1" class="pendulum" style="left:20%;">
                    <div class="drag-handle">‚Üî</div><div class="pendulum-string"></div>
                    <div class="q-mag horizontal" style="bottom:0;" id="m1">
                        <div class="pole n">N</div><div class="pole s">S</div>
                    </div>
                </div>
                <div id="p2" class="pendulum" style="left:50%;">
                    <div class="drag-handle">‚Üî</div><div class="pendulum-string"></div>
                    <div class="q-mag horizontal" style="bottom:0;" id="m2">
                        <div class="pole n">N</div><div class="pole s">S</div>
                    </div>
                </div>
                <div id="p3" class="pendulum" style="left:80%;">
                    <div class="drag-handle">‚Üî</div><div class="pendulum-string"></div>
                    <div class="q-mag horizontal" style="bottom:0;" id="m3">
                        <div class="pole n">N</div><div class="pole s">S</div>
                    </div>
                </div>
            </div>

            <div class="control-board">
                <div class="ctrl-row">
                    <span class="ctrl-label">1. (Sol):</span>
                    <button class="pole-btn" id="btn-p1-ns" onclick="setStringState(1, 'ns')">N-S</button>
                    <button class="pole-btn" id="btn-p1-sn" onclick="setStringState(1, 'sn')">S-N</button>
                    <button class="pole-btn" id="btn-p1-hide" onclick="setStringState(1, 'hide')">?</button>
                </div>
                <div class="ctrl-row">
                    <span class="ctrl-label">2. (Orta):</span>
                    <button class="pole-btn" id="btn-p2-ns" onclick="setStringState(2, 'ns')">N-S</button>
                    <button class="pole-btn" id="btn-p2-sn" onclick="setStringState(2, 'sn')">S-N</button>
                    <button class="pole-btn" id="btn-p2-hide" onclick="setStringState(2, 'hide')">?</button>
                </div>
                <div class="ctrl-row">
                    <span class="ctrl-label">3. (Saƒü):</span>
                    <button class="pole-btn" id="btn-p3-ns" onclick="setStringState(3, 'ns')">N-S</button>
                    <button class="pole-btn" id="btn-p3-sn" onclick="setStringState(3, 'sn')">S-N</button>
                    <button class="pole-btn" id="btn-p3-hide" onclick="setStringState(3, 'hide')">?</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab4" class="panel">
        <div class="card">
            <div class="header">Mƒ±knatƒ±s √áe≈üitleri</div>
            <div class="workspace">
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <svg width="80" height="100" viewBox="0 0 100 120" style="margin:auto;">
                            <path d="M20,10 L20,80 Q20,120 50,120 Q80,120 80,80 L80,10 H60 L60,80 Q60,100 50,100 Q40,100 40,80 L40,10 Z" fill="#b2bec3" stroke="#333" stroke-width="2"/>
                            <rect x="20" y="10" width="20" height="40" fill="#ff0000" />
                            <text x="30" y="35" fill="white" font-weight="bold" text-anchor="middle">N</text>
                            <rect x="60" y="10" width="20" height="40" fill="#0044ff" />
                            <text x="70" y="35" fill="white" font-weight="bold" text-anchor="middle">S</text>
                        </svg>
                        <div style="font-weight:bold; margin-top:5px;">U Mƒ±knatƒ±s</div>
                    </div>
                    <div class="gallery-item">
                        <div style="width:100%; height:30px; display:flex; margin:20px auto; border-radius:4px; overflow:hidden; border:1px solid #333;">
                            <div style="width:50%; background:#ff0000; color:white; font-weight:bold; display:flex; justify-content:center; align-items:center; border-right:2px solid white;">N</div>
                            <div style="width:50%; background:#0044ff; color:white; font-weight:bold; display:flex; justify-content:center; align-items:center;">S</div>
                        </div>
                        <div style="font-weight:bold;">√áubuk Mƒ±knatƒ±s</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(idx) {
            document.querySelectorAll('.panel').forEach((p, i) => p.classList.toggle('active', i === idx-1));
            document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', i === idx-1));
            if(idx===2) updateSpring();
            if(idx===3) updateString();
        }

        /* ----------------------------------------------------
           1. LABORATUVAR (Fƒ∞Zƒ∞K MOTORU D√úZELTƒ∞LDƒ∞)
           ---------------------------------------------------- */
        const labSpace = document.getElementById('lab-space');
        let labMagnets = []; let labMode = 'move';

        function labToggleBreak() { labMode=(labMode==='break')?'move':'break'; updateLabUI(); }
        function labToggleDel() { labMode=(labMode==='delete')?'move':'delete'; updateLabUI(); }
        function updateLabUI() {
            document.getElementById('btn-break').style.border = (labMode==='break')?'3px solid #333':'none';
            document.getElementById('btn-del').style.border = (labMode==='delete')?'3px solid #333':'none';
        }

        class LabMagnet {
            constructor(x, y, w, h) {
                this.x=x; this.y=y; this.w=w||140; this.h=h||40; this.vx=0; this.vy=0; this.flipped=false; this.dragging=false;
                this.el=document.createElement('div'); this.el.className='lab-mag'; this.render();
                this.el.addEventListener('mousedown', e=>this.start(e));
                this.el.addEventListener('touchstart', e=>this.start(e), {passive:false});
                this.el.addEventListener('dblclick', ()=>{ if(labMode==='move'){ this.flipped=!this.flipped; this.render(); } });
                labSpace.appendChild(this.el); this.update();
            }
            render() {
                this.el.style.width=this.w+'px'; this.el.style.height=this.h+'px';
                this.el.innerHTML = this.flipped ? 
                    `<div class="pole s">S</div><div class="pole n">N</div>` : 
                    `<div class="pole n">N</div><div class="pole s">S</div>`;
            }
            start(e) {
                if(e.type==='touchstart') e.preventDefault(); e.stopPropagation();
                if(labMode==='delete') { this.destroy(); return; }
                if(labMode==='break') {
                    if(this.w<60) return; this.destroy();
                    let nw=(this.w/2)-5;
                    let m1=new LabMagnet(this.x, this.y, nw, this.h);
                    let m2=new LabMagnet(this.x+nw+10, this.y, nw, this.h);
                    m1.flipped=this.flipped; m2.flipped=this.flipped; m1.vx=-2; m2.vx=2;
                    labMagnets.push(m1,m2); return;
                }
                this.dragging=true;
                const cx=e.clientX||e.touches[0].clientX; const cy=e.clientY||e.touches[0].clientY;
                this.ox=cx-this.x; this.oy=cy-this.y;
            }
            destroy() { this.el.remove(); labMagnets=labMagnets.filter(m=>m!==this); }
            update() { this.el.style.left=this.x+'px'; this.el.style.top=this.y+'px'; }
        }

        function labMove(e) {
            const cx=e.clientX||(e.touches?e.touches[0].clientX:0);
            const cy=e.clientY||(e.touches?e.touches[0].clientY:0);
            labMagnets.forEach(m=>{ if(m.dragging){ m.x=cx-m.ox; m.y=cy-m.oy; m.update(); }});
        }
        window.addEventListener('mousemove', labMove); window.addEventListener('touchmove', labMove, {passive:false});
        window.addEventListener('mouseup', ()=>labMagnets.forEach(m=>m.dragging=false)); 
        window.addEventListener('touchend', ()=>labMagnets.forEach(m=>m.dragging=false));
        
        function labAdd() { labMagnets.push(new LabMagnet(50+Math.random()*100, 50+Math.random()*100)); }
        function labClear() { labMagnets.forEach(m=>m.el.remove()); labMagnets=[]; }

        // Fƒ∞Zƒ∞K MOTORU (Sola kayma ve Yapƒ±≈üma D√ºzeltildi)
        function labLoop() {
            // √ñnce Kuvvetleri Hesapla
            for(let i=0; i<labMagnets.length; i++){
                let m1=labMagnets[i];
                if(m1.dragging) continue;

                // S√ºrt√ºnme (Durmasƒ± i√ßin)
                m1.vx *= 0.9; m1.vy *= 0.9;
                if(Math.abs(m1.vx)<0.1) m1.vx=0;
                if(Math.abs(m1.vy)<0.1) m1.vy=0;

                for(let j=0; j<labMagnets.length; j++){
                    if(i===j) continue; let m2=labMagnets[j];
                    
                    // U√ß Uca Kenetlenme (Snap)
                    let yDist = Math.abs((m1.y+m1.h/2)-(m2.y+m2.h/2));
                    // m1 Saƒü vs m2 Sol
                    if(yDist<20 && Math.abs(m2.x - (m1.x+m1.w)) < 20) {
                        let p1R = m1.flipped ? 'N' : 'S'; let p2L = m2.flipped ? 'S' : 'N';
                        if(p1R !== p2L) { // ZIT
                             m1.x = m2.x - m1.w; m1.y = m2.y; m1.vx=0; m1.vy=0; continue;
                        }
                    }
                    // m1 Sol vs m2 Saƒü
                    if(yDist<20 && Math.abs(m1.x - (m2.x+m2.w)) < 20) {
                        let p1L = m1.flipped ? 'S' : 'N'; let p2R = m2.flipped ? 'N' : 'S';
                        if(p1L !== p2R) {
                             m1.x = m2.x + m2.w; m1.y = m2.y; m1.vx=0; m1.vy=0; continue;
                        }
                    }

                    // Uzaktan Fizik
                    let dx=(m2.x+m2.w/2)-(m1.x+m1.w/2); let dy=(m2.y+m2.h/2)-(m1.y+m1.h/2);
                    let dist=Math.sqrt(dx*dx+dy*dy);
                    if(dist<50 || dist>250) continue;
                    
                    let isM2Right = (m2.x+m2.w/2) > (m1.x+m1.w/2);
                    let p1Side = isM2Right ? (m1.flipped?'N':'S') : (m1.flipped?'S':'N');
                    let p2Side = isM2Right ? (m2.flipped?'S':'N') : (m2.flipped?'N':'S');
                    
                    let attract = (p1Side !== p2Side);
                    let force = 2000 / (dist*dist); // Kuvvet
                    let fx = (dx/dist)*force; let fy = (dy/dist)*force;

                    if(attract) { m1.vx += fx; m1.vy += fy; } 
                    else { m1.vx -= fx; m1.vy -= fy; }
                }
            }
            // Konum G√ºncelle
            for(let i=0; i<labMagnets.length; i++){
                let m=labMagnets[i];
                if(m.dragging) continue;
                m.x += m.vx; m.y += m.vy;
                // Duvarlar
                if(m.x<0) m.x=0; if(m.y<0) m.y=0;
                if(m.x > labSpace.clientWidth-m.w) m.x = labSpace.clientWidth-m.w;
                if(m.y > labSpace.clientHeight-m.h) m.y = labSpace.clientHeight-m.h;
                m.update();
            }
            requestAnimationFrame(labLoop);
        }
        labAdd(); labAdd(); labLoop();


        /* ----------------------------------------------------
           2. YAY KONTROL Sƒ∞STEMƒ∞
           ---------------------------------------------------- */
        const sTop = document.getElementById('s-top');
        const sBot = document.getElementById('s-bot');
        const sPath = document.getElementById('spring-path');
        let sDragging=false; 
        let sTopSt='ns', sBotSt='ns'; // ns, sn, hide
        let sTopReal='ns', sBotReal='ns'; // gizli olsa bile fizik i√ßin

        sBot.addEventListener('mousedown', ()=>sDragging=true);
        sBot.addEventListener('touchstart', (e)=>{e.preventDefault(); sDragging=true;}, {passive:false});
        function springMove(e) {
            if(!sDragging) return;
            const cy=e.clientY||e.touches[0].clientY;
            let rect=document.getElementById('spring-space').getBoundingClientRect();
            let y=cy-rect.top-45; if(y<180) y=180; if(y>400) y=400;
            sBot.style.top=y+'px'; updateSpring();
        }
        document.getElementById('spring-space').addEventListener('mousemove', springMove);
        document.getElementById('spring-space').addEventListener('touchmove', springMove, {passive:false});
        window.addEventListener('mouseup', ()=>sDragging=false);
        window.addEventListener('touchend', ()=>sDragging=false);

        function setSpringState(w, st) {
            // Butonlarƒ± g√ºncelle
            const pfx = (w==='top') ? 'btn-st' : 'btn-sb';
            document.getElementById(pfx+'-ns').classList.remove('active');
            document.getElementById(pfx+'-sn').classList.remove('active');
            document.getElementById(pfx+'-hide').classList.remove('active');
            document.getElementById(pfx+'-'+st).classList.add('active');

            if(w==='top') { sTopSt=st; if(st!=='hide') sTopReal=st; else sTopReal=(Math.random()<0.5)?'ns':'sn'; }
            else { sBotSt=st; if(st!=='hide') sBotReal=st; else sBotReal=(Math.random()<0.5)?'ns':'sn'; }
            renderSpring(); updateSpring();
        }

        function renderSpring() {
            function r(m, st) {
                if(st==='hide') { m.className='q-mag vertical hidden-mag'; m.innerHTML=`<div class="pole"></div>`; }
                else { m.className='q-mag vertical'; m.innerHTML=(st==='sn')?`<div class="pole n">N</div><div class="pole s">S</div>`:`<div class="pole s">S</div><div class="pole n">N</div>`; }
            }
            r(sTop, sTopSt); r(sBot, sBotSt);
        }

        function updateSpring() {
            let fT = (sTopReal==='ns') ? 'N' : 'S'; // Alt Y√ºz√º
            let fB = (sBotReal==='ns') ? 'S' : 'N'; // √úst Y√ºz√º
            let attract = (fT !== fB);

            let tY=140; let bY=parseInt(sBot.style.top); let dist=bY-tY;
            let offset=0;
            if(dist<150) {
                let f=(150-dist)/2;
                offset = attract ? f : -f; 
            }
            let nTY = 50 + offset; sTop.style.top=nTY+'px';

            let coils=10; let path=`M30,0 L30,20`;
            for(let i=0; i<coils; i++){
                let x=(i%2===0)?50:10; let y=20+(i*(nTY-20)/coils);
                path+=` L${x},${y}`;
            }
            path+=` L30,${nTY}`; sPath.setAttribute('d', path);
        }
        setSpringState('top', 'ns'); setSpringState('bot', 'ns');

        /* ----------------------------------------------------
           3. ƒ∞P KONTROL Sƒ∞STEMƒ∞ (D√úZELTƒ∞LDƒ∞)
           ---------------------------------------------------- */
        const p1=document.getElementById('p1'), p2=document.getElementById('p2'), p3=document.getElementById('p3');
        const m1=document.getElementById('m1'), m2=document.getElementById('m2'), m3=document.getElementById('m3');
        let dragP=null;
        let st1='hide', st2='hide', st3='hide';
        let r1='ns', r2='ns', r3='ns';

        [p1, p2, p3].forEach(p => {
            p.addEventListener('mousedown', (e)=>{ e.stopPropagation(); dragP=p; });
            p.addEventListener('touchstart', (e)=>{ e.preventDefault(); e.stopPropagation(); dragP=p; }, {passive:false});
        });
        const strSpace = document.getElementById('string-space');
        function moveString(e) {
            if(!dragP) return;
            const cx=e.clientX||(e.touches?e.touches[0].clientX:0);
            let rect = strSpace.getBoundingClientRect();
            let x = ((cx - rect.left)/rect.width)*100;
            if(x<5) x=5; if(x>95) x=95;
            dragP.style.left = x+'%';
            updateString();
        }
        strSpace.addEventListener('mousemove', moveString); strSpace.addEventListener('touchmove', moveString, {passive:false});
        window.addEventListener('mouseup', ()=>dragP=null); window.addEventListener('touchend', ()=>dragP=null);

        function setStringState(idx, state) {
            const pfx = 'btn-p'+idx;
            document.getElementById(pfx+'-ns').classList.remove('active');
            document.getElementById(pfx+'-sn').classList.remove('active');
            document.getElementById(pfx+'-hide').classList.remove('active');
            document.getElementById(pfx+'-'+state).classList.add('active');

            if(idx===1) { st1=state; if(state!=='hide') r1=state; else r1=(Math.random()<0.5)?'ns':'sn'; }
            if(idx===2) { st2=state; if(state!=='hide') r2=state; else r2=(Math.random()<0.5)?'ns':'sn'; }
            if(idx===3) { st3=state; if(state!=='hide') r3=state; else r3=(Math.random()<0.5)?'ns':'sn'; }
            renderString(); updateString();
        }

        function renderString() {
            function r(m, st) {
                if(st==='hide') { m.className='q-mag horizontal hidden-mag'; m.innerHTML=`<div class="pole"></div>`; }
                else { m.className='q-mag horizontal'; m.innerHTML=(st==='sn')?`<div class="pole s">S</div><div class="pole n">N</div>`:`<div class="pole n">N</div><div class="pole s">S</div>`; }
            }
            r(m1, st1); r(m2, st2); r(m3, st3);
        }

        function updateString() {
            let f1R = (r1==='ns') ? 'S' : 'N';
            let f2L = (r2==='ns') ? 'N' : 'S';
            let f2R = (r2==='ns') ? 'S' : 'N';
            let f3L = (r3==='ns') ? 'N' : 'S';

            let att12 = (f1R !== f2L); // ZIT KUTUPLAR (√áEKME)
            let att23 = (f2R !== f3L); // ZIT KUTUPLAR (√áEKME)

            let x1=parseFloat(p1.style.left); let x2=parseFloat(p2.style.left); let x3=parseFloat(p3.style.left);
            let d12=x2-x1; let d23=x3-x2;
            let a1=0, a2L=0, a2R=0, a3=0;

            // 1. ve 2. Mƒ±knatƒ±s Etkile≈üimi
            if(Math.abs(d12)<25) {
                let deg=(25-Math.abs(d12))*0.8;
                if(att12) { 
                    // √áEKME (Zƒ±t): 1. saƒüa d√∂nmeli (negatif), 2. sola d√∂nmeli (pozitif)
                    a1 = -deg; 
                    a2L = deg; 
                } else { 
                    // ƒ∞TME (Aynƒ±): 1. sola d√∂nmeli (pozitif), 2. saƒüa d√∂nmeli (negatif)
                    a1 = deg; 
                    a2L = -deg; 
                }
            }
            
            // 2. ve 3. Mƒ±knatƒ±s Etkile≈üimi
            if(Math.abs(d23)<25) {
                let deg=(25-Math.abs(d23))*0.8;
                if(att23) { 
                    // √áEKME (Zƒ±t): 2. saƒüa d√∂nmeli (negatif), 3. sola d√∂nmeli (pozitif)
                    a2R = -deg; 
                    a3 = deg; 
                } else { 
                    // ƒ∞TME (Aynƒ±): 2. sola d√∂nmeli (pozitif), 3. saƒüa d√∂nmeli (negatif)
                    a2R = deg; 
                    a3 = -deg; 
                }
            }
            
            p1.style.transform=`rotate(${a1}deg)`;
            // 2. mƒ±knatƒ±s her iki taraftan da etkilendiƒüi i√ßin a√ßƒ±larƒ± topluyoruz
            p2.style.transform=`rotate(${a2L+a2R}deg)`;
            p3.style.transform=`rotate(${a3}deg)`;
        }
        setStringState(1, 'ns'); setStringState(2, 'hide'); setStringState(3, 'sn');

    </script>
</body>
</html>
