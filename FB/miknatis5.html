<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fen Bilimleri: MÄ±knatÄ±s UstasÄ± (V11 - Kenetlenme)</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --n-color: #e74c3c; /* KÄ±rmÄ±zÄ± */
            --s-color: #2980b9; /* Mavi */
            --bg-color: #f1f2f6;
            --accent: #27ae60;
        }

        body {
            font-family: 'Comic Neue', cursive;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        /* --- ÃœST MENÃœ --- */
        .nav-container {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;
        }
        .nav-btn {
            padding: 12px 20px; border: none; border-radius: 50px; cursor: pointer;
            font-size: 1.1rem; font-weight: bold; color: #555; background: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); transition: 0.2s;
        }
        .nav-btn.active { background: #2c3e50; color: white; transform: translateY(2px); box-shadow: none; }

        /* --- PANELLER --- */
        .panel { display: none; width: 100%; max-width: 1000px; height: 600px; animation: fadeIn 0.3s; }
        .panel.active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        .card {
            background: white; border-radius: 20px; height: 100%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); position: relative;
            border: 4px solid #34495e; overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        .header {
            background: #ecf0f1; padding: 15px; text-align: center; 
            font-size: 1.4rem; font-weight: bold; color: #2c3e50; border-bottom: 2px solid #bdc3c7;
        }

        .workspace {
            flex: 1; position: relative; overflow: hidden;
            background-image: radial-gradient(#bdc3c7 2px, transparent 2px);
            background-size: 30px 30px;
        }

        .controls {
            padding: 15px; background: #eee; display: flex; justify-content: center; gap: 15px;
        }
        
        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            font-weight: bold; font-family: inherit; color: white; box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-green { background: #27ae60; }
        .btn-orange { background: #f39c12; }
        .btn-red { background: #c0392b; }
        .btn-gray { background: #7f8c8d; }
        .mode-active { border: 3px solid #333; transform: scale(0.95); box-shadow: none; }

        /* --- MIKNATIS GÃ–RSELLERÄ° --- */
        .pole { flex: 1; display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; }
        .pole.n { background: var(--n-color); }
        .pole.s { background: var(--s-color); }
        
        /* Laboratuvar MÄ±knatÄ±sÄ± */
        .lab-mag {
            position: absolute; display: flex; width: 140px; height: 40px;
            border-radius: 4px; border: 2px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            font-size: 1.2rem; font-weight: bold; color: white; cursor: grab; z-index: 10;
        }
        .lab-mag:active { cursor: grabbing; z-index: 100; }

        /* Soru MÄ±knatÄ±slarÄ± */
        .q-mag {
            position: absolute; display: flex; border: 2px solid #555;
            font-size: 1.2rem; font-weight: bold; color: white; border-radius: 4px; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        .q-mag.vertical { width: 80px; height: 100px; flex-direction: column; }
        .q-mag.horizontal { width: 100px; height: 40px; flex-direction: row; }

        /* Yay ve Ä°p */
        #spring-path { fill: none; stroke: #34495e; stroke-width: 5; stroke-linecap: round; stroke-linejoin: round; }
        
        .pendulum {
            position: absolute; top: 0; width: 4px; height: 280px; transform-origin: top center;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .string { width: 2px; height: 100%; background: #333; margin: 0 auto; }

        /* Galeri */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; padding: 20px; }
        .gallery-item { text-align: center; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

    </style>
</head>
<body>

    <div class="nav-container">
        <button class="nav-btn active" onclick="showTab(1)">1. Serbest Laboratuvar</button>
        <button class="nav-btn" onclick="showTab(2)">2. Yay Sorusu</button>
        <button class="nav-btn" onclick="showTab(3)">3. Ä°p Sorusu</button>
        <button class="nav-btn" onclick="showTab(4)">4. MÄ±knatÄ±s Ã‡eÅŸitleri</button>
    </div>

    <div id="tab1" class="panel active">
        <div class="card">
            <div class="header">Serbest Deney AlanÄ± (UÃ§ Uca YapÄ±ÅŸma)</div>
            <div class="workspace" id="lab-space"></div>
            <div class="controls">
                <button class="btn btn-green" onclick="labAdd()">â• Ekle</button>
                <button class="btn btn-orange" id="btn-break" onclick="labToggleBreak()">ğŸ”¨ KÄ±rma Modu</button>
                <button class="btn btn-red" id="btn-del" onclick="labToggleDel()">ğŸ—‘ï¸ Silme Modu</button>
                <button class="btn btn-gray" onclick="labClear()">âœ¨ Temizle</button>
            </div>
            <div style="text-align:center; padding-bottom:5px; font-size:0.9rem; color:#777;">Ã‡evirmek iÃ§in mÄ±knatÄ±sa <b>Ã§ift tÄ±klayÄ±n</b>.</div>
        </div>
    </div>

    <div id="tab2" class="panel">
        <div class="card">
            <div class="header">Yay UzamasÄ± / KÄ±salmasÄ±</div>
            <div class="workspace" id="spring-space">
                <svg width="60" height="500" style="position:absolute; left:50%; transform:translateX(-50%); overflow:visible;">
                    <path id="spring-path" d="" />
                </svg>
                <div id="s-top" class="q-mag vertical" style="top:120px; left:50%; transform:translateX(-50%);">
                    <div class="pole s">S</div><div class="pole n">N</div>
                </div>
                <div id="s-bot" class="q-mag vertical" style="top:350px; left:50%; transform:translateX(-50%); cursor:ns-resize;">
                    <div class="pole s">S</div><div class="pole n">N</div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-orange" onclick="flipSpring('top')">Ãœst MÄ±knatÄ±sÄ± Ã‡evir ğŸ”„</button>
                <button class="btn btn-green" onclick="flipSpring('bot')">Alt MÄ±knatÄ±sÄ± Ã‡evir ğŸ”„</button>
            </div>
        </div>
    </div>

    <div id="tab3" class="panel">
        <div class="card">
            <div class="header">SarkaÃ§ Deneyi</div>
            <div class="workspace" id="string-space">
                <div style="width:100%; height:20px; background:#333;"></div>
                
                <div id="p-left" class="pendulum" style="left:30%;">
                    <div class="string"></div>
                    <div class="q-mag horizontal" style="bottom:0; left:-50px;" id="pm-left">
                        <div class="pole n">N</div><div class="pole s">S</div>
                    </div>
                </div>

                <div id="p-right" class="pendulum" style="left:70%; cursor:ew-resize;">
                    <div style="position:absolute; top:50%; background:#eee; padding:2px 5px; border-radius:5px; font-size:0.8rem; pointer-events:none;">â†” SÃ¼rÃ¼kle</div>
                    <div class="string"></div>
                    <div class="q-mag horizontal" style="bottom:0; left:-50px;" id="pm-right">
                        <div class="pole n">N</div><div class="pole s">S</div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-orange" onclick="flipPendulum('left')">Sol MÄ±knatÄ±sÄ± Ã‡evir ğŸ”„</button>
                <button class="btn btn-green" onclick="flipPendulum('right')">SaÄŸ MÄ±knatÄ±sÄ± Ã‡evir ğŸ”„</button>
            </div>
        </div>
    </div>

    <div id="tab4" class="panel">
        <div class="card">
            <div class="header">MÄ±knatÄ±s Ã‡eÅŸitleri</div>
            <div class="workspace" style="overflow-y:auto;">
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <svg width="100" height="120" viewBox="0 0 100 120" style="margin:auto;">
                            <path d="M15,120 V50 C15,10 85,10 85,50 V120 H65 V50 C65,30 35,30 35,50 V120 Z" fill="#ccc" stroke="#333" stroke-width="2"/>
                            <path d="M15,120 V90 H35 V120 Z" fill="#e74c3c"/>
                            <path d="M85,120 V90 H65 V120 Z" fill="#2980b9"/>
                            <text x="20" y="110" fill="white" font-weight="bold">N</text>
                            <text x="70" y="110" fill="white" font-weight="bold">S</text>
                        </svg>
                        <div>U MÄ±knatÄ±s</div>
                    </div>
                    <div class="gallery-item">
                        <div style="width:120px; height:30px; display:flex; margin:45px auto; border-radius:4px; overflow:hidden;">
                            <div style="width:50%; background:#e74c3c; color:white; font-weight:bold; display:flex; justify-content:center; align-items:center;">N</div>
                            <div style="width:50%; background:#2980b9; color:white; font-weight:bold; display:flex; justify-content:center; align-items:center;">S</div>
                        </div>
                        <div>Ã‡ubuk MÄ±knatÄ±s</div>
                    </div>
                     <div class="gallery-item">
                        <div style="width:70px; height:70px; border-radius:50%; background:radial-gradient(#999, #333); margin:25px auto;"></div>
                        <div>Yuvarlak MÄ±knatÄ±s</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(idx) {
            document.querySelectorAll('.panel').forEach((p, i) => { p.classList.toggle('active', i === idx-1); });
            document.querySelectorAll('.nav-btn').forEach((b, i) => { b.classList.toggle('active', i === idx-1); });
            if(idx === 2) updateSpring();
            if(idx === 3) updatePendulum();
        }

        /* --- 1. LABORATUVAR (GELÄ°ÅMÄ°Å YAPIÅMA FÄ°ZÄ°ÄÄ°) --- */
        const labSpace = document.getElementById('lab-space');
        let labMagnets = []; let labMode = 'move';

        function labToggleBreak() { labMode=(labMode==='break')?'move':'break'; updateLabBtn(); }
        function labToggleDel() { labMode=(labMode==='delete')?'move':'delete'; updateLabBtn(); }
        function updateLabBtn() {
            document.getElementById('btn-break').classList.remove('mode-active');
            document.getElementById('btn-del').classList.remove('mode-active');
            labSpace.style.cursor='default';
            if(labMode==='break') { document.getElementById('btn-break').classList.add('mode-active'); labSpace.style.cursor='crosshair'; }
            if(labMode==='delete') { document.getElementById('btn-del').classList.add('mode-active'); labSpace.style.cursor='not-allowed'; }
        }

        class LabMagnet {
            constructor(x, y, w, h) {
                this.x=x; this.y=y; this.w=w||140; this.h=h||40; this.vx=0; this.vy=0; this.flipped=false; this.dragging=false;
                this.el=document.createElement('div'); this.el.className='lab-mag'; this.render();
                this.el.addEventListener('mousedown', e=>this.start(e));
                this.el.addEventListener('touchstart', e=>this.start(e), {passive:false});
                this.el.addEventListener('dblclick', ()=>{ if(labMode==='move'){ this.flipped=!this.flipped; this.render(); } });
                labSpace.appendChild(this.el); this.update();
            }
            render() {
                this.el.style.width=this.w+'px'; this.el.style.height=this.h+'px';
                this.el.innerHTML = this.flipped ? `<div class="pole s">S</div><div class="pole n">N</div>` : `<div class="pole n">N</div><div class="pole s">S</div>`;
            }
            start(e) {
                e.stopPropagation();
                if(labMode==='delete') { this.destroy(); return; }
                if(labMode==='break') {
                    if(this.w<60) return; this.destroy();
                    let nw=(this.w/2)-5;
                    let m1=new LabMagnet(this.x, this.y, nw, this.h);
                    let m2=new LabMagnet(this.x+nw+10, this.y, nw, this.h);
                    m1.flipped=this.flipped; m2.flipped=this.flipped; m1.vx=-3; m2.vx=3;
                    labMagnets.push(m1,m2); return;
                }
                this.dragging=true;
                const cx=e.clientX||e.touches[0].clientX; const cy=e.clientY||e.touches[0].clientY;
                this.ox=cx-this.x; this.oy=cy-this.y;
            }
            destroy() { this.el.remove(); labMagnets=labMagnets.filter(m=>m!==this); }
            update() { this.el.style.left=this.x+'px'; this.el.style.top=this.y+'px'; }
        }
        function labAdd() { labMagnets.push(new LabMagnet(50+Math.random()*200, 50+Math.random()*200)); }
        function labClear() { labMagnets.forEach(m=>m.el.remove()); labMagnets=[]; }

        window.addEventListener('mousemove', e=>{ labMagnets.forEach(m=>{ if(m.dragging){ m.x=e.clientX-m.ox; m.y=e.clientY-m.oy; m.update(); }})});
        window.addEventListener('mouseup', ()=> labMagnets.forEach(m=>m.dragging=false));
        window.addEventListener('touchmove', e=>{ labMagnets.forEach(m=>{ if(m.dragging){ m.x=e.touches[0].clientX-m.ox; m.y=e.touches[0].clientY-m.oy; m.update(); }})}, {passive:false});
        window.addEventListener('touchend', ()=> labMagnets.forEach(m=>m.dragging=false));

        // GELÄ°ÅMÄ°Å FÄ°ZÄ°K: KENETLENME (SNAP)
        function labLoop() {
            for(let i=0; i<labMagnets.length; i++){
                let m1=labMagnets[i];
                if(m1.dragging) continue; // Tutulan hareket etmez, el kontrolÃ¼nde

                for(let j=0; j<labMagnets.length; j++){
                    if(i===j) continue; let m2=labMagnets[j];

                    // KutuplarÄ± Belirle (Sol uÃ§ X, SaÄŸ uÃ§ X+W)
                    let m1L_Pole = m1.flipped ? 'S' : 'N';
                    let m1R_Pole = m1.flipped ? 'N' : 'S';
                    let m2L_Pole = m2.flipped ? 'S' : 'N';
                    let m2R_Pole = m2.flipped ? 'N' : 'S';

                    // UÃ§ noktalarÄ±nÄ±n koordinatlarÄ±
                    // Y ekseninde hizalama iÃ§in merkez Y kullanÄ±lÄ±r
                    let y1 = m1.y + m1.h/2; 
                    let y2 = m2.y + m2.h/2;
                    let yDist = Math.abs(y1 - y2);

                    // X koordinatlarÄ± (Sol ve SaÄŸ uÃ§lar)
                    let m1L_x = m1.x;
                    let m1R_x = m1.x + m1.w;
                    let m2L_x = m2.x;
                    let m2R_x = m2.x + m2.w;

                    // 1. Durum: M1'in SAÄI ile M2'nin SOLU (Yan Yana)
                    // Mesafeyi Ã¶lÃ§
                    let dist1 = Math.sqrt(Math.pow(m2L_x - m1R_x, 2) + Math.pow(y2 - y1, 2));
                    
                    if(dist1 < 40 && m1R_Pole !== m2L_Pole) {
                        // ZIT KUTUP VE YAKIN -> YAPIÅ (SNAP)
                        m1.x = m2.x - m1.w; // Tam ucuna yapÄ±ÅŸtÄ±r
                        m1.y = m2.y; // Y eksenini eÅŸitle
                        m1.vx = 0; m1.vy = 0; // Durdur
                        continue; // Bu dÃ¶ngÃ¼yÃ¼ geÃ§
                    }

                    // 2. Durum: M1'in SOLU ile M2'nin SAÄI
                    let dist2 = Math.sqrt(Math.pow(m1L_x - m2R_x, 2) + Math.pow(y2 - y1, 2));

                    if(dist2 < 40 && m1L_Pole !== m2R_Pole) {
                        // ZIT KUTUP VE YAKIN -> YAPIÅ
                        m1.x = m2.x + m2.w; // Tam saÄŸÄ±na yapÄ±ÅŸtÄ±r
                        m1.y = m2.y;
                        m1.vx = 0; m1.vy = 0;
                        continue;
                    }

                    // EÄER YAPIÅMA YOKSA NORMAL Ä°TME/Ã‡EKME UYGULA
                    let dx=(m2.x+m2.w/2)-(m1.x+m1.w/2); let dy=(m2.y+m2.h/2)-(m1.y+m1.h/2);
                    let dist=Math.sqrt(dx*dx+dy*dy);
                    if(dist<50 || dist>300) continue;
                    
                    let isM2Right = (m2.x+m2.w/2) > (m1.x+m1.w/2);
                    let p1 = isM2Right ? m1R_Pole : m1L_Pole;
                    let p2 = isM2Right ? m2L_Pole : m2R_Pole;
                    let attract = (p1 !== p2);
                    
                    let f=1200/(dist*dist); let fx=(dx/dist)*f; let fy=(dy/dist)*f;
                    if(attract) { m1.vx+=fx; m1.vy+=fy; } else { m1.vx-=fx; m1.vy-=fy; }
                }
                
                m1.x+=m1.vx; m1.y+=m1.vy; m1.vx*=0.90; m1.vy*=0.90;
                if(m1.x<0) m1.x=0; if(m1.y<0) m1.y=0;
                if(m1.x>labSpace.clientWidth-m1.w) m1.x=labSpace.clientWidth-m1.w;
                if(m1.y>labSpace.clientHeight-m1.h) m1.y=labSpace.clientHeight-m1.h;
                m1.update();
            }
            requestAnimationFrame(labLoop);
        }
        labAdd(); labAdd(); labLoop();

        /* --- 2. YAY SORUSU --- */
        const sTop=document.getElementById('s-top'); const sBot=document.getElementById('s-bot'); const sPath=document.getElementById('spring-path');
        let sDragging=false; let sTopFlipped=false; let sBotFlipped=false;

        sBot.addEventListener('mousedown', ()=>sDragging=true);
        window.addEventListener('mouseup', ()=>sDragging=false);
        document.getElementById('spring-space').addEventListener('mousemove', e=>{
            if(!sDragging) return;
            let rect=document.getElementById('spring-space').getBoundingClientRect();
            let y=e.clientY-rect.top-50; if(y<200) y=200; if(y>400) y=400;
            sBot.style.top=y+'px'; updateSpring();
        });

        function flipSpring(which) {
            if(which==='top') { sTopFlipped=!sTopFlipped; sTop.innerHTML=sTopFlipped?`<div class="pole n">N</div><div class="pole s">S</div>`:`<div class="pole s">S</div><div class="pole n">N</div>`; }
            else { sBotFlipped=!sBotFlipped; sBot.innerHTML=sBotFlipped?`<div class="pole n">N</div><div class="pole s">S</div>`:`<div class="pole s">S</div><div class="pole n">N</div>`; }
            updateSpring();
        }
        function updateSpring() {
            let faceTop=sTopFlipped?'S':'N'; let faceBot=sBotFlipped?'N':'S';
            let attract=(faceTop!==faceBot); // ZÄ±t kutuplar Ã§eker (aÅŸaÄŸÄ± uzar)
            let topY=220; let botY=parseInt(sBot.style.top); let dist=botY-topY;
            let offset=0;
            if(dist<150) {
                let f=(150-dist)/2;
                offset = attract ? f : -f; // Ã‡ekerse uzar (+), iterse kÄ±salÄ±r (-)
            }
            let newTopY=120+offset; sTop.style.top=newTopY+'px';
            let coils=10; let path=`M30,0 L30,20`;
            for(let i=0; i<coils; i++) {
                let x=(i%2===0)?50:10; let y=20+(i*(newTopY-20)/coils);
                path+=` L${x},${y}`;
            }
            path+=` L30,${newTopY}`; sPath.setAttribute('d', path);
        }

        /* --- 3. Ä°P SORUSU --- */
        const pLeft=document.getElementById('p-left'); const pRight=document.getElementById('p-right');
        const pmLeft=document.getElementById('pm-left'); const pmRight=document.getElementById('pm-right');
        let pDragging=false; let leftFlipped=false; let rightFlipped=false;

        pRight.addEventListener('mousedown', ()=>pDragging=true);
        window.addEventListener('mouseup', ()=>pDragging=false);
        document.getElementById('string-space').addEventListener('mousemove', e=>{
            if(!pDragging) return;
            let rect=document.getElementById('string-space').getBoundingClientRect();
            let x=((e.clientX-rect.left)/rect.width)*100;
            if(x<35) x=35; if(x>90) x=90;
            pRight.style.left=x+'%'; updatePendulum();
        });

        function flipPendulum(side) {
            if(side==='left'){ leftFlipped=!leftFlipped; pmLeft.innerHTML=leftFlipped?`<div class="pole s">S</div><div class="pole n">N</div>`:`<div class="pole n">N</div><div class="pole s">S</div>`; }
            else { rightFlipped=!rightFlipped; pmRight.innerHTML=rightFlipped?`<div class="pole s">S</div><div class="pole n">N</div>`:`<div class="pole n">N</div><div class="pole s">S</div>`; }
            updatePendulum();
        }
        
        function updatePendulum() {
            let faceL = leftFlipped ? 'N' : 'S'; // Solun saÄŸÄ±
            let faceR = rightFlipped ? 'S' : 'N'; // SaÄŸÄ±n solu
            let attract = (faceL !== faceR);

            let lx=30; let rx=parseFloat(pRight.style.left); let dist=rx-lx;
            let angle=0;
            if(dist<40) { angle=(40-dist)*1.5; if(angle>25) angle=25; }

            // KURALINIZ: ZÄ±t Kutuplar (\ /), AynÄ± Kutuplar (/ \)
            if(attract) {
                // Ã‡EKME -> \ / (DIÅARI)
                pLeft.style.transform = `rotate(${-angle}deg)`;
                pRight.style.transform = `rotate(${angle}deg)`;
            } else {
                // Ä°TME -> / \ (Ä°Ã‡ERÄ°)
                pLeft.style.transform = `rotate(${angle}deg)`;
                pRight.style.transform = `rotate(${-angle}deg)`;
            }
        }

        updateSpring(); updatePendulum();

    </script>
</body>
</html>
