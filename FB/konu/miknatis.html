<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÄ±knatÄ±s Soru Ã‡Ã¶zÃ¼cÃ¼ V4</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --n-color: #ff3b30;
            --s-color: #007aff;
            --bg-color: #f2f2f7;
            --spring-color: #8e44ad;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        h1 { color: #333; margin-bottom: 10px; }
        
        /* --- NAVÄ°GASYON --- */
        .mode-switch {
            display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 5px; border-radius: 50px;
        }
        .mode-btn {
            padding: 10px 20px; border: none; background: transparent; cursor: pointer;
            font-family: 'Fredoka'; font-weight: bold; color: #999; border-radius: 50px; transition: 0.3s;
        }
        .mode-btn.active { background: #333; color: white; }

        /* --- ORTAK ALAN --- */
        .experiment-stage {
            width: 100%; max-width: 800px; height: 500px;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative; overflow: hidden;
            border-bottom: 5px solid #bdc3c7;
            display: none;
        }
        .experiment-stage.active { display: block; }

        /* --- ORTAK MIKNATIS STÄ°LÄ° --- */
        .mag-block {
            width: 60px; height: 120px; display: flex; flex-direction: column;
            border-radius: 4px; overflow: hidden; font-weight: bold; color: white; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: absolute; z-index: 2;
        }
        /* Yatay mÄ±knatÄ±s (Ä°p deneyi iÃ§in) */
        .mag-block.horizontal {
            width: 120px; height: 40px; flex-direction: row;
        }

        .pole { flex: 1; display: flex; align-items: center; justify-content: center; transition: background 0.3s; }
        .pole.n { background: var(--n-color); }
        .pole.s { background: var(--s-color); }

        /* --- YAY DENEYÄ° STÄ°LLERÄ° --- */
        #spring-visual {
            position: absolute; left: 50%; transform: translateX(-50%); top: 0;
            stroke: #555; stroke-width: 4; fill: none;
            /* YayÄ±n uzayÄ±p kÄ±salmasÄ± iÃ§in scaleY kullanacaÄŸÄ±z */
            transform-origin: top center;
        }

        #hanging-mag { left: 50%; transform: translateX(-50%); top: 150px; transition: top 0.1s; }
        
        #floor-mag { 
            left: 50%; transform: translateX(-50%); top: 350px; cursor: ns-resize;
            border: 3px solid #333; /* Tutulabilir olduÄŸunu belli et */
        }
        #floor-base {
            position: absolute; bottom: 0; left: 20%; width: 60%; height: 10px; background: #333; border-radius: 5px 5px 0 0;
        }
        
        /* --- Ä°P DENEYÄ° STÄ°LLERÄ° --- */
        .ceiling { position: absolute; top: 0; left: 0; width: 100%; height: 20px; background: repeating-linear-gradient(45deg, #333, #333 10px, #444 10px, #444 20px); }
        
        .pendulum-group {
            position: absolute; top: 20px; /* Tavandan baÅŸlar */
            width: 120px; height: 300px; /* Ä°p uzunluÄŸu */
            transform-origin: top center; /* Sallanma noktasÄ± */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .string-line {
            position: absolute; left: 50%; top: 0; width: 2px; height: 100%; background: #333;
        }
        
        .mag-on-string {
            position: absolute; bottom: 0; left: 0; /* Ä°pin ucunda */
        }
        
        /* SaÄŸdaki sarkaÃ§ sÃ¼rÃ¼klenebilir olacak */
        #pendulum-right { left: 500px; cursor: ew-resize; }
        #pendulum-right::after { content: 'â†” SÃ¼rÃ¼kle'; position: absolute; top: -30px; left: 20px; font-size: 0.8rem; color: #555; white-space: nowrap;} 
        #pendulum-left { left: 250px; pointer-events: none; }


        /* --- KONTROLLER --- */
        .controls-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; z-index: 10;
        }
        .btn {
            background: #333; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Fredoka';
        }
        .btn-flip { background: #e67e22; }

        .info-tag {
            position: absolute; top: 50%; left: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 10px; font-size: 0.9rem; color: #555; max-width: 150px;
        }

    </style>
</head>
<body>

    <h1>ğŸ” Soru Ã‡Ã¶zÃ¼m SimÃ¼lasyonu</h1>

    <div class="mode-switch">
        <button class="mode-btn active" onclick="setMode('spring')">1. Yay SorularÄ±</button>
        <button class="mode-btn" onclick="setMode('string')">2. Ä°p SorularÄ±</button>
    </div>

    <div id="stage-spring" class="experiment-stage active">
        <div class="info-tag">Alttaki mÄ±knatÄ±sÄ± yukarÄ± sÃ¼rÃ¼kle ve yaya etkisini gÃ¶r!</div>
        
        <svg id="spring-visual" width="60" height="150" viewBox="0 0 60 150">
            <path d="M30,0 L30,10 L50,15 L10,25 L50,35 L10,45 L50,55 L10,65 L50,75 L10,85 L50,95 L10,105 L50,115 L10,125 L50,135 L30,140 L30,150" 
                  stroke-linecap="round" stroke-linejoin="round"/>
        </svg>

        <div id="hanging-mag" class="mag-block">
            <div class="pole s">S</div>
            <div class="pole n">N</div>
        </div>

        <div id="floor-mag" class="mag-block">
            <div class="pole s">S</div>
            <div class="pole n">N</div>
        </div>
        <div id="floor-base"></div>

        <div class="controls-panel">
            <button class="btn btn-flip" onclick="flipMag('floor-mag')">Alttakini Ã‡evir ğŸ”„</button>
            <button class="btn btn-flip" onclick="flipMag('hanging-mag')">Ãœsttekini Ã‡evir ğŸ”„</button>
        </div>
    </div>

    <div id="stage-string" class="experiment-stage">
        <div class="ceiling"></div>
        <div class="info-tag">SaÄŸdaki ipi tut ve sola doÄŸru yaklaÅŸtÄ±r!</div>

        <div id="pendulum-left" class="pendulum-group">
            <div class="string-line"></div>
            <div class="mag-block horizontal mag-on-string" id="p-mag-1">
                <div class="pole n">N</div> <div class="pole s">S</div>
            </div>
        </div>

        <div id="pendulum-right" class="pendulum-group">
            <div class="string-line"></div>
            <div class="mag-block horizontal mag-on-string" id="p-mag-2">
                <div class="pole n">N</div> <div class="pole s">S</div>
            </div>
        </div>

        <div class="controls-panel">
            <button class="btn btn-flip" onclick="flipPendulum('p-mag-1')">Soldakini Ã‡evir ğŸ”„</button>
            <button class="btn btn-flip" onclick="flipPendulum('p-mag-2')">SaÄŸdakini Ã‡evir ğŸ”„</button>
        </div>
    </div>

    <script>
        // --- GENEL FONKSÄ°YONLAR ---
        function setMode(mode) {
            document.querySelectorAll('.experiment-stage').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.mode-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`stage-${mode}`).classList.add('active');
            // Butonu aktif yap (sÄ±rayla bulmak yerine basit index mantÄ±ÄŸÄ± veya class match)
            if(mode === 'spring') document.querySelectorAll('.mode-btn')[0].classList.add('active');
            else document.querySelectorAll('.mode-btn')[1].classList.add('active');
        }

        // --- YAY DENEYÄ° MANTIÄI ---
        const floorMag = document.getElementById('floor-mag');
        const hangingMag = document.getElementById('hanging-mag');
        const springSvg = document.getElementById('spring-visual');
        const stageSpring = document.getElementById('stage-spring');

        let isDraggingSpring = false;
        let springBaseY = 350; // Alttaki mÄ±knatÄ±sÄ±n baÅŸlangÄ±Ã§ Y'si

        // KutuplarÄ±n Durumu (true: S-N, false: N-S)
        let magState = {
            'floor-mag': false, // false: Ãœst S, Alt N
            'hanging-mag': false // false: Ãœst S, Alt N
        };

        // Event Listeners (Yay)
        floorMag.addEventListener('mousedown', startDragSpring);
        document.addEventListener('mousemove', dragSpring);
        document.addEventListener('mouseup', stopDragSpring);
        floorMag.addEventListener('touchstart', startDragSpring, {passive:false});
        document.addEventListener('touchmove', dragSpring, {passive:false});
        document.addEventListener('touchend', stopDragSpring);

        function startDragSpring(e) {
            isDraggingSpring = true;
            floorMag.style.cursor = 'grabbing';
        }

        function dragSpring(e) {
            if (!isDraggingSpring) return;
            e.preventDefault();
            const clientY = e.clientY || e.touches[0].clientY;
            const stageRect = stageSpring.getBoundingClientRect();
            
            // SÄ±nÄ±rlama (Tavana Ã§ok yaklaÅŸmasÄ±n)
            let newY = clientY - stageRect.top - 60; // 60 = half height
            if (newY < 200) newY = 200; 
            if (newY > 400) newY = 400;

            floorMag.style.top = newY + 'px';
            updateSpringPhysics();
        }

        function stopDragSpring() {
            isDraggingSpring = false;
            floorMag.style.cursor = 'ns-resize';
        }

        function flipMag(id) {
            const el = document.getElementById(id);
            magState[id] = !magState[id];
            
            // GÃ¶rsel olarak kutuplarÄ± deÄŸiÅŸtir (Flex order veya HTML deÄŸiÅŸimi)
            // Kolay yÃ¶ntem: HTML iÃ§eriÄŸini ters Ã§evir
            if (magState[id]) {
                el.innerHTML = '<div class="pole n">N</div><div class="pole s">S</div>';
            } else {
                el.innerHTML = '<div class="pole s">S</div><div class="pole n">N</div>';
            }
            updateSpringPhysics();
        }

        function updateSpringPhysics() {
            // 1. KutuplarÄ± Kontrol Et
            // AsÄ±lÄ± MÄ±knatÄ±sÄ±n ALT ucu nedir?
            // VarsayÄ±lan (false): Ãœst S, Alt N. -> Alt uÃ§ N
            // Ã‡evrilmiÅŸ (true): Ãœst N, Alt S. -> Alt uÃ§ S
            let hangingBottomPole = magState['hanging-mag'] ? 'S' : 'N';

            // Yer MÄ±knatÄ±sÄ±n ÃœST ucu nedir?
            // VarsayÄ±lan (false): Ãœst S, Alt N. -> Ãœst uÃ§ S
            // Ã‡evrilmiÅŸ (true): Ãœst N, Alt S. -> Ãœst uÃ§ N
            let floorTopPole = magState['floor-mag'] ? 'N' : 'S';

            let isAttracting = (hangingBottomPole !== floorTopPole); // ZÄ±t kutuplar

            // 2. Mesafeyi Ã–lÃ§
            let floorY = parseInt(floorMag.style.top || 350);
            let hangY = 150; // AsÄ±lÄ± mÄ±knatÄ±sÄ±n doÄŸal pozisyonu
            let dist = floorY - hangY;

            // 3. Etkiyi Hesapla (Mesafe kÄ±saldÄ±kÃ§a etki artar)
            // Max etki mesafesi: 200px
            let force = 0;
            if (dist < 250) {
                force = (250 - dist) / 3; // Kuvvet faktÃ¶rÃ¼
            }

            let newHangY = 150;
            let springScale = 1;

            if (isAttracting) {
                // Ã‡EKME: Yay uzar (AÅŸaÄŸÄ± iner)
                newHangY = 150 + force;
                springScale = 1 + (force / 150); // Yay uzama oranÄ±
            } else {
                // Ä°TME: Yay kÄ±salÄ±r (YukarÄ± Ã§Ä±kar)
                newHangY = 150 - force;
                springScale = 1 - (force / 150); // Yay kÄ±salma oranÄ±
            }

            // DeÄŸerleri Uygula
            hangingMag.style.top = newHangY + 'px';
            // YayÄ± hem uzat hem de mÄ±knatÄ±sa baÄŸla
            springSvg.style.height = newHangY + 'px'; 
            // YayÄ±n kÄ±vrÄ±mlarÄ±nÄ± germek iÃ§in scaleY deÄŸil, viewBox veya height ile oynuyoruz.
            // Ama daha gerÃ§ekÃ§i gÃ¶rÃ¼nÃ¼m iÃ§in path'i transform edelim:
            springSvg.setAttribute("viewBox", `0 0 60 ${newHangY}`);
            // Path d'yi deÄŸiÅŸtirmek zor, basitÃ§e scaleY yapalÄ±m ama svg container'a uyduralÄ±m
            springSvg.querySelector('path').style.transform = `scaleY(${newHangY/150})`;
        }


        // --- Ä°P DENEYÄ° MANTIÄI ---
        const pRight = document.getElementById('pendulum-right');
        const pLeft = document.getElementById('pendulum-left');
        const stageString = document.getElementById('stage-string');
        let isDragPendulum = false;

        let pendState = {
            'p-mag-1': false, // Sol mÄ±knatÄ±s: Sol N, SaÄŸ S
            'p-mag-2': false  // SaÄŸ mÄ±knatÄ±s: Sol N, SaÄŸ S
        };

        pRight.addEventListener('mousedown', startDragP);
        document.addEventListener('mousemove', dragP);
        document.addEventListener('mouseup', stopDragP);
        pRight.addEventListener('touchstart', startDragP, {passive:false});
        document.addEventListener('touchmove', dragP, {passive:false});
        document.addEventListener('touchend', stopDragP);

        function startDragP(e) {
            // Sadece baÅŸlÄ±ÄŸÄ±ndan tutulursa sÃ¼rÃ¼kle (basitlik iÃ§in heryerden olsun ÅŸimdilik)
            isDragPendulum = true;
        }

        function dragP(e) {
            if (!isDragPendulum) return;
            e.preventDefault();
            const clientX = e.clientX || e.touches[0].clientX;
            const stageRect = stageString.getBoundingClientRect();

            let newX = clientX - stageRect.left;
            // SÄ±nÄ±rlar
            if (newX < 150) newX = 150; // Ã‡ok sola gitmesin
            if (newX > 700) newX = 700;

            pRight.style.left = newX + 'px';
            updatePendulumPhysics();
        }

        function stopDragP() {
            isDragPendulum = false;
        }

        function flipPendulum(id) {
            const el = document.getElementById(id);
            pendState[id] = !pendState[id];

            if (pendState[id]) {
                // Ã‡evrilmiÅŸ: Sol S, SaÄŸ N
                el.innerHTML = '<div class="pole s">S</div><div class="pole n">N</div>';
            } else {
                // Normal: Sol N, SaÄŸ S
                el.innerHTML = '<div class="pole n">N</div><div class="pole s">S</div>';
            }
            updatePendulumPhysics();
        }

        function updatePendulumPhysics() {
            // 1. KutuplarÄ± Analiz Et
            // Sol MÄ±knatÄ±sÄ±n SAÄ ucu (EtkileÅŸen uÃ§)
            // Normal (false): N-S -> SaÄŸ uÃ§ S
            // Ã‡evrilmiÅŸ (true): S-N -> SaÄŸ uÃ§ N
            let leftInnerPole = pendState['p-mag-1'] ? 'N' : 'S';

            // SaÄŸ MÄ±knatÄ±sÄ±n SOL ucu (EtkileÅŸen uÃ§)
            // Normal (false): N-S -> Sol uÃ§ N
            // Ã‡evrilmiÅŸ (true): S-N -> Sol uÃ§ S
            let rightInnerPole = pendState['p-mag-2'] ? 'S' : 'N';

            let isAttracting = (leftInnerPole !== rightInnerPole);

            // 2. Mesafeyi Hesapla (Ä°p kÃ¶kleri arasÄ±ndaki mesafe)
            let leftX = 250;
            let rightX = parseInt(pRight.style.left || 500);
            let dist = rightX - leftX;

            // 3. AÃ§Ä± Hesapla
            // Mesafe azaldÄ±kÃ§a aÃ§Ä± artar
            let force = 0;
            if (dist < 400) {
                force = (400 - dist) / 8; // AÃ§Ä± faktÃ¶rÃ¼
                if (force > 45) force = 45; // Max aÃ§Ä±
            }

            if (isAttracting) {
                // Birbirine yaklaÅŸÄ±rlar (Ä°Ã§eri doÄŸru aÃ§Ä±)
                // Sol: Pozitif aÃ§Ä± (saÄŸa), SaÄŸ: Negatif aÃ§Ä± (sola)
                // Ä°plerin Ã§arpÄ±ÅŸmasÄ±nÄ± engellemek lazÄ±m ama basit tutalÄ±m
                pLeft.style.transform = `rotate(${force}deg)`;
                pRight.style.transform = `rotate(${-force}deg)`;
            } else {
                // Birbirinden kaÃ§arlar (DÄ±ÅŸarÄ± doÄŸru aÃ§Ä±)
                // Sol: Negatif (sola), SaÄŸ: Pozitif (saÄŸa)
                pLeft.style.transform = `rotate(${-force}deg)`;
                pRight.style.transform = `rotate(${force}deg)`;
            }
        }

        // BaÅŸlangÄ±Ã§ ayarÄ±
        updateSpringPhysics();
        updatePendulumPhysics();

    </script>
</body>
</html>
