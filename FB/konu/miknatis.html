<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro MÄ±knatÄ±s LaboratuvarÄ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --n-color: #eb4d4b; /* Kuzey */
            --s-color: #22a6b3; /* GÃ¼ney */
            --bg-grid: #dfe6e9;
            --field-attract: rgba(46, 213, 115, 0.4);
            --field-repel: rgba(255, 71, 87, 0.4);
        }

        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f1f2f6;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            overflow-x: hidden;
        }

        h1 { color: #2f3542; margin-bottom: 5px; font-size: 2rem; }
        p.subtitle { color: #57606f; margin-bottom: 20px; font-size: 1.1rem; }

        /* --- NAVÄ°GASYON --- */
        .nav-container { margin-bottom: 20px; display: flex; gap: 15px; }
        .nav-btn {
            background: white; border: 2px solid #ccc; padding: 10px 25px;
            border-radius: 50px; cursor: pointer; font-weight: bold; color: #747d8c;
            transition: all 0.3s; font-family: 'Rubik';
        }
        .nav-btn.active {
            border-color: #3742fa; color: #3742fa; background: #eccc6815; box-shadow: 0 4px 10px rgba(55, 66, 250, 0.2);
        }

        /* --- ORTAK ALAN STÄ°LLERÄ° --- */
        .lab-container { display: none; width: 100%; max-width: 1000px; animation: fadeIn 0.4s ease; }
        .lab-container.active { display: block; }
        
        .work-area {
            position: relative; width: 100%; height: 500px;
            background-color: var(--bg-grid);
            background-image: 
                linear-gradient(rgba(255,255,255,0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.5) 1px, transparent 1px);
            background-size: 40px 40px;
            border-radius: 20px;
            border: 4px solid #ced6e0;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.05);
            overflow: hidden;
            touch-action: none; /* Mobilde kaydÄ±rmayÄ± engelle */
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MIKNATIS STÄ°LÄ° --- */
        .magnet {
            position: absolute;
            display: flex;
            border-radius: 6px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2), 0 0 0 2px rgba(255,255,255,0.5);
            cursor: grab;
            font-weight: 900;
            color: white;
            font-size: 1.2rem;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
            z-index: 10;
            transition: transform 0.1s; /* Sadece scale iÃ§in */
        }
        .magnet:active { cursor: grabbing; z-index: 100; transform: scale(1.05); }
        
        .pole { flex: 1; display: flex; align-items: center; justify-content: center; height: 100%; position: relative; }
        .pole.n { background: var(--n-color); }
        .pole.s { background: var(--s-color); }
        
        /* KÄ±rÄ±labilir MÄ±knatÄ±s EkstralarÄ± */
        .breakable-overlay {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            background: #2f3542; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem;
            opacity: 0; transition: opacity 0.2s; pointer-events: none; white-space: nowrap;
        }
        .magnet:hover .breakable-overlay { opacity: 1; }

        /* Manyetik Alan Efektleri */
        .field-lines {
            position: absolute; pointer-events: none; border-radius: 50%;
            transition: all 0.2s; opacity: 0; mix-blend-mode: multiply;
        }
        .attracting-glow {
            box-shadow: 0 0 40px 10px #2ecc71;
            animation: pulse-green 0.5s infinite alternate;
        }
        .repelling-glow {
            box-shadow: 0 0 40px 10px #ff4757;
            animation: shake-red 0.2s infinite;
        }

        @keyframes pulse-green { from { opacity: 0.5; } to { opacity: 1; } }
        @keyframes shake-red { 0% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } 100% { transform: translateX(0); } }

        /* Kontrol Paneli */
        .controls {
            margin-top: 15px; display: flex; gap: 10px; justify-content: center; background: white; padding: 10px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        button.ctrl-btn {
            border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer;
            font-family: 'Rubik'; transition: 0.2s; color: white; font-size: 1rem;
        }
        .btn-flip { background: #ffa502; }
        .btn-reset { background: #ff6b81; }
        .btn-add { background: #1e90ff; }
        button:hover { filter: brightness(1.1); transform: translateY(-2px); }

    </style>
</head>
<body>

    <h1>ðŸ§² Profesyonel MÄ±knatÄ±s LaboratuvarÄ±</h1>
    <p class="subtitle">Her parÃ§a hareketli, her parÃ§a canlÄ±!</p>

    <div class="nav-container">
        <div class="nav-btn active" onclick="setMode('physics')">1. Ä°tme ve Ã‡ekme (Fizik)</div>
        <div class="nav-btn" onclick="setMode('break')">2. SÄ±nÄ±rsÄ±z ParÃ§alanma</div>
    </div>

    <div id="physics-lab" class="lab-container active">
        <div class="work-area" id="zone-1">
            </div>
        <div class="controls">
            <button class="ctrl-btn btn-flip" onclick="flipSelected()">SeÃ§ili OlanÄ± Ã‡evir (N-S) ðŸ”„</button>
            <button class="ctrl-btn btn-reset" onclick="initPhysicsLab()">LaboratuvarÄ± Temizle ðŸ§¹</button>
        </div>
        <p style="text-align: center; color: #999; font-size: 0.9rem;">Ä°pucu: Bir mÄ±knatÄ±sa tÄ±klayarak onu seÃ§, sonra "Ã‡evir" butonunu kullan. Ya da sadece sÃ¼rÃ¼kle!</p>
    </div>

    <div id="break-lab" class="lab-container">
        <div class="work-area" id="zone-2">
            </div>
        <div class="controls">
            <button class="ctrl-btn btn-reset" onclick="initBreakLab()">BaÅŸa DÃ¶n (Tek ParÃ§a) ðŸ§©</button>
            <div style="display: flex; align-items: center; color: #555; margin-left: 10px;">
                <span style="font-size: 1.5rem; margin-right: 5px;">ðŸ”¨</span>
                <span>KÄ±rmak iÃ§in mÄ±knatÄ±sÄ±n Ã¼zerine Ã§ift tÄ±kla!</span>
            </div>
        </div>
    </div>

    <script>
        // --- EVRENSEL DEÄžÄ°ÅžKENLER VE AYARLAR ---
        const physicsZone = document.getElementById('zone-1');
        const breakZone = document.getElementById('zone-2');
        let magnets = []; // TÃ¼m aktif mÄ±knatÄ±s objeleri burada tutulacak
        let selectedMagnetId = null;
        let activeZone = physicsZone;
        let animationFrame;

        // Fizik AyarlarÄ±
        const FRICTION = 0.92; // SÃ¼rtÃ¼nme (durmasÄ± iÃ§in)
        const FORCE_STRENGTH = 1200; // Ã‡ekim gÃ¼cÃ¼ katsayÄ±sÄ±
        const REPULSION_STRENGTH = 1500; // Ä°tme gÃ¼cÃ¼ biraz daha sert olsun
        const SNAP_DISTANCE = 15; // YapÄ±ÅŸma mesafesi

        // --- MIKNATIS SINIFI (CLASS) ---
        class Magnet {
            constructor(id, x, y, width, height, zone, isFlipped = false) {
                this.id = id;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.vx = 0; // HÄ±z X
                this.vy = 0; // HÄ±z Y
                this.isFlipped = isFlipped; // false: N-S, true: S-N
                this.isDragging = false;
                this.zone = zone;
                this.element = null;
                
                this.createDOM();
            }

            createDOM() {
                this.element = document.createElement('div');
                this.element.className = 'magnet';
                this.element.style.width = `${this.width}px`;
                this.element.style.height = `${this.height}px`;
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
                this.element.id = `mag-${this.id}`;

                // Ä°Ã§erik (Kutuplar)
                this.renderPoles();

                // Olay Dinleyicileri
                this.element.addEventListener('mousedown', (e) => this.startDrag(e));
                this.element.addEventListener('touchstart', (e) => this.startDrag(e), {passive: false});
                
                // SeÃ§im iÃ§in
                this.element.addEventListener('click', () => {
                    selectedMagnetId = this.id;
                    document.querySelectorAll('.magnet').forEach(m => m.style.border = 'none');
                    this.element.style.border = '3px solid #f1c40f';
                });

                // KÄ±rma Modu Ä°Ã§in Ã‡ift TÄ±klama
                if (this.zone === breakZone) {
                    this.element.addEventListener('dblclick', () => breakMagnet(this));
                    const tip = document.createElement('div');
                    tip.className = 'breakable-overlay';
                    tip.innerText = "KÄ±rmak iÃ§in Ã‡ift TÄ±kla ðŸ”¨";
                    this.element.appendChild(tip);
                }

                this.zone.appendChild(this.element);
            }

            renderPoles() {
                // KutuplarÄ± Ã§iz
                this.element.innerHTML = ''; // Temizle
                const p1 = document.createElement('div');
                const p2 = document.createElement('div');
                p1.className = `pole ${this.isFlipped ? 's' : 'n'}`;
                p2.className = `pole ${this.isFlipped ? 'n' : 's'}`;
                p1.innerText = this.isFlipped ? 'S' : 'N';
                p2.innerText = this.isFlipped ? 'N' : 'S';
                
                // KÄ±rma ipucu tekrar ekle (temizlendiÄŸi iÃ§in)
                if(this.zone === breakZone) {
                    const tip = document.createElement('div');
                    tip.className = 'breakable-overlay';
                    tip.innerText = "Ã‡ift TÄ±kla ðŸ”¨";
                    this.element.appendChild(tip);
                }

                this.element.appendChild(p1);
                this.element.appendChild(p2);
            }

            startDrag(e) {
                e.preventDefault();
                this.isDragging = true;
                this.vx = 0;
                this.vy = 0;
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                this.dragOffsetX = clientX - this.x;
                this.dragOffsetY = clientY - this.y;

                // Mouse up/move olaylarÄ±nÄ± document'a baÄŸla ki hÄ±zlÄ± Ã§ekince kopmasÄ±n
                const moveHandler = (ev) => this.onDrag(ev);
                const upHandler = () => {
                    this.isDragging = false;
                    document.removeEventListener('mousemove', moveHandler);
                    document.removeEventListener('mouseup', upHandler);
                    document.removeEventListener('touchmove', moveHandler);
                    document.removeEventListener('touchend', upHandler);
                };

                document.addEventListener('mousemove', moveHandler);
                document.addEventListener('mouseup', upHandler);
                document.addEventListener('touchmove', moveHandler, {passive: false});
                document.addEventListener('touchend', upHandler);
            }

            onDrag(e) {
                if (!this.isDragging) return;
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                this.x = clientX - this.dragOffsetX;
                this.y = clientY - this.dragOffsetY;
                
                // SÄ±nÄ±r KontrolÃ¼
                this.keepInBounds();
                this.updatePosition();
            }

            keepInBounds() {
                const maxX = this.zone.clientWidth - this.width;
                const maxY = this.zone.clientHeight - this.height;
                if (this.x < 0) { this.x = 0; this.vx *= -0.5; }
                if (this.y < 0) { this.y = 0; this.vy *= -0.5; }
                if (this.x > maxX) { this.x = maxX; this.vx *= -0.5; }
                if (this.y > maxY) { this.y = maxY; this.vy *= -0.5; }
            }

            updatePosition() {
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
            }

            flip() {
                this.isFlipped = !this.isFlipped;
                this.renderPoles();
                // KÃ¼Ã§Ã¼k bir animasyon efekti
                this.element.style.transform = "scale(0.9) rotate(180deg)";
                setTimeout(() => this.element.style.transform = "scale(1) rotate(0deg)", 200);
            }
        }

        // --- FÄ°ZÄ°K MOTORU DÃ–NGÃœSÃœ ---
        function physicsLoop() {
            // 1. Kuvvet Hesaplama
            for (let i = 0; i < magnets.length; i++) {
                let m1 = magnets[i];
                if (m1.isDragging) continue; // Tutulan mÄ±knatÄ±s fizikten etkilenmez (mouse kontrolÃ¼nde)

                for (let j = 0; j < magnets.length; j++) {
                    if (i === j) continue;
                    let m2 = magnets[j];

                    calculateInteraction(m1, m2);
                }
            }

            // 2. Hareket ve SÃ¼rtÃ¼nme Uygulama
            magnets.forEach(m => {
                if (!m.isDragging) {
                    m.x += m.vx;
                    m.y += m.vy;
                    m.vx *= FRICTION;
                    m.vy *= FRICTION;
                    m.keepInBounds();
                    m.updatePosition();
                }
            });

            animationFrame = requestAnimationFrame(physicsLoop);
        }

        function calculateInteraction(m1, m2) {
            // Merkez noktalarÄ±
            let c1 = { x: m1.x + m1.width / 2, y: m1.y + m1.height / 2 };
            let c2 = { x: m2.x + m2.width / 2, y: m2.y + m2.height / 2 };

            let dx = c2.x - c1.x;
            let dy = c2.y - c1.y;
            let dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < 50 || dist > 350) { // Ã‡ok uzaksa veya iÃ§ iÃ§eyse (hata korumasÄ±) hesaplama
                m1.element.style.boxShadow = ''; // Efekti sil
                return; 
            }

            // Kutup Analizi:
            // M1 Sol(1)-SaÄŸ(2) --- M2 Sol(3)-SaÄŸ(4)
            // Biz basitleÅŸtirilmiÅŸ "En yakÄ±n uÃ§lar" mantÄ±ÄŸÄ± kullanacaÄŸÄ±z.
            
            // Hangi uÃ§lar birbirine bakÄ±yor?
            // M1'in saÄŸÄ± (m1.isFlipped ? N : S)
            // M2'nin solu (m2.isFlipped ? S : N)
            
            // Basitlik iÃ§in sadece X eksenindeki duruma bakalÄ±m (Ã§oÄŸunlukla yan yana duracaklar)
            let m1RightPole = m1.isFlipped ? 'N' : 'S';
            let m2LeftPole = m2.isFlipped ? 'S' : 'N';
            
            // EÄŸer m2 m1'in saÄŸÄ±ndaysa:
            let isM2Right = (m2.x > m1.x); 
            
            let interactingPole1 = isM2Right ? (m1.isFlipped ? 'N' : 'S') : (m1.isFlipped ? 'S' : 'N');
            let interactingPole2 = isM2Right ? (m2.isFlipped ? 'S' : 'N') : (m2.isFlipped ? 'N' : 'S');

            let isOpposite = (interactingPole1 !== interactingPole2);
            
            let fx = dx / dist; // Normalize vektÃ¶r X
            let fy = dy / dist; // Normalize vektÃ¶r Y

            if (isOpposite) {
                // Ã‡EKÄ°M (ATTRACTION)
                let force = FORCE_STRENGTH / (dist * dist);
                m1.vx += fx * force;
                m1.vy += fy * force;

                // GÃ¶rsel Efekt
                if (dist < 200) {
                    m1.element.style.boxShadow = `0 0 20px 5px rgba(46, 213, 115, ${1 - dist/200})`;
                    // YapÄ±ÅŸma (Snap)
                    if (dist < m1.width + SNAP_DISTANCE && Math.abs(dy) < 30) {
                        m1.vx = 0; m1.vy = 0;
                        // Tam hizalama yapÄ±labilir ama serbest fizik daha eÄŸlenceli
                    }
                }
            } else {
                // Ä°TME (REPULSION)
                let force = -REPULSION_STRENGTH / (dist * dist);
                m1.vx += fx * force;
                m1.vy += fy * force;

                 // GÃ¶rsel Efekt
                 if (dist < 200) {
                    m1.element.style.boxShadow = `0 0 20px 5px rgba(255, 71, 87, ${1 - dist/200})`;
                }
            }
        }

        // --- KIRMA FONKSÄ°YONU ---
        function breakMagnet(parentMagnet) {
            // MÄ±natÄ±s Ã§ok kÃ¼Ã§Ã¼kse kÄ±rma
            if (parentMagnet.width < 60) return;

            // Mevcut mÄ±knatÄ±sÄ± listeden ve DOM'dan sil
            magnets = magnets.filter(m => m.id !== parentMagnet.id);
            parentMagnet.element.remove();

            // Yeni boyutlar
            const newW = parentMagnet.width / 2 - 5; // Arada boÅŸluk olsun diye -5
            const newH = parentMagnet.height;

            // ParÃ§a 1
            const m1 = new Magnet(Date.now(), parentMagnet.x, parentMagnet.y, newW, newH, breakZone, false);
            // ParÃ§a 2 (Biraz saÄŸa itelenmiÅŸ)
            const m2 = new Magnet(Date.now() + 1, parentMagnet.x + newW + 10, parentMagnet.y, newW, newH, breakZone, false);

            // Yeni parÃ§alar hafifÃ§e fÄ±rlasÄ±n (Patlama efekti)
            m1.vx = -2; m2.vx = 2;

            magnets.push(m1, m2);
        }

        // --- KURULUM VE RESET ---
        function initPhysicsLab() {
            activeZone.innerHTML = '';
            magnets = [];
            
            // Ä°ki bÃ¼yÃ¼k mÄ±knatÄ±s ekle
            let m1 = new Magnet(1, 100, 200, 200, 60, physicsZone, false); // N-S
            let m2 = new Magnet(2, 600, 200, 200, 60, physicsZone, false); // N-S (AynÄ± kutuplar bakar ÅŸekilde baÅŸlasÄ±n S - N)
            
            magnets.push(m1, m2);
        }

        function initBreakLab() {
            activeZone.innerHTML = '';
            magnets = [];

            // Bir tane dev mÄ±knatÄ±s ekle
            let bigMag = new Magnet(99, 300, 200, 400, 80, breakZone, false);
            magnets.push(bigMag);
        }

        // --- ARAYÃœZ KONTROLLERÄ° ---
        function setMode(mode) {
            document.querySelectorAll('.lab-container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            if (mode === 'physics') {
                document.getElementById('physics-lab').classList.add('active');
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
                activeZone = physicsZone;
                initPhysicsLab();
            } else {
                document.getElementById('break-lab').classList.add('active');
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
                activeZone = breakZone;
                initBreakLab();
            }
        }

        function flipSelected() {
            if (selectedMagnetId) {
                const mag = magnets.find(m => m.id === selectedMagnetId);
                if (mag) mag.flip();
            } else {
                alert("LÃ¼tfen Ã¶nce Ã§evirmek istediÄŸiniz mÄ±knatÄ±sa tÄ±klayÄ±n!");
            }
        }

        // BaÅŸlat
        initPhysicsLab();
        physicsLoop();

    </script>
</body>
</html>
