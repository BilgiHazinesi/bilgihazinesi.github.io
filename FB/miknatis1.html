<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanal MÄ±knatÄ±s LaboratuvarÄ± | Bilgi Hazinesi</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --bg: #ecf0f1;
            --panel: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background-color: var(--primary);
            color: white;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 10;
        }

        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        p { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.8; }

        #controls {
            background: var(--panel);
            padding: 10px 20px;
            width: 90%;
            max-width: 1000px;
            display: flex;
            gap: 10px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, background 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:active { transform: scale(0.95); }

        .btn-add { background-color: #3498db; color: white; }
        .btn-add:hover { background-color: #2980b9; }

        .btn-break { background-color: var(--accent); color: white; }
        .btn-break:hover { background-color: #c0392b; }

        .btn-reset { background-color: #95a5a6; color: white; }
        .btn-reset:hover { background-color: #7f8c8d; }

        .btn-compass { background-color: #f1c40f; color: #2c3e50; }

        #canvas-container {
            position: relative;
            flex-grow: 1;
            width: 95%;
            max-width: 1200px;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            border: 2px solid #bdc3c7;
            cursor: crosshair;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Bilgi balonu */
        .info-bubble {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid var(--accent);
            font-size: 0.9rem;
            max-width: 300px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            pointer-events: none;
        }

    </style>
</head>
<body>

<header>
    <h1>ðŸ§ª Sanal MÄ±knatÄ±s LaboratuvarÄ±</h1>
    <p>MÄ±knatÄ±slarÄ± sÃ¼rÃ¼kleyin, etkileÅŸimlerini gÃ¶zlemleyin ve parÃ§alayÄ±n.</p>
</header>

<div id="controls">
    <button class="btn-add" onclick="addMagnet('bar')">âž• Ã‡ubuk MÄ±knatÄ±s Ekle</button>
    <button class="btn-compass" onclick="toggleCompassMode()">ðŸ§­ Pusula Modu (AÃ§/Kapa)</button>
    <button class="btn-break" onclick="breakSelectedMagnet()">âš¡ SeÃ§ili MÄ±knatÄ±sÄ± KÄ±r</button>
    <button class="btn-reset" onclick="resetSim()">ðŸ”„ SÄ±fÄ±rla</button>
</div>

<div id="canvas-container">
    <canvas id="simCanvas"></canvas>
    <div class="info-bubble">
        <strong>NasÄ±l KullanÄ±lÄ±r?</strong><br>
        1. MÄ±knatÄ±slarÄ± taÅŸÄ±mak iÃ§in sÃ¼rÃ¼kleyin.<br>
        2. Arka plandaki oklar manyetik alan yÃ¶nÃ¼nÃ¼ gÃ¶sterir.<br>
        3. Bir mÄ±knatÄ±sa tÄ±klayÄ±p <b>"KÄ±r"</b> butonuna basarak yeni kutuplarÄ±n oluÅŸumunu izleyin.
    </div>
</div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;

    // Durum DeÄŸiÅŸkenleri
    let magnets = [];
    let particles = []; // Demir tozlarÄ± / Alan oklarÄ± iÃ§in
    let selectedMagnet = null;
    let isCompassMode = false;
    let mouseX = 0, mouseY = 0;
    let isDragging = false;
    let dragOffsetX = 0, dragOffsetY = 0;

    // Ayarlar
    const GRID_SPACING = 30; // Alan Ã§izgileri sÄ±klÄ±ÄŸÄ±

    class Magnet {
        constructor(x, y, w, h) {
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.colorN = '#e74c3c'; // KÄ±rmÄ±zÄ±
            this.colorS = '#3498db'; // Mavi
            this.rotation = 0; // Ä°leride dÃ¶ndÃ¼rme eklenirse diye
            this.id = Math.random();
        }

        draw(ctx) {
            ctx.save();
            ctx.translate(this.x, this.y);
            
            // GÃ¶lge
            ctx.shadowBlur = 10;
            ctx.shadowColor = "rgba(0,0,0,0.3)";

            // SeÃ§iliyse vurgula
            if (selectedMagnet === this) {
                ctx.lineWidth = 4;
                ctx.strokeStyle = "#f1c40f";
                ctx.strokeRect(-this.w/2 - 2, -this.h/2 - 2, this.w + 4, this.h + 4);
            }

            ctx.shadowBlur = 0;

            // Kuzey Kutbu (N)
            ctx.fillStyle = this.colorN;
            ctx.fillRect(-this.w/2, -this.h/2, this.w/2, this.h);
            
            // GÃ¼ney Kutbu (S)
            ctx.fillStyle = this.colorS;
            ctx.fillRect(0, -this.h/2, this.w/2, this.h);

            // YazÄ±lar
            ctx.fillStyle = "white";
            ctx.font = "bold 20px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("N", -this.w/4, 0);
            ctx.fillText("S", this.w/4, 0);

            ctx.restore();
        }

        // Nokta mÄ±knatÄ±sÄ±n iÃ§inde mi?
        contains(mx, my) {
            return mx > this.x - this.w/2 && mx < this.x + this.w/2 &&
                   my > this.y - this.h/2 && my < this.y + this.h/2;
        }

        // Basit manyetik dipol hesaplamasÄ± iÃ§in kutup pozisyonlarÄ±
        getPoles() {
            return {
                n: { x: this.x - this.w/2.5, y: this.y },
                s: { x: this.x + this.w/2.5, y: this.y }
            };
        }
    }

    function init() {
        resize();
        window.addEventListener('resize', resize);
        
        // BaÅŸlangÄ±Ã§ta bir mÄ±knatÄ±s
        addMagnet('bar');
        
        loop();
    }

    function resize() {
        width = canvas.width = document.getElementById('canvas-container').offsetWidth;
        height = canvas.height = document.getElementById('canvas-container').offsetHeight;
        initFieldGrid();
    }

    function addMagnet(type) {
        // Rastgele gÃ¼venli bir konumda oluÅŸtur
        const m = new Magnet(width/2 + (Math.random()*40-20), height/2 + (Math.random()*40-20), 200, 50);
        magnets.push(m);
        selectedMagnet = m;
    }

    function breakSelectedMagnet() {
        if (!selectedMagnet) {
            alert("LÃ¼tfen Ã¶nce kÄ±rmak istediÄŸiniz mÄ±knatÄ±sÄ± seÃ§in (Ã¼zerine tÄ±klayÄ±n).");
            return;
        }

        if (selectedMagnet.w < 60) {
            alert("Bu mÄ±knatÄ±s artÄ±k kÄ±rÄ±lamayacak kadar kÃ¼Ã§Ã¼k! (Atomik boyuta yaklaÅŸtÄ±nÄ±z ðŸ˜‰)");
            return;
        }

        const old = selectedMagnet;
        const newW = (old.w / 2) - 10; // Biraz boÅŸluk bÄ±rakarak kÃ¼Ã§Ã¼lt
        const offset = newW/2 + 10;

        // Sol ParÃ§a (Yeni N-S)
        const leftMag = new Magnet(old.x - offset, old.y, newW, old.h);
        // SaÄŸ ParÃ§a (Yeni N-S)
        const rightMag = new Magnet(old.x + offset, old.y, newW, old.h);

        // Eskiyi sil, yenileri ekle
        magnets = magnets.filter(m => m !== old);
        magnets.push(leftMag, rightMag);
        
        selectedMagnet = null;
    }

    function resetSim() {
        magnets = [];
        addMagnet('bar');
    }

    function toggleCompassMode() {
        isCompassMode = !isCompassMode;
        // Basit bir gÃ¶rsel geri bildirim iÃ§in buton stili deÄŸiÅŸtirilebilir
    }

    // Manyetik Alan GÃ¶rselleÅŸtirme IzgarasÄ±
    let gridPoints = [];
    function initFieldGrid() {
        gridPoints = [];
        for(let x = 0; x < width; x += GRID_SPACING) {
            for(let y = 0; y < height; y += GRID_SPACING) {
                gridPoints.push({x, y});
            }
        }
    }

    function calculateField(x, y) {
        let totalBx = 0;
        let totalBy = 0;

        magnets.forEach(mag => {
            const poles = mag.getPoles();
            
            // Kuzey kutbundan Ã§Ä±kan vektÃ¶r (Ä°tme)
            let dxN = x - poles.n.x;
            let dyN = y - poles.n.y;
            let distN = Math.sqrt(dxN*dxN + dyN*dyN);
            let forceN = 5000 / (distN * distN * distN); // 1/r^2 (vektÃ¶r iÃ§in r^3 ile normalize)
            
            totalBx += dxN * forceN;
            totalBy += dyN * forceN;

            // GÃ¼ney kutbuna giren vektÃ¶r (Ã‡ekme - Ters iÅŸaret)
            let dxS = x - poles.s.x;
            let dyS = y - poles.s.y;
            let distS = Math.sqrt(dxS*dxS + dyS*dyS);
            let forceS = 5000 / (distS * distS * distS);

            totalBx -= dxS * forceS;
            totalBy -= dyS * forceS;
        });

        return { x: totalBx, y: totalBy };
    }

    function drawField() {
        ctx.strokeStyle = "rgba(44, 62, 80, 0.3)";
        ctx.lineWidth = 1;

        // EÄŸer pusula modu aÃ§Ä±ksak sadece farenin olduÄŸu yere bÃ¼yÃ¼k bir pusula Ã§iz
        // DeÄŸilse tÃ¼m Ä±zgarayÄ± Ã§iz
        
        if (!isCompassMode) {
            gridPoints.forEach(p => {
                const field = calculateField(p.x, p.y);
                const angle = Math.atan2(field.y, field.x);
                const len = 10; // Ok uzunluÄŸu

                ctx.beginPath();
                ctx.translate(p.x, p.y);
                ctx.rotate(angle);
                
                // Ok Ã§izimi (Pusula iÄŸnesi gibi)
                ctx.moveTo(-len/2, 0);
                ctx.lineTo(len/2, 0);
                // Ok ucu (Kuzeyi gÃ¶sterir)
                ctx.lineTo(len/4, -3);
                ctx.moveTo(len/2, 0);
                ctx.lineTo(len/4, 3);

                ctx.rotate(-angle);
                ctx.translate(-p.x, -p.y);
                ctx.stroke();
            });
        }
    }

    function drawCompassAtMouse() {
        if (!isCompassMode) return;
        
        const field = calculateField(mouseX, mouseY);
        const angle = Math.atan2(field.y, field.x);
        
        ctx.save();
        ctx.translate(mouseX, mouseY);
        ctx.rotate(angle);
        
        // Pusula GÃ¶vdesi
        ctx.beginPath();
        ctx.arc(0, 0, 30, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#2c3e50";
        ctx.stroke();

        // Ä°ÄŸne (KÄ±rmÄ±zÄ± N, Mavi S)
        // N Ucu
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(20, 0);
        ctx.lineTo(0, -6);
        ctx.lineTo(0, 6);
        ctx.fillStyle = "red";
        ctx.fill();
        
        // S Ucu
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(-20, 0);
        ctx.lineTo(0, -6);
        ctx.lineTo(0, 6);
        ctx.fillStyle = "blue";
        ctx.fill();
        
        // N harfi
        ctx.restore();
        
        // Pusula metni
        ctx.fillStyle = "#2c3e50";
        ctx.font = "12px Arial";
        ctx.fillText("Pusula", mouseX, mouseY + 45);
    }

    function loop() {
        ctx.clearRect(0, 0, width, height);

        // 1. Alan Ã‡izimi (Altta kalmalÄ±)
        drawField();

        // 2. MÄ±knatÄ±slarÄ± Ã‡iz
        magnets.forEach(m => m.draw(ctx));

        // 3. Pusula Modu (Ãœstte)
        drawCompassAtMouse();

        requestAnimationFrame(loop);
    }

    // --- Fare OlaylarÄ± ---
    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;

        // TÄ±klanan mÄ±knatÄ±sÄ± bul (Tersten bak ki en Ã¼sttekini seÃ§sin)
        let clickedMagnet = null;
        for (let i = magnets.length - 1; i >= 0; i--) {
            if (magnets[i].contains(mouseX, mouseY)) {
                clickedMagnet = magnets[i];
                break;
            }
        }

        if (clickedMagnet) {
            selectedMagnet = clickedMagnet;
            isDragging = true;
            dragOffsetX = mouseX - selectedMagnet.x;
            dragOffsetY = mouseY - selectedMagnet.y;
        } else {
            // BoÅŸluÄŸa tÄ±klanÄ±rsa seÃ§imi kaldÄ±r
            selectedMagnet = null;
        }
    });

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;

        if (isDragging && selectedMagnet) {
            selectedMagnet.x = mouseX - dragOffsetX;
            selectedMagnet.y = mouseY - dragOffsetY;
        }
        
        // Ä°mleÃ§ stili
        let hovering = false;
        magnets.forEach(m => {
            if (m.contains(mouseX, mouseY)) hovering = true;
        });
        canvas.style.cursor = hovering ? 'grab' : (isCompassMode ? 'none' : 'default');
        if (isDragging) canvas.style.cursor = 'grabbing';
    });

    canvas.addEventListener('mouseup', () => {
        isDragging = false;
    });
    
    // Dokunmatik Ekran DesteÄŸi (Mobil/Tablet/AkÄ±llÄ± Tahta)
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        mouseX = touch.clientX - rect.left;
        mouseY = touch.clientY - rect.top;
        
        // MouseDown mantÄ±ÄŸÄ±nÄ±n aynÄ±sÄ±
        let clickedMagnet = null;
        for (let i = magnets.length - 1; i >= 0; i--) {
            if (magnets[i].contains(mouseX, mouseY)) {
                clickedMagnet = magnets[i];
                break;
            }
        }
        if (clickedMagnet) {
            selectedMagnet = clickedMagnet;
            isDragging = true;
            dragOffsetX = mouseX - selectedMagnet.x;
            dragOffsetY = mouseY - selectedMagnet.y;
        } else {
            selectedMagnet = null;
        }
    }, {passive: false});

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if(!isDragging || !selectedMagnet) return;
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        mouseX = touch.clientX - rect.left;
        mouseY = touch.clientY - rect.top;
        
        selectedMagnet.x = mouseX - dragOffsetX;
        selectedMagnet.y = mouseY - dragOffsetY;
    }, {passive: false});

    canvas.addEventListener('touchend', () => {
        isDragging = false;
    });

    // BaÅŸlat
    init();

</script>

</body>
</html>
