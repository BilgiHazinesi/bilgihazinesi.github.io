<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f5f7fa">
    <title>Zeynal Ã–ÄŸretmen KÃ¼tÃ¼phanesi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="loginOverlay" class="overlay-bg">
        <div class="modal-card">
            <h2 style="margin: 0 0 10px 0; color: var(--text-main);">KÃ¼tÃ¼phane GiriÅŸi</h2>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="setLoginMode('teacher')" id="tabTeacher">Ã–ÄŸretmen</button>
                <button class="login-tab" onclick="setLoginMode('student')" id="tabStudent">Ã–ÄŸrenci</button>
            </div>
            
            <div id="teacherLoginForm">
                <div class="input-wrapper">
                    <input type="password" id="appPassword" placeholder="Ã–ÄŸretmen Åifresi" style="text-align:center; letter-spacing: 5px;">
                </div>
            </div>

            <div id="studentLoginForm" style="display:none;">
                <p style="font-size:0.85rem; color:var(--text-sub); margin-bottom:10px;">Sadece ÅŸifreni gir ve baÅŸla!</p>
                <div class="input-wrapper">
                    <input type="password" id="studentLoginPass" placeholder="Ã–ÄŸrenci Åifreniz" style="text-align:center; letter-spacing: 2px;">
                </div>
            </div>

            <button class="btn btn-primary" onclick="login()">GiriÅŸ Yap</button>
            <div id="loader" style="display:block; margin-top:10px; font-size:0.8rem; color:var(--primary);">Veriler YÃ¼kleniyor...</div>
        </div>
    </div>

    <div id="ratingOverlay" class="overlay-bg" style="display:none; background: rgba(0,0,0,0.8);">
        <div class="modal-card" style="background: #1e293b; color: white; border: 1px solid rgba(255,255,255,0.2); max-width: 450px;">
            <h3 style="margin-top:0; color:#fff;">DeÄŸerlendirme</h3>
            <div class="rating-btn-group" id="starGroup">
                <button class="rating-btn" onclick="selectStar(1)">1</button>
                <button class="rating-btn" onclick="selectStar(2)">2</button>
                <button class="rating-btn" onclick="selectStar(3)">3</button>
                <button class="rating-btn" onclick="selectStar(4)">4</button>
                <button class="rating-btn" onclick="selectStar(5)">5</button>
            </div>
            <div class="input-wrapper" style="margin-bottom:5px;">
                <select id="exitCardSelect" onchange="updateCardPrompt()" style="background:rgba(255,255,255,0.1); color:white;">
                    <option value="">-- Ã‡Ä±kÄ±ÅŸ KartÄ± SeÃ§iniz --</option>
                </select>
            </div>
            <div id="cardPromptBox" class="card-question" style="display:none;"></div>
            <div class="input-wrapper" id="commentWrapper" style="display:none;">
                <textarea id="returnComment" placeholder="Yorumu buraya girin..." style="background:rgba(255,255,255,0.1); color:white;"></textarea>
                <button class="mic-btn" onclick="startDictation()"><i class="fas fa-microphone"></i></button>
            </div>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn" style="background:rgba(255,255,255,0.1); color:white; flex:1; margin-bottom:0;" onclick="closeRatingModal()">Ä°ptal</button>
                <button class="btn btn-primary" style="flex:1; margin-bottom:0;" onclick="submitReturn()">Kaydet</button>
            </div>
        </div>
    </div>

    <div id="bookDetailOverlay" class="overlay-bg" style="display:none;">
        <div class="modal-card" style="text-align:left; max-width:600px; padding:0; overflow:hidden; background:var(--bg-image);">
            <div style="padding:20px; position:relative; z-index:2;">
                <button class="close-overlay-btn" onclick="closeBookDetail()">&times;</button>
                <h3 id="bdTitle" style="margin:0 0 5px 0; color:var(--primary); text-align:center; font-size:1.5rem;">Kitap AdÄ±</h3>
                <p id="bdStats" style="font-size:0.9rem; color:var(--text-sub); margin-bottom:10px; text-align:center;">0 Meyve ToplandÄ±</p>
                
                <div class="tree-wrapper">
                    <svg class="tree-svg-container" viewBox="0 0 400 500" preserveAspectRatio="xMidYMax slice">
                        <defs>
                            <linearGradient id="trunkGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#4e342e;stop-opacity:1" /><stop offset="100%" style="stop-color:#8d6e63;stop-opacity:1" /></linearGradient>
                            <radialGradient id="leafGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="0%" style="stop-color:#66bb6a;stop-opacity:1" /><stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" /></radialGradient>
                        </defs>
                        <path d="M180,500 L180,400 Q160,350 140,300 Q180,320 200,300 Q220,320 260,300 Q240,350 220,400 L220,500 Z" fill="url(#trunkGrad)" />
                        <circle cx="200" cy="200" r="140" fill="url(#leafGrad)" opacity="0.9" /><circle cx="120" cy="250" r="80" fill="url(#leafGrad)" opacity="0.8" /><circle cx="280" cy="250" r="80" fill="url(#leafGrad)" opacity="0.8" /><circle cx="200" cy="100" r="90" fill="url(#leafGrad)" opacity="0.9" />
                    </svg>
                    <div id="treeFruitsContainer"></div>
                    <div id="fruitDetailBox" class="fruit-detail-modal">
                        <div style="font-weight:800; font-size:1.1rem; color:var(--primary); margin-bottom:5px;" id="fdStudent"></div>
                        <div style="font-size:0.85rem; background:rgba(59,130,246,0.1); display:inline-block; padding:3px 10px; border-radius:12px; margin-bottom:10px;" id="fdCard"></div>
                        <div style="font-style:italic; font-size:1rem; line-height:1.4;" id="fdComment"></div>
                    </div>
                </div>

                <h4 style="margin:20px 0 10px 0; color:var(--text-main); border-bottom:2px solid var(--primary); display:inline-block;">TÃ¼m Yorumlar</h4>
                <div id="bdReviews" class="all-reviews-list"></div>
            </div>
        </div>
    </div>

    <div id="appContainer" style="display:none;">
        <div class="app-header">
            <div class="app-title" id="mainTitle">Zeynal Ã–ÄŸretmen</div>
            <button class="theme-btn" onclick="toggleTheme()" id="themeIcon">ğŸŒ™</button>
        </div>
        
        <div class="container" id="teacherContainer" style="display:none;">
            <div class="glass-panel" style="padding: 15px; padding-bottom: 10px; margin-bottom: 20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:0.85rem; font-weight:600; color:var(--text-sub);"><span>ğŸ¯ SÄ±nÄ±f Hedefi</span><span id="targetText">0 / 830 Kitap</span></div>
                <div class="progress-container"><div class="progress-fill" id="progressBar" style="width: 0%;"></div><div class="progress-text" id="progressPercent">0%</div></div>
            </div>
            
            <div id="tab-lend" class="section active">
                <div class="glass-panel">
                    <h3 style="margin:0 0 15px 0; color:var(--primary);">HÄ±zlÄ± Ä°ÅŸlem</h3>
                    <div class="input-wrapper"><input type="text" list="studentList" id="studentInput" placeholder="Ã–ÄŸrenci SeÃ§iniz..." oninput="handleInput(this); renderHistory()"><i class="fas fa-times-circle clear-btn" onclick="clearField('studentInput', renderHistory)"></i></div>
                    <div class="input-wrapper"><input type="text" list="bookList" id="bookInput" placeholder="Kitap SeÃ§iniz..." oninput="handleInput(this)"><i class="fas fa-times-circle clear-btn" onclick="clearField('bookInput')"></i></div>
                    <button class="btn btn-primary" onclick="lendBook()">KitabÄ± Teslim Et</button>
                </div>
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><h4 style="margin:0; color:var(--text-main);">Son Hareketler</h4><span id="syncStatus" style="font-size:0.75rem; color:var(--text-sub); opacity:0.7;">BaÄŸlanÄ±yor...</span></div>
                    <div id="historyList"></div>
                </div>
            </div>

            <div id="tab-books" class="section">
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <div class="filter-group" style="margin-bottom:0; flex:1;"><div class="filter-chip active" onclick="filterBooks('all', this)">TÃ¼mÃ¼</div><div class="filter-chip" onclick="filterBooks('out', this)">DÄ±ÅŸarÄ±da</div><div class="filter-chip" onclick="filterBooks('rating', this)">Puan</div></div>
                        <button class="btn-edit-toggle" id="editToggleBtn" onclick="toggleEditMode()">âœï¸ DÃ¼zenle</button>
                    </div>
                    <div class="input-wrapper"><input type="text" id="bookSearch" placeholder="Kitap Ara..." onkeyup="handleInput(this); renderBookManager()"><i class="fas fa-times-circle clear-btn" onclick="clearField('bookSearch', renderBookManager)"></i></div>
                    <div id="bookManagerList"></div>
                </div>
                <div class="glass-panel">
                    <h4 style="margin:0 0 10px 0; color:var(--text-main);">Yeni Kitap Ekle</h4>
                    <div class="input-wrapper"><input type="text" id="newBookInput" placeholder="Kitap AdÄ±..." oninput="handleInput(this)"><i class="fas fa-times-circle clear-btn" onclick="clearField('newBookInput')"></i></div>
                    <button class="btn btn-primary" onclick="addNewBook()">Ekle</button>
                </div>
            </div>

            <div id="tab-report" class="section">
                <div class="glass-panel">
                    <h3 style="margin:0 0 15px 0; color:var(--primary);">Motivasyon Raporu</h3>
                    <div class="input-wrapper"><input type="text" list="studentList" id="reportStudentInput" placeholder="Ã–ÄŸrenci SeÃ§iniz..." oninput="handleInput(this); genReport()"><i class="fas fa-times-circle clear-btn" onclick="clearField('reportStudentInput')"></i></div>
                    <div id="reportOutput" style="background:var(--input-bg); padding:15px; border-radius:12px; margin:15px 0; white-space:pre-wrap; font-size:0.9rem; color:var(--text-main); border:var(--glass-border);">...</div>
                    <button class="btn btn-primary" onclick="copyReport()"><i class="far fa-copy"></i> Kopyala</button>
                    <div class="journey-container" id="spaceJourney"><div class="stars"></div><svg class="svg-path" id="journeySvg"></svg></div>
                </div>
            </div>

            <div id="tab-stats" class="section">
                <div class="stats-summary"><div class="summary-box"><div class="sb-title">ğŸ¥‡ Lider (Kitap)</div><div class="sb-value" id="statTopReader">-</div></div><div class="summary-box"><div class="sb-title">ğŸ“– Toplam Sayfa</div><div class="sb-value" id="statTotalPages">0</div></div></div>
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"><h3 style="margin:0; color:var(--primary);">ğŸ† Okuma SÄ±ralamasÄ±</h3><button class="sort-btn" onclick="toggleStatsSort()" id="sortBtnIcon">SÄ±rala: Kitap â¬‡</button></div>
                    <div id="rankingList"></div>
                </div>
            </div>

            <div id="tab-settings" class="section">
                <div class="glass-panel">
                    <h3 style="margin:0 0 15px 0; color:var(--primary);">âš™ï¸ Genel Ayarlar</h3>
                    <label class="setting-label">SÄ±nÄ±f Kitap Hedefi</label><div class="input-wrapper"><input type="number" id="set-target" placeholder="Ã–rn: 830"></div>
                    <div class="setting-row"><div style="flex:1"><label class="setting-label">GÃ¼mÃ¼ÅŸ Madalya</label><input type="number" id="set-silver" placeholder="4"></div><div style="flex:1"><label class="setting-label">AltÄ±n Madalya</label><input type="number" id="set-gold" placeholder="6"></div></div>
                    <button class="btn btn-primary" onclick="saveSettings()">AyarlarÄ± Kaydet</button>
                </div>
                <div class="glass-panel">
                    <h3 style="margin:0 0 15px 0; color:var(--primary);">ğŸ‘¥ Ã–ÄŸrenci & Åifre YÃ¶netimi</h3>
                    <div class="input-wrapper" style="margin-bottom:5px;"><input type="text" id="single-student-add" placeholder="Yeni Ã–ÄŸrenci AdÄ±..."></div>
                    <div class="input-wrapper"><input type="text" id="single-student-pass" placeholder="Ã–ÄŸrenci Åifresi (Ä°steÄŸe baÄŸlÄ±)"></div>
                    <button class="btn btn-primary" onclick="addSingleStudent()">Ã–ÄŸrenciyi Kaydet</button>
                    <div class="divider-text">Mevcut Åifreleri DÃ¼zenle</div>
                    <div id="studentPassList" style="max-height:200px; overflow-y:auto; margin-bottom:15px;"></div>
                    <div class="divider-text" style="color:#ef4444;">Silme Ä°ÅŸlemleri</div>
                    <div style="display:flex; gap:5px;"><input type="text" list="studentList" id="single-student-del" placeholder="Silinecek Ã–ÄŸrenci..." style="flex:1;"><button class="btn btn-danger" style="width:auto; margin-bottom:0;" onclick="delSingleStudent()">Sil</button></div>
                </div>
                <div class="glass-panel" style="border: 1px solid rgba(220, 38, 38, 0.3);"><h3 style="margin:0 0 15px 0; color:#ef4444;">âš ï¸ Tehlikeli BÃ¶lge</h3><button class="btn btn-danger" onclick="resetAllData()">TÃ¼m Verileri SÄ±fÄ±rla</button></div>
            </div>
        </div>
        
        <div class="bottom-nav" id="teacherNav" style="display:none;">
            <button class="nav-item active" onclick="switchTab('lend', this)"><i class="fas fa-home"></i><span>GiriÅŸ</span></button>
            <button class="nav-item" onclick="switchTab('books', this)"><i class="fas fa-book"></i><span>Kitaplar</span></button>
            <button class="nav-item" onclick="switchTab('report', this)"><i class="fas fa-file-invoice"></i><span>Rapor</span></button>
            <button class="nav-item" onclick="switchTab('stats', this)"><i class="fas fa-chart-pie"></i><span>Ä°statistik</span></button>
            <button class="nav-item" onclick="switchTab('settings', this)"><i class="fas fa-cog"></i><span>Ayarlar</span></button>
        </div>

        <div class="container" id="studentContainer" style="display:none;">
            <div class="glass-panel" style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h2 style="margin:0; color:var(--primary);" id="stName">-</h2>
                        <div style="font-size:0.9rem; color:var(--text-sub); font-weight:600; margin-top:5px;" id="stRank">BaÅŸlangÄ±Ã§</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:1.5rem;" id="stMedals"></div>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <div class="summary-box" style="background:rgba(255,255,255,0.4);">
                        <div class="sb-title">Okunan Kitap</div>
                        <div class="sb-value" id="stBookCount">0</div>
                    </div>
                    <div class="summary-box" style="background:rgba(255,255,255,0.4);">
                        <div class="sb-title">Okunan Sayfa</div>
                        <div class="sb-value" id="stPageCount">0</div>
                    </div>
                </div>
            </div>
            
            <div id="tab-student-home" class="section active">
                 <div class="glass-panel">
                    <h4 style="margin:0 0 10px 0; color:var(--text-main);">ğŸš€ Okuma YolculuÄŸum</h4>
                    <div class="journey-container" id="studentSpaceJourney"><div class="stars"></div><svg class="svg-path" id="studentJourneySvg"></svg></div>
                </div>
                <div class="glass-panel">
                    <h4 style="margin:0 0 10px 0; color:var(--text-main);">ğŸ“š KÃ¼tÃ¼phane GeÃ§miÅŸim</h4>
                    <div id="studentMyBooksList"></div>
                </div>
            </div>
        </div>
        
        <div class="bottom-nav" id="studentNav" style="display:none;">
            <button class="nav-item active"><i class="fas fa-user-astronaut"></i><span>Profilim</span></button>
            <button class="nav-item" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i><span>Ã‡Ä±kÄ±ÅŸ</span></button>
        </div>
    </div>

    <datalist id="studentList"></datalist>
    <datalist id="bookList"></datalist>

    <script src="script.js"></script>
</body>
</html>
