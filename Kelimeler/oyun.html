<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeynal Öğretmen - Oyun Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --primary: #3498db; /* Mavi - Kelime Avı */
            --bundle: #e67e22;  /* Turuncu - Bundle */
            --correct: #27ae60; /* Yeşil */
            --present: #f1c40f; /* Sarı */
            --absent: #95a5a6;  /* Gri */
            --text: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 600px; width: 100%;
            background: white; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden; margin-top: 10px;
        }

        /* --- SEKMELER (TABS) --- */
        .tabs { display: flex; border-bottom: 2px solid #ecf0f1; }
        .tab-btn {
            flex: 1; padding: 15px; border: none; background: #fff;
            font-size: 1rem; font-weight: 800; color: #95a5a6;
            cursor: pointer; transition: 0.3s;
        }
        .tab-btn.active.tab-classic { color: var(--primary); border-bottom: 4px solid var(--primary); background: #ebf5fb; }
        .tab-btn.active.tab-bundle { color: var(--bundle); border-bottom: 4px solid var(--bundle); background: #fdf2e9; }

        .tab-content { display: none; padding: 20px; text-align: center; }
        .tab-content.active { display: block; animation: fadeEffect 0.5s; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        /* --- OYUN ALANLARI --- */
        h2 { margin: 0 0 10px 0; font-weight: 900; }
        .info-bar { font-weight: 700; color: #7f8c8d; margin-bottom: 15px; font-size: 0.9rem; }
        
        .hint-box {
            background: #fff3cd; color: #856404; padding: 10px;
            border-radius: 8px; margin-bottom: 20px; font-weight: 700;
        }

        /* Kelime Avı Kutuları */
        .ka-container { display: flex; justify-content: center; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; }
        .ka-box {
            width: 40px; height: 50px; background: #e9ecef; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; font-weight: 800; color: transparent;
        }
        .ka-box.revealed { background: var(--primary); color: white; }

        /* Bundle Grid */
        .grid { display: grid; gap: 5px; justify-content: center; margin-bottom: 20px; }
        .grid-row { display: flex; gap: 5px; }
        .w-box {
            width: 45px; height: 45px; border: 2px solid #dee2e6;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 900; text-transform: uppercase;
        }
        .w-correct { background: var(--correct); color: white; border-color: var(--correct); }
        .w-present { background: var(--present); color: white; border-color: var(--present); }
        .w-absent { background: var(--absent); color: white; border-color: var(--absent); }

        /* Input ve Butonlar */
        input[type="text"] {
            padding: 12px; width: 60%; border: 2px solid #dfe6e9;
            border-radius: 50px; text-align: center; font-weight: 700;
            font-size: 1.1rem; outline: none; margin-bottom: 10px;
            text-transform: uppercase;
        }
        input:focus { border-color: var(--text); }
        
        .btn {
            padding: 10px 25px; border: none; border-radius: 50px;
            color: white; font-weight: 800; cursor: pointer; margin: 5px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-hint { background: #f1c40f; color: #5d4037; }
        .btn-check-c { background: var(--primary); }
        .btn-check-b { background: var(--bundle); }

        .feedback { min-height: 25px; font-weight: 800; margin-top: 10px; font-size: 1.1rem; }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 999; display: flex; justify-content: center; align-items: center;
        }
    </style>
</head>
<body>

<div id="loader"><h3>Yükleniyor...</h3></div>

<div class="container" id="game-app" style="display:none;">
    <div class="tabs">
        <button class="tab-btn tab-classic active" onclick="switchTab('classic')">KELİME AVI</button>
        <button class="tab-btn tab-bundle" onclick="switchTab('bundle')">BUNDLE (WORDLE)</button>
    </div>

    <div id="classic" class="tab-content active">
        <h2 style="color:var(--primary)">Kelime Avı</h2>
        <div class="info-bar">Soru: <span id="c-idx">1</span></div>
        <div id="c-hint" class="hint-box">...</div>
        <div id="c-board" class="ka-container"></div>
        
        <div>
            <button class="btn btn-hint" onclick="c_getLetter()">Harf Al</button><br>
            <input type="text" id="c-input" placeholder="Cevabı Yaz"><br>
            <button class="btn btn-check-c" onclick="c_check()">YANITLA</button>
        </div>
        <div id="c-msg" class="feedback"></div>
    </div>

    <div id="bundle" class="tab-content">
        <h2 style="color:var(--bundle)">Bundle</h2>
        <div class="info-bar">Soru: <span id="b-idx">1</span> (6 Hakkın Var)</div>
        <div id="b-grid" class="grid"></div>
        
        <div>
            <input type="text" id="b-input" placeholder="TAHMİN ET"><br>
            <button class="btn btn-check-b" onclick="b_check()">KONTROL ET</button>
        </div>
        <div id="b-msg" class="feedback"></div>
    </div>
</div>

<script>
    // CSV LINKINI BURAYA EKLE
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGIsfx3q4A24MbeGif6c1Nnr6NSOw5PS40df8j34MyppgdNp4T4My20jeEH0kKJrpuehciw3J_QgR/pub?gid=0&single=true&output=csv";

    let listClassic = []; // {word, hint} -> A ve B sütunundan
    let listBundle = [];  // {word} -> C sütunundan

    // Oyun Durumu
    let cState = { idx: 0, revealed: [] };
    let bState = { idx: 0, guesses: [], gameOver: false };

    document.addEventListener('DOMContentLoaded', () => {
        fetchData();
        document.getElementById('c-input').addEventListener('keypress', e => { if(e.key==='Enter') c_check(); });
        document.getElementById('b-input').addEventListener('keypress', e => { if(e.key==='Enter') b_check(); });
    });

    function fetchData() {
        if(CSV_URL.includes("BURAYA")) { alert("Lütfen CSV linkini ekleyin."); return; }
        fetch(CSV_URL).then(r => r.text()).then(txt => {
            parseCSV(txt);
            document.getElementById('loader').style.display = 'none';
            document.getElementById('game-app').style.display = 'block';
            initClassic();
            initBundle();
        }).catch(e => alert("Hata: " + e));
    }

    // --- KRİTİK NOKTA: AYRIŞTIRMA MANTIĞI ---
    function parseCSV(text) {
        const rows = text.split(/\r?\n/);
        for(let i=1; i<rows.length; i++) {
            // Satırı virgülle ayır (Basit parser)
            const row = rows[i].split(',');
            
            // Eğer satır boşsa geç
            if(row.length < 1) continue;

            // Sütunları Temizle
            const colA = row[0] ? row[0].trim() : "";
            const colB = row[1] ? row[1].trim() : "";
            const colC = row[2] ? row[2].trim() : ""; // Sadece C hücresi (3. sütun)

            // 1. Kural: A ve B doluysa -> Kelime Avı listesine ekle
            if(colA.length > 0) {
                listClassic.push({ word: colA, hint: colB });
            }

            // 2. Kural: C doluysa -> Bundle listesine ekle (A ve B'den bağımsız)
            if(colC.length > 0) {
                listBundle.push(colC);
            }
        }
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.querySelector(`.tab-${tab}`).classList.add('active');
    }

    function toTr(s) { return s.toLocaleUpperCase('tr-TR'); }

    // === KELİME AVI MOTORU ===
    function initClassic() {
        if(cState.idx >= listClassic.length) {
            document.getElementById('classic').innerHTML = "<h2>Bitti!</h2><p>Kelime Avı Tamamlandı.</p>";
            return;
        }
        const q = listClassic[cState.idx];
        cState.revealed = new Array(q.word.length).fill(false);
        
        document.getElementById('c-idx').innerText = (cState.idx + 1) + " / " + listClassic.length;
        document.getElementById('c-hint').innerText = q.hint;
        document.getElementById('c-msg').innerText = "";
        document.getElementById('c-input').value = "";
        
        c_render();
    }

    function c_render() {
        const board = document.getElementById('c-board');
        board.innerHTML = '';
        const w = listClassic[cState.idx].word;
        for(let i=0; i<w.length; i++) {
            const d = document.createElement('div');
            d.className = 'ka-box';
            if(w[i] === ' ') {
                d.style.opacity = 0; cState.revealed[i] = true;
            } else if(cState.revealed[i]) {
                d.className += ' revealed'; d.innerText = toTr(w[i]);
            } else {
                d.innerText = "?";
            }
            board.appendChild(d);
        }
    }

    function c_getLetter() {
        const closed = [];
        cState.revealed.forEach((r, i) => { if(!r) closed.push(i); });
        if(closed.length > 0) {
            const rnd = closed[Math.floor(Math.random()*closed.length)];
            cState.revealed[rnd] = true;
            c_render();
        }
    }

    function c_check() {
        const inp = document.getElementById('c-input');
        const guess = toTr(inp.value).replace(/\s/g,'');
        const target = toTr(listClassic[cState.idx].word).replace(/\s/g,'');
        
        if(guess === target) {
            document.getElementById('c-msg').style.color = "var(--correct)";
            document.getElementById('c-msg').innerText = "DOĞRU!";
            cState.revealed.fill(true);
            c_render();
            setTimeout(() => { cState.idx++; initClassic(); }, 1500);
        } else {
            document.getElementById('c-msg').style.color = "red";
            document.getElementById('c-msg').innerText = "YANLIŞ";
        }
    }

    // === BUNDLE (WORDLE) MOTORU ===
    function initBundle() {
        if(bState.idx >= listBundle.length) {
            document.getElementById('bundle').innerHTML = "<h2>Bitti!</h2><p>Tüm Bundle Soruları Çözüldü.</p>";
            return;
        }
        bState.guesses = [];
        bState.gameOver = false;
        
        document.getElementById('b-idx').innerText = (bState.idx + 1) + " / " + listBundle.length;
        document.getElementById('b-input').value = "";
        document.getElementById('b-input').disabled = false;
        document.getElementById('b-msg').innerText = "";
        
        // Input uzunluk ayarı
        const wLen = listBundle[bState.idx].length;
        document.getElementById('b-input').setAttribute('maxlength', wLen);
        document.getElementById('b-input').setAttribute('placeholder', `${wLen} HARFLİ KELİME`);
        
        b_render();
    }

    function b_render() {
        const grid = document.getElementById('b-grid');
        grid.innerHTML = '';
        const target = toTr(listBundle[bState.idx]);
        const len = target.length;

        // Tahminleri Çiz
        bState.guesses.forEach(g => {
            const row = document.createElement('div');
            row.className = 'grid-row';
            
            // Renk Mantığı
            const tChars = target.split('');
            const gChars = g.split('');
            const status = new Array(len).fill('w-absent');
            const taken = new Array(len).fill(false);

            // 1. Yeşilleri Bul
            gChars.forEach((c, i) => {
                if(c === tChars[i]) { status[i] = 'w-correct'; taken[i] = true; }
            });
            // 2. Sarıları Bul
            gChars.forEach((c, i) => {
                if(status[i] !== 'w-correct') {
                    const found = tChars.findIndex((tc, ti) => tc === c && !taken[ti]);
                    if(found !== -1) { status[i] = 'w-present'; taken[found] = true; }
                }
            });

            for(let i=0; i<len; i++) {
                const b = document.createElement('div');
                b.className = `w-box ${status[i]}`;
                b.innerText = gChars[i];
                row.appendChild(b);
            }
            grid.appendChild(row);
        });

        // Boş Satırlar (Kalan Haklar)
        const remain = 6 - bState.guesses.length;
        for(let i=0; i<remain; i++) {
            const r = document.createElement('div');
            r.className = 'grid-row';
            for(let j=0; j<len; j++) {
                const b = document.createElement('div');
                b.className = 'w-box';
                r.appendChild(b);
            }
            grid.appendChild(r);
        }
    }

    function b_check() {
        if(bState.gameOver) return;
        const inp = document.getElementById('b-input');
        const guess = toTr(inp.value.trim());
        const target = toTr(listBundle[bState.idx]);

        if(guess.length !== target.length) {
            document.getElementById('b-msg').style.color = "#e67e22";
            document.getElementById('b-msg').innerText = `${target.length} Harfli Olmalı!`;
            return;
        }

        bState.guesses.push(guess);
        inp.value = "";
        b_render();

        if(guess === target) {
            document.getElementById('b-msg').style.color = "var(--correct)";
            document.getElementById('b-msg').innerText = "BULDUN!";
            bState.gameOver = true;
            inp.disabled = true;
            setTimeout(() => { bState.idx++; initBundle(); }, 2000);
        } else if(bState.guesses.length >= 6) {
            document.getElementById('b-msg').style.color = "red";
            document.getElementById('b-msg').innerText = `CEVAP: ${target}`;
            bState.gameOver = true;
            inp.disabled = true;
            setTimeout(() => { bState.idx++; initBundle(); }, 3000);
        }
    }
</script>
</body>
</html>
