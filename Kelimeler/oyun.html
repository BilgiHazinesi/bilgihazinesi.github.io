<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeynal Öğretmen - Oyun Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f7f6;
            --primary: #3498db; 
            --bundle: #d35400; 
            --correct: #27ae60; 
            --present: #f1c40f; 
            --absent: #95a5a6; 
            --text: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 600px; width: 100%;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden; min-height: 600px;
        }

        /* TABS */
        .tabs { display: flex; background: #ecf0f1; padding: 5px; }
        .tab-btn {
            flex: 1; padding: 15px; border: none; background: transparent;
            font-size: 1rem; font-weight: 800; color: #7f8c8d;
            cursor: pointer; border-radius: 15px; transition: 0.3s;
        }
        .tab-btn.active.classic { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn.active.bundle { background: white; color: var(--bundle); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .tab-content { display: none; padding: 25px; text-align: center; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        h2 { margin: 0 0 10px 0; font-weight: 900; }
        .info { font-weight: 700; color: #95a5a6; font-size: 0.9rem; margin-bottom: 20px; }

        /* KELİME AVI */
        .hint-box { background: #e8f6f3; color: #16a085; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 700; }
        .ka-board { display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; margin-bottom: 20px; }
        .ka-box {
            width: 45px; height: 55px; background: #dfe6e9; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; font-weight: 800; color: transparent;
        }
        .ka-box.revealed { background: var(--primary); color: white; }

        /* WORDLE GRID */
        .w-grid { display: grid; gap: 5px; justify-content: center; margin-bottom: 20px; }
        .w-box {
            width: 50px; height: 50px; border: 2px solid #dcdde1;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: 900; text-transform: uppercase;
            background: white;
        }
        .w-correct { background: var(--correct); color: white; border-color: var(--correct); }
        .w-present { background: var(--present); color: white; border-color: var(--present); }
        .w-absent { background: var(--absent); color: white; border-color: var(--absent); }

        /* INPUTS */
        input {
            width: 70%; padding: 12px; font-size: 1.2rem; text-align: center;
            border: 2px solid #dfe6e9; border-radius: 50px; outline: none;
            font-weight: 700; text-transform: uppercase; margin-bottom: 10px;
        }
        input:focus { border-color: #34495e; }

        button { padding: 12px 30px; border-radius: 50px; border: none; color: white; font-weight: 800; cursor: pointer; }
        .btn-c { background: var(--primary); }
        .btn-b { background: var(--bundle); }
        .btn-hint { background: #f1c40f; color: #5d4037; margin-bottom: 10px; font-size: 0.9rem; }

        .feedback { height: 30px; margin-top: 15px; font-weight: 800; font-size: 1.1rem; }

        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%; background:white;
            z-index:999; display:flex; justify-content:center; align-items:center; flex-direction:column;
        }
        .spinner { width:40px; height:40px; border:5px solid #f3f3f3; border-top:5px solid var(--primary); border-radius:50%; animation:spin 1s infinite linear; }
        @keyframes spin { 100% {transform:rotate(360deg);} }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p style="margin-top:15px; font-weight:700; color:#95a5a6;">Veriler Çekiliyor...</p>
</div>

<div class="container" id="app" style="display:none;">
    
    <div class="tabs">
        <button class="tab-btn active classic" onclick="showTab('classic')">KELİME AVI</button>
        <button class="tab-btn bundle" onclick="showTab('bundle')">BUNDLE</button>
    </div>

    <div id="classic" class="tab-content active">
        <h2 style="color:var(--primary)">Kelime Avı</h2>
        <div class="info">Soru: <span id="c-idx">1</span></div>
        <div id="c-hint" class="hint-box">...</div>
        <div id="c-board" class="ka-board"></div>
        
        <button class="btn-hint" onclick="buyLetter()">Harf Al</button><br>
        <input type="text" id="c-input" placeholder="TAHMİN"><br>
        <button class="btn-c" onclick="checkClassic()">YANITLA</button>
        <div id="c-msg" class="feedback"></div>
    </div>

    <div id="bundle" class="tab-content">
        <h2 style="color:var(--bundle)">Bundle</h2>
        <div class="info">Soru: <span id="b-idx">1</span> | Hak: <span id="b-lives">6</span></div>
        
        <div id="b-grid" class="w-grid"></div>
        
        <input type="text" id="b-input" placeholder="KELİME GİR"><br>
        <button class="btn-b" onclick="checkBundle()">KONTROL ET</button>
        <div id="b-msg" class="feedback"></div>
    </div>

</div>

<script>
    // ========================================================
    // BURAYA APPS SCRIPT URL'SİNİ YAPIŞTIR
    // ========================================================
    const API_URL = "https://script.google.com/macros/s/AKfycbz7bBi5iFtmwyAnwLovu_1AEyk4h6v3afVL4f3GvFn1lCB548wxO_Kx_qWyvOkjiNzxGA/exec"; 
    // ========================================================

    let data = { classic: [], bundle: [] };
    
    // Kelime Avı Değişkenleri
    let cIdx = 0;
    let cRevealed = [];

    // Bundle Değişkenleri
    let bIdx = 0;
    let bGuesses = [];
    let bGameOver = false;

    document.addEventListener('DOMContentLoaded', () => {
        if(API_URL.includes("BURAYA")) { alert("Lütfen Apps Script Linkini Ekleyin!"); return; }
        
        fetch(API_URL)
            .then(res => res.json())
            .then(json => {
                data = json;
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                if(data.classic.length > 0) initClassic();
                if(data.bundle.length > 0) initBundle();
            })
            .catch(err => alert("Veri çekilemedi: " + err));

        // Enter tuşları
        document.getElementById('c-input').addEventListener('keyup', e => { if(e.key==='Enter') checkClassic() });
        document.getElementById('b-input').addEventListener('keyup', e => { if(e.key==='Enter') checkBundle() });
    });

    function showTab(tab) {
        document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.querySelector('.' + tab).classList.add('active');
    }

    function toTr(s) { return s.toLocaleUpperCase('tr-TR'); }

    // === KELİME AVI ===
    function initClassic() {
        if(cIdx >= data.classic.length) {
            document.getElementById('classic').innerHTML = "<h2>Bitti!</h2><p>Tüm kelimeler bulundu.</p>";
            return;
        }
        const item = data.classic[cIdx];
        cRevealed = new Array(item.word.length).fill(false);
        
        document.getElementById('c-idx').innerText = (cIdx + 1) + "/" + data.classic.length;
        document.getElementById('c-hint').innerText = item.hint;
        document.getElementById('c-msg').innerText = "";
        document.getElementById('c-input').value = "";
        renderCBoard();
    }

    function renderCBoard() {
        const board = document.getElementById('c-board');
        board.innerHTML = "";
        const word = data.classic[cIdx].word;
        
        for(let i=0; i<word.length; i++) {
            const box = document.createElement('div');
            box.className = 'ka-box';
            if(word[i] === ' ') { 
                box.style.opacity = 0; cRevealed[i] = true; 
            } else if(cRevealed[i]) {
                box.classList.add('revealed'); box.innerText = toTr(word[i]);
            } else {
                box.innerText = "?";
            }
            board.appendChild(box);
        }
    }

    function buyLetter() {
        let closed = [];
        cRevealed.forEach((v,i) => { if(!v) closed.push(i); });
        if(closed.length > 0) {
            cRevealed[closed[Math.floor(Math.random()*closed.length)]] = true;
            renderCBoard();
        }
    }

    function checkClassic() {
        const inp = document.getElementById('c-input');
        const guess = toTr(inp.value).replace(/\s+/g,'');
        const target = toTr(data.classic[cIdx].word).replace(/\s+/g,'');
        
        if(guess === target) {
            document.getElementById('c-msg').innerText = "DOĞRU!";
            document.getElementById('c-msg').style.color = "var(--primary)";
            cRevealed.fill(true);
            renderCBoard();
            setTimeout(() => { cIdx++; initClassic(); }, 1500);
        } else {
            document.getElementById('c-msg').innerText = "YANLIŞ";
            document.getElementById('c-msg').style.color = "red";
        }
    }

    // === BUNDLE (WORDLE) ===
    function initBundle() {
        if(bIdx >= data.bundle.length) {
            document.getElementById('bundle').innerHTML = "<h2>Bitti!</h2><p>Tüm Wordle soruları tamamlandı.</p>";
            return;
        }
        bGuesses = [];
        bGameOver = false;
        const target = toTr(data.bundle[bIdx]).replace(/\s+/g,'');
        
        document.getElementById('b-idx').innerText = (bIdx + 1) + "/" + data.bundle.length;
        document.getElementById('b-lives').innerText = 6;
        document.getElementById('b-msg').innerText = "";
        document.getElementById('b-input').value = "";
        document.getElementById('b-input').disabled = false;
        document.getElementById('b-input').setAttribute('maxlength', target.length);
        document.getElementById('b-input').setAttribute('placeholder', `${target.length} HARFLİ`);

        // Grid'i kelime uzunluğuna göre ayarla
        document.getElementById('b-grid').style.gridTemplateColumns = `repeat(${target.length}, 50px)`;
        
        renderBGrid();
    }

    function renderBGrid() {
        const grid = document.getElementById('b-grid');
        grid.innerHTML = "";
        const target = toTr(data.bundle[bIdx]).replace(/\s+/g,'');
        const len = target.length;

        // Tahminleri Çiz
        bGuesses.forEach(guess => {
            const status = getColors(guess, target);
            for(let i=0; i<len; i++) {
                const box = document.createElement('div');
                box.className = `w-box ${status[i]}`;
                box.innerText = guess[i];
                grid.appendChild(box);
            }
        });

        // Boş Hakları Çiz
        const remain = 6 - bGuesses.length;
        for(let i=0; i<remain * len; i++) {
            const box = document.createElement('div');
            box.className = 'w-box';
            grid.appendChild(box);
        }
    }

    function getColors(guess, target) {
        let res = new Array(target.length).fill('w-absent');
        let tArr = target.split('');
        let gArr = guess.split('');
        let taken = new Array(target.length).fill(false);

        // Yeşil
        gArr.forEach((c, i) => {
            if(c === tArr[i]) { res[i] = 'w-correct'; taken[i] = true; }
        });
        // Sarı
        gArr.forEach((c, i) => {
            if(res[i] !== 'w-correct') {
                let found = tArr.findIndex((tc, ti) => tc === c && !taken[ti]);
                if(found !== -1) { res[i] = 'w-present'; taken[found] = true; }
            }
        });
        return res;
    }

    function checkBundle() {
        if(bGameOver) return;
        const inp = document.getElementById('b-input');
        const guess = toTr(inp.value).replace(/\s+/g,'');
        const target = toTr(data.bundle[bIdx]).replace(/\s+/g,'');

        if(guess.length !== target.length) {
            document.getElementById('b-msg').innerText = `${target.length} HARFLİ OLMALI`;
            document.getElementById('b-msg').style.color = "orange";
            return;
        }

        bGuesses.push(guess);
        inp.value = "";
        renderBGrid();
        document.getElementById('b-lives').innerText = 6 - bGuesses.length;

        if(guess === target) {
            document.getElementById('b-msg').innerText = "HARİKA!";
            document.getElementById('b-msg').style.color = "var(--correct)";
            bGameOver = true;
            inp.disabled = true;
            setTimeout(() => { bIdx++; initBundle(); }, 2000);
        } else if(bGuesses.length >= 6) {
            document.getElementById('b-msg').innerText = `CEVAP: ${target}`;
            document.getElementById('b-msg').style.color = "red";
            bGameOver = true;
            inp.disabled = true;
            setTimeout(() => { bIdx++; initBundle(); }, 3000);
        }
    }
</script>
</body>
</html>
