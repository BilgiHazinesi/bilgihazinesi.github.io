<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeynal Öğretmen - Oyun Platformu</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f6f8;
            --primary: #3498db; /* Kelime Avı */
            --bundle: #e67e22;  /* Wordle */
            --correct: #27ae60; /* Yeşil */
            --present: #f1c40f; /* Sarı */
            --absent: #95a5a6;  /* Gri */
            --text: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 600px; width: 100%;
            background: white; border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            overflow: hidden; margin-top: 10px;
            min-height: 600px;
        }

        /* --- TABLAR --- */
        .tabs { display: flex; background: #dfe6e9; }
        .tab-btn {
            flex: 1; padding: 18px; border: none; cursor: pointer;
            font-size: 1.1rem; font-weight: 800; color: #7f8c8d;
            background: transparent; transition: 0.3s;
            border-bottom: 5px solid transparent;
        }
        .tab-btn.active.tab-classic { color: var(--primary); border-bottom-color: var(--primary); background: white; }
        .tab-btn.active.tab-bundle { color: var(--bundle); border-bottom-color: var(--bundle); background: white; }

        .tab-content { display: none; padding: 20px; text-align: center; }
        .tab-content.active { display: block; animation: fade 0.4s; }
        @keyframes fade { from {opacity:0} to {opacity:1} }

        /* --- OYUN ALANLARI --- */
        h2 { margin: 0 0 5px 0; font-weight: 900; }
        .sub-info { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; font-weight: 700; }
        
        /* Kelime Avı */
        .hint-box { background: #e3f2fd; color: #1565c0; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 700; }
        .ka-container { display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; margin-bottom: 20px; }
        .ka-box {
            width: 42px; height: 52px; background: #ecf0f1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 800; color: transparent;
        }
        .ka-box.revealed { background: var(--primary); color: white; }

        /* Wordle Grid */
        .grid-container { 
            display: flex; flex-direction: column; gap: 5px; 
            align-items: center; margin-bottom: 20px; 
        }
        .grid-row { display: flex; gap: 5px; }
        .w-box {
            width: 48px; height: 48px; border: 2px solid #dee2e6;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: 900; text-transform: uppercase;
            background: white;
        }
        .w-correct { background: var(--correct); color: white; border-color: var(--correct); }
        .w-present { background: var(--present); color: white; border-color: var(--present); }
        .w-absent { background: var(--absent); color: white; border-color: var(--absent); }

        /* Kontroller */
        input[type="text"] {
            width: 70%; padding: 14px; font-size: 1.2rem; text-align: center;
            border: 2px solid #dfe6e9; border-radius: 50px; outline: none;
            font-weight: 700; text-transform: uppercase; margin-bottom: 10px;
        }
        input:focus { border-color: var(--text); }
        
        .btn { padding: 12px 30px; border-radius: 50px; border: none; color: white; font-weight: 800; cursor: pointer; }
        .btn-c { background: var(--primary); }
        .btn-b { background: var(--bundle); }
        .btn-hint { background: #f1c40f; color: #5d4037; margin-bottom: 5px; }

        .feedback { min-height: 25px; margin-top: 10px; font-weight: 800; font-size: 1.1rem; }

        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%; background:white;
            z-index:999; display:flex; justify-content:center; align-items:center; flex-direction:column;
        }
        .spinner { width:40px; height:40px; border:5px solid #eee; border-top:5px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { 100% {transform: rotate(360deg);} }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <h3 style="color:#7f8c8d; margin-top:15px;">Yükleniyor...</h3>
</div>

<div class="container" id="game-app" style="display:none;">
    
    <div class="tabs">
        <button class="tab-btn tab-classic active" onclick="openTab('classic')">KELİME AVI</button>
        <button class="tab-btn tab-bundle" onclick="openTab('bundle')">BUNDLE (WORDLE)</button>
    </div>

    <div id="classic" class="tab-content active">
        <h2 style="color:var(--primary)">Kelime Avı</h2>
        <div class="sub-info">Soru: <span id="c-idx">1</span></div>
        
        <div id="c-hint" class="hint-box">...</div>
        <div id="c-board" class="ka-container"></div>
        
        <button class="btn btn-hint" onclick="buyLetter()">Harf Al (-100)</button><br>
        <input type="text" id="c-input" placeholder="TAHMİN ET"><br>
        <button class="btn btn-c" onclick="checkClassic()">YANITLA</button>
        
        <div id="c-msg" class="feedback"></div>
    </div>

    <div id="bundle" class="tab-content">
        <h2 style="color:var(--bundle)">Bundle</h2>
        <div class="sub-info">Soru: <span id="b-idx">1</span> | Puan: <span id="b-score">0</span></div>
        <p style="font-size:0.9rem; color:#7f8c8d;">Bu kelimeyi bulmak için 6 hakkın var.</p>

        <div id="b-grid" class="grid-container"></div>

        <input type="text" id="b-input" placeholder="KELİME GİR"><br>
        <button class="btn btn-b" onclick="checkBundle()">KONTROL ET</button>
        
        <div id="b-msg" class="feedback"></div>
    </div>

</div>

<script>
    // ==========================================
    // AYARLAR: CSV LİNKİ BURAYA
    // ==========================================
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGIsfx3q4A24MbeGif6c1Nnr6NSOw5PS40df8j34MyppgdNp4T4My20jeEH0kKJrpuehciw3J_QgR/pub?gid=0&single=true&output=csv"; 
    // ==========================================

    let classicList = [];
    let bundleList = [];

    // Durum Değişkenleri
    let cState = { idx: 0, revealed: [] };
    let bState = { idx: 0, score: 0, guesses: [], gameOver: false };

    document.addEventListener('DOMContentLoaded', () => {
        fetchData();
        // Enter tuşu
        document.getElementById('c-input').addEventListener('keypress', e=>{if(e.key==='Enter') checkClassic()});
        document.getElementById('b-input').addEventListener('keypress', e=>{if(e.key==='Enter') checkBundle()});
    });

    function fetchData() {
        if(CSV_URL.includes("BURAYA")) { alert("CSV Linkini ekleyiniz!"); return; }
        fetch(CSV_URL).then(r=>r.text()).then(txt => {
            parseCSV(txt);
            document.getElementById('loader').style.display = 'none';
            document.getElementById('game-app').style.display = 'block';
            initClassic();
            initBundle();
        }).catch(e => alert("Hata: " + e));
    }

    function parseCSV(text) {
        const rows = text.split(/\r?\n/);
        for(let i=1; i<rows.length; i++) {
            // Basit virgül ayrımı
            const row = rows[i].split(',');
            if(!row || row.length < 1) continue;

            // Sütunları Temizle (Tırnak ve boşlukları sil)
            const clean = (str) => str ? str.replace(/^"|"$/g, '').trim() : "";
            
            const colA = clean(row[0]);
            const colB = clean(row[1]);
            const colC = clean(row[2]); // Sadece C sütunu

            // 1. Kural: A ve B varsa Klasik'e ekle
            if(colA.length > 0) {
                classicList.push({ word: colA, hint: colB });
            }

            // 2. Kural: C varsa Bundle'a ekle (A ve B'den bağımsız)
            if(colC.length > 0) {
                // Güvenlik: 20 karakterden uzunsa hatalı okumadır, alma.
                if(colC.length < 20) {
                    bundleList.push(colC);
                }
            }
        }
    }

    function openTab(tab) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.querySelector(`.tab-${tab}`).classList.add('active');
    }

    function toTr(s) { return s.toLocaleUpperCase('tr-TR'); }

    // === KELİME AVI MOTORU ===
    function initClassic() {
        if(cState.idx >= classicList.length) {
            document.getElementById('classic').innerHTML = "<h2>Bitti!</h2><p>Tüm kelimeler bulundu.</p>";
            return;
        }
        const q = classicList[cState.idx];
        cState.revealed = new Array(q.word.length).fill(false);
        
        document.getElementById('c-idx').innerText = (cState.idx + 1) + "/" + classicList.length;
        document.getElementById('c-hint').innerText = q.hint || "İpucu Yok";
        document.getElementById('c-msg').innerText = "";
        document.getElementById('c-input').value = "";
        renderClassicBoard();
    }

    function renderClassicBoard() {
        const board = document.getElementById('c-board');
        board.innerHTML = '';
        const w = classicList[cState.idx].word;
        for(let i=0; i<w.length; i++) {
            const b = document.createElement('div');
            b.className = 'ka-box';
            if(w[i] === ' ') {
                b.style.opacity = 0; cState.revealed[i] = true;
            } else if(cState.revealed[i]) {
                b.classList.add('revealed');
                b.innerText = toTr(w[i]);
            } else {
                b.innerText = "?";
            }
            board.appendChild(b);
        }
    }

    function buyLetter() {
        const closed = [];
        cState.revealed.forEach((r,i) => { if(!r) closed.push(i); });
        if(closed.length > 0) {
            const rnd = closed[Math.floor(Math.random()*closed.length)];
            cState.revealed[rnd] = true;
            renderClassicBoard();
        }
    }

    function checkClassic() {
        const inp = document.getElementById('c-input');
        const guess = toTr(inp.value).replace(/\s/g,'');
        const target = toTr(classicList[cState.idx].word).replace(/\s/g,'');
        
        if(guess === target) {
            document.getElementById('c-msg').innerText = "DOĞRU!";
            document.getElementById('c-msg').style.color = "var(--correct)";
            cState.revealed.fill(true);
            renderClassicBoard();
            setTimeout(() => { cState.idx++; initClassic(); }, 1500);
        } else {
            document.getElementById('c-msg').innerText = "YANLIŞ";
            document.getElementById('c-msg').style.color = "red";
        }
    }

    // === BUNDLE (WORDLE) MOTORU ===
    function initBundle() {
        if(bState.idx >= bundleList.length) {
            document.getElementById('bundle').innerHTML = `<h2>Tebrikler!</h2><p>Tüm Bundle Soruları Bitti.</p><h1>Puan: ${bState.score}</h1>`;
            return;
        }
        
        bState.guesses = [];
        bState.gameOver = false;
        const targetWord = toTr(bundleList[bState.idx]).replace(/\s/g,''); // Hedef kelime
        
        document.getElementById('b-idx').innerText = (bState.idx + 1) + "/" + bundleList.length;
        document.getElementById('b-score').innerText = bState.score;
        document.getElementById('b-msg').innerText = "";
        document.getElementById('b-input').value = "";
        document.getElementById('b-input').disabled = false;
        
        // Input limitini kelime uzunluğuna eşitle
        document.getElementById('b-input').setAttribute('maxlength', targetWord.length);
        document.getElementById('b-input').setAttribute('placeholder', `${targetWord.length} HARFLİ KELİME`);
        
        renderBundleGrid();
    }

    function renderBundleGrid() {
        const grid = document.getElementById('b-grid');
        grid.innerHTML = '';
        const target = toTr(bundleList[bState.idx]).replace(/\s/g,'');
        const len = target.length;

        // Geçmiş tahminleri çiz
        bState.guesses.forEach(guess => {
            const row = document.createElement('div');
            row.className = 'grid-row';
            
            // Renk algoritması
            const tChars = target.split('');
            const gChars = guess.split('');
            const status = new Array(len).fill('w-absent');
            const taken = new Array(len).fill(false);

            // 1. Yeşiller
            gChars.forEach((c, i) => {
                if(c === tChars[i]) { status[i] = 'w-correct'; taken[i] = true; }
            });
            // 2. Sarılar
            gChars.forEach((c, i) => {
                if(status[i] !== 'w-correct') {
                    const found = tChars.findIndex((tc, ti) => tc === c && !taken[ti]);
                    if(found !== -1) { status[i] = 'w-present'; taken[found] = true; }
                }
            });

            for(let i=0; i<len; i++) {
                const b = document.createElement('div');
                b.className = `w-box ${status[i]}`;
                b.innerText = gChars[i];
                row.appendChild(b);
            }
            grid.appendChild(row);
        });

        // Kalan hakları (Boş satırları) çiz
        const remaining = 6 - bState.guesses.length;
        for(let i=0; i<remaining; i++) {
            const row = document.createElement('div');
            row.className = 'grid-row';
            for(let j=0; j<len; j++) {
                const b = document.createElement('div');
                b.className = 'w-box';
                row.appendChild(b);
            }
            grid.appendChild(row);
        }
    }

    function checkBundle() {
        if(bState.gameOver) return;
        const inp = document.getElementById('b-input');
        const guess = toTr(inp.value.trim()).replace(/\s/g,'');
        const target = toTr(bundleList[bState.idx]).replace(/\s/g,'');

        if(guess.length !== target.length) {
            document.getElementById('b-msg').innerText = `${target.length} Harfli Olmalı!`;
            document.getElementById('b-msg').style.color = "#e67e22";
            return;
        }

        bState.guesses.push(guess);
        inp.value = "";
        renderBundleGrid();

        if(guess === target) {
            // Kazandı
            bState.score += (700 - (bState.guesses.length * 100));
            document.getElementById('b-msg').innerText = "HARİKA!";
            document.getElementById('b-msg').style.color = "var(--correct)";
            bState.gameOver = true;
            inp.disabled = true;
            setTimeout(() => { bState.idx++; initBundle(); }, 2000);
        } else if(bState.guesses.length >= 6) {
            // Kaybetti
            document.getElementById('b-msg').innerText = `CEVAP: ${target}`;
            document.getElementById('b-msg').style.color = "red";
            bState.gameOver = true;
            inp.disabled = true;
            setTimeout(() => { bState.idx++; initBundle(); }, 3000);
        }
    }

</script>
</body>
</html>
