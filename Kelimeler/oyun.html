<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeynal Ã–ÄŸretmen - EÄŸitim Platformu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        
        :root {
            --bg-color: #eef2f5;
            --card-bg: #ffffff;
            --primary: #3498db; /* Kelime AvÄ± Rengi */
            --secondary: #9b59b6; /* Bundle Rengi */
            --accent: #f1c40f; 
            --success: #2ecc71; 
            --text: #2c3e50;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .main-container {
            max-width: 650px; width: 100%;
            background: var(--card-bg); 
            border-radius: 25px; box-shadow: var(--shadow);
            overflow: hidden; position: relative;
        }

        /* --- SEKME (TAB) YAPISI --- */
        .tabs-header {
            display: flex; background: #dfe6e9; p-padding: 5px;
        }
        .tab-btn {
            flex: 1; padding: 15px; border: none; outline: none;
            cursor: pointer; font-family: 'Nunito', sans-serif;
            font-weight: 800; font-size: 1rem; color: #7f8c8d;
            background: transparent; transition: all 0.3s;
            border-bottom: 4px solid transparent;
        }
        .tab-btn.active { background: white; color: var(--text); }
        
        /* Sekme Renkleri */
        .tab-btn[data-tab="classic"].active { border-bottom-color: var(--primary); color: var(--primary); }
        .tab-btn[data-tab="bundle"].active { border-bottom-color: var(--secondary); color: var(--secondary); }

        /* --- Ä°Ã‡ERÄ°K ALANI --- */
        .tab-content { display: none; padding: 25px; text-align: center; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BaÅŸlÄ±klar */
        h2 { margin: 0 0 10px 0; font-weight: 900; font-size: 1.6rem; }
        .classic-theme h2 { color: var(--primary); }
        .bundle-theme h2 { color: var(--secondary); }

        .stats {
            display: flex; justify-content: space-between; background: #f1f2f6;
            padding: 8px 15px; border-radius: 10px; font-weight: 700; color: #7f8c8d;
            margin-bottom: 20px; font-size: 0.9rem;
        }
        .score-val { color: var(--success); font-weight: 900; }

        /* Ä°pucu Kutusu */
        .hint-box {
            background: #fff9db; border-left: 5px solid var(--accent);
            padding: 15px; border-radius: 8px; text-align: left;
            font-size: 1.1rem; line-height: 1.4; color: #5d4037;
            margin-bottom: 25px; font-weight: 700;
        }

        /* --- OYUN ALANI --- */
        .word-area {
            display: flex; flex-direction: column; align-items: center; gap: 12px; margin-bottom: 25px;
        }

        .word-row { display: flex; justify-content: center; gap: 5px; flex-wrap: nowrap; }

        .letter-box {
            width: 42px; height: 52px; background: #dfe6e9;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 800; color: transparent;
            transition: 0.2s; user-select: none; box-shadow: inset 0 -3px rgba(0,0,0,0.1);
        }
        
        /* Klasik Mod AÃ§Ä±k Harf */
        .classic-theme .letter-box.revealed { background: var(--primary); color: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }
        /* Bundle Mod AÃ§Ä±k Harf */
        .bundle-theme .letter-box.revealed { background: var(--secondary); color: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(155, 89, 182, 0.3); }
        
        /* Bundle Ã‡Ã¶zÃ¼len Grup */
        .question-group {
            width: 100%; padding: 10px; background: #fafafa; 
            border-radius: 12px; border: 1px solid #eee; display: flex; flex-direction: column; gap: 5px;
        }
        .question-group.solved { background: #e8f8f5; border-color: var(--success); }
        .question-group.solved .letter-box { background: var(--success); }

        /* Mobil */
        @media (max-width: 500px) {
            .letter-box { width: 30px; height: 40px; font-size: 1.1rem; }
            .word-row { gap: 3px; }
            .tab-btn { font-size: 0.9rem; padding: 12px; }
        }
        .word-row.long-word .letter-box { width: 22px; height: 32px; font-size: 0.9rem; }

        /* Kontrol AlanÄ± */
        .control-area { margin-top: 10px; }
        
        input[type="text"] {
            width: 70%; padding: 12px; font-size: 1.1rem; text-align: center;
            border: 2px solid #dfe6e9; border-radius: 50px; outline: none;
            font-family: 'Nunito', sans-serif; font-weight: 700; color: var(--text);
            transition: 0.3s; background: white; margin-bottom: 10px;
        }
        .classic-theme input:focus { border-color: var(--primary); }
        .bundle-theme input:focus { border-color: var(--secondary); }

        .btn {
            border: none; padding: 10px 25px; border-radius: 50px;
            font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1rem;
            cursor: pointer; color: white; margin: 5px; display: inline-block;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-hint { background: var(--accent); color: #5d4037; }
        .btn-check { background: var(--success); }

        .feedback { min-height: 25px; margin-top: 10px; font-weight: 800; font-size: 1.1rem; }

        /* YÃ¼kleme EkranÄ± */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 999; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .loader {
            width: 50px; height: 50px; border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Konfeti */
        .confetti { position: absolute; width: 10px; height: 10px; background: red; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loader"></div>
        <p style="margin-top:20px; color:#95a5a6; font-weight:bold;">Sorular YÃ¼kleniyor...</p>
    </div>

    <div class="main-container" id="game-container" style="display:none;">
        
        <div class="tabs-header">
            <button class="tab-btn active" onclick="switchTab('classic')" data-tab="classic">ðŸ§© KELÄ°MELER</button>
            <button class="tab-btn" onclick="switchTab('bundle')" data-tab="bundle">ðŸ“š BUNDLE TAHMÄ°N</button>
        </div>

        <div id="tab-classic" class="tab-content classic-theme active">
            <h2>Kelime AvÄ±</h2>
            <div class="stats">
                <span id="c-count">Soru: 1/?</span>
                <span>Puan: <span id="c-score" class="score-val">0</span></span>
            </div>

            <div id="c-hint" class="hint-box">...</div>
            <div id="c-word-area" class="word-area"></div>
            
            <div class="control-area">
                <button class="btn btn-hint" onclick="getLetterClassic()">Harf Al (-100)</button><br>
                <input type="text" id="c-input" placeholder="CevabÄ± yaz..." autocomplete="off"><br>
                <button class="btn btn-check" onclick="checkClassic()">YANITLA</button>
            </div>
            <div id="c-feedback" class="feedback"></div>
        </div>

        <div id="tab-bundle" class="tab-content bundle-theme">
            <h2 id="b-title">Bundle Konusu</h2>
            <div class="stats">
                <span id="b-count">BÃ¶lÃ¼m: 1/?</span>
                <span>Puan: <span id="b-score" class="score-val">0</span></span>
            </div>

            <div id="b-hint" class="hint-box">...</div>
            <div id="b-word-area" class="word-area"></div>
            
            <div class="control-area">
                <button class="btn btn-hint" onclick="getLetterBundle()">Harf Al (-100)</button><br>
                <input type="text" id="b-input" placeholder="CevabÄ± yaz..." autocomplete="off"><br>
                <button class="btn btn-check" onclick="checkBundle()">YANITLA</button>
            </div>
            <div id="b-feedback" class="feedback"></div>
        </div>

    </div>

    <script>
        // ============================================================
        // AYARLAR: CSV LÄ°NKÄ°NÄ° BURAYA YAPIÅžTIR
        // ============================================================
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGIsfx3q4A24MbeGif6c1Nnr6NSOw5PS40df8j34MyppgdNp4T4My20jeEH0kKJrpuehciw3J_QgR/pub?gid=0&single=true&output=csv"; 
        // ============================================================

        // VERÄ° DEPOLARI
        let classicData = [];
        let bundleData = [];

        // OYUN DURUMLARI (STATE)
        let state = {
            classic: { idx: 0, score: 0, finished: false },
            bundle: { idx: 0, score: 0, finished: false }
        };

        // Mevcut gÃ¶rÃ¼nÃ¼m
        let activeTab = 'classic'; 

        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            
            // Enter tuÅŸu desteÄŸi
            document.getElementById('c-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkClassic(); });
            document.getElementById('b-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkBundle(); });
        });

        function fetchData() {
            if(SHEET_CSV_URL.includes("BURAYA_GOOGLE")) {
                alert("LÃ¼tfen CSV linkini ekleyiniz!");
                return;
            }
            fetch(SHEET_CSV_URL)
                .then(r => r.text())
                .then(data => {
                    parseCSV(data);
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('game-container').style.display = 'block';
                    
                    // Ä°lk yÃ¼klemeler
                    loadClassicQuestion();
                    loadBundleQuestion();
                })
                .catch(e => alert("Hata: " + e));
        }

        // --- CSV AYRIÅžTIRMA (SENÄ°N Ä°STEDÄ°ÄžÄ°N MANTIK) ---
        function parseCSV(text) {
            const rows = text.split(/\r?\n/);
            
            for(let i=1; i<rows.length; i++) {
                const row = rows[i].split(',');
                if(row.length < 2) continue;

                const colA = row[0].trim(); // Kelime (Klasik) veya Konu (Bundle)
                const colB = row[1] ? row[1].trim() : ""; // Ä°pucu
                const colC = row.length > 2 ? row.slice(2).join(',').trim() : ""; // Cevaplar (Bundle)

                if (colC.length > 0) {
                    // --- BUNDLE (C Dolu) ---
                    if(colA.length > 0) {
                        const words = colC.split(',').map(w => w.trim()).filter(w => w.length > 0);
                        bundleData.push({
                            title: colA,
                            hint: colB,
                            items: words.map(w => ({
                                word: w,
                                solved: false,
                                revealed: new Array(w.replace(/\s+/g, '').length).fill(false)
                            }))
                        });
                    }
                } else {
                    // --- KLASÄ°K (C BoÅŸ, A ve B Dolu) ---
                    if(colA.length > 0) {
                        classicData.push({
                            word: colA,
                            hint: colB,
                            revealed: new Array(colA.replace(/\s+/g, '').length).fill(false)
                        });
                    }
                }
            }
        }

        // --- SEKME DEÄžÄ°ÅžTÄ°RME ---
        function switchTab(tabName) {
            activeTab = tabName;
            
            // ButonlarÄ± gÃ¼ncelle
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.tab === tabName) btn.classList.add('active');
            });

            // Ä°Ã§eriÄŸi gÃ¼ncelle
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function toTrUpper(str) { return str.toLocaleUpperCase('tr-TR'); }

        // ==========================================
        // 1. SEKME: KLASÄ°K OYUN MANTIÄžI
        // ==========================================
        function loadClassicQuestion() {
            if(classicData.length === 0) {
                document.getElementById('tab-classic').innerHTML = "<h2>Sorular Bitti!</h2>";
                return;
            }
            if(state.classic.idx >= classicData.length) {
                document.getElementById('tab-classic').innerHTML = `<h2>Tebrikler!</h2><p>TÃ¼m kelimeler bitti.</p><h1>${state.classic.score}</h1>`;
                startConfetti();
                return;
            }

            const q = classicData[state.classic.idx];
            document.getElementById('c-count').innerText = `Soru: ${state.classic.idx + 1}/${classicData.length}`;
            document.getElementById('c-score').innerText = state.classic.score;
            document.getElementById('c-hint').innerText = q.hint;
            document.getElementById('c-input').value = "";
            document.getElementById('c-feedback').innerText = "";

            const area = document.getElementById('c-word-area');
            area.innerHTML = '';
            renderWordRow(q.word, q.revealed, area, false, 'c');
        }

        function getLetterClassic() {
            const q = classicData[state.classic.idx];
            let closed = [];
            q.revealed.forEach((r, i) => { if(!r) closed.push(i); });

            if(closed.length > 0) {
                const rnd = closed[Math.floor(Math.random() * closed.length)];
                q.revealed[rnd] = true;
                state.classic.score -= 100;
                
                // UI GÃ¼ncelle
                loadClassicQuestion(); // Re-render
                
                if(q.revealed.every(Boolean)) {
                     // Harflerle bittiyse otomatik geÃ§
                     setTimeout(() => {
                         state.classic.idx++;
                         loadClassicQuestion();
                     }, 1500);
                }
            }
        }

        function checkClassic() {
            const input = document.getElementById('c-input');
            const guess = toTrUpper(input.value.trim()).replace(/\s+/g, '');
            const q = classicData[state.classic.idx];
            const target = toTrUpper(q.word).replace(/\s+/g, '');

            if(guess === target) {
                document.getElementById('c-feedback').innerText = "DOÄžRU!";
                document.getElementById('c-feedback').style.color = "var(--success)";
                state.classic.score += 500;
                q.revealed.fill(true);
                loadClassicQuestion(); // Harfleri aÃ§
                setTimeout(() => {
                    state.classic.idx++;
                    loadClassicQuestion();
                }, 1500);
            } else {
                document.getElementById('c-feedback').innerText = "YANLIÅž";
                document.getElementById('c-feedback').style.color = "red";
            }
        }


        // ==========================================
        // 2. SEKME: BUNDLE OYUN MANTIÄžI
        // ==========================================
        function loadBundleQuestion() {
            if(bundleData.length === 0) {
                document.getElementById('tab-bundle').innerHTML = "<h2>Bundle BulunamadÄ±</h2>";
                return;
            }
            if(state.bundle.idx >= bundleData.length) {
                document.getElementById('tab-bundle').innerHTML = `<h2>Harika!</h2><p>TÃ¼m bundlelar bitti.</p><h1>${state.bundle.score}</h1>`;
                startConfetti();
                return;
            }

            const q = bundleData[state.bundle.idx];
            document.getElementById('b-title').innerText = q.title;
            document.getElementById('b-count').innerText = `BÃ¶lÃ¼m: ${state.bundle.idx + 1}/${bundleData.length}`;
            document.getElementById('b-score').innerText = state.bundle.score;
            document.getElementById('b-hint').innerText = q.hint;
            document.getElementById('b-input').value = "";
            document.getElementById('b-feedback').innerText = "";

            const area = document.getElementById('b-word-area');
            area.innerHTML = '';

            q.items.forEach((item, idx) => {
                const group = document.createElement('div');
                group.className = 'question-group' + (item.solved ? ' solved' : '');
                renderWordRow(item.word, item.revealed, group, item.solved, 'b');
                area.appendChild(group);
            });
        }

        function getLetterBundle() {
            const q = bundleData[state.bundle.idx];
            let candidates = [];
            
            q.items.forEach((item, iIdx) => {
                if(!item.solved) {
                    item.revealed.forEach((r, cIdx) => { if(!r) candidates.push({iIdx, cIdx}); });
                }
            });

            if(candidates.length > 0) {
                const choice = candidates[Math.floor(Math.random() * candidates.length)];
                const item = q.items[choice.iIdx];
                item.revealed[choice.cIdx] = true;
                state.bundle.score -= 100;

                if(item.revealed.every(Boolean) && !item.solved) {
                    item.solved = true;
                }

                loadBundleQuestion(); // Re-render

                if(q.items.every(i => i.solved)) {
                    setTimeout(() => {
                        state.bundle.idx++;
                        loadBundleQuestion();
                    }, 2000);
                }
            }
        }

        function checkBundle() {
            const input = document.getElementById('b-input');
            const guess = toTrUpper(input.value.trim()).replace(/\s+/g, '');
            const q = bundleData[state.bundle.idx];
            let found = false;

            q.items.forEach(item => {
                if(!item.solved) {
                    const target = toTrUpper(item.word).replace(/\s+/g, '');
                    if(guess === target) {
                        item.solved = true;
                        item.revealed.fill(true);
                        state.bundle.score += 300;
                        found = true;
                    }
                }
            });

            if(found) {
                document.getElementById('b-feedback').innerText = "BULUNDU!";
                document.getElementById('b-feedback').style.color = "var(--success)";
                loadBundleQuestion();
                
                if(q.items.every(i => i.solved)) {
                    setTimeout(() => {
                        state.bundle.idx++;
                        loadBundleQuestion();
                    }, 2000);
                }
            } else {
                document.getElementById('b-feedback').innerText = "LÄ°STEDE YOK";
                document.getElementById('b-feedback').style.color = "red";
            }
        }


        // --- ORTAK RENDER FONKSÄ°YONU ---
        function renderWordRow(wordStr, revealedArr, container, isSolved, prefix) {
            const row = document.createElement('div');
            row.className = 'word-row';
            if(wordStr.length > 11) row.classList.add('long-word');

            const chars = wordStr.split('');
            let cCount = 0;

            chars.forEach(char => {
                if(char === ' ') {
                    const spacer = document.createElement('div');
                    spacer.style.width = "10px";
                    row.appendChild(spacer);
                } else {
                    const box = document.createElement('div');
                    box.className = 'letter-box';
                    if(isSolved || revealedArr[cCount]) {
                        box.classList.add('revealed');
                        box.innerText = toTrUpper(char);
                    } else {
                        box.innerText = "?";
                    }
                    row.appendChild(box);
                    cCount++;
                }
            });
            container.appendChild(row);
        }

        function startConfetti() {
            const colors = ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6'];
            for(let i=0; i<50; i++) {
                let c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.background = colors[Math.floor(Math.random() * colors.length)];
                c.style.animationDuration = (Math.random() * 3 + 2) + 's';
                document.body.appendChild(c);
            }
        }

    </script>
</body>
</html>
