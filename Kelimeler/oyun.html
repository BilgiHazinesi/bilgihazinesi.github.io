<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeynal Öğretmen - Eğitim Oyunları</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f2f5;
            --primary: #3498db; /* Kelime Avı Mavi */
            --bundle: #e67e22;  /* Bundle Turuncu */
            --correct: #27ae60; /* Yeşil */
            --present: #f1c40f; /* Sarı */
            --absent: #7f8c8d;  /* Gri */
            --text: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 600px; width: 100%;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden; min-height: 600px;
        }

        /* SEKME BUTONLARI */
        .tabs { display: flex; background: #dfe6e9; }
        .tab-btn {
            flex: 1; padding: 18px; border: none; cursor: pointer;
            font-size: 1.1rem; font-weight: 800; color: #7f8c8d;
            background: transparent; transition: 0.3s;
            border-bottom: 5px solid transparent;
        }
        .tab-btn.active-classic { color: var(--primary); border-bottom-color: var(--primary); background: white; }
        .tab-btn.active-bundle { color: var(--bundle); border-bottom-color: var(--bundle); background: white; }

        .tab-content { display: none; padding: 20px; text-align: center; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { margin: 0 0 10px 0; font-weight: 900; }
        .hint-box {
            background: #fff3cd; color: #856404; padding: 15px;
            border-radius: 10px; margin-bottom: 20px; font-weight: 700;
        }

        /* --- KELİME AVI STİLLERİ --- */
        .word-container {
            display: flex; justify-content: center; gap: 5px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .ka-box {
            width: 45px; height: 55px; background: #e9ecef; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; font-weight: 800; color: transparent;
            box-shadow: inset 0 -3px rgba(0,0,0,0.1);
        }
        .ka-box.revealed { background: var(--primary); color: white; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }

        /* --- BUNDLE (WORDLE) STİLLERİ --- */
        .grid {
            display: grid; gap: 5px; justify-content: center; margin-bottom: 20px;
        }
        .grid-row { display: flex; gap: 5px; justify-content: center; }
        .w-box {
            width: 50px; height: 50px; border: 2px solid #dee2e6;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: 900; text-transform: uppercase;
            color: var(--text);
        }
        /* Bundle Renkleri */
        .w-correct { background-color: var(--correct); color: white; border-color: var(--correct); }
        .w-present { background-color: var(--present); color: white; border-color: var(--present); }
        .w-absent  { background-color: var(--absent); color: white; border-color: var(--absent); }

        /* ORTAK KONTROLLER */
        input[type="text"] {
            width: 70%; padding: 15px; font-size: 1.2rem; text-align: center;
            border: 2px solid #dfe6e9; border-radius: 50px; outline: none;
            font-weight: 700; margin-bottom: 10px; text-transform: uppercase;
        }
        input[type="text"]:focus { border-color: var(--primary); }
        
        button {
            padding: 12px 30px; border-radius: 50px; border: none;
            font-weight: 800; cursor: pointer; font-size: 1rem; color: white;
            transition: transform 0.1s; margin: 5px;
        }
        button:active { transform: scale(0.95); }
        .btn-hint { background: #f39c12; }
        .btn-submit { background: var(--primary); }
        .btn-bundle { background: var(--bundle); }
        
        .feedback { height: 30px; font-weight: 800; margin-top: 10px; font-size: 1.2rem; }

        /* Yükleme Ekranı */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 1000; display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .spinner {
            width: 40px; height: 40px; border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <h3 style="color:#7f8c8d; margin-top:20px;">Sorular Yükleniyor...</h3>
</div>

<div class="container" id="game-container" style="display:none;">
    
    <div class="tabs">
        <button class="tab-btn active-classic" onclick="openTab('classic')" id="btn-tab-classic">KELİME AVI</button>
        <button class="tab-btn" onclick="openTab('bundle')" id="btn-tab-bundle">BUNDLE (WORDLE)</button>
    </div>

    <div id="classic" class="tab-content active">
        <h2 style="color:var(--primary)">Kelime Avı</h2>
        <div style="color:#7f8c8d; margin-bottom:15px; font-weight:700;">
            Soru: <span id="c-idx">1</span> | Puan: <span id="c-score" style="color:var(--primary)">0</span>
        </div>
        
        <div class="hint-box" id="c-hint">...</div>
        <div class="word-container" id="c-board"></div>
        
        <div>
            <button class="btn-hint" onclick="buyLetter()">Harf Al (-100)</button>
            <br>
            <input type="text" id="c-input" placeholder="TAHMİNİNİZ" maxlength="20">
            <br>
            <button class="btn-submit" onclick="checkClassic()">YANITLA</button>
        </div>
        <div class="feedback" id="c-msg"></div>
    </div>

    <div id="bundle" class="tab-content">
        <h2 style="color:var(--bundle)">Bundle Tahmin</h2>
        <p style="color:#7f8c8d; font-size:0.9rem;">Gizli kelimeyi 6 denemede bul!</p>
        <div style="color:#7f8c8d; margin-bottom:15px; font-weight:700;">
            Bölüm: <span id="b-idx">1</span> | Puan: <span id="b-score" style="color:var(--bundle)">0</span>
        </div>

        <div class="grid" id="b-grid"></div>

        <div id="b-controls">
            <input type="text" id="b-input" placeholder="KELİME GİRİN" maxlength="20">
            <br>
            <button class="btn-bundle" onclick="checkBundle()">KONTROL ET</button>
        </div>
        <div class="feedback" id="b-msg"></div>
    </div>

</div>

<script>
    // ==========================================
    // AYARLAR: CSV LİNKİNİ BURAYA YAPIŞTIRIN
    // ==========================================
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGIsfx3q4A24MbeGif6c1Nnr6NSOw5PS40df8j34MyppgdNp4T4My20jeEH0kKJrpuehciw3J_QgR/pub?gid=0&single=true&output=csv";
    // ==========================================

    let classicData = [];
    let bundleData = []; 
    
    // Oyun Durumları
    let cState = { idx: 0, score: 0, revealed: [] };
    let bState = { idx: 0, score: 0, guesses: [], gameOver: false };

    document.addEventListener('DOMContentLoaded', () => {
        fetchData();
        // Enter tuşu desteği
        document.getElementById('c-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkClassic(); });
        document.getElementById('b-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkBundle(); });
    });

    function fetchData() {
        if(CSV_URL.includes("BURAYA")) { alert("Lütfen CSV Linkini Ekleyin!"); return; }
        fetch(CSV_URL).then(r => r.text()).then(txt => {
            parseCSV(txt);
            document.getElementById('loader').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            initClassic();
            initBundle();
        }).catch(e => alert("Hata: " + e));
    }

    // --- HATASIZ AYRIŞTIRMA ---
    function parseCSV(text) {
        // Satır satır böl
        const rows = text.split(/\r?\n/);
        
        for(let i=1; i<rows.length; i++) {
            let row = rows[i];
            
            // Boş satırları atla
            if(!row || row.trim() === '') continue;

            // Satırı virgülle ayır
            const parts = row.split(',');

            // Parçaları temizle (Tırnak işaretleri veya boşluk varsa sil)
            const colA = parts[0] ? parts[0].replace(/^"|"$/g, '').trim() : "";
            const colB = parts[1] ? parts[1].replace(/^"|"$/g, '').trim() : "";
            
            // C Sütunu (index 2) var mı kontrol et
            const colC = parts[2] ? parts[2].replace(/^"|"$/g, '').trim() : "";

            // 1. Kural: A ve B doluysa -> Kelime Avı
            if(colA.length > 0 && colB.length > 0) {
                classicData.push({ word: colA, hint: colB });
            }

            // 2. Kural: C doluysa -> Bundle (A ve B'ye bakmaz)
            if(colC.length > 0) {
                // 67 harfli hatası burada çözülüyor: Sadece colC alınıyor.
                bundleData.push(colC);
            }
        }
    }

    function toTrUpper(s) { return s.toLocaleUpperCase('tr-TR'); }

    // --- SEKME GEÇİŞİ ---
    function openTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.className = 'tab-btn');
        
        document.getElementById(tab).classList.add('active');
        document.getElementById('btn-tab-' + tab).classList.add(tab === 'classic' ? 'active-classic' : 'active-bundle');
    }

    // ==========================================
    // 1. KELİME AVI (KLASİK)
    // ==========================================
    function initClassic() {
        if(cState.idx >= classicData.length) {
            document.getElementById('classic').innerHTML = `<h2>Tebrikler!</h2><h1>Puan: ${cState.score}</h1>`;
            return;
        }
        const q = classicData[cState.idx];
        cState.revealed = new Array(q.word.length).fill(false);
        
        document.getElementById('c-idx').innerText = (cState.idx + 1) + "/" + classicData.length;
        document.getElementById('c-score').innerText = cState.score;
        document.getElementById('c-hint').innerText = q.hint;
        document.getElementById('c-input').value = "";
        document.getElementById('c-msg').innerText = "";
        
        renderClassicBoard();
    }

    function renderClassicBoard() {
        const board = document.getElementById('c-board');
        board.innerHTML = '';
        const word = classicData[cState.idx].word;
        
        for(let i=0; i<word.length; i++) {
            const box = document.createElement('div');
            box.className = 'ka-box';
            if(word[i] === ' ') {
                box.style.opacity = 0; 
                cState.revealed[i] = true;
            } else if(cState.revealed[i]) {
                box.classList.add('revealed');
                box.innerText = toTrUpper(word[i]);
            } else {
                box.innerText = "?";
            }
            board.appendChild(box);
        }
    }

    function buyLetter() {
        const closed = [];
        cState.revealed.forEach((r, i) => { if(!r) closed.push(i); });
        if(closed.length > 0) {
            const rnd = closed[Math.floor(Math.random() * closed.length)];
            cState.revealed[rnd] = true;
            cState.score -= 100;
            renderClassicBoard();
            document.getElementById('c-score').innerText = cState.score;
        }
    }

    function checkClassic() {
        const guess = toTrUpper(document.getElementById('c-input').value.trim()).replace(/\s/g, '');
        const target = toTrUpper(classicData[cState.idx].word).replace(/\s/g, '');
        
        if(guess === target) {
            cState.score += 500;
            cState.idx++;
            document.getElementById('c-msg').style.color = "var(--correct)";
            document.getElementById('c-msg').innerText = "DOĞRU!";
            setTimeout(initClassic, 1500);
        } else {
            document.getElementById('c-msg').style.color = "red";
            document.getElementById('c-msg').innerText = "YANLIŞ";
        }
    }

    // ==========================================
    // 2. BUNDLE (WORDLE)
    // ==========================================
    function initBundle() {
        if(bState.idx >= bundleData.length) {
            document.getElementById('bundle').innerHTML = `<h2>Tüm Bundlelar Bitti!</h2><h1>Puan: ${bState.score}</h1>`;
            return;
        }
        bState.guesses = [];
        bState.gameOver = false;
        
        document.getElementById('b-idx').innerText = (bState.idx + 1) + "/" + bundleData.length;
        document.getElementById('b-score').innerText = bState.score;
        document.getElementById('b-input').value = "";
        document.getElementById('b-input').disabled = false;
        document.getElementById('b-msg').innerText = "";
        
        // Input uzunluğunu kelimeye göre ayarla
        const cleanWord = bundleData[bState.idx].replace(/\s/g,'');
        const targetLen = cleanWord.length;
        
        document.getElementById('b-input').setAttribute('maxlength', targetLen);
        document.getElementById('b-input').setAttribute('placeholder', `${targetLen} HARFLİ KELİME`);

        renderBundleGrid();
    }

    function renderBundleGrid() {
        const grid = document.getElementById('b-grid');
        grid.innerHTML = '';
        const target = toTrUpper(bundleData[bState.idx]).replace(/\s/g, '');
        const len = target.length;

        // Geçmiş tahminleri çiz
        bState.guesses.forEach(guess => {
            const row = document.createElement('div');
            row.className = 'grid-row';
            
            // Renk Mantığı
            const targetChars = target.split('');
            const guessChars = guess.split('');
            const status = new Array(len).fill('w-absent');
            const taken = new Array(len).fill(false);

            // Yeşilleri Bul
            guessChars.forEach((char, i) => {
                if(char === targetChars[i]) {
                    status[i] = 'w-correct';
                    taken[i] = true;
                }
            });

            // Sarıları Bul
            guessChars.forEach((char, i) => {
                if(status[i] !== 'w-correct') {
                    const foundIdx = targetChars.findIndex((c, tI) => c === char && !taken[tI]);
                    if(foundIdx !== -1) {
                        status[i] = 'w-present';
                        taken[foundIdx] = true;
                    }
                }
            });

            for(let i=0; i<len; i++) {
                const box = document.createElement('div');
                box.className = `w-box ${status[i]}`;
                box.innerText = guessChars[i];
                row.appendChild(box);
            }
            grid.appendChild(row);
        });

        // Kalan hakları boş kutu olarak çiz (Toplam 6 hak)
        const remaining = 6 - bState.guesses.length;
        for(let i=0; i<remaining; i++) {
            const row = document.createElement('div');
            row.className = 'grid-row';
            for(let j=0; j<len; j++) {
                const box = document.createElement('div');
                box.className = 'w-box';
                row.appendChild(box);
            }
            grid.appendChild(row);
        }
    }

    function checkBundle() {
        if(bState.gameOver) return;
        
        const input = document.getElementById('b-input');
        const guess = toTrUpper(input.value.trim()).replace(/\s/g, '');
        const target = toTrUpper(bundleData[bState.idx]).replace(/\s/g, '');

        if(guess.length !== target.length) {
            document.getElementById('b-msg').innerText = `${target.length} Harfli Olmalı!`;
            document.getElementById('b-msg').style.color = "orange";
            return;
        }

        bState.guesses.push(guess);
        input.value = "";
        renderBundleGrid();

        if(guess === target) {
            // KAZANDI
            bState.score += (700 - (bState.guesses.length * 100)); 
            document.getElementById('b-msg').innerText = "HARİKA!";
            document.getElementById('b-msg').style.color = "var(--correct)";
            bState.gameOver = true;
            input.disabled = true;
            setTimeout(() => {
                bState.idx++;
                initBundle();
            }, 2000);
        } else if(bState.guesses.length >= 6) {
            // KAYBETTİ
            document.getElementById('b-msg').innerText = `Bilemedin! Cevap: ${target}`;
            document.getElementById('b-msg').style.color = "red";
            bState.gameOver = true;
            input.disabled = true;
            setTimeout(() => {
                bState.idx++; 
                initBundle();
            }, 3000);
        }
    }

</script>
</body>
</html>
