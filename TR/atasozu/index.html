<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atasözleri Dünyası</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --papyrus-bg: #fdf5e6; 
            --text-primary: #5a452d; 
            --text-secondary: #7a654d;
            --accent-color: #8B4513; 
            --border-color: #c8b79b; 
            --shadow-color: rgba(0, 0, 0, 0.15);
            --box-bg: #fffaf0; 
            --correct-bg: #e8f5e9; 
            --correct-border: #4CAF50;
            --incorrect-bg: #ffebee; 
            --incorrect-border: #f44336;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Kalam', cursive; 
            background-color: var(--papyrus-bg); 
            color: var(--text-primary); 
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png'); 
            background-attachment: fixed; 
            padding: clamp(10px, 2vw, 15px); 
        }
        .home-button { 
            position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; 
            background-color: var(--accent-color); 
            color: var(--papyrus-bg); 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; text-decoration: none; 
            box-shadow: 0 4px 10px var(--shadow-color); 
            z-index: 1000; transition: transform 0.2s ease; user-select: none; 
        }
        .home-button:hover { transform: scale(1.1); }
        .container { 
            max-width: 1200px; margin: 0 auto; 
            background-color: rgba(253, 245, 230, 0.85); 
            border: 2px solid var(--border-color); 
            border-radius: 10px; 
            box-shadow: 0 5px 20px var(--shadow-color); 
            padding: clamp(15px, 3vw, 30px); 
        }
        header { 
            text-align: center; margin-bottom: 20px; 
            border-bottom: 3px double var(--border-color); 
            padding-bottom: 20px; 
        }
        header h1 { 
            font-family: 'Cinzel Decorative', cursive; 
            font-size: clamp(2.2rem, 5vw, 3.5rem); 
            color: var(--accent-color); 
            text-shadow: 1px 1px 2px var(--shadow-color); 
        }
        .sub-tab-container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            margin-bottom: 25px; 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 10px;
            gap: 10px;
        }
        .sub-tab-link { 
            font-family: 'Cinzel Decorative', cursive; 
            padding: 8px 16px; 
            font-size: 1.1rem; 
            cursor: pointer; 
            background-color: var(--box-bg); 
            border: 2px solid var(--border-color); 
            border-radius: 8px; 
            transition: all 0.3s ease; 
        }
        .sub-tab-link:hover { background-color: var(--accent-color); color: var(--box-bg); }
        .sub-tab-link.active { 
            background-color: var(--accent-color); 
            color: var(--box-bg); 
            border-color: var(--accent-color); 
        }
        .sub-tab-content { display: none; animation: fadeIn 0.5s ease-in-out; }
        .sub-tab-content.active { display: block; }

        .controls { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; margin: 25px 0; }
        .controls button { 
            font-family: 'Cinzel Decorative', cursive; 
            font-weight: 700; 
            font-size: 1.1rem;
            padding: 8px 16px;
            border-radius: 6px; 
            border: 2px solid var(--border-color); 
            background-color: var(--accent-color); 
            color: var(--papyrus-bg); 
            cursor: pointer; 
            transition: transform 0.2s ease, box-shadow 0.2s ease; 
        }
        .controls button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); }
        .controls button:disabled { background-color: var(--text-secondary); color: #fffaf0; cursor: not-allowed; transform: none; box-shadow: none;}

        /* Atasözü Kartları */
        #proverb-cards-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .proverb-card { background-color: transparent; height: 180px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .proverb-card.flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px; border-radius: 10px; border: 2px solid var(--border-color); box-shadow: 0 4px 8px var(--shadow-color); }
        .card-front { background: var(--box-bg); font-size: 1.4rem; font-weight: bold; }
        .card-back { background: var(--accent-color); color: var(--box-bg); transform: rotateY(180deg); font-size: 1.1rem; }
        #proverb-pagination { margin-top: 20px; text-align: center; }
        #proverb-pagination button { margin: 0 5px; font-size: 1rem; padding: 6px 12px; }

        /* Anlamını Bul & Zorlu Anlam Bulma */
        .find-meaning-game { text-align: center; max-width: 900px; margin: 0 auto; }
        .meaning-question { background: var(--box-bg); padding: 20px; border-radius: 8px; border: 2px dashed var(--border-color); font-size: 1.2rem; margin-bottom: 20px; line-height: 1.6; }
        .meaning-options { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 600px) { .meaning-options { grid-template-columns: 1fr 1fr; } }
        .meaning-option { padding: 15px; font-size: 1.1rem; border-radius: 8px; border: 2px solid var(--border-color); background: #fff; cursor: pointer; transition: all 0.3s ease; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .meaning-option:hover { transform: translateY(-3px); box-shadow: 0 4px 8px var(--shadow-color); }
        .meaning-option.correct { background: var(--correct-bg); border-color: var(--correct-border); color: #155724; }
        .meaning-option.incorrect { background: var(--incorrect-bg); border-color: var(--incorrect-border); color: #721c24; }

        /* Boşluk Doldurma */
        .fill-blank-game { text-align: center; max-width: 800px; margin: 0 auto; }
        .fill-blank-sentence { font-size: 1.5rem; background-color: var(--box-bg); padding: 30px 20px; border: 2px dashed var(--border-color); border-radius: 8px; margin-bottom: 20px; line-height: 2; }
        .fill-blank-input { font-family: 'Kalam', cursive; font-size: 1.5rem; border: none; border-bottom: 3px dotted var(--accent-color); background: transparent; text-align: center; width: 150px; color: var(--text-primary); }
        .fill-blank-input:focus { outline: none; border-bottom-color: var(--accent-color); }
        #fill-blank-feedback { min-height: 24px; margin-top: 15px; font-weight: bold; font-size: 1.2rem; }
    </style>
</head>
<body>
    <a href="https://bilgihazinesi.github.io/" class="home-button" title="Ana Sayfaya Dön">&#127968;</a>
    <div class="container">
        <header><h1>Atasözleri Dünyası</h1></header>

        <div class="sub-tab-container" id="proverbs-sub-tabs">
            <button class="sub-tab-link active" data-sub-tab="sub-tab-1">Atasözü Kartları</button>
            <button class="sub-tab-link" data-sub-tab="sub-tab-2">Anlamını Bul</button>
            <button class="sub-tab-link" data-sub-tab="sub-tab-3">Boşluk Doldurma</button>
            <button class="sub-tab-link" data-sub-tab="sub-tab-4">Zorlu Anlam Bulma</button>
        </div>

        <div class="sub-tab-content-container">
            <div id="sub-tab-1" class="sub-tab-content active">
                <div id="proverb-cards-container"></div>
                <div id="proverb-pagination" class="controls"></div>
            </div>
            <div id="sub-tab-2" class="sub-tab-content">
                <div class="find-meaning-game">
                    <div id="meaning-question-container" class="meaning-question"></div>
                    <div id="meaning-options-container" class="meaning-options"></div>
                    <div class="controls" style="margin-top: 20px;">
                        <button id="new-meaning-question-btn">Yeni Soru</button>
                    </div>
                </div>
            </div>
            <div id="sub-tab-3" class="sub-tab-content">
                <div class="fill-blank-game">
                    <div id="fill-blank-sentence-container" class="fill-blank-sentence"></div>
                    <div id="fill-blank-feedback"></div>
                    <div class="controls" style="margin-top: 20px;">
                         <button id="fill-blank-check-btn">Kontrol Et</button>
                         <button id="new-fill-blank-btn">Yeni Soru</button>
                    </div>
                </div>
            </div>
            <div id="sub-tab-4" class="sub-tab-content">
                 <div class="find-meaning-game">
                    <div id="challenging-question-container" class="meaning-question"></div>
                    <div id="challenging-options-container" class="meaning-options"></div>
                    <div class="controls" style="margin-top: 20px;">
                        <button id="new-challenging-question-btn">Yeni Soru</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            async function initializeProverbsApp() {
                try {
                    const response = await fetch('atasozleri.json');
                    if (!response.ok) {
                        throw new Error(`HTTP hatası! Durum: ${response.status}`);
                    }
                    const proverbsData = await response.json();
                    
                    runAllProverbActivities(proverbsData);

                } catch (error) {
                    console.error('Atasözleri yüklenirken bir hata oluştu:', error);
                    const container = document.querySelector('.sub-tab-content-container');
                    container.innerHTML = `<p style="color: red; text-align: center; font-size: 1.2rem;">Atasözleri yüklenemedi. Lütfen 'atasozleri.json' dosyasının bu HTML dosyasıyla aynı klasörde olduğundan emin olun.</p>`;
                }
            }

            function runAllProverbActivities(proverbsData) {
                const subTabs = document.querySelectorAll('.sub-tab-link');
                const subTabContents = document.querySelectorAll('.sub-tab-content');
                subTabs.forEach(subTab => {
                    subTab.addEventListener('click', () => {
                        subTabs.forEach(item => item.classList.remove('active'));
                        subTab.classList.add('active');
                        const targetId = subTab.getAttribute('data-sub-tab');
                        subTabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === targetId) { content.classList.add('active'); }
                        });
                    });
                });

                // --- 1. Alıştırma: Atasözü Kartları ---
                const cardsContainer = document.getElementById('proverb-cards-container');
                const paginationContainer = document.getElementById('proverb-pagination');
                const itemsPerPage = 12;
                let currentPage = 1;

                function displayCards(page) {
                    cardsContainer.innerHTML = ''; page--; 
                    const start = itemsPerPage * page; const end = start + itemsPerPage;
                    const paginatedItems = proverbsData.slice(start, end);
                    for (const proverb of paginatedItems) {
                        const card = document.createElement('div'); card.className = 'proverb-card';
                        card.innerHTML = `<div class="card-inner"><div class="card-face card-front">${proverb.söz}</div><div class="card-face card-back">${proverb.anlam}</div></div>`;
                        card.addEventListener('click', () => card.classList.toggle('flipped'));
                        cardsContainer.appendChild(card);
                    }
                }

                function setupPagination() {
                    paginationContainer.innerHTML = ''; const pageCount = Math.ceil(proverbsData.length / itemsPerPage);
                    for (let i = 1; i <= pageCount; i++) {
                        const btn = document.createElement('button'); btn.innerText = i;
                        if (i === currentPage) btn.disabled = true;
                        btn.addEventListener('click', () => {
                            currentPage = i; displayCards(currentPage);
                            const currentActive = paginationContainer.querySelector('button:disabled');
                            if(currentActive) currentActive.disabled = false;
                            btn.disabled = true;
                        });
                        paginationContainer.appendChild(btn);
                    }
                }

                // --- 2. Alıştırma: Anlamını Bul ---
                const meaningQuestionContainer = document.getElementById('meaning-question-container');
                const meaningOptionsContainer = document.getElementById('meaning-options-container');
                const newMeaningQuestionBtn = document.getElementById('new-meaning-question-btn');
                let correctMeaningAnswerId;

                function generateMeaningQuestion() {
                    meaningOptionsContainer.innerHTML = ''; let options = [];
                    while (options.length < 4) {
                        const randomProverb = proverbsData[Math.floor(Math.random() * proverbsData.length)];
                        if (!options.some(opt => opt.id === randomProverb.id)) { options.push(randomProverb); }
                    }
                    const correctOption = options[0]; correctMeaningAnswerId = correctOption.id;
                    meaningQuestionContainer.textContent = correctOption.anlam;
                    options.sort(() => Math.random() - 0.5);
                    options.forEach(option => {
                        const optionBtn = document.createElement('button'); optionBtn.className = 'meaning-option';
                        optionBtn.textContent = option.söz; optionBtn.dataset.id = option.id;
                        optionBtn.addEventListener('click', checkMeaningAnswer);
                        meaningOptionsContainer.appendChild(optionBtn);
                    });
                }

                function checkMeaningAnswer(e) {
                    const selectedId = parseInt(e.target.dataset.id, 10);
                    const allOptions = meaningOptionsContainer.querySelectorAll('.meaning-option');
                    allOptions.forEach(opt => {
                        opt.removeEventListener('click', checkMeaningAnswer);
                        if (parseInt(opt.dataset.id, 10) === correctMeaningAnswerId) { opt.classList.add('correct'); }
                    });
                    if (selectedId !== correctMeaningAnswerId) { e.target.classList.add('incorrect'); }
                }
                newMeaningQuestionBtn.addEventListener('click', generateMeaningQuestion);

                // --- 3. Alıştırma: Boşluk Doldurma ---
                const fillBlankContainer = document.getElementById('fill-blank-sentence-container');
                const fillBlankCheckBtn = document.getElementById('fill-blank-check-btn');
                const newFillBlankBtn = document.getElementById('new-fill-blank-btn');
                const fillBlankFeedback = document.getElementById('fill-blank-feedback');
                let missingWord = '';

                function generateFillBlankProblem() {
                    fillBlankFeedback.textContent = '';
                    const proverb = proverbsData[Math.floor(Math.random() * proverbsData.length)];
                    const words = proverb.söz.split(' ');
                    if (words.length < 3) { generateFillBlankProblem(); return; }
                    const wordIndex = Math.floor(Math.random() * (words.length - 2)) + 1;
                    missingWord = words[wordIndex].replace(/[,.]/g, '');
                    words[wordIndex] = `<input type="text" class="fill-blank-input" style="width: ${Math.max(100, missingWord.length * 20)}px;">`;
                    fillBlankContainer.innerHTML = words.join(' ');
                }

                fillBlankCheckBtn.addEventListener('click', () => {
                    const input = fillBlankContainer.querySelector('input');
                    if (input.value.trim().toLowerCase() === missingWord.toLowerCase()) {
                        fillBlankFeedback.textContent = 'Tebrikler, Doğru!'; fillBlankFeedback.style.color = 'var(--correct-border)';
                    } else {
                        fillBlankFeedback.textContent = `Yanlış. Doğru cevap: "${missingWord}"`; fillBlankFeedback.style.color = 'var(--incorrect-border)';
                    }
                });
                newFillBlankBtn.addEventListener('click', generateFillBlankProblem);
                
                // --- 4. Alıştırma: Zorlu Anlam Bulma ---
                const challengingQuestionContainer = document.getElementById('challenging-question-container');
                const challengingOptionsContainer = document.getElementById('challenging-options-container');
                const newChallengingQuestionBtn = document.getElementById('new-challenging-question-btn');
                let correctChallengingAnswerId;

                function generateChallengingQuestion() {
                    challengingOptionsContainer.innerHTML = ''; let options = [];
                    while (options.length < 6) { // 6 seçenek oluştur
                        const randomProverb = proverbsData[Math.floor(Math.random() * proverbsData.length)];
                        if (!options.some(opt => opt.id === randomProverb.id)) { options.push(randomProverb); }
                    }
                    const correctOption = options[0]; correctChallengingAnswerId = correctOption.id;
                    challengingQuestionContainer.textContent = correctOption.anlam;
                    options.sort(() => Math.random() - 0.5);
                    options.forEach(option => {
                        const optionBtn = document.createElement('button'); optionBtn.className = 'meaning-option';
                        optionBtn.textContent = option.söz; optionBtn.dataset.id = option.id;
                        optionBtn.addEventListener('click', checkChallengingAnswer);
                        challengingOptionsContainer.appendChild(optionBtn);
                    });
                }

                function checkChallengingAnswer(e) {
                    const selectedId = parseInt(e.target.dataset.id, 10);
                    const allOptions = challengingOptionsContainer.querySelectorAll('.meaning-option');
                    allOptions.forEach(opt => {
                        opt.removeEventListener('click', checkChallengingAnswer);
                        if (parseInt(opt.dataset.id, 10) === correctChallengingAnswerId) { opt.classList.add('correct'); }
                    });
                    if (selectedId !== correctChallengingAnswerId) { e.target.classList.add('incorrect'); }
                }
                newChallengingQuestionBtn.addEventListener('click', generateChallengingQuestion);
                
                // --- İlk Yüklemeler ---
                displayCards(currentPage);
                setupPagination();
                generateMeaningQuestion();
                generateFillBlankProblem();
                generateChallengingQuestion();
            }

            initializeProverbsApp();
        });
    </script>
</body>
</html>
