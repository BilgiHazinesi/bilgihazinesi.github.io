<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4. SÄ±nÄ±f Tam KapsamlÄ± DeÄŸerlendirme</title>
<style>
    :root { --main: #2c3e50; --blue: #3498db; --green: #27ae60; --orange: #f39c12; --red: #c0392b; --bg: #ecf0f1; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

    /* ÃœST PANEL (Ã–ÄŸrenci Listesi + Yedekleme) */
    #top-bar { background: white; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 10; display:flex; flex-direction:column; gap:10px; }
    .toolbar { display: flex; justify-content: space-between; align-items: center; }
    .toolbar h2 { margin: 0; font-size: 1.1rem; color: var(--main); }
    
    /* Yedekleme ButonlarÄ± */
    .backup-controls { display: flex; gap: 5px; }
    .mini-btn { font-size: 11px; padding: 5px 10px; cursor: pointer; border: none; border-radius: 4px; color: white; background: #7f8c8d; }
    .mini-btn.save { background: #2980b9; }
    .mini-btn.load { background: #8e44ad; }

    /* Yatay Liste */
    .student-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
    .chip { 
        flex: 0 0 auto; padding: 8px 15px; background: #eee; border-radius: 50px; font-size: 0.85rem; 
        font-weight: 600; color: #555; cursor: pointer; border: 2px solid transparent; transition: 0.2s; 
    }
    .chip.active { background: var(--blue); color: white; transform: scale(1.05); box-shadow: 0 3px 8px rgba(52, 152, 219, 0.4); }
    .chip.done { border-color: var(--green); background: #eafaf1; color: var(--green); }
    .chip.done.active { background: var(--green); color: white; }

    /* ORTA PANEL (Rubrik) */
    #workspace { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; }
    .rubric-card { background: white; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 5px solid #ddd; }
    .rubric-card.answered { border-left-color: var(--green); }
    
    .r-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 700; color: #34495e; font-size: 0.9rem; }
    .cat-tag { font-size: 0.65rem; background: #f0f3f4; padding: 2px 6px; border-radius: 4px; color: #7f8c8d; height: fit-content; }
    
    .btn-row { display: flex; gap: 5px; }
    .score-btn { 
        flex: 1; padding: 8px; border: 1px solid #e0e0e0; background: white; border-radius: 6px; 
        font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: 0.2s; color: #7f8c8d;
    }
    .score-btn[data-v="2"].sel { background: var(--green); color: white; border-color: var(--green); }
    .score-btn[data-v="1"].sel { background: var(--orange); color: white; border-color: var(--orange); }
    .score-btn[data-v="0"].sel { background: var(--red); color: white; border-color: var(--red); }

    /* ALT PANEL (Mesaj) */
    #bottom-panel { background: white; padding: 10px; border-top: 1px solid #ccc; position: relative; z-index: 20; }
    textarea { width: 100%; height: 80px; padding: 8px; border: 1px solid #bdc3c7; border-radius: 6px; font-family: inherit; font-size: 0.85rem; resize: none; margin-bottom: 5px; box-sizing: border-box; }
    .actions { display: flex; gap: 8px; }
    .act-btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-weight: bold; font-size: 0.9rem; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 5px; }
    .btn-copy { background: var(--main); }
    .btn-print { background: var(--orange); }
    .btn-del { background: #95a5a6; flex: 0.3; }

    /* YAZDIRMA (GÄ°ZLÄ° KARNE) */
    #print-area { display: none; }
    @media print {
        body > *:not(#print-area) { display: none !important; }
        body { background: white; height: auto; display: block; overflow: visible; }
        #print-area { display: block !important; padding: 20px; font-family: "Times New Roman", serif; }
        
        .pc-header { text-align: center; border-bottom: 2px solid black; margin-bottom: 20px; padding-bottom: 10px; }
        .pc-title { font-size: 20px; font-weight: bold; margin: 10px 0; }
        .pc-info { display: flex; justify-content: space-between; margin-top: 20px; font-weight: bold; font-size: 14px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #555; padding: 6px; }
        th { background: #eee; }
        .pc-score { text-align: center; font-weight: bold; width: 80px; }
        
        .pc-footer { margin-top: 30px; border: 1px dashed #999; padding: 10px; font-size: 12px; background: #fafafa; }
        .pc-sign { display: flex; justify-content: space-around; margin-top: 50px; }
        .pc-sign div { border-top: 1px solid black; width: 150px; text-align: center; padding-top: 5px; }
    }
</style>
</head>
<body>

<div id="top-bar">
    <div class="toolbar">
        <h2>4. SÄ±nÄ±f Takip</h2>
        <div class="backup-controls">
            <button class="mini-btn save" onclick="downloadJSON()">ğŸ’¾ Yedek Ä°ndir</button>
            <button class="mini-btn load" onclick="document.getElementById('fileIn').click()">ğŸ“‚ YÃ¼kle</button>
            <input type="file" id="fileIn" style="display:none" onchange="uploadJSON(this)">
        </div>
    </div>
    <div class="student-scroll" id="studentList"></div>
</div>

<div id="workspace">
    <div style="text-align:center; margin-top:80px; color:#95a5a6;">
        <div style="font-size:40px;">ğŸ‘†</div>
        <p>Listeden Ã–ÄŸrenci SeÃ§in</p>
    </div>
</div>

<div id="bottom-panel" style="display:none">
    <textarea id="msgBox" placeholder="Mesaj burada oluÅŸacak..."></textarea>
    <div class="actions">
        <button class="act-btn btn-copy" onclick="copyMsg()">ğŸ“‹ MesajÄ± Kopyala</button>
        <button class="act-btn btn-print" onclick="printReport()">ğŸ–¨ï¸ Karne Ã‡Ä±kar</button>
        <button class="act-btn btn-del" onclick="resetStudent()">ğŸ—‘ï¸</button>
    </div>
</div>

<div id="print-area">
    <div class="pc-header">
        <div style="font-size:12px;">2024 - 2025 EÄÄ°TÄ°M Ã–ÄRETÄ°M YILI</div>
        <div class="pc-title">ARALIK AYI KAZANIM DEÄERLENDÄ°RME RAPORU</div>
        <div class="pc-info">
            <span id="p-name">Ã–ÄŸrenci: -</span>
            <span>SÄ±nÄ±f: 4/O</span>
            <span id="p-date">Tarih: 15.12.2025</span>
        </div>
    </div>
    <table id="p-table">
        <thead>
            <tr>
                <th>KAZANIMLAR</th>
                <th class="pc-score">DURUM</th>
            </tr>
        </thead>
        <tbody id="p-tbody"></tbody>
    </table>
    <div class="pc-footer">
        <strong>Ã–ÄŸretmen GÃ¶rÃ¼ÅŸÃ¼:</strong><br>
        <span id="p-note">-</span>
    </div>
    <div class="pc-sign">
        <div>SÄ±nÄ±f Ã–ÄŸretmeni</div>
        <div>Okul MÃ¼dÃ¼rÃ¼</div>
    </div>
</div>

<script>
// --- 1. VERÄ°LER (TAM KAPSAMLI) ---
const students = [
    "HAKAN AKDENÄ°Z", "HÃœSEYÄ°N Ã‡AÄAN GÃœRGAH", "AHMET ARIN AÄTÃœRK", "DENÄ°Z GÃœNEY", "Ä°DÄ°L DEMÄ°RCÄ°", 
    "DURU AYKANAT", "DENÄ°Z KÄ°MYON", "KADÄ°R BERKTAÅ", "DOÄA BORA", "AHMET CEVDET KORKMAZ", 
    "GÃœLNÄ°HAL KARAKAÅ", "NÄ°L TÄ°RYAKÄ°", "MASAL DEFNE TEL", "EYLÃœL AFAT", "ELÄ°F ADA KEKEÃ‡", 
    "EYLÃœL MUTAF", "Ä°PEK MÄ°MAROÄLU", "YEKTA URAS DEMÄ°RER", "HAMZA KAAN Ã‡EVEN", "BEYZA DAÄDELEN", 
    "NAZ KARABAÄLI", "AYNUR BUDAK", "DURU BÃœKÃœN", "WAFA MAKANSSI"
];

// PDF Ä°Ã§eriÄŸine GÃ¶re GENÄ°ÅLETÄ°LMÄ°Å Rubrik (13 Madde)
const rubric = [
    { cat:"TR", text:"Åiirde ana duyguyu ve Milli MÃ¼cadele rotasÄ±nÄ± (Samsun vb.) yorumlar.", good:"Åiir yorumlama ve ana duygu tespiti Ã§ok baÅŸarÄ±lÄ±.", bad:"Åiirdeki ana duyguyu bulmakta zorlanÄ±yor." },
    { cat:"TR", text:"Metindeki neden-sonuÃ§, karÅŸÄ±laÅŸtÄ±rma ve soru cÃ¼mlelerini bulur.", good:"Neden-sonuÃ§ ve karÅŸÄ±laÅŸtÄ±rma cÃ¼mlelerini hatasÄ±z buluyor.", bad:"Metin iÃ§i anlam iliÅŸkilerini (neden-sonuÃ§) kurmakta zorlanÄ±yor." },
    { cat:"TR", text:"Hikaye edici metnin tÃ¼rÃ¼nÃ¼ ve Ã¶zelliklerini belirler.", good:"Metin tÃ¼rlerini ayÄ±rt edebiliyor.", bad:"Metin tÃ¼rlerini belirlemede tekrar yapmalÄ±." },
    { cat:"TR", text:"EÅŸ sesli (sesteÅŸ) kelimeleri ayÄ±rt eder, cÃ¼mle iÃ§inde kullanÄ±r.", good:"EÅŸ sesli kelimeleri baÄŸlama uygun kullanÄ±yor.", bad:"EÅŸ sesli kelimelerin farklÄ± anlamlarÄ±nÄ± karÄ±ÅŸtÄ±rÄ±yor." },
    { cat:"TR", text:"Kelimeler arasÄ± anlam iliÅŸkilerini (EÅŸ/ZÄ±t anlam) kavrar.", good:"Kelime hazinesi ve zÄ±t anlam bilgisi Ã§ok iyi.", bad:"Kelimelerin eÅŸ/zÄ±t anlamlarÄ±nÄ± bulmakta zorlanÄ±yor." },
    
    { cat:"MAT", text:"DoÄŸal sayÄ±larÄ± en yakÄ±n onluÄŸa ve yÃ¼zlÃ¼ÄŸe yuvarlar.", good:"Yuvarlama iÅŸlemlerinde Ã§ok pratik.", bad:"SayÄ±larÄ± yuvarlarken kural hatasÄ± yapÄ±yor." },
    { cat:"MAT", text:"Verilen sÄ±ralamaya (eÅŸitsizliÄŸe) uygun sayÄ± deÄŸerlerini bulur.", good:"SayÄ± sÄ±ralama ve karÅŸÄ±laÅŸtÄ±rma becerisi tam.", bad:"BÃ¼yÃ¼ktÃ¼r/kÃ¼Ã§Ã¼ktÃ¼r sembollerini ve sÄ±ralamayÄ± karÄ±ÅŸtÄ±rÄ±yor." },
    { cat:"MAT", text:"SayÄ± Ã¶rÃ¼ntÃ¼lerini kuralÄ±na gÃ¶re devam ettirir.", good:"Ã–rÃ¼ntÃ¼ kuralÄ±nÄ± hÄ±zlÄ±ca fark edip devam ettiriyor.", bad:"SayÄ± Ã¶rÃ¼ntÃ¼lerindeki kuralÄ± bulmakta zorlanÄ±yor." },
    { cat:"MAT", text:"DoÄŸal sayÄ±larla toplama iÅŸlemini yapar (Eldeli/Eldesiz).", good:"Toplama iÅŸlemlerini hatasÄ±z yapÄ±yor.", bad:"Toplama iÅŸleminde eldeleri unutabiliyor." },
    { cat:"MAT", text:"Ã‡ok adÄ±mlÄ± problemleri (toplama-Ã§Ä±karma) analiz edip Ã§Ã¶zer.", good:"Problemleri analiz edip doÄŸru iÅŸlem sÄ±rasÄ±nÄ± kuruyor.", bad:"Problemi anlama ve iÅŸlem sÄ±rasÄ±nÄ± belirlemede desteÄŸe ihtiyacÄ± var." },
    { cat:"MAT", text:"Basamak deÄŸerlerine gÃ¶re sayÄ±larÄ± okur ve yazar.", good:"Basamak deÄŸeri kavramÄ±nÄ± tam olarak kavramÄ±ÅŸ.", bad:"SayÄ±larÄ±n okunuÅŸu ve basamak deÄŸerlerinde hata yapÄ±yor." },
    { cat:"MAT", text:"DallanmÄ±ÅŸ aÄŸaÃ§ vb. diyagramlardaki kurallarÄ± takip eder.", good:"GÃ¶rsel diyagramlardaki (aÄŸaÃ§ ÅŸemasÄ±) kurallarÄ± iyi takip ediyor.", bad:"GÃ¶rsel tablolarÄ± ve ÅŸemalarÄ± okumakta zorlanÄ±yor." },
    { cat:"MAT", text:"Ã‡Ä±karma iÅŸlemi gerektiren problemleri (Mesafe/Fark) Ã§Ã¶zer.", good:"Ã‡Ä±karma iÅŸlemi problemlerini baÅŸarÄ±yla Ã§Ã¶zÃ¼yor.", bad:"Ã‡Ä±karma iÅŸleminde onluk bozma vb. hatalar yapÄ±yor." }
];

let db = JSON.parse(localStorage.getItem('okul_db_full')) || {};
let current = null;

const listEl = document.getElementById('studentList');
const wsEl = document.getElementById('workspace');

// --- 2. FONKSÄ°YONLAR ---

function init() { renderList(); }

function renderList() {
    listEl.innerHTML = '';
    students.forEach(name => {
        const d = document.createElement('div');
        d.className = `chip ${db[name] ? 'done' : ''}`;
        if(current === name) d.classList.add('active');
        d.innerText = name;
        d.onclick = () => selectStudent(name);
        listEl.appendChild(d);
    });
}

function selectStudent(name) {
    current = name;
    renderList();
    document.getElementById('bottom-panel').style.display = 'block';
    
    // RubriÄŸi Ã§iz
    wsEl.innerHTML = '';
    const data = db[current] || {};
    
    rubric.forEach((item, i) => {
        const val = data[i];
        const div = document.createElement('div');
        div.className = `rubric-card ${val !== undefined ? 'answered' : ''}`;
        div.innerHTML = `
            <div class="r-header">
                <span>${i+1}. ${item.text}</span>
                <span class="cat-tag">${item.cat}</span>
            </div>
            <div class="btn-row">
                <button class="score-btn ${val===2?'sel':''}" onclick="save(${i}, 2)" data-v="2">Tam (2)</button>
                <button class="score-btn ${val===1?'sel':''}" onclick="save(${i}, 1)" data-v="1">KÄ±smen (1)</button>
                <button class="score-btn ${val===0?'sel':''}" onclick="save(${i}, 0)" data-v="0">GeliÅŸmeli (0)</button>
            </div>
        `;
        wsEl.appendChild(div);
    });
    generateMsg();
}

function save(idx, score) {
    if(!db[current]) db[current] = {};
    db[current][idx] = score;
    localStorage.setItem('okul_db_full', JSON.stringify(db));
    selectStudent(current); // UI Yenile
}

function generateMsg() {
    const data = db[current] || {};
    let goods = [], bads = [];
    rubric.forEach((r, i) => {
        if(data[i] === 2) goods.push(r.good);
        if(data[i] === 1 || data[i] === 0) bads.push(r.bad);
    });

    // Ä°simli Mesaj FormatÄ±
    let msg = `SayÄ±n Velimiz,\nÃ–ÄŸrencimiz ${current} ile AralÄ±k ayÄ± kazanÄ±m deÄŸerlendirmesi yaptÄ±k.\n\n`;
    
    if(goods.length > 0) msg += `âœ… ${goods.slice(0,3).join(' ')}\n`; // Max 3 olumlu cÃ¼mle
    if(bads.length > 0) msg += `âš ï¸ ${bads.join(' ')}\n`;
    
    if(goods.length > 0 && bads.length === 0) msg += `ğŸ§¿ Ã–ÄŸrencimiz tÃ¼m kazanÄ±mlarda tam baÅŸarÄ± gÃ¶sterdi. Tebrik ederim.\n`;
    
    msg += `\nÄ°ÅŸbirliÄŸiniz iÃ§in teÅŸekkÃ¼rler.\nSÄ±nÄ±f Ã–ÄŸretmeni`;
    document.getElementById('msgBox').value = msg;
}

// --- 3. YEDEKLEME SÄ°STEMÄ° (JSON) ---
function downloadJSON() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
    const node = document.createElement('a');
    node.setAttribute("href", dataStr);
    node.setAttribute("download", "sinif_yedek_" + new Date().toLocaleDateString() + ".json");
    document.body.appendChild(node);
    node.click();
    node.remove();
}

function uploadJSON(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            db = JSON.parse(e.target.result);
            localStorage.setItem('okul_db_full', JSON.stringify(db));
            alert("Yedek baÅŸarÄ±yla yÃ¼klendi!");
            renderList();
            if(current) selectStudent(current);
        } catch(err) { alert("HatalÄ± dosya!"); }
    };
    reader.readAsText(file);
    input.value = "";
}

// --- 4. KARNE Ã‡IKTI ---
function printReport() {
    document.getElementById('p-name').innerText = "Ã–ÄŸrenci: " + current;
    document.getElementById('p-date').innerText = "Tarih: " + new Date().toLocaleDateString();
    document.getElementById('p-note').innerText = document.getElementById('msgBox').value;
    
    const tbody = document.getElementById('p-tbody');
    tbody.innerHTML = '';
    const data = db[current] || {};
    
    rubric.forEach((r, i) => {
        const val = data[i];
        let status = "-"; let color = "black";
        if(val===2) { status="TAM"; color="green"; }
        else if(val===1) { status="KISMEN"; color="#f39c12"; }
        else if(val===0) { status="GELÄ°ÅMELÄ°"; color="red"; }
        
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.text}</td><td class="pc-score" style="color:${color}">${status}</td>`;
        tbody.appendChild(tr);
    });
    
    window.print();
}

function copyMsg() {
    const t = document.getElementById('msgBox'); t.select(); t.setSelectionRange(0,99999);
    navigator.clipboard.writeText(t.value); alert("KopyalandÄ±!");
}

function resetStudent() {
    if(confirm(current + " isimli Ã¶ÄŸrencinin notlarÄ± silinsin mi?")) {
        delete db[current];
        localStorage.setItem('okul_db_full', JSON.stringify(db));
        selectStudent(current);
        renderList();
    }
}

init();
</script>
</body>
</html>
