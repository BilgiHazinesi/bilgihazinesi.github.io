<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>4. SÄ±nÄ±f AkÄ±llÄ± KayÄ±t Sistemi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        /* --- GENEL AYARLAR --- */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 0;
            color: #333;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }

        /* --- KARTLAR --- */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e1e4e8;
        }

        /* Arama Kutusu */
        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
            color: #333;
            font-weight: bold;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        h3 { margin: 0 0 10px 0; color: #2c3e50; font-size: 18px; }

        /* --- HIZLI BUTONLAR --- */
        .quick-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f1f2f6;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .btn-quick {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
        }

        /* --- RUBRÄ°K --- */
        .rubric-item {
            border-bottom: 1px solid #eee;
            padding: 12px 0;
        }
        .rubric-text {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.3;
        }

        .score-grid {
            display: flex;
            gap: 5px;
        }
        .score-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            font-weight: bold;
            color: #7f8c8d;
            transition: background 0.2s;
        }
        
        .active-2 { background-color: #27ae60; color: white; border-color: #27ae60; }
        .active-1 { background-color: #f1c40f; color: white; border-color: #f39c12; }
        .active-0 { background-color: #e74c3c; color: white; border-color: #c0392b; }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-family: inherit;
            box-sizing: border-box;
            font-size: 15px;
        }

        /* --- ALT BAR --- */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 1000;
            box-sizing: border-box;
            display: flex;
            gap: 10px;
        }
        
        .btn-print {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            flex: 2;
        }
        
        .btn-reset {
            background-color: #c0392b;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            flex: 1;
        }

        /* --- BASKI AYARLARI (KRÄ°TÄ°K BÃ–LÃœM) --- */
        #print-container { display: none; }

        @page {
            size: A4;
            margin: 10mm; /* Kenar boÅŸluklarÄ±nÄ± sabitledik */
        }

        @media print {
            body, html { 
                margin: 0; 
                padding: 0; 
                background: white; 
                height: auto;
            }
            .container, .bottom-bar { display: none !important; }
            #print-container { display: block !important; }

            /* URL ve Tarih Gizleme */
            @page {
                margin-top: 0;
                margin-bottom: 0;
            }

            .page-break {
                page-break-after: always;
                page-break-inside: avoid;
                width: 100%;
                min-height: 280mm; /* A4 boyuna yakÄ±n ama taÅŸmayacak yÃ¼kseklik */
                box-sizing: border-box;
                padding-top: 10mm;
                padding-bottom: 5mm;
                position: relative;
            }

            /* Son sayfadan sonra boÅŸ sayfa Ã§Ä±kmasÄ±nÄ± engellemek iÃ§in */
            .page-break:last-child {
                page-break-after: auto;
            }

            .print-header {
                text-align: center;
                border-bottom: 2px solid #333;
                margin-bottom: 10px;
                padding-bottom: 5px;
            }
            .print-header h1 { font-size: 18px; margin: 0; }
            
            .student-meta {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                font-size: 14px;
                border-bottom: 1px dashed #ccc;
                padding-bottom: 5px;
                margin-bottom: 10px;
            }

            .print-section-title {
                background-color: #eee;
                font-weight: bold;
                padding: 4px;
                font-size: 12px;
                border-left: 4px solid #333;
                margin-top: 8px;
                margin-bottom: 4px;
                -webkit-print-color-adjust: exact;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 11px;
            }
            th, td {
                border: 1px solid #888;
                padding: 3px; /* Padding kÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
                vertical-align: middle;
            }
            th { background-color: #f9f9f9; text-align: center; }
            .col-mark { width: 30px; text-align: center; font-weight: bold; }
            .filled { background-color: #333; color: white; -webkit-print-color-adjust: exact; }
            
            .teacher-comment-print {
                border: 1px solid #333;
                padding: 5px;
                min-height: 30px;
                font-size: 11px;
                margin-top: 5px;
            }
            .signature { margin-top: 15px; text-align: right; font-size: 12px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card" style="position: sticky; top: 10px; z-index: 90; border-top: 5px solid #3498db; padding: 10px;">
            <label style="font-size:12px; font-weight:bold; color:#666; margin-bottom:5px; display:block;">Ã–ÄŸrenci Ara:</label>
            <input type="text" id="studentSearchInput" list="studentsList" placeholder="Ä°sim yazmaya baÅŸla..." oninput="checkStudentSelection()">
            <datalist id="studentsList"></datalist>
            <div id="selectionStatus" style="font-size:12px; color:#27ae60; margin-top:5px; height:15px; font-weight:bold;"></div>
        </div>

        <div id="evaluationArea" style="display:none;">
            
            <div class="card">
                <div class="quick-actions">
                    <h3 style="color:#d35400; margin:0;">TÃœRKÃ‡E</h3>
                    <button class="btn-quick" onclick="fillAll('turkish', 2)">Hepsini Tam Yap</button>
                </div>
                <div id="turkish-container"></div>
            </div>

            <div class="card">
                <div class="quick-actions">
                    <h3 style="color:#2980b9; margin:0;">MATEMATÄ°K</h3>
                    <button class="btn-quick" onclick="fillAll('math', 2)">Hepsini Tam Yap</button>
                </div>
                <div id="math-container"></div>
            </div>

            <div class="card">
                <h3>Ã–ÄŸretmen GÃ¶rÃ¼ÅŸÃ¼</h3>
                <textarea id="teacherComment" rows="3" placeholder="Ã–ÄŸrenci iÃ§in notlar..." oninput="saveComment()"></textarea>
            </div>
        </div>
    </div>

    <div class="bottom-bar">
        <button class="btn-reset" onclick="resetAllData()">ğŸ—‘ï¸ SIFIRLA</button>
        <button class="btn-print" onclick="printAll()">ğŸ–¨ï¸ PDF Ä°NDÄ°R</button>
    </div>

    <div id="print-container"></div>

    <script>
        // --- VERÄ°LER ---
        const studentList = [
            "HAKAN AKDENÄ°Z", "HÃœSEYÄ°N Ã‡AÄAN GÃœRGAH", "AHMET ARIN AÄTÃœRK", "DENÄ°Z GÃœNEY",
            "Ä°DÄ°L DEMÄ°RCÄ°", "DURU AYKANAT", "DENÄ°Z KÄ°MYON", "KADÄ°R BERKTAÅ", "DOÄA BORA",
            "AHMET CEVDET KORKMAZ", "GÃœLNÄ°HAL KARAKAÅ", "NÄ°L TÄ°RYAKÄ°", "MASAL DEFNE TEL",
            "EYLÃœL AFAT", "ELÄ°F ADA KEKEÃ‡", "EYLÃœL MUTAF", "Ä°PEK MÄ°MAROÄLU",
            "YEKTA URAS DEMÄ°RER", "HAMZA KAAN Ã‡EVEN", "BEYZA DAÄDELEN", "NAZ KARABAÄLI",
            "AYNUR BUDAK", "DURU BÃœKÃœN", "WAFA MAKANSSI"
        ];

        const rubric = {
            turkish: [
                { id: 't1', text: 'Åiir analizi, ana duygu ve Milli MÃ¼cadele kronolojisi' },
                { id: 't2', text: 'Neden - SonuÃ§ cÃ¼mlelerini belirleme ve kurma' },
                { id: 't3', text: 'Soru cÃ¼mlesi oluÅŸturma ve ayÄ±rt etme' },
                { id: 't4', text: 'KarÅŸÄ±laÅŸtÄ±rma cÃ¼mlelerini belirleme ve analiz etme' },
                { id: 't5', text: 'Metin tÃ¼rÃ¼nÃ¼ ayÄ±rt etme (Hikaye Edici Metin)' },
                { id: 't6', text: 'EÅŸ sesli kelimeleri aynÄ± cÃ¼mlede farklÄ± anlamlarÄ±yla kullanma' },
                { id: 't7', text: 'EÅŸ anlamlÄ± ve zÄ±t anlamlÄ± kelime Ã§iftleri arasÄ±nda iliÅŸki kurma' }
            ],
            math: [
                { id: 'm1', text: 'DoÄŸal sayÄ±larÄ± en yakÄ±n onluÄŸa/yÃ¼zlÃ¼ÄŸe yuvarlama' },
                { id: 'm2', text: 'DoÄŸal sayÄ±larÄ± sembol kullanarak sÄ±ralama (<, >)' },
                { id: 'm3', text: 'SÄ±ralamaya uygun deÄŸer verme ve Ã¶rÃ¼ntÃ¼ oluÅŸturma' },
                { id: 'm4', text: 'Ã‡ok adÄ±mlÄ± toplama iÅŸlemi problemlerini Ã§Ã¶zme' },
                { id: 'm5', text: 'DÃ¶rt iÅŸlem becerisi (Toplama, Ã‡Ä±karma, Ã‡arpma)' },
                { id: 'm6', text: 'Verilen yÃ¶nergelere gÃ¶re doÄŸal sayÄ±larÄ± oluÅŸturma' },
                { id: 'm7', text: 'Ã‡Ä±karma iÅŸlemi gerektiren problem Ã§Ã¶zme' },
                { id: 'm8', text: 'YÃ¼zer ritmik sayma ve basamak bÃ¶lÃ¼k iliÅŸkisi ile toplama' }
            ]
        };

        let classData = {};
        let currentStudent = null;

        // --- BAÅLANGIÃ‡ ---
        window.onload = function() {
            loadFromStorage(); // Ã–nce hafÄ±zadaki veriyi Ã§ek
            populateDataList();
            renderRubricHTML();
        };

        // --- HAFIZA (LOCAL STORAGE) ---
        function loadFromStorage() {
            const savedData = localStorage.getItem('okul_verisi_v1');
            if (savedData) {
                classData = JSON.parse(savedData);
            } else {
                // HafÄ±zada yoksa boÅŸ baÅŸlat
                studentList.forEach(name => {
                    classData[name] = { scores: {}, comment: "" };
                });
            }
        }

        function saveToStorage() {
            localStorage.setItem('okul_verisi_v1', JSON.stringify(classData));
        }

        function resetAllData() {
            if(confirm("DÄ°KKAT! TÃ¼m Ã¶ÄŸrenci notlarÄ± ve yorumlarÄ± silinecek. Emin misiniz?")) {
                localStorage.removeItem('okul_verisi_v1');
                location.reload();
            }
        }

        // --- ARAYÃœZ ---
        function populateDataList() {
            const dl = document.getElementById('studentsList');
            studentList.forEach(name => {
                let opt = document.createElement('option');
                opt.value = name;
                dl.appendChild(opt);
            });
        }

        function renderRubricHTML() {
            const createRows = (items, type) => items.map(item => `
                <div class="rubric-item">
                    <span class="rubric-text">${item.text}</span>
                    <div class="score-grid">
                        <div class="score-btn" id="btn-${item.id}-2" onclick="setScore('${item.id}', 2)">Tam</div>
                        <div class="score-btn" id="btn-${item.id}-1" onclick="setScore('${item.id}', 1)">KÄ±smen</div>
                        <div class="score-btn" id="btn-${item.id}-0" onclick="setScore('${item.id}', 0)">YapmadÄ±</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('turkish-container').innerHTML = createRows(rubric.turkish, 'turkish');
            document.getElementById('math-container').innerHTML = createRows(rubric.math, 'math');
        }

        // --- Ä°ÅLEMLER ---
        function checkStudentSelection() {
            const val = document.getElementById('studentSearchInput').value.trim(); // .toUpperCase() eklenebilir gerekirse
            // Tam eÅŸleÅŸme kontrolÃ¼ (BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarlÄ± olabilir, listeden seÃ§ilmesi garanti)
            if (classData[val]) {
                currentStudent = val;
                document.getElementById('selectionStatus').innerText = "âœ“ " + val + " (KayÄ±tlÄ±)";
                document.getElementById('evaluationArea').style.display = 'block';
                
                // Verileri forma yÃ¼kle
                document.getElementById('teacherComment').value = classData[val].comment || "";
                refreshUI();
            } else {
                currentStudent = null;
                document.getElementById('selectionStatus').innerText = "";
                document.getElementById('evaluationArea').style.display = 'none';
            }
        }

        function setScore(id, val) {
            if(!currentStudent) return;
            classData[currentStudent].scores[id] = val;
            refreshUI();
            saveToStorage(); // HER TIKLAMADA KAYDET
        }

        function fillAll(subject, val) {
            if(!currentStudent) return;
            rubric[subject].forEach(item => {
                classData[currentStudent].scores[item.id] = val;
            });
            refreshUI();
            saveToStorage(); // HER TIKLAMADA KAYDET
        }

        function saveComment() {
            if(currentStudent) {
                classData[currentStudent].comment = document.getElementById('teacherComment').value;
                saveToStorage(); // YAZARKEN KAYDET
            }
        }

        function refreshUI() {
            document.querySelectorAll('.score-btn').forEach(b => b.className = 'score-btn');
            const scores = classData[currentStudent].scores;
            for (const [id, val] of Object.entries(scores)) {
                const btn = document.getElementById(`btn-${id}-${val}`);
                if(btn) btn.classList.add(`active-${val}`);
            }
        }

        // --- PDF BASKI ---
        function printAll() {
            const container = document.getElementById('print-container');
            container.innerHTML = '';
            const date = new Date().toLocaleDateString('tr-TR');

            studentList.forEach(name => {
                const data = classData[name];
                
                // HTML Åablonu
                let html = `
                <div class="page-break">
                    <div class="print-header">
                        <h1>NESÄ°BE AYDIN OKULLARI</h1>
                        <h2 style="font-size:14px; font-weight:normal; margin:5px 0;">4. SÄ±nÄ±flar GeliÅŸim Ä°zleme Raporu</h2>
                    </div>
                    
                    <div class="student-meta">
                        <span>Ã–ÄŸrenci: ${name}</span>
                        <span>Tarih: ${date}</span>
                    </div>

                    <div class="print-section-title">TÃœRKÃ‡E DEÄERLENDÄ°RMESÄ°</div>
                    <table>
                        <tr><th>KazanÄ±m</th><th class="col-mark">Tam</th><th class="col-mark">KÄ±s</th><th class="col-mark">Yok</th></tr>`;
                
                rubric.turkish.forEach(item => {
                    const s = data.scores[item.id];
                    html += `<tr>
                        <td>${item.text}</td>
                        <td class="col-mark ${s===2 ? 'filled' : ''}">${s===2 ? 'X' : ''}</td>
                        <td class="col-mark ${s===1 ? 'filled' : ''}">${s===1 ? 'X' : ''}</td>
                        <td class="col-mark ${s===0 ? 'filled' : ''}">${s===0 ? 'X' : ''}</td>
                    </tr>`;
                });
                html += `</table>`;

                html += `<div class="print-section-title">MATEMATÄ°K DEÄERLENDÄ°RMESÄ°</div>
                    <table>
                        <tr><th>KazanÄ±m</th><th class="col-mark">Tam</th><th class="col-mark">KÄ±s</th><th class="col-mark">Yok</th></tr>`;

                rubric.math.forEach(item => {
                    const s = data.scores[item.id];
                    html += `<tr>
                        <td>${item.text}</td>
                        <td class="col-mark ${s===2 ? 'filled' : ''}">${s===2 ? 'X' : ''}</td>
                        <td class="col-mark ${s===1 ? 'filled' : ''}">${s===1 ? 'X' : ''}</td>
                        <td class="col-mark ${s===0 ? 'filled' : ''}">${s===0 ? 'X' : ''}</td>
                    </tr>`;
                });
                html += `</table>`;

                if(data.comment && data.comment.trim() !== "") {
                    html += `<div style="margin-top:10px;"><strong>Ã–ÄŸretmen GÃ¶rÃ¼ÅŸÃ¼:</strong><div class="teacher-comment-print">${data.comment}</div></div>`;
                }

                html += `<div class="signature">SÄ±nÄ±f Ã–ÄŸretmeni<br>Ä°mza</div></div>`; // Page break kapanÄ±ÅŸ
                container.innerHTML += html;
            });

            window.print();
        }
    </script>
</body>
</html>
