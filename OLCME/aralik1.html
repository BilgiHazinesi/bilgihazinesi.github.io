<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>4. SÄ±nÄ±f AkÄ±llÄ± DeÄŸerlendirme</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        /* --- GENEL AYARLAR --- */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 0;
            color: #333;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }

        /* --- ARAMA KUTUSU VE KARTLAR --- */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e1e4e8;
        }

        /* Arama Kutusu Stili */
        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
            color: #333;
            font-weight: bold;
            box-sizing: border-box; /* TaÅŸmayÄ± Ã¶nler */
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        h3 { margin: 0 0 10px 0; color: #2c3e50; font-size: 18px; }

        /* --- HIZLI Ä°ÅLEM BUTONLARI --- */
        .quick-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f1f2f6;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .btn-quick {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
        }

        /* --- SORU SATIRLARI --- */
        .rubric-item {
            border-bottom: 1px solid #eee;
            padding: 14px 0;
        }
        .rubric-text {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 500;
            line-height: 1.4;
        }

        /* --- PUANLAMA KUTUCUKLARI --- */
        .score-grid {
            display: flex;
            gap: 8px;
        }
        .score-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            font-weight: bold;
            color: #7f8c8d;
            transition: all 0.15s;
        }
        
        /* Renkler */
        .active-2 { background-color: #27ae60; color: white; border-color: #27ae60; } /* Tam */
        .active-1 { background-color: #f1c40f; color: white; border-color: #f39c12; } /* KÄ±smen */
        .active-0 { background-color: #e74c3c; color: white; border-color: #c0392b; } /* YapmadÄ± */

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-family: inherit;
            box-sizing: border-box;
            font-size: 15px;
        }

        /* --- SABÄ°T ALT BUTON --- */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 1000;
            box-sizing: border-box;
        }
        .btn-print {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(230, 126, 34, 0.3);
        }

        /* --- BASKI (PDF) AYARLARI --- */
        #print-container { display: none; }

        @media print {
            body, html { margin: 0; padding: 0; background: white; }
            .container, .bottom-bar { display: none !important; }
            #print-container { display: block !important; }

            .page-break {
                page-break-after: always;
                width: 100%;
                height: 100vh;
                box-sizing: border-box;
                padding: 10mm;
            }

            .print-header {
                text-align: center;
                border-bottom: 2px solid #333;
                margin-bottom: 10px;
                padding-bottom: 5px;
            }
            .print-header h1 { font-size: 18px; margin: 0; }
            
            .student-meta {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                font-size: 14px;
                border-bottom: 1px dashed #ccc;
                padding-bottom: 5px;
                margin-bottom: 10px;
            }

            .print-section-title {
                background-color: #eee;
                font-weight: bold;
                padding: 4px;
                font-size: 12px;
                border-left: 4px solid #333;
                margin-top: 10px;
                margin-bottom: 5px;
                -webkit-print-color-adjust: exact;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 11px;
            }
            th, td {
                border: 1px solid #888;
                padding: 4px;
                vertical-align: middle;
            }
            th { background-color: #f9f9f9; text-align: center; }
            .col-mark { width: 35px; text-align: center; font-weight: bold; }
            .filled { background-color: #333; color: white; -webkit-print-color-adjust: exact; }
            
            .teacher-comment-print {
                border: 1px solid #333;
                padding: 5px;
                min-height: 40px;
                font-size: 11px;
                margin-top: 5px;
            }
            .signature { margin-top: 20px; text-align: right; font-size: 12px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card" style="position: sticky; top: 10px; z-index: 90; border-top: 5px solid #3498db; padding: 10px;">
            <label style="font-size:12px; font-weight:bold; color:#666; margin-bottom:5px; display:block;">Ã–ÄŸrenci Ara:</label>
            
            <input type="text" id="studentSearchInput" list="studentsList" placeholder="Ä°sim yazmaya baÅŸla..." oninput="checkStudentSelection()">
            
            <datalist id="studentsList">
                </datalist>

            <div id="selectionStatus" style="font-size:12px; color:#27ae60; margin-top:5px; height:15px; font-weight:bold;"></div>
        </div>

        <div id="evaluationArea" style="display:none;">
            
            <div class="card">
                <div class="quick-actions">
                    <h3 style="color:#d35400; margin:0;">TÃœRKÃ‡E</h3>
                    <button class="btn-quick" onclick="fillAll('turkish', 2)">Hepsini Tam Yap</button>
                </div>
                <div id="turkish-container"></div>
            </div>

            <div class="card">
                <div class="quick-actions">
                    <h3 style="color:#2980b9; margin:0;">MATEMATÄ°K</h3>
                    <button class="btn-quick" onclick="fillAll('math', 2)">Hepsini Tam Yap</button>
                </div>
                <div id="math-container"></div>
            </div>

            <div class="card">
                <h3>Ã–ÄŸretmen GÃ¶rÃ¼ÅŸÃ¼</h3>
                <textarea id="teacherComment" rows="3" placeholder="Ã–ÄŸrenci iÃ§in notlar..." oninput="saveComment()"></textarea>
            </div>
        </div>
    </div>

    <div class="bottom-bar">
        <button class="btn-print" onclick="printAll()">ğŸ–¨ï¸ RAPORU Ä°NDÄ°R (PDF)</button>
    </div>

    <div id="print-container"></div>

    <script>
        // --- LÄ°STE ---
        const studentList = [
            "HAKAN AKDENÄ°Z", "HÃœSEYÄ°N Ã‡AÄAN GÃœRGAH", "AHMET ARIN AÄTÃœRK", "DENÄ°Z GÃœNEY",
            "Ä°DÄ°L DEMÄ°RCÄ°", "DURU AYKANAT", "DENÄ°Z KÄ°MYON", "KADÄ°R BERKTAÅ", "DOÄA BORA",
            "AHMET CEVDET KORKMAZ", "GÃœLNÄ°HAL KARAKAÅ", "NÄ°L TÄ°RYAKÄ°", "MASAL DEFNE TEL",
            "EYLÃœL AFAT", "ELÄ°F ADA KEKEÃ‡", "EYLÃœL MUTAF", "Ä°PEK MÄ°MAROÄLU",
            "YEKTA URAS DEMÄ°RER", "HAMZA KAAN Ã‡EVEN", "BEYZA DAÄDELEN", "NAZ KARABAÄLI",
            "AYNUR BUDAK", "DURU BÃœKÃœN", "WAFA MAKANSSI"
        ];

        // --- RUBRÄ°K ---
        const rubric = {
            turkish: [
                { id: 't1', text: 'Åiir analizi, ana duygu ve Milli MÃ¼cadele kronolojisi' },
                { id: 't2', text: 'Neden - SonuÃ§ cÃ¼mlelerini belirleme ve kurma' },
                { id: 't3', text: 'Soru cÃ¼mlesi oluÅŸturma ve ayÄ±rt etme' },
                { id: 't4', text: 'KarÅŸÄ±laÅŸtÄ±rma cÃ¼mlelerini belirleme ve analiz etme' },
                { id: 't5', text: 'Metin tÃ¼rÃ¼nÃ¼ ayÄ±rt etme (Hikaye Edici Metin)' },
                { id: 't6', text: 'EÅŸ sesli kelimeleri aynÄ± cÃ¼mlede farklÄ± anlamlarÄ±yla kullanma' },
                { id: 't7', text: 'EÅŸ anlamlÄ± ve zÄ±t anlamlÄ± kelime Ã§iftleri arasÄ±nda iliÅŸki kurma' }
            ],
            math: [
                { id: 'm1', text: 'DoÄŸal sayÄ±larÄ± en yakÄ±n onluÄŸa/yÃ¼zlÃ¼ÄŸe yuvarlama' },
                { id: 'm2', text: 'DoÄŸal sayÄ±larÄ± sembol kullanarak sÄ±ralama (<, >)' },
                { id: 'm3', text: 'SÄ±ralamaya uygun deÄŸer verme ve Ã¶rÃ¼ntÃ¼ oluÅŸturma' },
                { id: 'm4', text: 'Ã‡ok adÄ±mlÄ± toplama iÅŸlemi problemlerini Ã§Ã¶zme' },
                { id: 'm5', text: 'DÃ¶rt iÅŸlem becerisi (Toplama, Ã‡Ä±karma, Ã‡arpma)' },
                { id: 'm6', text: 'Verilen yÃ¶nergelere gÃ¶re doÄŸal sayÄ±larÄ± oluÅŸturma' },
                { id: 'm7', text: 'Ã‡Ä±karma iÅŸlemi gerektiren problem Ã§Ã¶zme' },
                { id: 'm8', text: 'YÃ¼zer ritmik sayma ve basamak bÃ¶lÃ¼k iliÅŸkisi ile toplama' }
            ]
        };

        let classData = {};
        let currentStudent = null;

        // --- BAÅLANGIÃ‡ ---
        window.onload = function() {
            const dataList = document.getElementById('studentsList');
            
            studentList.forEach(name => {
                // Veri HazÄ±rlÄ±ÄŸÄ±
                classData[name] = { scores: {}, comment: "" };
                
                // Listeyi Doldur
                let opt = document.createElement('option');
                opt.value = name;
                dataList.appendChild(opt);
            });

            renderRubricHTML();
        };

        // --- HTML OLUÅTURMA ---
        function renderRubricHTML() {
            const createRows = (items, type) => {
                return items.map(item => `
                    <div class="rubric-item">
                        <span class="rubric-text">${item.text}</span>
                        <div class="score-grid">
                            <div class="score-btn" id="btn-${item.id}-2" onclick="setScore('${item.id}', 2)">Tam</div>
                            <div class="score-btn" id="btn-${item.id}-1" onclick="setScore('${item.id}', 1)">KÄ±smen</div>
                            <div class="score-btn" id="btn-${item.id}-0" onclick="setScore('${item.id}', 0)">YapmadÄ±</div>
                        </div>
                    </div>
                `).join('');
            };
            document.getElementById('turkish-container').innerHTML = createRows(rubric.turkish, 'turkish');
            document.getElementById('math-container').innerHTML = createRows(rubric.math, 'math');
        }

        // --- ARAMA VE SEÃ‡Ä°M ---
        function checkStudentSelection() {
            const val = document.getElementById('studentSearchInput').value;
            const statusDiv = document.getElementById('selectionStatus');
            const area = document.getElementById('evaluationArea');

            // Listede tam eÅŸleÅŸme var mÄ±?
            if (studentList.includes(val)) {
                currentStudent = val;
                statusDiv.innerText = "âœ“ " + val + " seÃ§ildi.";
                area.style.display = 'block';
                
                // Verileri YÃ¼kle
                document.getElementById('teacherComment').value = classData[val].comment;
                refreshUI();
            } else {
                currentStudent = null;
                statusDiv.innerText = "";
                area.style.display = 'none';
            }
        }

        // --- PUANLAMA ---
        function setScore(id, val) {
            if(!currentStudent) return;
            classData[currentStudent].scores[id] = val;
            refreshUI();
        }

        function fillAll(subject, val) {
            if(!currentStudent) return;
            rubric[subject].forEach(item => {
                classData[currentStudent].scores[item.id] = val;
            });
            refreshUI();
        }

        function refreshUI() {
            // Temizle
            document.querySelectorAll('.score-btn').forEach(b => b.className = 'score-btn');
            
            // Ä°ÅŸaretle
            const scores = classData[currentStudent].scores;
            for (const [id, val] of Object.entries(scores)) {
                const btn = document.getElementById(`btn-${id}-${val}`);
                if(btn) btn.classList.add(`active-${val}`);
            }
        }

        function saveComment() {
            if(currentStudent) {
                classData[currentStudent].comment = document.getElementById('teacherComment').value;
            }
        }

        // --- PDF BASKI ---
        function printAll() {
            const container = document.getElementById('print-container');
            container.innerHTML = ''; 
            const date = new Date().toLocaleDateString('tr-TR');

            studentList.forEach(name => {
                const data = classData[name];
                
                let html = `
                <div class="page-break">
                    <div class="print-header">
                        <h1>NESÄ°BE AYDIN OKULLARI</h1>
                        <h2 style="font-size:14px; font-weight:normal; margin:5px 0;">4. SÄ±nÄ±flar TÃ¼rkÃ§e - Matematik DeÄŸerlendirme Raporu</h2>
                    </div>
                    
                    <div class="student-meta">
                        <span>Ã–ÄŸrenci: ${name}</span>
                        <span>Tarih: ${date}</span>
                    </div>

                    <div class="print-section-title">TÃœRKÃ‡E DEÄERLENDÄ°RMESÄ°</div>
                    <table>
                        <tr><th>KazanÄ±m</th><th class="col-mark">Tam</th><th class="col-mark">KÄ±s</th><th class="col-mark">Yok</th></tr>`;
                
                rubric.turkish.forEach(item => {
                    const s = data.scores[item.id];
                    html += `<tr>
                        <td>${item.text}</td>
                        <td class="col-mark ${s===2 ? 'filled' : ''}">${s===2 ? 'X' : ''}</td>
                        <td class="col-mark ${s===1 ? 'filled' : ''}">${s===1 ? 'X' : ''}</td>
                        <td class="col-mark ${s===0 ? 'filled' : ''}">${s===0 ? 'X' : ''}</td>
                    </tr>`;
                });
                html += `</table>`;

                html += `<div class="print-section-title">MATEMATÄ°K DEÄERLENDÄ°RMESÄ°</div>
                    <table>
                        <tr><th>KazanÄ±m</th><th class="col-mark">Tam</th><th class="col-mark">KÄ±s</th><th class="col-mark">Yok</th></tr>`;

                rubric.math.forEach(item => {
                    const s = data.scores[item.id];
                    html += `<tr>
                        <td>${item.text}</td>
                        <td class="col-mark ${s===2 ? 'filled' : ''}">${s===2 ? 'X' : ''}</td>
                        <td class="col-mark ${s===1 ? 'filled' : ''}">${s===1 ? 'X' : ''}</td>
                        <td class="col-mark ${s===0 ? 'filled' : ''}">${s===0 ? 'X' : ''}</td>
                    </tr>`;
                });
                html += `</table>`;

                if(data.comment && data.comment.trim() !== "") {
                    html += `<div style="margin-top:10px;"><strong>Ã–ÄŸretmen GÃ¶rÃ¼ÅŸÃ¼:</strong><div class="teacher-comment-print">${data.comment}</div></div>`;
                }

                html += `<div class="signature">SÄ±nÄ±f Ã–ÄŸretmeni<br>Ä°mza</div></div>`;
                container.innerHTML += html;
            });

            window.print();
        }
    </script>
</body>
</html>
