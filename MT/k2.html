<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aydınlık Sunum Paneli</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f4f7f6; /* Ferah açık gri */
            color: #2c3e50;
            margin: 0;
            padding: 15px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        h1 {
            text-align: center;
            color: #34495e;
            margin: 0 0 15px 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* 3'lü Panel Düzeni */
        .stage-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 20px;
            padding-bottom: 10px;
            box-sizing: border-box;
        }

        .panel {
            flex: 1;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 2px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            position: relative;
            transition: all 0.3s;
        }

        /* Başlıklar (Renkli şeritler) */
        .panel-header {
            width: 100%;
            text-align: center;
            padding: 10px 0;
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            border-radius: 15px 15px 0 0;
            position: absolute;
            top: 0;
            left: 0;
        }
        .p1-head { background: linear-gradient(135deg, #ff9a9e, #fecfef); color: #c0392b; }
        .p2-head { background: linear-gradient(135deg, #a18cd1, #fbc2eb); color: #8e44ad; }
        .p3-head { background: linear-gradient(135deg, #84fab0, #8fd3f4); color: #27ae60; }

        /* İçerik Alanı */
        .panel-content {
            margin-top: 50px; /* Başlık payı */
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Ayar Alanı (Input ve Butonlar) */
        .setup-area {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            border: 1px dashed #bdc3c7;
            margin-bottom: 20px;
        }

        .num-input {
            font-size: 1.4rem;
            padding: 8px;
            width: 100px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .mode-btns { display: flex; gap: 5px; justify-content: center; width: 100%; }
        
        .setup-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: 0.2s;
            flex: 1;
        }
        .setup-btn:hover { opacity: 1; transform: translateY(-2px); }
        .setup-btn.active { opacity: 1; box-shadow: inset 0 3px 5px rgba(0,0,0,0.2); transform: scale(0.95); }
        
        .btn-5 { background: #ffb74d; }
        .btn-25 { background: #81c784; }
        .btn-50 { background: #64b5f6; }
        .btn-125 { background: #ba68c8; }

        /* Görsel Sahne */
        .visual-stage {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .question-text {
            font-size: 3rem;
            font-weight: bold;
            color: #34495e;
        }

        /* Grid Sistemi */
        .calc-row {
            display: flex;
            gap: 4px;
            align-items: flex-end;
            visibility: hidden;
        }

        .digit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 50px;
        }

        /* Kutular */
        .box {
            width: 50px;
            height: 50px;
            background: white;
            border: 3px solid #cfd8dc;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #455a64;
            z-index: 1;
            transition: all 0.3s;
        }

        /* Sonradan gelen sıfırlar */
        .zero-box {
            border-color: #ffcc80;
            color: #ef6c00;
            background: #fff3e0;
            opacity: 0;
            transform: translateX(-30px);
        }
        .zero-show { opacity: 1; transform: translateX(0); }

        /* Sonuç Kutusu */
        .res-box {
            width: 50px;
            height: 50px;
            margin-top: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
            font-weight: bold;
            color: #4caf50;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s;
        }
        .res-show { opacity: 1; transform: translateY(0); }

        /* Elde (Carry) */
        .carry {
            position: absolute;
            top: -20px;
            left: -5px;
            font-size: 1.1rem;
            color: #e53935;
            font-weight: bold;
            opacity: 0;
            z-index: 2;
            transition: all 0.4s;
        }
        .carry-show { opacity: 1; transform: translateY(0); }

        /* Aktif Kutu Vurgusu */
        .active-calc {
            border-color: #29b6f6;
            box-shadow: 0 0 15px rgba(41, 182, 246, 0.4);
            transform: scale(1.1);
            background: #e1f5fe;
        }

        .divider-sign {
            font-size: 2rem;
            margin-right: 15px;
            color: #78909c;
            padding-bottom: 60px;
            font-weight: bold;
        }

        /* Alt Buton Grubu */
        .control-bar {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .main-btn {
            flex: 2;
            padding: 12px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            background: #34495e;
            box-shadow: 0 4px 0 #2c3e50;
            transition: transform 0.1s;
        }
        .main-btn:active { transform: translateY(3px); box-shadow: none; }
        .main-btn:disabled { background: #b0bec5; box-shadow: none; cursor: default; }

        .instant-btn {
            flex: 1;
            padding: 12px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            background: #ff7043; /* Turuncu */
            box-shadow: 0 4px 0 #d84315;
            transition: transform 0.1s;
        }
        .instant-btn:active { transform: translateY(3px); box-shadow: none; }

        .reset-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
            opacity: 0.7;
            z-index: 5;
        }
        .reset-icon:hover { opacity: 1; transform: rotate(90deg); transition: 0.3s; }

    </style>
</head>
<body>

    <h1>✨ Akıllı Tahta Matematik Paneli</h1>

    <div class="stage-container">
        
        <div class="panel">
            <div class="panel-header p1-head">
                SORU 1
                <div class="reset-icon" onclick="resetPanel(1)">↺</div>
            </div>
            <div class="panel-content">
                <div class="setup-area" id="setup-1">
                    <input type="number" id="inp-1" class="num-input" value="12">
                    <div class="mode-btns">
                        <button class="setup-btn btn-5" onclick="setMode(1, 5, this)">x5</button>
                        <button class="setup-btn btn-25" onclick="setMode(1, 25, this)">x25</button>
                        <button class="setup-btn btn-50" onclick="setMode(1, 50, this)">x50</button>
                        <button class="setup-btn btn-125" onclick="setMode(1, 125, this)">x125</button>
                    </div>
                </div>

                <div class="visual-stage" id="stage-1">
                    <div class="question-text" id="qtext-1">Hazır</div>
                    <div class="calc-row" id="grid-1"></div>
                </div>

                <div class="control-bar">
                    <button class="main-btn" id="btn-play-1" onclick="nextStep(1)" disabled>▶ OYNAT</button>
                    <button class="instant-btn" id="btn-quick-1" onclick="instantShow(1)" disabled>⚡ CEVAP</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header p2-head">
                SORU 2
                <div class="reset-icon" onclick="resetPanel(2)">↺</div>
            </div>
            <div class="panel-content">
                <div class="setup-area" id="setup-2">
                    <input type="number" id="inp-2" class="num-input" value="24">
                    <div class="mode-btns">
                        <button class="setup-btn btn-5" onclick="setMode(2, 5, this)">x5</button>
                        <button class="setup-btn btn-25" onclick="setMode(2, 25, this)">x25</button>
                        <button class="setup-btn btn-50" onclick="setMode(2, 50, this)">x50</button>
                        <button class="setup-btn btn-125" onclick="setMode(2, 125, this)">x125</button>
                    </div>
                </div>

                <div class="visual-stage" id="stage-2">
                    <div class="question-text" id="qtext-2">Hazır</div>
                    <div class="calc-row" id="grid-2"></div>
                </div>

                <div class="control-bar">
                    <button class="main-btn" id="btn-play-2" onclick="nextStep(2)" disabled>▶ OYNAT</button>
                    <button class="instant-btn" id="btn-quick-2" onclick="instantShow(2)" disabled>⚡ CEVAP</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header p3-head">
                SORU 3
                <div class="reset-icon" onclick="resetPanel(3)">↺</div>
            </div>
            <div class="panel-content">
                <div class="setup-area" id="setup-3">
                    <input type="number" id="inp-3" class="num-input" value="16">
                    <div class="mode-btns">
                        <button class="setup-btn btn-5" onclick="setMode(3, 5, this)">x5</button>
                        <button class="setup-btn btn-25" onclick="setMode(3, 25, this)">x25</button>
                        <button class="setup-btn btn-50" onclick="setMode(3, 50, this)">x50</button>
                        <button class="setup-btn btn-125" onclick="setMode(3, 125, this)">x125</button>
                    </div>
                </div>

                <div class="visual-stage" id="stage-3">
                    <div class="question-text" id="qtext-3">Hazır</div>
                    <div class="calc-row" id="grid-3"></div>
                </div>

                <div class="control-bar">
                    <button class="main-btn" id="btn-play-3" onclick="nextStep(3)" disabled>▶ OYNAT</button>
                    <button class="instant-btn" id="btn-quick-3" onclick="instantShow(3)" disabled>⚡ CEVAP</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const states = {
            1: { step: 0, factor: 0, div: 0, zeros: "", num: 0 },
            2: { step: 0, factor: 0, div: 0, zeros: "", num: 0 },
            3: { step: 0, factor: 0, div: 0, zeros: "", num: 0 }
        };

        const rules = {
            5: { div: 2, zeros: "0" },
            25: { div: 4, zeros: "00" },
            50: { div: 2, zeros: "00" },
            125: { div: 8, zeros: "000" }
        };

        // --- KURULUM ---
        function setMode(pid, factor, btn) {
            // Buton aktifliği
            const allBtns = document.querySelectorAll(`#setup-${pid} .setup-btn`);
            allBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const inputVal = document.getElementById(`inp-${pid}`).value;
            if(!inputVal) return;

            // State Güncelle
            states[pid].factor = factor;
            states[pid].num = inputVal;
            states[pid].step = 1;

            // Ekranı Hazırla
            document.getElementById(`qtext-${pid}`).innerText = `${inputVal} x ${factor} = ?`;
            document.getElementById(`qtext-${pid}`).style.display = 'block';
            document.getElementById(`grid-${pid}`).innerHTML = '';
            
            // Butonları Aç
            const btnPlay = document.getElementById(`btn-play-${pid}`);
            const btnQuick = document.getElementById(`btn-quick-${pid}`);
            
            btnPlay.disabled = false;
            btnPlay.innerText = "▶ OYNAT";
            btnQuick.disabled = false;
        }

        // --- ADIM ADIM OYNATMA ---
        async function nextStep(pid) {
            const state = states[pid];
            const rule = rules[state.factor];
            const btnPlay = document.getElementById(`btn-play-${pid}`);
            const btnQuick = document.getElementById(`btn-quick-${pid}`);

            if (state.step === 1) {
                // Aşama 1: SIFIR EKLEME
                btnPlay.disabled = true; // Animasyon bitene kadar bekle
                btnQuick.disabled = true; 

                prepareGrid(pid, state.num, rule.zeros, rule.div);
                
                document.getElementById(`qtext-${pid}`).style.display = 'none';
                document.getElementById(`grid-${pid}`).style.visibility = 'visible';

                // Sıfırları animasyonla getir
                const zeroBoxes = document.querySelectorAll(`#grid-${pid} .zero-box`);
                for(let box of zeroBoxes) {
                    await wait(300);
                    box.classList.add('zero-show');
                }

                btnPlay.innerText = "➗ BÖL";
                btnPlay.disabled = false;
                btnQuick.disabled = false; // İsterse burada da hızlı cevaba basabilir
                state.step = 2;

            } else if (state.step === 2) {
                // Aşama 2: BÖLME ANİMASYONU
                btnPlay.disabled = true;
                btnQuick.disabled = true;

                await autoPlayDivision(pid, state.num + rule.zeros, rule.div);

                btnPlay.innerText = "TEKRAR";
                btnPlay.disabled = false;
                state.step = 3; // Bitti
            } else if (state.step === 3) {
                resetPanel(pid);
            }
        }

        // --- HIZLI CEVAP (TEK TIKLA SONUÇ) ---
        function instantShow(pid) {
            const state = states[pid];
            if(!state.factor) return; // Seçim yapılmamışsa çık

            const rule = rules[state.factor];
            const fullStr = state.num + rule.zeros;
            const digits = fullStr.split('').map(Number);
            const divisor = rule.div;

            // Grid'i hemen çiz (Eğer çizili değilse)
            prepareGrid(pid, state.num, rule.zeros, rule.div);
            document.getElementById(`qtext-${pid}`).style.display = 'none';
            document.getElementById(`grid-${pid}`).style.visibility = 'visible';

            // Tüm sıfırları görünür yap
            const zeroBoxes = document.querySelectorAll(`#grid-${pid} .zero-box`);
            zeroBoxes.forEach(box => box.classList.add('zero-show'));
            // Geçiş efektini kaldır ki hemen görünsün
            zeroBoxes.forEach(box => box.style.transition = 'none');

            // Tüm işlemi bir kerede hesapla ve yaz
            let remainder = 0;
            for(let i=0; i<digits.length; i++) {
                let currentVal = parseInt(remainder.toString() + digits[i].toString());
                let quotient = Math.floor(currentVal / divisor);
                let newRemainder = currentVal % divisor;

                // Sonuç kutusunu doldur ve göster
                const resBox = document.getElementById(`p${pid}-r-${i}`);
                resBox.innerText = quotient;
                resBox.classList.add('res-show');
                resBox.style.transition = 'none'; // Animasyonsuz

                // Elde varsa göster
                if(i < digits.length - 1 && newRemainder > 0) {
                    const carry = document.getElementById(`p${pid}-c-${i+1}`);
                    carry.innerText = newRemainder;
                    carry.classList.add('carry-show');
                    carry.style.transition = 'none';
                }
                remainder = newRemainder;
            }

            // Butonları güncelle
            document.getElementById(`btn-play-${pid}`).innerText = "TEKRAR";
            document.getElementById(`btn-play-${pid}`).disabled = false;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
            states[pid].step = 3;
        }

        // YARDIMCI FONKSİYONLAR
        function prepareGrid(pid, numStr, zeros, divisor) {
            const grid = document.getElementById(`grid-${pid}`);
            grid.innerHTML = '';

            const divSign = document.createElement('div');
            divSign.className = 'divider-sign';
            divSign.innerHTML = `÷ ${divisor}`;
            grid.appendChild(divSign);

            const fullStr = numStr + zeros;
            for(let i=0; i < fullStr.length; i++) {
                const isZero = i >= numStr.length;
                const digit = fullStr[i];

                const group = document.createElement('div');
                group.className = 'digit-group';
                
                const carry = document.createElement('div');
                carry.className = 'carry';
                carry.id = `p${pid}-c-${i}`;
                group.appendChild(carry);

                const box = document.createElement('div');
                box.className = `box ${isZero ? 'zero-box' : ''}`;
                box.innerText = digit;
                box.id = `p${pid}-b-${i}`;
                group.appendChild(box);

                const res = document.createElement('div');
                res.className = 'res-box';
                res.id = `p${pid}-r-${i}`;
                group.appendChild(res);

                grid.appendChild(group);
            }
        }

        async function autoPlayDivision(pid, fullNumberStr, divisor) {
            const digits = fullNumberStr.split('').map(Number);
            let remainder = 0;

            for(let i=0; i < digits.length; i++) {
                const box = document.getElementById(`p${pid}-b-${i}`);
                const resBox = document.getElementById(`p${pid}-r-${i}`);
                
                // Vurgula
                box.classList.add('active-calc');
                await wait(600);

                let currentVal = parseInt(remainder.toString() + digits[i].toString());
                let quotient = Math.floor(currentVal / divisor);
                let newRemainder = currentVal % divisor;

                // Sonucu Yaz
                resBox.innerText = quotient;
                resBox.classList.add('res-show');
                
                // Elde Taşıma
                if(i < digits.length - 1 && newRemainder > 0) {
                    const nextCarry = document.getElementById(`p${pid}-c-${i+1}`);
                    await wait(300);
                    nextCarry.innerText = newRemainder;
                    nextCarry.classList.add('carry-show');
                }

                await wait(300);
                box.classList.remove('active-calc');
                remainder = newRemainder;
            }
        }

        function resetPanel(pid) {
            states[pid].step = 0;
            document.getElementById(`qtext-${pid}`).style.display = 'block';
            document.getElementById(`qtext-${pid}`).innerText = 'Hazır';
            document.getElementById(`grid-${pid}`).innerHTML = '';
            document.getElementById(`grid-${pid}`).style.visibility = 'hidden';
            
            const allBtns = document.querySelectorAll(`#setup-${pid} .setup-btn`);
            allBtns.forEach(b => b.classList.remove('active'));
            
            document.getElementById(`btn-play-${pid}`).innerText = "▶ OYNAT";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
