<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İnteraktif Bölme ve PDF Oluşturucu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --papyrus-bg: #f5e8c9;
            --papyrus-inner-bg: #fffaf0;
            --papyrus-border: #d3c0a5;
            --papyrus-text: #5a4a35;
            --papyrus-header: #8b4513;
            --box-size: clamp(35px, 8vw, 45px);
        }
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: 'Georgia', serif; background-color: var(--papyrus-bg); color: var(--papyrus-text);
            margin: 0; padding: 15px; display: flex; justify-content: center;
        }
        .container {
            width: 100%; max-width: 800px; background-color: var(--papyrus-inner-bg);
            padding: 20px; border: 2px solid var(--papyrus-border); box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            text-align: center; color: var(--papyrus-header);
            border-bottom: 2px solid var(--papyrus-border); padding-bottom: 10px; margin-top: 0;
        }
        h3 { font-size: 1.2em; margin-top: 30px; border-bottom-style: dashed; }
        .tab { display: flex; border: 1px solid var(--papyrus-border); background-color: #fdf5e6; }
        .tab button {
            background-color: inherit; border: none; outline: none; cursor: pointer;
            padding: 14px 10px; transition: 0.3s; font-size: clamp(14px, 2.5vw, 17px);
            font-family: 'Georgia', serif; color: var(--papyrus-header); width: 50%;
        }
        .tab button:hover { background-color: var(--papyrus-border); }
        .tab button.active { background-color: #c4ae8a; font-weight: bold; }
        .tabcontent { display: none; padding: 15px 10px; border: 1px solid var(--papyrus-border); border-top: none; animation: fadeEffect 0.8s; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        .setup-area {
            display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 20px;
            padding: 15px; border: 1px dashed var(--papyrus-border);
        }
        .input-group, .random-group {
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px;
        }
        input[type="number"], select {
            width: 130px; padding: 8px; border: 1px solid var(--papyrus-border);
            font-size: 1em; text-align: center;
        }
        .action-btn {
            padding: 10px 20px; font-size: 1em; cursor: pointer;
            background-color: var(--papyrus-header); color: white;
            border: none; border-radius: 5px; transition: background-color 0.3s;
        }
        .action-btn:hover:not(:disabled) { background-color: #a0522d; }
        .action-btn:disabled { background-color: #a9a9a9; cursor: not-allowed; }

        .explanation {
            min-height: 40px; margin-top: 25px; padding: 12px;
            background-color: #fdf5e6; border-left: 4px solid var(--papyrus-header);
            text-align: center; font-style: italic; line-height: 1.5;
        }
        
        .visual-container {
            display: flex; justify-content: center; margin-top: 20px;
            font-family: 'Courier New', Courier, monospace; font-size: 1.5em;
            overflow-x: auto; padding: 10px 0;
        }
        .num-box {
            width: var(--box-size); height: var(--box-size);
            display: flex; justify-content: center; align-items: center;
            border: 1px solid var(--papyrus-border); background-color: white; padding: 0;
            text-align: center; font-size: inherit;
        }
        
        /* Paylaştırma Stilleri */
        #paylastirma-grid { display: grid; grid-template-columns: auto auto 1fr; gap: 5px; align-items: start; }
        .line { border-right: 2px solid var(--papyrus-header); grid-row: 1 / span 20; }
        
        /* Uzun Bölme Stilleri */
        #uzun-bolme-grid { display: grid; grid-template-columns: repeat(11, var(--box-size)); grid-auto-rows: var(--box-size); align-items: center; }
        .grid-bolen-cizgi { grid-column: 7; grid-row: 1 / span 2; border-left: 2px solid var(--papyrus-header); height: 100%; }
        .grid-bolum-cizgi { grid-column: 8 / span 4; grid-row: 1; border-bottom: 2px solid var(--papyrus-header); height: 100%; }
    </style>
</head>
<body>

<div class="container">
    <h1>Bölme İşlemi Yöntemleri</h1>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Paylastirma')" id="defaultOpen">Paylaştırma Yöntemi</button>
        <button class="tablinks" onclick="openTab(event, 'UzunBolme')">Klasik Uzun Bölme</button>
    </div>

    <div id="Paylastirma" class="tabcontent">
        <h2>Paylaştırma Yöntemi (Avrupa)</h2>
        <div class="setup-area">
            <div class="input-group">
                <input type="number" id="p_bolunen_input" placeholder="Bölünen">
                <span>÷</span>
                <input type="number" id="p_bolen_input" placeholder="Bölen">
            </div>
            <div class="random-group">
                <select id="p_bolunen_digits">
                    <option value="2">2 Basamaklı Bölünen</option>
                    <option value="3" selected>3 Basamaklı Bölünen</option>
                    <option value="4">4 Basamaklı Bölünen</option>
                    <option value="5">5 Basamaklı Bölünen</option>
                    <option value="6">6 Basamaklı Bölünen</option>
                </select>
                <select id="p_bolen_digits">
                    <option value="1" selected>1 Basamaklı Bölen</option>
                    <option value="2">2 Basamaklı Bölen</option>
                    <option value="3">3 Basamaklı Bölen</option>
                </select>
                <button class="action-btn" onclick="generateAndFillNumbers('p_bolunen_digits', 'p_bolen_digits', 'p_bolunen_input', 'p_bolen_input')">Rastgele Üret</button>
            </div>
             <button class="action-btn" onclick="setupPaylastirma()">İnteraktif Başlat</button>
        </div>
        <div class="controls" id="paylastirma-controls" style="display:none;">
            <input type="number" id="p_kismi_bolum_input" placeholder="Kaçar dağıtacaksın?">
            <button class="action-btn" id="p_next_step_btn" onclick="handlePaylastirmaAdim()">Dağıt</button>
        </div>
        <div class="visual-container" id="paylastirma-visual" style="display:none;">
             <div id="paylastirma-grid"></div>
        </div>
        <div class="explanation" id="paylastirma-aciklama">Sayıları girin veya rastgele üretip "İnteraktif Başlat" butonuna basın.</div>
        
        <div class="pdf-section">
            <h3>Çalışma Sayfası Oluştur</h3>
            <div class="setup-area" style="border: none;">
                <button class="action-btn" onclick="generatePdf('paylastirma')">9 Soruluk PDF İndir</button>
            </div>
        </div>
    </div>

    <div id="UzunBolme" class="tabcontent">
        <h2>Klasik Uzun Bölme Yöntemi (Türkiye)</h2>
        <div class="setup-area">
            <div class="input-group">
                <input type="number" id="u_bolunen_input" placeholder="Bölünen">
                <span>÷</span>
                <input type="number" id="u_bolen_input" placeholder="Bölen">
            </div>
             <div class="random-group">
                <select id="u_bolunen_digits">
                    <option value="2">2 Basamaklı Bölünen</option>
                    <option value="3">3 Basamaklı Bölünen</option>
                    <option value="4" selected>4 Basamaklı Bölünen</option>
                    <option value="5">5 Basamaklı Bölünen</option>
                    <option value="6">6 Basamaklı Bölünen</option>
                </select>
                <select id="u_bolen_digits">
                    <option value="1">1 Basamaklı Bölen</option>
                    <option value="2" selected>2 Basamaklı Bölen</option>
                    <option value="3">3 Basamaklı Bölen</option>
                </select>
                <button class="action-btn" onclick="generateAndFillNumbers('u_bolunen_digits', 'u_bolen_digits', 'u_bolunen_input', 'u_bolen_input')">Rastgele Üret</button>
            </div>
            <button class="action-btn" onclick="setupUzunBolme()">İnteraktif Başlat</button>
        </div>
        <div class="controls" id="uzun-bolme-controls" style="display:none;">
            <button class="action-btn" id="u_next_step_btn" onclick="handleUzunBolmeAdim()">Sonraki Adım</button>
        </div>
        <div class="visual-container" id="uzun-bolme-visual" style="display:none;">
            <div id="uzun-bolme-grid"></div>
        </div>
        <div class="explanation" id="uzun-bolme-aciklama">Sayıları girin veya rastgele üretip "İnteraktif Başlat" butonuna basın.</div>
        
        <div class="pdf-section">
            <h3>Çalışma Sayfası Oluştur</h3>
            <div class="setup-area" style="border: none;">
                <button class="action-btn" onclick="generatePdf('uzunbolme')">9 Soruluk PDF İndir</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- GLOBAL VE YARDIMCI FONKSİYONLAR ---
const { jsPDF } = window.jspdf;

function openTab(evt, tabName) {
    let i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) tabcontent[i].style.display = "none";
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) tablinks[i].className = tablinks[i].className.replace(" active", "");
    document.getElementById(tabName).style.display = "block";
    if(evt) evt.currentTarget.className += " active";
}
document.getElementById("defaultOpen").click();

function generateRandomNumber(digits) {
    const min = Math.pow(10, digits - 1);
    const max = Math.pow(10, digits) - 1;
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function generateAndFillNumbers(bolunenDigitsId, bolenDigitsId, bolunenInputId, bolenInputId) {
    const bolunenDigits = document.getElementById(bolunenDigitsId).value;
    const bolenDigits = document.getElementById(bolenDigitsId).value;
    
    let bolunen, bolen;
    do {
        bolunen = generateRandomNumber(parseInt(bolunenDigits));
        bolen = generateRandomNumber(parseInt(bolenDigits));
    } while (bolen >= bolunen); // Anlamlı bir bölme işlemi için

    document.getElementById(bolunenInputId).value = bolunen;
    document.getElementById(bolenInputId).value = bolen;
}


// --- PAYLAŞTIRMA YÖNTEMİ ---
// Değişkenler ve fonksiyonlar...
let p_bolen, p_kalan, p_toplam_bolum;
function setupPaylastirma() { /* ... önceki kodla aynı ... */ }
function handlePaylastirmaAdim() { /* ... önceki kodla aynı ... */ }


// --- UZUN BÖLME YÖNTEMİ ---
// Değişkenler ve fonksiyonlar...
let u_bolunen_dizi, u_bolen, u_adim, u_islem_sayisi_str, u_bolum_dizi, u_kalan, u_index, u_grid_row;
function setupUzunBolme() { /* ... önceki kodla aynı ... */ }
function handleUzunBolmeAdim() { /* ... önceki kodla aynı ... */ }


// --- PDF OLUŞTURMA FONKSİYONU ---
function generatePdf(type) {
    const doc = new jsPDF('p', 'mm', 'a4');
    const margin = 15;
    const cellWidth = (210 - 2 * margin) / 3;
    const cellHeight = (297 - 2 * margin - 20) / 3; // Başlık için 20mm ayır
    const startY = margin + 20;

    // Türkçe karakterler için font ayarı (jsPDF standart fontları desteklemeyebilir)
    // Bu örnekte standart font kullanıyoruz, görüntüleme programına bağlı olarak çalışacaktır.
    doc.setFont("Helvetica");
    doc.setFontSize(18);
    doc.text("Bölme İşlemi Çalışma Sayfası", 105, margin + 5, { align: 'center' });
    doc.setFontSize(16);

    for (let row = 0; row < 3; row++) {
        for (let col = 0; col < 3; col++) {
            const x = margin + col * cellWidth;
            const y = startY + row * cellHeight;
            
            let bolunen, bolen;
            do {
                bolunen = generateRandomNumber(Math.floor(Math.random() * 4) + 3); // 3-6 basamaklı
                bolen = generateRandomNumber(Math.floor(Math.random() * 2) + 2); // 2-3 basamaklı
            } while (bolen >= bolunen);

            if (type === 'paylastirma') {
                doc.text(String(bolen), x + 5, y + 10);
                doc.line(x + 15, y, x + 15, y + 40); // Dikey çizgi
                doc.text(String(bolunen), x + 20, y + 10);
                doc.line(x + 5, y + 15, x + 10, y + 15); // Bölüm için alt çizgi
            } else { // uzunbolme
                doc.text(String(bolunen), x + 5, y + 10);
                doc.line(x, y + 2, x + 30, y + 2); // Üst çizgi
                doc.line(x + 30, y + 2, x + 30, y + 15); // Dikey çizgi
                doc.text(String(bolen), x + 35, y + 10);
            }
        }
    }
    
    doc.save(`bolme_calisma_sayfasi_${type}.pdf`);
}

// Önceki interaktif fonksiyonları buraya ekliyoruz (değişiklik yok)
function setupPaylastirma() {
    let p_bolunen = parseInt(document.getElementById('p_bolunen_input').value);
    p_bolen = parseInt(document.getElementById('p_bolen_input').value);
    if (isNaN(p_bolunen) || isNaN(p_bolen) || p_bolen <= 0) {
        alert("Lütfen geçerli sayılar girin. Bölen 0'dan büyük olmalı."); return;
    }
    p_kalan = p_bolunen;
    p_toplam_bolum = 0;
    const grid = document.getElementById('paylastirma-grid');
    grid.innerHTML = `<div class="num-box" style="grid-column: 1; grid-row: 1;">${p_bolen}</div><div class="line"></div><div class="num-box" style="grid-column: 3; grid-row: 1;">${p_bolunen}</div><div id="paylastirma-adimlari" style="grid-column: 3; grid-row: 2;"></div><div class="num-box" id="paylastirma-bolum" style="grid-column: 1; grid-row: 2; border-top: 2px solid var(--papyrus-header); background-color: #f0e68c; align-self: end;"></div>`;
    document.getElementById('paylastirma-visual').style.display = 'flex';
    document.getElementById('paylastirma-controls').style.display = 'flex';
    document.getElementById('p_next_step_btn').disabled = false;
    document.getElementById('paylastirma-aciklama').textContent = `${p_bolunen} sayısını ${p_bolen}'li gruplara dağıtmaya başlayalım. Her gruba kaçar tane vermek istersin?`;
}
function handlePaylastirmaAdim() {
    const kismi_bolum = parseInt(document.getElementById('p_kismi_bolum_input').value);
    if (isNaN(kismi_bolum) || kismi_bolum <= 0) { alert("Lütfen geçerli bir dağıtım sayısı girin."); return; }
    const cikarilacak = kismi_bolum * p_bolen;
    if (cikarilacak > p_kalan) { alert(`${cikarilacak} sayısı, kalan ${p_kalan}'dan büyük. Daha küçük bir sayı dene.`); return; }
    p_kalan -= cikarilacak;
    p_toplam_bolum += kismi_bolum;
    const adimlarDiv = document.getElementById('paylastirma-adimlari');
    adimlarDiv.innerHTML += `<div style="display: flex; align-items: center; justify-content: flex-end; gap: 5px;"><span>-</span><div class="num-box" style="width: auto; min-width: var(--box-size); padding: 0 5px;">${cikarilacak}</div><span style="font-size: 0.7em;">(${kismi_bolum} x ${p_bolen})</span></div><div style="text-align: right; border-top: 1px solid black; padding-right: 5px; font-weight: bold; margin-top: 5px; padding-top: 5px;">${p_kalan}</div>`;
    document.getElementById('paylastirma-bolum').textContent = p_toplam_bolum;
    document.getElementById('p_kismi_bolum_input').value = '';
    if (p_kalan < p_bolen) {
        document.getElementById('paylastirma-aciklama').innerHTML = `İşlem bitti! Kalan (${p_kalan}), bölenden (${p_bolen}) küçük. <br><b>Sonuç: Bölüm = ${p_toplam_bolum}, Kalan = ${p_kalan}</b>`;
        document.getElementById('p_next_step_btn').disabled = true;
    } else {
        document.getElementById('paylastirma-aciklama').textContent = `Harika! Şimdi kalan ${p_kalan} için dağıtıma devam et.`;
    }
}
function setupUzunBolme() {
    const bolunen_str = document.getElementById('u_bolunen_input').value;
    u_bolen = parseInt(document.getElementById('u_bolen_input').value);
    if (bolunen_str === '' || isNaN(u_bolen) || u_bolen <= 0 || bolunen_str.length > 6) {
        alert("Lütfen geçerli sayılar girin. Bölen 0'dan büyük olmalı ve bölünen en fazla 6 basamaklı olmalıdır."); return;
    }
    u_bolunen_dizi = bolunen_str.split(''); u_adim = 'INDIR'; u_islem_sayisi_str = '';
    u_bolum_dizi = []; u_kalan = 0; u_index = 0; u_grid_row = 1;
    const grid = document.getElementById('uzun-bolme-grid');
    grid.innerHTML = '';
    u_bolunen_dizi.forEach((d, i) => { grid.innerHTML += `<div class="num-box" style="grid-column: ${i + 1}; grid-row: 1;">${d}</div>`; });
    grid.innerHTML += `<div class="num-box" style="grid-column: 8; grid-row: 1; width: auto; min-width: var(--box-size); padding: 0 5px;">${u_bolen}</div>`;
    grid.innerHTML += `<div class="grid-bolen-cizgi"></div><div class="grid-bolum-cizgi"></div>`;
    document.getElementById('uzun-bolme-visual').style.display = 'flex';
    document.getElementById('uzun-bolme-controls').style.display = 'flex';
    document.getElementById('u_next_step_btn').disabled = false;
    document.getElementById('uzun-bolme-aciklama').textContent = 'Bölme işlemine başlamak için "Sonraki Adım" butonuna tıkla.';
}
function handleUzunBolmeAdim() {
    const aciklama = document.getElementById('uzun-bolme-aciklama');
    const grid = document.getElementById('uzun-bolme-grid');
    if (u_adim === 'INDIR') {
        u_islem_sayisi_str += u_bolunen_dizi[u_index];
        aciklama.textContent = `Sıradaki rakam (${u_bolunen_dizi[u_index]}) indirildi. Yeni sayımız: ${u_islem_sayisi_str}.`;
        u_adim = 'BOL';
    } else if (u_adim === 'BOL') {
        let islem_sayisi = parseInt(u_islem_sayisi_str);
        let bolum_rakami = Math.floor(islem_sayisi / u_bolen);
        u_bolum_dizi.push(bolum_rakami);
        grid.innerHTML += `<div class="num-box" style="grid-column: ${8 + u_bolum_dizi.length - 1}; grid-row: 2; background-color: #ffc0cb;">${bolum_rakami}</div>`;
        aciklama.textContent = `${islem_sayisi} içinde ${u_bolen}, ${bolum_rakami} defa var. Bölüme ${bolum_rakami} yazılır.`;
        u_adim = 'CARP';
    } else if (u_adim === 'CARP') {
        u_grid_row++;
        let son_bolum_rakami = u_bolum_dizi[u_bolum_dizi.length - 1];
        let carpim_str = String(son_bolum_rakami * u_bolen);
        let baslangic_sutun = u_index + 1 - (carpim_str.length - 1);
        grid.innerHTML += `<div style="grid-column: ${baslangic_sutun - 1}; grid-row: ${u_grid_row}; display:flex; align-items:center; justify-content:flex-end;">-</div>`;
        carpim_str.split('').forEach((d, i) => { grid.innerHTML += `<div class="num-box" style="grid-column: ${baslangic_sutun + i}; grid-row: ${u_grid_row};">${d}</div>`; });
        aciklama.textContent = `${son_bolum_rakami} ile ${u_bolen} çarpılır. Sonuç: ${carpim_str}.`;
        u_adim = 'CIKAR';
    } else if (u_adim === 'CIKAR') {
        u_grid_row++;
        let islem_sayisi = parseInt(u_islem_sayisi_str);
        let son_bolum_rakami = u_bolum_dizi[u_bolum_dizi.length - 1];
        u_kalan = islem_sayisi - (son_bolum_rakami * u_bolen);
        let kalan_str = String(u_kalan);
        let baslangic_sutun_cizgi = u_index + 1 - (u_islem_sayisi_str.length - 1);
        grid.innerHTML += `<div style="grid-column: ${baslangic_sutun_cizgi} / span ${u_islem_sayisi_str.length}; grid-row: ${u_grid_row - 1}; border-bottom: 2px solid black; align-self: end;"></div>`;
        let baslangic_sutun_kalan = u_index + 1 - (kalan_str.length - 1);
        kalan_str.split('').forEach((d, i) => { grid.innerHTML += `<div class="num-box" style="grid-column: ${baslangic_sutun_kalan + i}; grid-row: ${u_grid_row}; background-color: #90ee90;">${d}</div>`; });
        u_islem_sayisi_str = String(u_kalan);
        aciklama.textContent = `${islem_sayisi}'den çıkarma yapıldı. Kalan: ${u_kalan}.`;
        u_index++;
        if (u_index >= u_bolunen_dizi.length) { u_adim = 'BITTI';
        } else {
            let indirilen_sutun = u_index + 1;
            grid.innerHTML += `<div class="num-box" style="grid-column: ${indirilen_sutun}; grid-row: ${u_grid_row};">${u_bolunen_dizi[u_index]}</div>`;
            u_adim = 'INDIR';
        }
    }
    if (u_adim === 'BITTI') {
        aciklama.innerHTML = `Bölünecek başka rakam kalmadı. İşlem bitti! <br><b>Sonuç: Bölüm = ${u_bolum_dizi.join('') || 0}, Kalan = ${u_kalan}</b>`;
        document.getElementById('u_next_step_btn').disabled = true;
    }
}
</script>

</body>
</html>
