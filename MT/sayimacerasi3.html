<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sayı Atölyesi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2d3436;
            --accent: #0984e3;
            --bg: #f1f2f6;
            --white: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; width: 100%; height: 100vh;
            background-color: var(--bg); font-family: 'Nunito', sans-serif;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- 1. ÜST KISIM (SAYI VİTRİNİ) --- */
        .top-display {
            background: var(--white);
            padding: 15px 10px;
            box-shadow: var(--shadow);
            z-index: 10;
            flex-shrink: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 120px; /* Sayı için yeterli alan */
        }

        /* Sayı Kutucukları Konteyneri */
        .number-container {
            display: flex; justify-content: center; align-items: flex-end;
            gap: 2px; /* Varsayılan bitişik */
            transition: all 0.3s;
        }

        /* Gruplama Modu için boşluk açma */
        .number-container.grouped { gap: 15px; }

        /* Rakam Kutusu */
        .digit-box {
            width: 40px; height: 60px; /* Mobilde parmak basacak kadar */
            background: #f5f6fa; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: 900; color: #2d3436; /* Varsayılan Siyah */
            border-bottom: 4px solid #dcdde1;
            cursor: pointer; transition: all 0.2s; user-select: none;
        }

        /* Aktif (Seçili) Durum */
        .digit-box.active {
            background: #ffeaa7 !important; color: #d35400 !important; 
            border-bottom-color: #e67e22 !important; transform: translateY(-5px);
        }

        /* Renkli Mod (Sadece 'grouped' class'ı varsa çalışır) */
        .number-container.colored .g-0 .digit-box { color: #00b894; border-bottom-color: #00b894; } /* Birler */
        .number-container.colored .g-1 .digit-box { color: #0984e3; border-bottom-color: #0984e3; } /* Binler */
        .number-container.colored .g-2 .digit-box { color: #d63031; border-bottom-color: #d63031; } /* Milyon */
        .number-container.colored .g-3 .digit-box { color: #6c5ce7; border-bottom-color: #6c5ce7; } /* Milyar */

        /* Bölük Etiketleri (Altındaki yazılar) */
        .group-label {
            position: absolute; bottom: -20px; left: 0; width: 100%; text-align: center;
            font-size: 0.6rem; font-weight: 800; color: #999; text-transform: uppercase;
            display: none; /* Varsayılan gizli */
        }
        .number-container.grouped .group-label { display: block; }

        /* Her bölük grubu */
        .digit-group {
            display: flex; gap: 2px; position: relative;
            transition: transform 0.3s;
        }
        
        /* Mod Göstergesi */
        .mode-badge {
            background: #e17055; color: white; font-size: 0.75rem; padding: 3px 10px;
            border-radius: 10px; font-weight: bold; margin-bottom: 5px; display: none;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.7} 100%{opacity:1} }

        /* --- 2. SEKMELER --- */
        .tabs {
            display: flex; background: #dfe6e9; padding: 5px; overflow-x: auto; flex-shrink: 0;
        }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: transparent;
            font-weight: 800; font-size: 0.9rem; color: #636e72; min-width: 70px;
            border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; align-items: center;
        }
        .tab-btn i { font-size: 1.2rem; margin-bottom: 4px; }
        .tab-btn.active { background: white; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* --- 3. İÇERİK ALANI --- */
        .content { flex: 1; overflow-y: auto; padding: 15px; position: relative; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

        /* KARTLAR VE ELEMANLAR */
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 15px; text-align: center; }
        .card-title { font-size: 0.8rem; color: #b2bec3; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; }
        .card-val { font-family: 'Patrick Hand', cursive; font-size: 1.6rem; color: #2d3436; font-weight: bold; }
        
        /* Butonlar */
        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            background: var(--accent); color: white; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; margin-top: 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-green { background: #00b894; }
        .btn-orange { background: #e17055; }

        /* Merdiven (Fix) */
        .ladder-wrap {
            display: flex; align-items: flex-end; justify-content: center; gap: 5px;
            height: 350px; padding-bottom: 0; overflow-x: auto;
            border-bottom: 4px solid #b2bec3; /* Zemin Çizgisi */
        }
        .ladder-col {
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            height: 100%; min-width: 45px;
        }
        .ladder-bar {
            width: 100%; border-radius: 5px 5px 0 0; 
            color: black; font-weight: bold; font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 2px -2px 5px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            /* Animasyon */
            height: 0; animation: grow 0.5s forwards; animation-delay: 0.1s;
        }
        @keyframes grow { to { height: var(--h); } }

        .ladder-text-vertical {
            writing-mode: vertical-lr; transform: rotate(180deg); white-space: nowrap; padding: 10px 0;
        }
        /* Basamak İsimleri (Zeminin Altında) */
        .ladder-label {
            margin-top: 5px; height: 100px; display: flex; align-items: flex-start; justify-content: center;
            font-size: 0.7rem; font-weight: 800; color: #636e72; text-transform: uppercase;
        }
        .ladder-label span { writing-mode: vertical-lr; transform: rotate(180deg); }

        /* Şifre ve Alfabe */
        .alpha-scroll { display: flex; gap: 5px; overflow-x: auto; padding: 10px; background: #2d3436; border-radius: 8px; margin-bottom: 15px; }
        .alpha-item { min-width: 35px; height: 45px; background: white; border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; }
        
        /* Ayarlar Satırı */
        .set-row { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; font-weight: bold; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Footer */
        .footer { text-align: center; padding: 15px; color: #b2bec3; font-size: 0.9rem; font-weight: bold; font-family: 'Patrick Hand'; }

    </style>
</head>
<body>

    <div class="top-display">
        <div id="mode-badge" class="mode-badge">MOD AKTİF</div>
        <div class="number-container" id="num-container">
            </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('test')"><i class="fas fa-puzzle-piece"></i> Test</button>
        <button class="tab-btn" onclick="openTab('analiz')"><i class="fas fa-microscope"></i> Analiz</button>
        <button class="tab-btn" onclick="openTab('merdiven')"><i class="fas fa-stream"></i> Merdiven</button>
        <button class="tab-btn" onclick="openTab('yazma')"><i class="fas fa-pen-alt"></i> Yazma</button>
        <button class="tab-btn" onclick="openTab('sifre')"><i class="fas fa-user-secret"></i> Şifre</button>
        <button class="tab-btn" onclick="openTab('ayarlar')"><i class="fas fa-cogs"></i> Ayarlar</button>
    </div>

    <div class="content">

        <div id="page-test" class="page active">
            <button class="btn" onclick="generateQuiz()"><i class="fas fa-sync-alt"></i> Yeni Sorular Getir</button>
            <div id="quiz-area" style="margin-top:20px; display:flex; flex-direction:column; gap:15px;"></div>
        </div>

        <div id="page-analiz" class="page">
            <div class="card" id="analiz-intro" style="background:#fff3cd; color:#d35400;">
                <i class="fas fa-hand-pointer"></i> Analiz etmek için yukarıdaki bir rakama tıkla!
            </div>
            
            <div id="analiz-reveal-area" style="display:none; margin-top:20px;">
                <button class="btn btn-green" onclick="showAnalysis()">ANALİZİ GÖR</button>
            </div>

            <div id="analiz-details" style="display:none;">
                <div class="card"><div class="card-title">Basamak Adı</div><div class="card-val" id="an-name">...</div></div>
                <div style="display:flex; gap:10px;">
                    <div class="card" style="flex:1"><div class="card-title">Sayı Değeri</div><div class="card-val" style="font-size:2.5rem" id="an-face">0</div></div>
                    <div class="card" style="flex:1">
                        <div class="card-title">Basamak Değeri</div>
                        <div class="card-val" style="color:#d63031" id="an-place">0</div>
                        <div style="font-size:0.9rem; color:#999; margin-top:5px;" id="an-expo"></div>
                    </div>
                </div>
                <div class="card"><div class="card-title">Birim Analizi</div><div class="card-val" style="color:#e17055" id="an-unit">...</div></div>
                <div class="card"><div class="card-title">Okunuş</div><div class="card-val" style="font-size:1.2rem" id="an-read">...</div></div>
            </div>
        </div>

        <div id="page-merdiven" class="page">
            <div class="ladder-wrap" id="ladder-area"></div>
            <div class="card" style="margin-top:15px;">
                <div class="card-title">Çözümleme</div>
                <div class="card-val" style="font-size:1rem; text-align:left" id="ladder-exp">...</div>
            </div>
        </div>

        <div id="page-yazma" class="page">
            <div class="card">
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <select id="write-digits" style="padding:10px; border-radius:8px; flex:1;">
                        <option value="4">4 Basamaklı</option><option value="5">5 Basamaklı</option><option value="6">6 Basamaklı</option>
                        <option value="7">7 Basamaklı</option><option value="9" selected>9 Basamaklı</option><option value="12">12 Basamaklı</option>
                    </select>
                    <button class="btn" style="margin:0; width:auto;" onclick="newWriteQ()">Soru Üret</button>
                </div>
                <div style="font-weight:bold; color:#636e72; margin-bottom:10px;">Okunuşu verilen sayıyı yaz:</div>
                <div id="write-q" style="font-size:1.3rem; font-weight:800; color:#2d3436; margin-bottom:20px; min-height:60px; background:#f1f2f6; padding:15px; border-radius:10px; border-left:5px solid #0984e3;">...</div>
                <input type="number" id="write-ans" placeholder="Cevabını buraya yaz" style="width:100%; padding:15px; font-size:1.5rem; border-radius:10px; border:2px solid #dfe6e9; text-align:center;">
                <button class="btn btn-green" onclick="checkWrite()">KONTROL ET</button>
                <div id="write-feedback" style="margin-top:15px; font-weight:bold; font-size:1.2rem; height:40px;"></div>
            </div>
        </div>

        <div id="page-sifre" class="page">
            <div class="alpha-scroll" id="alpha-strip"></div>
            <div class="card">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="cipher-in" placeholder="İSİM GİRİNİZ (Örn: ALİ)" style="text-transform:uppercase; width:100%; padding:10px; border-radius:8px; border:2px solid #dfe6e9;">
                    <button class="btn" style="margin:0; width:auto;" onclick="doCipher()">ŞİFRELE</button>
                </div>
                <div id="cipher-res" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:20px;"></div>
                <div id="cipher-sum" style="margin-top:20px; font-weight:bold; font-size:1.5rem; color:#d35400;"></div>
            </div>
        </div>

        <div id="page-ayarlar" class="page">
            <div class="set-row">
                <span>Rastgele Sayı Üret:</span>
                <div style="display:flex; gap:5px;">
                    <select id="gen-digits" style="padding:5px; border-radius:5px;">
                        <option value="3">3 Bas</option><option value="6">6 Bas</option><option value="9" selected>9 Bas</option><option value="12">12 Bas</option>
                    </select>
                    <button style="background:var(--accent); color:white; border:none; padding:5px 15px; border-radius:5px; font-weight:bold; cursor:pointer;" onclick="newNum()">Üret</button>
                </div>
            </div>
            <div class="set-row">
                <span>Sayıyı Elle Gir:</span>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="man-in" placeholder="123..." style="width:80px; padding:5px; border-radius:5px; border:1px solid #ccc;">
                    <button style="background:#2d3436; color:white; border:none; padding:5px 10px; border-radius:5px; font-weight:bold; cursor:pointer;" onclick="manualNum()">OK</button>
                </div>
            </div>
            <hr style="margin:15px 0; border:0; border-top:1px solid #ccc;">
            <div class="set-row">
                <span><i class="fas fa-columns"></i> Gruplara Ayır</span>
                <label class="switch"><input type="checkbox" id="tg-group" onchange="toggleGroup()"><span class="slider"></span></label>
            </div>
            <div class="set-row" style="background:#fff0f0;">
                <span><i class="fas fa-exchange-alt"></i> Bölük Taşıma Modu</span>
                <label class="switch"><input type="checkbox" id="tg-swap" onchange="toggleSwap()"><span class="slider"></span></label>
            </div>
            <div class="set-row" style="background:#fff8e1;">
                <span><i class="fas fa-random"></i> Rakam Taşıma Modu</span>
                <label class="switch"><input type="checkbox" id="tg-digit" onchange="toggleDigit()"><span class="slider"></span></label>
            </div>
        </div>

    </div>

    <div class="footer">Zeynal Öğretmenin Sayı Atölyesi</div>

<script>
    // GLOBAL STATE
    let G = {
        num: "", // Sayı String
        group: false, // Gruplama açık mı?
        mode: null, // 'swap', 'digit', null
        sel: null, // Seçilen index
        temp: {} // Analiz verisi
    };

    const names = ["Birler","Onlar","Yüzler","Binler","On Binler","Yüz Binler","Milyonlar","On Milyonlar","Yüz Milyonlar","Milyarlar","On Milyarlar","Yüz Milyarlar"];
    const pNames = ["Birler","Binler","Milyonlar","Milyarlar"];
    const suffix = {"Birler":"Birlik","Onlar":"Onluk","Yüzler":"Yüzlük","Binler":"Binlik","On Binler":"On Binlik","Yüz Binler":"Yüz Binlik","Milyonlar":"Milyonluk","On Milyonlar":"On Milyonluk","Yüz Milyonlar":"Yüz Milyonluk","Milyarlar":"Milyarlık","On Milyarlar":"On Milyarlık","Yüz Milyarlar":"Yüz Milyarlık"};
    const colors = ["#fab1a0", "#55efc4", "#74b9ff", "#a29bfe", "#ffeaa7", "#ff7675"];
    const abc = 'ABCÇDEFGĞHIİJKLMNOÖPRSŞTUÜVYZ';

    // --- BAŞLANGIÇ ---
    function init() {
        newNum();
        fillAlpha();
        openTab('test');
    }

    // --- GÖRÜNTÜLEME MOTORU ---
    function render() {
        const con = document.getElementById('num-container');
        con.innerHTML = "";
        
        // CSS sınıflarını ayarla
        con.className = `number-container ${G.group ? 'grouped colored' : ''}`;
        
        // Sayıyı dinamik boyutlandır (Telefona sığsın)
        let digitCount = G.num.length;
        let boxW = digitCount > 9 ? 28 : (digitCount > 6 ? 35 : 45);
        let fontS = digitCount > 9 ? 1.2 : (digitCount > 6 ? 1.6 : 2.2);

        // Grupları oluştur
        let parts = [];
        let tempS = G.num;
        while(tempS.length > 0) { parts.unshift(tempS.slice(-3)); tempS = tempS.slice(0,-3); }

        parts.forEach((part, pIdx) => {
            let revIdx = parts.length - 1 - pIdx; // 0=Birler, 1=Binler...
            
            let grpDiv = document.createElement('div');
            grpDiv.className = `digit-group g-${revIdx}`;
            
            // Bölük Seçimi (Swap Modu)
            if(G.mode === 'swap' && G.sel === pIdx) grpDiv.style.transform = "translateY(-10px)";
            grpDiv.onclick = (e) => { if(G.mode === 'swap') doSwap(pIdx); };

            // Rakamları bas
            let digitsHTML = "";
            let chars = part.split('');
            // Sağdan sola offset
            let rightOffset = 0; for(let k=pIdx+1; k<parts.length; k++) rightOffset+=3;

            chars.forEach((d, dIdx) => {
                let power = rightOffset + (chars.length - 1 - dIdx); // 10^power
                let realIdx = G.num.length - 1 - power; // String içindeki index
                
                let isActive = (G.mode === 'digit' && G.sel === realIdx);
                let style = `width:${boxW}px; height:${boxW*1.5}px; font-size:${fontS}rem; ${isActive ? 'background:#d35400; color:white;' : ''}`;
                
                // Tıklama
                let click = "";
                if(G.mode === 'digit') click = `onclick="doDigitSwap(${realIdx}, event)"`;
                else if(!G.mode) click = `onclick="prepAnaliz(${power}, '${d}', event)"`;

                digitsHTML += `<div class="digit-box" style="${style}" ${click}>${d}</div>`;
            });

            grpDiv.innerHTML = `${digitsHTML}<div class="group-label">${pNames[revIdx]}</div>`;
            con.appendChild(grpDiv);
        });
        
        // Rozet Güncelle
        let badge = document.getElementById('mode-badge');
        if(G.mode === 'swap') { badge.style.display='block'; badge.innerText="BÖLÜK TAŞIMA MODU"; }
        else if(G.mode === 'digit') { badge.style.display='block'; badge.innerText="RAKAM TAŞIMA MODU"; }
        else badge.style.display='none';
    }

    // --- FONKSİYONLAR ---
    function newNum() {
        let d = parseInt(document.getElementById('gen-digits').value);
        let n = Math.floor(Math.random()*9+1).toString();
        for(let i=1; i<d; i++) n += Math.floor(Math.random()*10);
        setNum(n);
    }
    function manualNum() {
        let v = document.getElementById('man-in').value.slice(0,12);
        if(v.length>0) { setNum(v); openTab('analiz'); }
    }
    function setNum(s) {
        G.num = s; resetModes();
        render(); renderLadder(); genQuiz(); newWriteQ();
        document.getElementById('analiz-intro').style.display='block';
        document.getElementById('analiz-reveal-area').style.display='none';
        document.getElementById('analiz-details').style.display='none';
    }

    // MOD YÖNETİMİ
    function toggleGroup() { G.group = document.getElementById('tg-group').checked; render(); }
    function toggleSwap() {
        let on = document.getElementById('tg-swap').checked;
        if(on) { 
            G.mode='swap'; G.group=true; document.getElementById('tg-group').checked=true;
            G.sel=null; document.getElementById('tg-digit').checked=false;
            openTab('analiz'); // İşlem ekranı
        } else { G.mode=null; G.sel=null; }
        render();
    }
    function toggleDigit() {
        let on = document.getElementById('tg-digit').checked;
        if(on) { 
            G.mode='digit'; G.sel=null; document.getElementById('tg-swap').checked=false;
            openTab('analiz');
        } else { G.mode=null; G.sel=null; }
        render();
    }
    function resetModes() {
        G.mode=null; G.sel=null;
        document.getElementById('tg-swap').checked=false;
        document.getElementById('tg-digit').checked=false;
    }

    // TAŞIMA İŞLEMLERİ
    function doSwap(idx) {
        if(G.sel === null) { G.sel = idx; render(); }
        else if(G.sel === idx) { G.sel = null; render(); }
        else {
            let parts = []; let t = G.num;
            while(t.length>0){parts.unshift(t.slice(-3)); t=t.slice(0,-3);}
            let tmp = parts[G.sel]; parts[G.sel] = parts[idx]; parts[idx] = tmp;
            
            let newS = "";
            parts.forEach((p,i)=>{ if(i===0) newS+=parseInt(p).toString(); else newS+=p.toString().padStart(3,'0'); });
            
            G.num = parseInt(newS).toString(); G.sel=null;
            render(); renderLadder(); genQuiz();
        }
    }
    function doDigitSwap(idx, e) {
        e.stopPropagation();
        if(G.sel === null) { G.sel = idx; render(); }
        else {
            let arr = G.num.split('');
            let t = arr[G.sel]; arr[G.sel] = arr[idx]; arr[idx] = t;
            G.num = arr.join('');
            G.sel = null;
            render(); renderLadder(); genQuiz();
        }
    }

    // ANALİZ
    function prepAnaliz(pow, val, e) {
        // Görsel Seçim
        document.querySelectorAll('.digit-box').forEach(b=>b.classList.remove('active'));
        e.target.classList.add('active');

        let name = basamakAdlari[pow];
        let pv = parseInt(val) * Math.pow(10, pow);
        G.temp = {
            name: name + " Basamağı",
            face: val,
            place: pv.toLocaleString('tr-TR'),
            expo: `${val} x 10<sup>${pow}</sup>`,
            unit: `${val} tane ${suffix[name] || name}`,
            read: numToText(parseInt(G.num))
        };
        document.getElementById('analiz-intro').style.display='none';
        document.getElementById('analiz-details').style.display='none';
        document.getElementById('analiz-reveal-area').style.display='block';
        openTab('analiz');
    }
    function showAnalysis() {
        document.getElementById('analiz-reveal-area').style.display='none';
        document.getElementById('analiz-details').style.display='block';
        document.getElementById('an-name').innerText = G.temp.name;
        document.getElementById('an-face').innerText = G.temp.face;
        document.getElementById('an-place').innerText = G.temp.place;
        document.getElementById('an-expo').innerHTML = G.temp.expo;
        document.getElementById('an-unit').innerText = G.temp.unit;
        document.getElementById('an-read').innerText = G.temp.read;
    }

    // MERDİVEN
    function renderLadder() {
        const c = document.getElementById('ladder-area'); c.innerHTML="";
        let len = G.num.length; let expParts=[];
        for(let i=0; i<len; i++) {
            let d = parseInt(G.num[i]); let p = len-1-i; let v = d*Math.pow(10,p);
            
            let col = document.createElement('div'); col.className='ladder-col';
            let h = (5 + (p*8)); if(h>95) h=95;
            
            col.innerHTML = `
                <div class="ladder-bar" style="height:${h}%; background:${colors[p%6]}; --h:${h}%">
                    <span class="ladder-text-vertical">${d} x 10<sup>${p}</sup> = ${v.toLocaleString()}</span>
                </div>
                <div class="ladder-label"><span>${basamakAdlari[p]}</span></div>
            `;
            c.appendChild(col);
            if(d>0) expParts.push(`(${d} x ${Math.pow(10,p).toLocaleString()})`);
        }
        document.getElementById('ladder-exp').innerText = expParts.join(' + ');
    }

    // QUIZ
    function genQuiz() {
        const c = document.getElementById('quiz-area'); c.innerHTML="";
        let len = G.num.length;
        // 10 Soru
        for(let k=0; k<10; k++) {
            let type = Math.floor(Math.random()*4);
            let q={t:"", a:""};
            if(type===0) { 
                let idx = Math.floor(Math.random()*len); 
                let p = len-1-idx; 
                q.t=`<strong>${basamakAdlari[p]}</strong> basamağındaki rakam kaçtır?`; q.a=G.num[idx]; 
            }
            else if(type===1) {
                let idx = Math.floor(Math.random()*len); let p = len-1-idx;
                q.t=`<strong>${basamakAdlari[p]}</strong> basamağının basamak değeri?`; q.a=(parseInt(G.num[idx])*Math.pow(10,p)).toLocaleString();
            }
            else if(type===2) {
                q.t="Sayıdaki rakamların sayı değerleri toplamı?"; q.a=G.num.split('').reduce((a,b)=>a+parseInt(b),0);
            }
            else {
                q.t="Basamak değeri ile sayı değeri eşit olan kaç rakam var?"; 
                let count=0; for(let i=0;i<len;i++){ if(parseInt(G.num[i]) * Math.pow(10,len-1-i) == parseInt(G.num[i])) count++; }
                q.a = count;
            }
            
            let div = document.createElement('div'); div.className='card'; style="text-align:center; margin:0";
            div.innerHTML = `<div style="font-weight:bold; margin-bottom:10px">Soru ${k+1}: ${q.t}</div><button class="btn" style="margin:0; padding:5px; background:#636e72" onclick="this.nextElementSibling.style.display='block'; this.style.display='none'">Cevap</button><div class="ans-reveal">${q.a}</div>`;
            c.appendChild(div);
        }
    }

    // YAZMA & ŞİFRE & TOOLS
    function newWriteQ() {
        let d = document.getElementById('write-digits').value;
        let n = Math.floor(Math.random()*9+1).toString(); for(let i=1;i<d;i++) n+=Math.floor(Math.random()*10);
        document.getElementById('write-q').innerText = numToText(parseInt(n));
        document.getElementById('write-ans').dataset.ans = n;
        document.getElementById('write-ans').value = "";
        document.getElementById('write-feedback').innerText = "";
    }
    function checkWrite() {
        let user = document.getElementById('write-ans').value.replace(/\D/g,'');
        let real = document.getElementById('write-ans').dataset.ans;
        let fb = document.getElementById('write-feedback');
        if(user===real) { fb.innerText="DOĞRU!"; fb.style.color="green"; } else { fb.innerText="YANLIŞ ("+real+")"; fb.style.color="red"; }
    }
    function fillAlpha() {
        let h=""; abc.split('').forEach((c,i)=>h+=`<div class="alpha-item"><span>${c}</span><span style="color:red;font-size:0.7rem">${i+1}</span></div>`);
        document.getElementById('alpha-strip').innerHTML=h;
    }
    function doCipher() {
        let n = document.getElementById('cipher-in').value.toUpperCase();
        let html=""; let sum=0;
        for(let c of n) { let idx=abc.indexOf(c)+1; if(idx>0){sum+=idx; html+=`<div style="border:1px solid #ccc; border-radius:5px; padding:5px; min-width:40px; text-align:center"><div style="font-weight:900; font-size:1.5rem">${c}</div><div style="color:red; font-weight:bold">${idx}</div></div>`;} }
        document.getElementById('cipher-res').innerHTML=html; document.getElementById('cipher-sum').innerText="Toplam: "+sum;
    }

    // TAB & UTILS
    function openTab(id) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById('page-'+id).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        event.currentTarget?.classList.add('active');
        // İlk açılışta test butonu aktif görünsün diye manuel class ekleme gerekebilir, init'te hallediyoruz.
    }
    function numToText(n){
        if(n==0)return "Sıfır"; const o=["","Bir","İki","Üç","Dört","Beş","Altı","Yedi","Sekiz","Dokuz"]; const t=["","On","Yirmi","Otuz","Kırk","Elli","Altmış","Yetmiş","Seksen","Doksan"]; const p=["","Bin","Milyon","Milyar"];
        let s=n.toString(), out="", parts=[]; while(s.length>0){parts.push(s.slice(-3));s=s.slice(0,-3);}
        for(let i=parts.length-1;i>=0;i--){
            let x=parseInt(parts[i]); if(x>0){
                let y=Math.floor(x/100), te=Math.floor((x%100)/10), un=x%10;
                if(y==1)out+="Yüz "; else if(y>1)out+=o[y]+" Yüz ";
                out+=t[te]+" "+o[un]+" ";
                if(i==1 && x==1)out="";
                out+=p[i]+" ";
            }
        }
        return out.trim();
    }

    init();
</script>
</body>
</html>
