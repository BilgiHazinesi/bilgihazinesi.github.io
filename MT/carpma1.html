<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çarpma Egzersizi (İki Seviye) - Bilgi Hazinesi</title>
    
    <base href="https://bilgihazinesi.github.io/">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="stiller/stil.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        /* Önceki stiller + Yeni stiller */
        body { font-family: 'Crimson Pro', serif; }
        .container { max-width: 900px; margin: 0 auto; text-align: center; padding: 20px; }
        header h1 a { font-family: 'Cinzel Decorative', cursive; color: var(--text-primary-color); font-size: clamp(1.8rem, 5vw, 2.5rem); margin-bottom: 10px; text-decoration: none; }
        header p { font-size: clamp(1rem, 3vw, 1.1rem); margin-bottom: 30px; color: var(--text-secondary-color); }
        
        .setup-card, .quiz-card, .results-card { background-color: var(--papyrus-bg-color-dark); padding: clamp(15px, 4vw, 25px); border-radius: 12px; border: 1px solid var(--border-color); box-shadow: var(--shadow-color); margin: 0 auto 20px auto; max-width: 700px; }
        
        /* Başlangıç Ekranı Stilleri */
        .setup-card h2 { font-family: 'Cinzel Decorative', cursive; color: var(--accent-color); margin-bottom: 20px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 700; color: var(--text-secondary-color); font-size: 1.1rem; }
        .input-group input[type="text"] { width: 80%; max-width: 300px; padding: 10px; border: 2px solid var(--border-color); background: var(--papyrus-bg-color-light); border-radius: 8px; font-size: 1.1rem; font-family: 'Crimson Pro', serif; text-align: center; box-sizing: border-box; }
        .time-options button { margin: 5px; padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--papyrus-bg-color-light); color: var(--text-secondary-color); font-size: 1rem; font-family: 'Crimson Pro', serif; font-weight: 700; cursor: pointer; transition: all 0.3s ease; }
        .time-options button.selected { background-color: var(--accent-color); color: white; border-color: var(--accent-color); }
         /* YENİ: Seviye Seçim Butonları */
         .level-selection { margin-top: 25px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
         .level-button { padding: 12px 25px; }

        /* Quiz Kartı Stilleri */
        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 1.1rem; font-weight: 700; color: var(--text-secondary-color); }
        #timer, #score { background-color: var(--papyrus-bg-color-light); padding: 5px 10px; border-radius: 6px; border: 1px solid var(--border-color); min-width: 70px; text-align: center; }
        
        /* Seviye 1 Özel Stilleri */
        #multiplication-problem { font-size: clamp(2rem, 8vw, 3.5rem); font-weight: 700; color: var(--accent-color); margin-bottom: 15px; font-family: 'Cinzel Decorative', cursive; }
        #repeated-addition { font-size: clamp(1rem, 3.5vw, 1.3rem); color: var(--text-secondary-color); margin-bottom: 25px; font-weight: 500; word-wrap: break-word; min-height: 1.5em; }
        #visual-model { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: clamp(10px, 2vw, 15px); margin-bottom: 30px; padding: 10px; border: 1px dashed var(--border-color); border-radius: 8px; background-color: var(--papyrus-bg-color-light); min-height: 100px; }
        .visual-group { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 5px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--papyrus-bg-color-dark); }
        .visual-item { font-size: clamp(1.2rem, 4vw, 1.8rem); color: var(--accent-color); line-height: 1; }
        
        /* Seviye 2 Özel Stilleri */
         #word-problem-question {
             font-size: clamp(1.2rem, 4vw, 1.6rem); /* Problem cümlesi için boyut */
             font-weight: 600;
             line-height: 1.5;
             margin-bottom: 30px; /* Cevap alanından önce boşluk */
             color: var(--text-primary-color);
         }
         /* Seviye 2'de gereksiz alanları gizle */
         .level2-active #repeated-addition,
         .level2-active #visual-model,
         .level2-active #multiplication-problem {
             display: none;
         }
         /* Seviye 1'de problem cümlesini gizle */
         .level1-active #word-problem-question {
              display: none;
         }


        #answer-input { width: 150px; padding: 12px; border: 2px solid var(--border-color); background: var(--papyrus-bg-color-light); border-radius: 8px; font-size: clamp(1.5rem, 5vw, 2rem); font-family: 'Crimson Pro', serif; text-align: center; box-sizing: border-box; font-weight: 700; margin: 0 auto 15px auto; display: block; -moz-appearance: textfield; }
        #answer-input::-webkit-outer-spin-button, #answer-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .quiz-buttons { margin-top: 20px; display: flex; justify-content: center; gap: 15px; }
        .quiz-btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; font-family: 'Crimson Pro', serif; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .check-btn { background-color: var(--accent-color); color: white; }
        .next-btn { background-color: var(--text-secondary-color); color: white; }
        .feedback { font-weight: 700; margin-top: 15px; min-height: 24px; font-size: 1.1rem; }
        .correct { color: #2e7d32; }
        .wrong { color: #c62828; }

        /* Sonuç Ekranı Stilleri */
        .results-card h2 { font-family: 'Cinzel Decorative', cursive; color: var(--accent-color); margin-bottom: 15px; }
        .results-card p { font-size: 1.3rem; margin-bottom: 25px; font-weight: 600; }
        .results-card strong { color: var(--accent-color); font-size: 1.5rem;}
        
    </style>
</head>
<body>

    <div id="menu-container"></div>

    <div class="container">
        <header>
            <h1><a href="https://bilgihazinesi.github.io/">Çarpma Egzersizi</a></h1>
            <p>Çarpma işlemini farklı seviyelerde tekrar edelim.</p>
        </header>

        <main>
            <div id="setup-screen" class="setup-card">
                <h2>Egzersize Başla</h2>
                <div class="input-group">
                    <label for="student-name">Adın:</label>
                    <input type="text" id="student-name" placeholder="Adını buraya yaz">
                </div>
                <div class="input-group">
                     <label>Süre Seç:</label>
                     <div class="time-options">
                         <button onclick="multiplicationPractice.selectTime(2, this)">2 Dakika</button>
                         <button onclick="multiplicationPractice.selectTime(3, this)">3 Dakika</button>
                         <button onclick="multiplicationPractice.selectTime(4, this)">4 Dakika</button>
                         <button onclick="multiplicationPractice.selectTime(5, this)">5 Dakika</button>
                     </div>
                </div>
                <div class="level-selection">
                     <button class="quiz-btn check-btn level-button" onclick="multiplicationPractice.startExercise(1)">Seviye 1 Başla</button>
                     <button class="quiz-btn check-btn level-button" onclick="multiplicationPractice.startExercise(2)">Seviye 2 Başla</button>
                 </div>
                 <p id="setup-feedback" class="feedback wrong"></p> 
            </div>

            <div id="quiz-screen" class="quiz-card" style="display: none;">
                
                 <div class="quiz-header">
                     <div id="timer">00:00</div>
                     <div id="score">Skor: 0</div>
                 </div>
                
                 <div id="multiplication-problem">? x ? = ?</div>
                <div id="repeated-addition">...</div>
                <div id="visual-model"></div>
                
                 <div id="word-problem-question">Problem cümlesi buraya gelecek...</div>

                 <input type="number" id="answer-input" placeholder="?" min="0" inputmode="numeric"> 
                <p class="feedback" id="feedback"></p>
                <div class="quiz-buttons">
                   <button id="check-btn" class="quiz-btn check-btn" onclick="multiplicationPractice.checkAnswer()">Kontrol Et</button>
                   </div>

            </div>

             <div id="results-screen" class="results-card" style="display: none;">
                 <h2>Süre Doldu!</h2>
                 <p id="final-score">Harika iş, [İsim]! Skorun: <strong>[Skor]</strong></p>
                 <button class="quiz-btn next-btn" onclick="multiplicationPractice.restartExercise()">Yeniden Başla</button>
             </div>

        </main>
    </div>

    <script>
        const multiplicationPractice = {
            currentProblem: { num1: 0, num2: 0, answer: 0, questionText: "" },
            studentName: "Öğrenci",
            selectedTime: 0, // Saniye
            remainingTime: 0,
            timerInterval: null,
            score: 0,
            isExerciseRunning: false,
            currentLevel: 1, // Aktif seviye
            
            // DOM elementleri
            setupScreenEl: null, nameInputEl: null, timeButtonsEl: null, setupFeedbackEl: null,
            quizScreenEl: null, timerEl: null, scoreEl: null, problemEl: null, additionEl: null, modelEl: null, wordProblemEl: null, inputEl: null, feedbackEl: null, checkBtnEl: null,
            resultsScreenEl: null, finalScoreEl: null,

            initialize: function() {
                this.setupScreenEl = document.getElementById('setup-screen');
                this.nameInputEl = document.getElementById('student-name');
                this.timeButtonsEl = document.querySelector('.time-options');
                this.setupFeedbackEl = document.getElementById('setup-feedback');
                this.quizScreenEl = document.getElementById('quiz-screen');
                this.timerEl = document.getElementById('timer');
                this.scoreEl = document.getElementById('score');
                this.problemEl = document.getElementById('multiplication-problem');
                this.additionEl = document.getElementById('repeated-addition');
                this.modelEl = document.getElementById('visual-model');
                this.wordProblemEl = document.getElementById('word-problem-question'); // Seviye 2 için
                this.inputEl = document.getElementById('answer-input');
                this.feedbackEl = document.getElementById('feedback');
                this.checkBtnEl = document.getElementById('check-btn');
                this.resultsScreenEl = document.getElementById('results-screen');
                this.finalScoreEl = document.getElementById('final-score');

                if (!this.setupScreenEl || !this.quizScreenEl || !this.resultsScreenEl || !this.inputEl || !this.timeButtonsEl || !this.wordProblemEl) {
                    console.error("Çarpma egzersizi için gerekli ana HTML elementleri bulunamadı!");
                    document.querySelector('main').innerHTML = "<p style='color:red; font-weight:bold; text-align:center;'>Etkinlik yüklenirken bir hata oluştu.</p>";
                    return;
                }
                
                 this.inputEl.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter' && this.isExerciseRunning && !this.inputEl.disabled) {
                         event.preventDefault(); 
                         this.checkAnswer();
                     }
                 });
            },

            selectTime: function(minutes, clickedButton) { /*...*/ this.selectedTime = minutes * 60; this.timeButtonsEl.querySelectorAll('button').forEach(btn => btn.classList.remove('selected')); clickedButton.classList.add('selected'); this.setupFeedbackEl.textContent = ''; },

            // Egzersizi belirtilen seviyede başlat
            startExercise: function(level) {
                 if (this.selectedTime === 0) { this.setupFeedbackEl.textContent = 'Lütfen bir süre seçin!'; return; }
                 this.studentName = this.nameInputEl.value.trim() || "Öğrenci";
                 this.currentLevel = level; // Seçilen seviyeyi ayarla

                 this.setupScreenEl.style.display = 'none';
                 this.resultsScreenEl.style.display = 'none';
                 this.quizScreenEl.style.display = 'block';
                 
                 // CSS class'ı ile seviyeye özel gösterim/gizleme
                 this.quizScreenEl.classList.remove('level1-active', 'level2-active');
                 this.quizScreenEl.classList.add(`level${level}-active`);

                 this.score = 0;
                 this.remainingTime = this.selectedTime;
                 this.isExerciseRunning = true;
                 this.updateScoreDisplay();
                 this.updateTimerDisplay();
                 this.startTimer();
                 this.loadQuestion(); // Seviyeye uygun soruyu yükle
            },

            // Seviyeye göre uygun soru yükleme fonksiyonunu çağır
            loadQuestion: function() {
                 if (!this.isExerciseRunning) return; 

                 // Önceki geri bildirimi temizle ve inputu aktif et
                 this.feedbackEl.textContent = '';
                 this.feedbackEl.className = 'feedback';
                 this.inputEl.value = '';
                 this.inputEl.disabled = false;
                 this.checkBtnEl.style.display = 'inline-block'; // Kontrol butonunu göster
                 
                 if (this.currentLevel === 1) {
                     this.loadQuestionLevel1();
                 } else {
                     this.loadQuestionLevel2();
                 }
                 
                 setTimeout(() => this.inputEl.focus(), 100); 
            },

            // Seviye 1 için soru yükle (Önceki mantık)
            loadQuestionLevel1: function() {
                 let num1, num2;
                 const useZeroOne = Math.random() < 0.2; 
                 if (useZeroOne) { num1 = Math.random() < 0.5 ? 0 : 1; num2 = Math.floor(Math.random() * 21); } 
                 else { num1 = Math.floor(Math.random() * 9) + 2; num2 = Math.floor(Math.random() * 12); }
                 if (Math.random() < 0.5) { [num1, num2] = [num2, num1]; }
                 if(!useZeroOne && (num1 === 0 || num1 === 1)){ [num1, num2] = [num2, num1]; if(num1 === 0 || num1 === 1) { this.loadQuestionLevel1(); return; }}
                 
                 const answer = num1 * num2;
                 this.currentProblem = { num1, num2, answer, questionText: `${num1} x ${num2} = ?` };
                 this.problemEl.textContent = this.currentProblem.questionText;

                 this.additionEl.textContent = ''; this.modelEl.innerHTML = '';
                 if (num1 === 0 || num2 === 0) { this.additionEl.textContent = `${num1} tane ${num2}'nin toplamı: 0`; } 
                 else if (num1 === 1) { this.additionEl.textContent = `1 tane ${num2}'nin toplamı: ${num2}`; const groupDiv = document.createElement('div'); groupDiv.classList.add('visual-group'); for (let j = 0; j < num2; j++) { const itemIcon = document.createElement('i'); itemIcon.classList.add('bi', 'bi-star-fill', 'visual-item'); groupDiv.appendChild(itemIcon); } this.modelEl.appendChild(groupDiv); } 
                 else if (num2 === 1) { this.additionEl.textContent = `${num1} tane 1'in toplamı: ${Array(num1).fill(1).join(' + ')}`; for (let i = 0; i < num1; i++) { const groupDiv = document.createElement('div'); groupDiv.classList.add('visual-group'); const itemIcon = document.createElement('i'); itemIcon.classList.add('bi', 'bi-star-fill', 'visual-item'); groupDiv.appendChild(itemIcon); this.modelEl.appendChild(groupDiv); } } 
                 else { const additionArray = Array(num1).fill(num2); this.additionEl.textContent = `${num1} tane ${num2}'nin toplamı: ${additionArray.join(' + ')}`; for (let i = 0; i < num1; i++) { const groupDiv = document.createElement('div'); groupDiv.classList.add('visual-group'); for (let j = 0; j < num2; j++) { const itemIcon = document.createElement('i'); itemIcon.classList.add('bi', 'bi-star-fill', 'visual-item'); groupDiv.appendChild(itemIcon); } if(num2 > 5) groupDiv.style.maxWidth = "150px"; this.modelEl.appendChild(groupDiv); } }
            },

            // Seviye 2 için soru yükle (Problem Cümleleri)
            loadQuestionLevel2: function() {
                 // 1-10 (veya 1-12 arası) çarpım tablosundan sayılar seçelim
                 let num1 = Math.floor(Math.random() * 10) + 1; // 1-10
                 let num2 = Math.floor(Math.random() * 12) + 1; // 1-12
                 const answer = num1 * num2;

                 let questionText = "";
                 let correctAnswer = 0;

                 // Rastgele bir problem türü seç
                 const problemType = Math.floor(Math.random() * 4); 

                 switch (problemType) {
                     case 0: // X'in Y katı kaçtır?
                         questionText = `${num1}'in ${num2} katı kaç eder?`;
                         correctAnswer = answer;
                         break;
                     case 1: // Kaç tane X toplarsak Y eder?
                          // Cevabın tam sayı olduğundan emin olalım (zaten çarpımdan geldiği için tam sayı)
                         questionText = `Kaç tane ${num1}'i toplarsam ${answer} eder?`;
                         correctAnswer = num2;
                         break;
                     case 2: // X'in kaç katı Y eder?
                         questionText = `${num1}'in kaç katı ${answer} eder?`;
                         correctAnswer = num2;
                         break;
                     case 3: // Hangi sayının Y katı Z eder?
                         questionText = `Hangi sayının ${num2} katı ${answer} eder?`;
                         correctAnswer = num1;
                         break;
                 }

                 this.currentProblem = { num1, num2, answer: correctAnswer, questionText: questionText }; // answer burda sorunun cevabı
                 this.wordProblemEl.textContent = this.currentProblem.questionText;
            },

            // Cevabı kontrol et
            checkAnswer: function() {
                 if (!this.inputEl || !this.feedbackEl || this.inputEl.disabled || !this.isExerciseRunning) return; 
                 const userAnswer = parseInt(this.inputEl.value);
                 this.inputEl.disabled = true; 
                 this.checkBtnEl.style.display = 'none'; // Kontrol butonunu gizle

                 if (isNaN(userAnswer)) {
                     this.feedbackEl.textContent = 'Lütfen bir sayı girin.'; this.feedbackEl.className = 'feedback wrong';
                     setTimeout(() => this.loadQuestion(), 1000); return;
                 }

                 let feedbackText = "";
                 let isCorrect = (userAnswer === this.currentProblem.answer);

                 if (isCorrect) {
                     this.score++; this.updateScoreDisplay();
                     feedbackText = "Doğru!"; this.feedbackEl.className = 'feedback correct';
                     setTimeout(() => this.loadQuestion(), 500); // Doğruysa hızlı geç
                 } else {
                     feedbackText = `Yanlış! Doğru cevap: <strong>${this.currentProblem.answer}</strong> idi.`; this.feedbackEl.className = 'feedback wrong';
                     setTimeout(() => this.loadQuestion(), 1500); // Yanlışsa biraz bekle
                 }
                 
                 // Seviye 1 için ek açıklama
                  if(this.currentLevel === 1 && !isCorrect) {
                      feedbackText += `<br><small>(${this.currentProblem.num1} x ${this.currentProblem.num2} = ${this.currentProblem.num1 * this.currentProblem.num2})</small>`;
                  } else if (this.currentLevel === 1 && isCorrect) {
                       feedbackText += ` (${this.currentProblem.num1} x ${this.currentProblem.num2} = ${this.currentProblem.answer})`;
                  }

                  this.feedbackEl.innerHTML = feedbackText; 
            },

             startTimer: function() { /*...*/ this.stopTimer(); this.timerInterval = setInterval(() => { this.remainingTime--; this.updateTimerDisplay(); if (this.remainingTime <= 0) { this.endExercise(); } }, 1000); },
             stopTimer: function() { /*...*/ clearInterval(this.timerInterval); this.timerInterval = null; },
             updateTimerDisplay: function() { /*...*/ if (!this.timerEl) return; const minutes = Math.floor(this.remainingTime / 60); const seconds = this.remainingTime % 60; this.timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; },
             updateScoreDisplay: function() { /*...*/ if (!this.scoreEl) return; this.scoreEl.textContent = `Skor: ${this.score}`; },
             
             endExercise: function() {
                 this.isExerciseRunning = false; this.stopTimer();
                 if(this.finalScoreEl) { this.finalScoreEl.innerHTML = `Harika iş, ${this.studentName}! Skorun: <strong>${this.score}</strong>`; }
                 if(this.quizScreenEl) this.quizScreenEl.style.display = 'none';
                 if(this.resultsScreenEl) this.resultsScreenEl.style.display = 'block';
             },

             restartExercise: function() {
                 if(this.resultsScreenEl) this.resultsScreenEl.style.display = 'none';
                 if(this.quizScreenEl) this.quizScreenEl.style.display = 'none'; 
                 if(this.setupScreenEl) this.setupScreenEl.style.display = 'block';
                 this.score = 0; this.remainingTime = 0; this.isExerciseRunning = false; this.currentLevel = 1; // Seviyeyi de sıfırla
                 // this.selectedTime = 0; // Süre seçimini sıfırlama, belki aynı sürede tekrar oynamak ister
                 // if(this.timeButtonsEl) this.timeButtonsEl.querySelectorAll('button').forEach(btn => btn.classList.remove('selected')); 
                 if(this.setupFeedbackEl) this.setupFeedbackEl.textContent = ''; 
             }
        };

        // DOM Hazır olduğunda etkinliği başlat
        document.addEventListener('DOMContentLoaded', () => {
            try { multiplicationPractice.initialize(); } catch (error) { console.error("Çarpma Egzersizi başlatılırken hata:", error); document.querySelector('main').innerHTML = "<p style='color:red; font-weight:bold; text-align:center;'>Etkinlik yüklenirken bir hata oluştu.</p>"; }
        });

    </script>

    <script src="bilesenler/menu.js"></script>

</body>
</html>
