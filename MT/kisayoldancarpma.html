<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkÄ±llÄ± Matematik LaboratuvarÄ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #ffebee; /* Ã‡ok aÃ§Ä±k kÄ±rmÄ±zÄ± ton */
            color: #37474f;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 { color: #c62828; text-align: center; margin-bottom: 10px; }

        .main-card {
            background: white;
            width: 100%;
            max-width: 850px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 25px;
            border: 4px solid #ef9a9a;
        }

        /* Kontrol Paneli */
        .controls {
            background: #fff3e0;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            border: 2px dashed #ffcc80;
        }

        input {
            padding: 12px;
            font-size: 1.5rem;
            width: 110px;
            text-align: center;
            border: 2px solid #ffb74d;
            border-radius: 10px;
            color: #ef6c00;
            font-weight: bold;
            font-family: inherit;
            outline: none;
        }
        
        input:focus { border-color: #e65100; background: #fffde7; }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }

        button {
            padding: 10px 24px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        button:active { transform: translateY(3px); box-shadow: none; }
        
        .btn-5 { background: #ff7043; }
        .btn-25 { background: #66bb6a; }
        .btn-50 { background: #42a5f5; }
        .btn-125 { background: #ab47bc; }

        /* AnlatÄ±cÄ± Kutusu */
        #narrator {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.25rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border-left: 5px solid #2196f3;
            transition: background 0.3s;
        }

        /* Sahne AlanlarÄ± */
        .stage-title {
            font-size: 0.9rem;
            color: #90a4ae;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .transform-stage {
            height: 180px;
            background: #fafafa;
            border: 3px dashed #cfd8dc;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .calc-stage {
            background: #263238;
            color: white;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        /* Animasyon Ã–ÄŸeleri */
        .bubble-container { display: flex; gap: 20px; align-items: center; }
        
        .ball {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            color: white;
            font-weight: bold;
            position: relative;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .ball-5 { background: #ff7043; }
        .ball-10 { background: #1976d2; transform: scale(1.15); }

        .helper-2 {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #4caf50;
            color: white;
            position: absolute;
            top: -60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            z-index: 10;
            transition: top 0.6s ease-in;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .calc-step {
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s;
            text-align: center;
        }
        .calc-step.show { opacity: 1; transform: translateY(0); }

        .highlight-zeros { color: #ffeb3b; font-weight: bold; }
        .highlight-div { color: #f48fb1; font-weight: bold; }

    </style>
</head>
<body>

    <h1>âœ¨ Sihirli Ã‡arpma LaboratuvarÄ±</h1>

    <div class="main-card">
        
        <div class="controls">
            <div>
                <label style="font-weight:bold; color:#e65100;">SayÄ±:</label>
                <input type="number" id="inpNumber" value="12" placeholder="?" oninput="clearBoard()">
            </div>

            <div class="btn-group">
                <button class="btn-5" onclick="startMagic(5)">x 5</button>
                <button class="btn-25" onclick="startMagic(25)">x 25</button>
                <button class="btn-50" onclick="startMagic(50)">x 50</button>
                <button class="btn-125" onclick="startMagic(125)">x 125</button>
            </div>
        </div>

        <div id="narrator">HoÅŸ geldin! Bir sayÄ± gir ve butona bas.</div>

        <div>
            <div class="stage-title">1. DÃ¶nÃ¼ÅŸÃ¼m Sahnesi (Neden bÃ¶lÃ¼yoruz?)</div>
            <div class="transform-stage" id="transformArea">
                <div style="color:#cfd8dc;">(Animasyon alanÄ±)</div>
            </div>
        </div>

        <div>
            <div class="stage-title">2. Ä°ÅŸlem TahtasÄ±</div>
            <div class="calc-stage" id="calcArea">
                <div style="font-size:1rem; color:#546e7a;">SonuÃ§lar burada gÃ¶rÃ¼necek...</div>
            </div>
        </div>

    </div>

    <script>
        const narrator = document.getElementById('narrator');
        const transformArea = document.getElementById('transformArea');
        const calcArea = document.getElementById('calcArea');
        const inpNumber = document.getElementById('inpNumber');

        // Animasyon Ä°ptal MekanizmasÄ±
        // Her butona basÄ±ldÄ±ÄŸÄ±nda bu ID artar.
        // EÄŸer animasyon sÄ±rasÄ±nda ID deÄŸiÅŸmiÅŸse, eski animasyon durur.
        let globalAnimationId = 0;

        function clearBoard() {
            // AnimasyonlarÄ± durdurmak iÃ§in ID'yi artÄ±rÄ±yoruz ama yeni iÅŸlem baÅŸlatmÄ±yoruz
            globalAnimationId++; 
            
            transformArea.innerHTML = '<div style="color:#cfd8dc;">(Temizlendi)</div>';
            calcArea.innerHTML = '<div style="font-size:1rem; color:#546e7a;">Yeni iÅŸlem bekleniyor...</div>';
            narrator.innerText = "Yeni sayÄ± iÃ§in iÅŸlem seÃ§iniz...";
            narrator.style.backgroundColor = "#e3f2fd";
        }

        async function startMagic(factor) {
            // 1. Ã–nceki iÅŸlemleri temizle ve yeni bir iÅŸlem kimliÄŸi (ID) oluÅŸtur
            globalAnimationId++;
            const myAnimationId = globalAnimationId; // Bu deÄŸiÅŸken, bu fonksiyon Ã§alÄ±ÅŸÄ±rken sabit kalÄ±r

            const userNumber = parseInt(inpNumber.value);
            if (!userNumber) {
                narrator.innerText = "LÃ¼tfen Ã¶nce bir sayÄ± gir!";
                narrator.style.backgroundColor = "#ffcdd2";
                return;
            }

            // EkranÄ± temizle
            transformArea.innerHTML = '';
            calcArea.innerHTML = '';
            narrator.style.backgroundColor = "#e3f2fd";

            // --- YAPILANDIRMA ---
            let config = {};
            if (factor === 5) config = { balls: [5], mult: 10, div: 2, zeros: "0" };
            else if (factor === 25) config = { balls: [5, 5], mult: 100, div: 4, zeros: "00" };
            else if (factor === 50) config = { balls: [50], mult: 100, div: 2, zeros: "00" };
            else if (factor === 125) config = { balls: [5, 5, 5], mult: 1000, div: 8, zeros: "000" };

            // --- SAHNE 1: BALONLARI DÄ°Z ---
            narrator.innerText = `${factor} ile Ã§arpmak yerine ${config.mult} ile Ã§arpÄ±p ${config.div}'ye bÃ¶leceÄŸiz.`;

            const container = document.createElement('div');
            container.className = 'bubble-container';
            transformArea.appendChild(container);

            for (let i = 0; i < config.balls.length; i++) {
                let wrapper = document.createElement('div');
                wrapper.style.position = 'relative';
                
                let ball = document.createElement('div');
                ball.className = 'ball ball-5';
                if(config.balls[i]===50) ball.style.backgroundColor = '#29b6f6';
                ball.innerText = config.balls[i];
                ball.id = `ball-${i}`;

                let helper = document.createElement('div');
                helper.className = 'helper-2';
                helper.innerText = 'x2';
                helper.id = `helper-${i}`;

                wrapper.appendChild(helper);
                wrapper.appendChild(ball);
                container.appendChild(wrapper);

                if (i < config.balls.length - 1) {
                    let x = document.createElement('div');
                    x.innerText = 'x';
                    x.style.fontSize = '2rem';
                    x.style.color = '#b0bec5';
                    container.appendChild(x);
                }
            }

            // GÃœVENLÄ°K KONTROLÃœ: EÄŸer kullanÄ±cÄ± baÅŸka butona bastÄ±ysa DUR.
            if(globalAnimationId !== myAnimationId) return;
            await wait(1000);
            if(globalAnimationId !== myAnimationId) return;

            // --- SAHNE 2: DÃ–NÃœÅžÃœM (x2 Ä°NDÄ°R) ---
            narrator.innerHTML = `SayÄ±larÄ± yuvarlamak iÃ§in <b>2 ile geniÅŸletiyoruz</b>!`;

            for (let i = 0; i < config.balls.length; i++) {
                let helper = document.getElementById(`helper-${i}`);
                let ball = document.getElementById(`ball-${i}`);
                
                helper.style.top = '15px'; // Top dÃ¼ÅŸer
                await wait(500);
                if(globalAnimationId !== myAnimationId) return;

                helper.style.opacity = '0'; // Kaybol
                
                if (config.balls[i] === 5) {
                    ball.innerText = '10';
                    ball.classList.add('ball-10');
                } else if (config.balls[i] === 50) {
                    ball.innerText = '100';
                    ball.style.backgroundColor = '#1565c0';
                    ball.style.transform = 'scale(1.1)';
                }
            }

            await wait(1500);
            if(globalAnimationId !== myAnimationId) return;

            // --- SAHNE 3: Ä°ÅžLEM TAHTASI ---
            narrator.innerHTML = `SayÄ±yÄ± ${config.mult} yaptÄ±k. Dengelemek iÃ§in <b>${config.div}'ye bÃ¶lmeliyiz.</b>`;

            // AdÄ±m 1: SÄ±fÄ±r Ekle
            let expanded = userNumber * config.mult;
            let line1 = document.createElement('div');
            line1.className = 'calc-step';
            line1.innerHTML = `1. AdÄ±m: ${userNumber} yanÄ±na sÄ±fÄ±r ekle <br> <span style="font-size:2.2rem">${userNumber}<span class="highlight-zeros">${config.zeros}</span></span>`;
            calcArea.appendChild(line1);

            await wait(100);
            line1.classList.add('show');
            await wait(2000);
            if(globalAnimationId !== myAnimationId) return;

            // AdÄ±m 2: BÃ¶lme
            let finalVal = expanded / config.div;
            let line2 = document.createElement('div');
            line2.className = 'calc-step';
            line2.innerHTML = `2. AdÄ±m: ${config.div}'ye bÃ¶l <br> <span style="font-size:2.2rem">${expanded} : <span class="highlight-div">${config.div}</span> = ${finalVal}</span>`;
            calcArea.appendChild(line2);

            await wait(100);
            line2.classList.add('show');

            // BitiÅŸ
            await wait(1000);
            if(globalAnimationId !== myAnimationId) return;
            narrator.innerHTML = `ðŸŽ‰ Tebrikler! SonuÃ§: <b>${finalVal}</b>`;
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
