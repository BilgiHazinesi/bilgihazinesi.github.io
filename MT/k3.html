<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klasik B√∂lme Sunum Paneli</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #e0f2f1;
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #37474f;
        }

        h1 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            color: #00695c;
            text-transform: uppercase;
        }

        .stage-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 15px;
            padding-bottom: 5px;
            box-sizing: border-box;
        }

        /* PANEL TASARIMI */
        .panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 2px solid #b2dfdb;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .panel-header {
            width: 100%;
            text-align: center;
            padding: 8px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        .p1-head { background: #ff7043; }
        .p2-head { background: #42a5f5; }
        .p3-head { background: #66bb6a; }

        .panel-content {
            padding: 10px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto; /* ƒ∞≈ülem uzarsa kaydƒ±rma √ßubuƒüu √ßƒ±ksƒ±n */
        }

        /* AYARLAR */
        .setup-area {
            background: #fafafa;
            padding: 5px;
            border-radius: 8px;
            width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            border: 1px dashed #cfd8dc;
            margin-bottom: 10px;
        }

        .num-input {
            font-size: 1.2rem;
            padding: 5px;
            width: 80px;
            text-align: center;
            border: 2px solid #b0bec5;
            border-radius: 6px;
            font-weight: bold;
        }

        .mode-btns { display: flex; gap: 3px; justify-content: center; width: 100%; }
        .setup-btn {
            padding: 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            flex: 1;
            opacity: 0.7;
        }
        .setup-btn.active { opacity: 1; transform: scale(0.95); }
        
        .btn-5 { background: #ef6c00; }
        .btn-25 { background: #2e7d32; }
        .btn-50 { background: #1565c0; }
        .btn-125 { background: #6a1b9a; }

        /* G√ñRSEL ALAN */
        .visual-stage {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .question-box {
            font-size: 1.8rem;
            font-weight: bold;
            color: #455a64;
            background: #eceff1;
            padding: 5px 15px;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .arrow {
            font-size: 2rem;
            color: #ff7043;
            margin-bottom: 5px;
            opacity: 0;
            transition: 0.5s;
        }
        .arrow.show { opacity: 1; }

        /* KLASƒ∞K B√ñLME GRID Sƒ∞STEMƒ∞ */
        .long-division-container {
            font-family: 'Roboto Mono', monospace; /* Hizalama i√ßin Monospace ≈üart */
            font-size: 1.5rem;
            line-height: 1.5rem;
            display: grid;
            /* Grid dinamik olarak JS ile ayarlanacak ama varsayƒ±lan deƒüerler */
            grid-template-columns: repeat(10, 1fr); 
            gap: 2px;
            visibility: hidden;
        }

        .cell {
            width: 25px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #37474f;
        }

        /* √áizgiler ve Renkler */
        .border-bottom { border-bottom: 2px solid #37474f; }
        .border-right { border-right: 2px solid #37474f; }
        
        .quotient-digit { color: #2e7d32; font-weight: bold; animation: popIn 0.3s; } /* Sonu√ß Rakamlarƒ± */
        .sub-digit { color: #c62828; animation: slideDown 0.4s; } /* √áƒ±kan sayƒ±lar */
        .bring-down { color: #1565c0; font-weight: bold; animation: dropIn 0.5s; } /* A≈üaƒüƒ± inenler */
        
        /* Animasyonlar */
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes slideDown { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes dropIn { 0% { opacity: 0; transform: translateY(-20px); } 100% { opacity: 1; transform: translateY(0); } }

        /* BUTONLAR */
        .control-bar {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .main-btn, .instant-btn {
            padding: 10px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
        }
        .main-btn { flex: 2; background: #546e7a; }
        .instant-btn { flex: 1; background: #ff7043; }
        button:disabled { background: #cfd8dc; cursor: default; }

        .reset-icon { position: absolute; top: 8px; right: 8px; color: white; cursor: pointer; font-size: 1.2rem; }
    </style>
</head>
<body>

    <h1>üìè Klasik B√∂lme Y√∂ntemi (Bakkal B√∂lmesi)</h1>

    <div class="stage-container">
        <script>
            // 3 Paneli D√∂ng√ºyle Olu≈üturalƒ±m
            for(let i=1; i<=3; i++) {
                let colorClass = i===1 ? 'p1-head' : (i===2 ? 'p2-head' : 'p3-head');
                document.write(`
                <div class="panel">
                    <div class="panel-header ${colorClass}">
                        SORU ${i}
                        <div class="reset-icon" onclick="resetPanel(${i})">‚Ü∫</div>
                    </div>
                    <div class="panel-content">
                        <div class="setup-area" id="setup-${i}">
                            <input type="number" id="inp-${i}" class="num-input" value="${12 + i*4}">
                            <div class="mode-btns">
                                <button class="setup-btn btn-5" onclick="setMode(${i}, 5, this)">x5</button>
                                <button class="setup-btn btn-25" onclick="setMode(${i}, 25, this)">x25</button>
                                <button class="setup-btn btn-50" onclick="setMode(${i}, 50, this)">x50</button>
                                <button class="setup-btn btn-125" onclick="setMode(${i}, 125, this)">x125</button>
                            </div>
                        </div>

                        <div class="visual-stage">
                            <div class="question-box" id="qtext-${i}">Hazƒ±r</div>
                            <div class="arrow" id="arrow-${i}">‚¨á</div>
                            <div class="long-division-container" id="grid-${i}"></div>
                        </div>

                        <div class="control-bar">
                            <button class="main-btn" id="btn-play-${i}" onclick="playAnimation(${i})" disabled>‚ñ∂ OYNAT</button>
                            <button class="instant-btn" id="btn-quick-${i}" onclick="instantShow(${i})" disabled>‚ö° CEVAP</button>
                        </div>
                    </div>
                </div>
                `);
            }
        </script>
    </div>

    <script>
        const states = {
            1: { factor: 0, steps: [], currentStepIdx: 0, expandedNum: 0, divisor: 0 },
            2: { factor: 0, steps: [], currentStepIdx: 0, expandedNum: 0, divisor: 0 },
            3: { factor: 0, steps: [], currentStepIdx: 0, expandedNum: 0, divisor: 0 }
        };

        const rules = {
            5: { div: 2, zeros: "0" },
            25: { div: 4, zeros: "00" },
            50: { div: 2, zeros: "00" },
            125: { div: 8, zeros: "000" }
        };

        // --- KURULUM ---
        function setMode(pid, factor, btn) {
            // Buton g√∂rselliƒüi
            const allBtns = document.querySelectorAll(`#setup-${pid} .setup-btn`);
            allBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const inputVal = document.getElementById(`inp-${pid}`).value;
            if(!inputVal) return;

            // Verileri Hazƒ±rla
            const rule = rules[factor];
            const expandedStr = inputVal + rule.zeros;
            const expandedNum = parseInt(expandedStr);
            const divisor = rule.div;

            states[pid].factor = factor;
            states[pid].expandedNum = expandedNum;
            states[pid].divisor = divisor;
            states[pid].steps = generateDivisionSteps(expandedNum, divisor);
            states[pid].currentStepIdx = 0;

            // Aray√ºz√º Sƒ±fƒ±rla
            document.getElementById(`qtext-${pid}`).innerText = `${inputVal} x ${factor}`;
            document.getElementById(`arrow-${pid}`).classList.remove('show');
            document.getElementById(`grid-${pid}`).innerHTML = '';
            document.getElementById(`grid-${pid}`).style.visibility = 'hidden';

            const btnPlay = document.getElementById(`btn-play-${pid}`);
            const btnQuick = document.getElementById(`btn-quick-${pid}`);
            btnPlay.disabled = false;
            btnPlay.innerText = "‚ñ∂ OYNAT";
            btnQuick.disabled = false;
        }

        // --- OYNATMA MANTIƒûI ---
        async function playAnimation(pid) {
            const btnPlay = document.getElementById(`btn-play-${pid}`);
            const btnQuick = document.getElementById(`btn-quick-${pid}`);
            const state = states[pid];

            // Eƒüer hi√ß ba≈ülamadƒ±ysa √∂nce sahneyi kur
            if(state.currentStepIdx === 0) {
                btnPlay.disabled = true;
                btnQuick.disabled = true;

                document.getElementById(`arrow-${pid}`).classList.add('show');
                setupGrid(pid, state.expandedNum, state.divisor);
                document.getElementById(`grid-${pid}`).style.visibility = 'visible';
                
                await wait(1000);
                btnPlay.innerText = "ADIM ADIM";
                btnPlay.disabled = false;
                btnQuick.disabled = false;
                return; // ƒ∞lk tƒ±klamada sadece gridi kurar
            }

            // Sonraki adƒ±mlarƒ± tek tek oynat
            if(state.currentStepIdx < state.steps.length) {
                btnPlay.disabled = true;
                const step = state.steps[state.currentStepIdx];
                await renderStep(pid, step);
                state.currentStepIdx++;
                btnPlay.disabled = false;

                if(state.currentStepIdx >= state.steps.length) {
                    btnPlay.innerText = "Bƒ∞TTƒ∞";
                    btnPlay.disabled = true;
                }
            }
        }

        function instantShow(pid) {
            const state = states[pid];
            // Hen√ºz grid kurulmadƒ±ysa kur
            if(document.getElementById(`grid-${pid}`).innerHTML === '') {
                document.getElementById(`arrow-${pid}`).classList.add('show');
                setupGrid(pid, state.expandedNum, state.divisor);
                document.getElementById(`grid-${pid}`).style.visibility = 'visible';
            }

            // Kalan t√ºm adƒ±mlarƒ± hƒ±zlƒ±ca bas
            while(state.currentStepIdx < state.steps.length) {
                const step = state.steps[state.currentStepIdx];
                // Hƒ±zlƒ± render (wait olmadan)
                renderStepSync(pid, step);
                state.currentStepIdx++;
            }
            
            document.getElementById(`btn-play-${pid}`).innerText = "Bƒ∞TTƒ∞";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
        }

        // --- B√ñLME ALGORƒ∞TMASI (BEYƒ∞N) ---
        function generateDivisionSteps(dividend, divisor) {
            const dividendStr = dividend.toString();
            const steps = [];
            
            let remainder = 0;
            let row = 2; // 0: B√∂l√ºm, 1: Soru satƒ±rƒ±, 2+: ƒ∞≈ülemler
            
            // Grid koordinatlarƒ± i√ßin basit bir mantƒ±k
            // S√ºtunlar: Sayƒ±nƒ±n rakamlarƒ± kadar.
            
            for (let i = 0; i < dividendStr.length; i++) {
                const digit = parseInt(dividendStr[i]);
                const currentVal = remainder * 10 + digit; // ƒ∞ndirilen sayƒ± dahil
                
                // Adƒ±m 1: A≈üaƒüƒ± ƒ∞ndirme (ƒ∞lk rakam hari√ß g√∂rsel olarak)
                if (i > 0) {
                     steps.push({ type: 'bring_down', val: digit, row: row, col: i });
                }
                
                // Kontrol: Bu sayƒ± b√∂len'den k√º√ß√ºk m√º? (Sadece ba≈üta deƒüilse 0 atƒ±lƒ±r)
                const quotientDigit = Math.floor(currentVal / divisor);
                
                // B√∂l√ºm hanesine yaz
                steps.push({ type: 'quotient', val: quotientDigit, col: i });

                const product = quotientDigit * divisor;
                const newRemainder = currentVal - product;

                // √áarpma ve Yazma (Sadece 0 deƒüilse veya i≈ülem bitiyorsa g√∂sterelim)
                // Klasik b√∂lmede 0 olsa bile "0 kere var" diyip 0 √ßƒ±karƒ±lƒ±r.
                // Biz sadece anlamlƒ± adƒ±mlarƒ± g√∂sterelim (Product yaz, √áƒ±kar)
                
                steps.push({ type: 'product', val: product, row: row + 1, col: i, isDoubleDigit: product >= 10 });
                
                // √áƒ±karma √áizgisi ve Sonu√ß
                steps.push({ type: 'subtract_res', val: newRemainder, row: row + 2, col: i });
                
                remainder = newRemainder;
                row += 2; // Her i≈ülem bloƒüu 2 satƒ±r yer kaplar (√áƒ±kan sayƒ± + Kalan)
            }
            return steps;
        }

        // --- GRID KURULUMU ---
        function setupGrid(pid, dividend, divisor) {
            const container = document.getElementById(`grid-${pid}`);
            const divStr = dividend.toString();
            const cols = divStr.length + 3; // Biraz bo≈üluk
            
            // Grid stili g√ºncelle
            container.style.gridTemplateColumns = `repeat(${cols}, 25px)`;
            
            // Ba≈ülangƒ±√ß Yapƒ±sƒ±
            // Satƒ±r 0: B√∂l√ºm Alanƒ± (Bo≈ü, √ßizgili)
            // Satƒ±r 1: B√∂len | B√∂l√ºnen
            
            // B√∂l√ºm √áizgisi (√ústteki √ßizgi)
            for(let i=0; i<cols; i++) {
                const cell = createCell('');
                if(i >= 2 && i < 2 + divStr.length) cell.classList.add('border-bottom'); // B√∂l√ºnenin √ºst√º deƒüil, B√∂l√ºm√ºn altƒ± aslƒ±nda
                container.appendChild(cell);
            }

            // Ana Satƒ±r (B√∂len | B√∂l√ºnen)
            // S√ºtun 0: B√∂len
            const cellDivisor = createCell(divisor);
            cellDivisor.classList.add('border-right');
            container.appendChild(cellDivisor);
            
            // S√ºtun 1: Bo≈üluk (Parantez i√ßi)
            container.appendChild(createCell('')); 

            // S√ºtun 2+: B√∂l√ºnen Rakamlarƒ±
            for(let char of divStr) {
                const cell = createCell(char);
                // Sonradan eklenen sƒ±fƒ±rlar farklƒ± renk olabilir
                container.appendChild(cell);
            }
            // Kalan bo≈üluklar
            container.appendChild(createCell(''));
        }

        // --- RENDER ---
        async function renderStep(pid, step) {
            const container = document.getElementById(`grid-${pid}`);
            const cols = parseInt(container.style.gridTemplateColumns.split('(')[1]); // Kolon sayƒ±sƒ±nƒ± √ßek
            
            if(step.type === 'quotient') {
                // B√∂l√ºm (En √ºst satƒ±r deƒüil, aslƒ±nda Grid mantƒ±ƒüƒ±nda √∂zel yerle≈ütirme lazƒ±m)
                // Gridde "absolute" yerle≈ütirme yapmayƒ±p, flow kullanƒ±yorsak zor.
                // Bu y√ºzden basitlik adƒ±na: En √ºst satƒ±rdaki ilgili h√ºcrenin i√ßine yazacaƒüƒ±z.
                // Grid child index hesabƒ±: Row 0, Col X.
                // Index = step.col + 2 (√á√ºnk√º ilk 2 kolon b√∂len i√ßin)
                const index = step.col + 2; 
                const cell = container.children[index];
                cell.innerText = step.val;
                cell.classList.add('quotient-digit');
                await wait(500);
            }
            else if(step.type === 'bring_down') {
                // A≈üaƒüƒ± indirme: Mevcut satƒ±rƒ±n, ilgili kolonuna yaz
                // Gridde "bo≈üluklarƒ± doldurarak" gitmek lazƒ±m.
                // Bu yapƒ± i√ßin: Her yeni satƒ±r i√ßin 'cols' kadar div ekleyeceƒüiz.
                // Ama √∂nceki adƒ±mlardan satƒ±r eklenmi≈ü olabilir.
                
                // Pratik √á√∂z√ºm: Grid'e her seferinde tam bir satƒ±r ekle.
                // step.row satƒ±rƒ±na denk gelene kadar bo≈ü satƒ±r ekle.
                ensureRows(container, step.row, cols);
                
                const cellIndex = (step.row * cols) + (step.col + 2);
                // Hedef h√ºcre dolu olabilir (√∂nceki kalan), yanƒ±na yazmak gerekebilir.
                // Bu grid yapƒ±sƒ±nda tam hizalama i√ßin: Sayƒ±larƒ±n basamak deƒüeri kolonudur.
                const cell = container.children[cellIndex];
                cell.innerText = step.val;
                cell.classList.add('bring-down');
                await wait(600);
            }
            else if(step.type === 'product') {
                ensureRows(container, step.row, cols);
                // √áƒ±kan sayƒ±yƒ± yaz (√ñrn: 16)
                // Tek basamaksa: step.col'a yaz.
                // √áift basamaksa: step.col ve step.col-1'e yaz.
                
                if(step.val < 10) {
                    const idx = (step.row * cols) + (step.col + 2);
                    const cell = container.children[idx];
                    cell.innerText = step.val;
                    cell.classList.add('sub-digit');
                    cell.style.borderBottom = "1px solid #aaa"; // √áƒ±karma √ßizgisi
                } else {
                    // onlar basamaƒüƒ±
                    const idx1 = (step.row * cols) + (step.col + 1);
                    container.children[idx1].innerText = Math.floor(step.val / 10);
                    container.children[idx1].classList.add('sub-digit');
                    container.children[idx1].style.borderBottom = "1px solid #aaa";

                    // birler basamaƒüƒ±
                    const idx2 = (step.row * cols) + (step.col + 2);
                    container.children[idx2].innerText = step.val % 10;
                    container.children[idx2].classList.add('sub-digit');
                    container.children[idx2].style.borderBottom = "1px solid #aaa";
                }
                
                // Eksi i≈üareti
                const signIdx = (step.row * cols) + (step.col); 
                container.children[signIdx].innerText = "-";
                
                await wait(800);
            }
            else if(step.type === 'subtract_res') {
                ensureRows(container, step.row, cols);
                // Kalanƒ± yaz
                const idx = (step.row * cols) + (step.col + 2);
                container.children[idx].innerText = step.val;
                await wait(600);
            }
        }

        // Senkron Render (Hƒ±zlƒ± Cevap i√ßin)
        function renderStepSync(pid, step) {
            // Animasyonsuz versiyon
            const container = document.getElementById(`grid-${pid}`);
            const cols = parseInt(container.style.gridTemplateColumns.split('(')[1]);
            
            if(step.type === 'quotient') {
                const index = step.col + 2; 
                const cell = container.children[index];
                cell.innerText = step.val;
                cell.classList.add('quotient-digit');
            }
            else if(step.type === 'bring_down') {
                ensureRows(container, step.row, cols);
                const cellIndex = (step.row * cols) + (step.col + 2);
                container.children[cellIndex].innerText = step.val;
                container.children[cellIndex].classList.add('bring-down');
            }
            else if(step.type === 'product') {
                ensureRows(container, step.row, cols);
                if(step.val < 10) {
                    const idx = (step.row * cols) + (step.col + 2);
                    const cell = container.children[idx];
                    cell.innerText = step.val;
                    cell.style.borderBottom = "1px solid #aaa";
                } else {
                    const idx1 = (step.row * cols) + (step.col + 1);
                    container.children[idx1].innerText = Math.floor(step.val / 10);
                    container.children[idx1].style.borderBottom = "1px solid #aaa";
                    const idx2 = (step.row * cols) + (step.col + 2);
                    container.children[idx2].innerText = step.val % 10;
                    container.children[idx2].style.borderBottom = "1px solid #aaa";
                }
                const signIdx = (step.row * cols) + (step.col); 
                container.children[signIdx].innerText = "-";
            }
            else if(step.type === 'subtract_res') {
                ensureRows(container, step.row, cols);
                const idx = (step.row * cols) + (step.col + 2);
                container.children[idx].innerText = step.val;
            }
        }

        function createCell(content) {
            const div = document.createElement('div');
            div.className = 'cell';
            div.innerText = content;
            return div;
        }

        function ensureRows(container, targetRow, cols) {
            // ≈ûu anki satƒ±r sayƒ±sƒ± = toplam √ßocuk / kolon sayƒ±sƒ±
            let currentRows = Math.ceil(container.children.length / cols);
            while (currentRows <= targetRow) {
                for (let i = 0; i < cols; i++) {
                    container.appendChild(createCell(''));
                }
                currentRows++;
            }
        }

        function resetPanel(pid) {
            document.getElementById(`qtext-${pid}`).innerText = 'Hazƒ±r';
            document.getElementById(`arrow-${pid}`).classList.remove('show');
            document.getElementById(`grid-${pid}`).innerHTML = '';
            document.getElementById(`grid-${pid}`).style.visibility = 'hidden';
            
            const allBtns = document.querySelectorAll(`#setup-${pid} .setup-btn`);
            allBtns.forEach(b => b.classList.remove('active'));
            
            const btnPlay = document.getElementById(`btn-play-${pid}`);
            btnPlay.innerText = "‚ñ∂ OYNAT";
            btnPlay.disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

    </script>
</body>
</html>
