<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kusursuz Hizalƒ± B√∂lme Tahtasƒ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #e8f5e9;
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #263238;
        }

        h1 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1.6rem;
            color: #2e7d32;
            text-transform: uppercase;
        }

        .stage-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 15px;
            padding-bottom: 5px;
            box-sizing: border-box;
        }

        /* PANEL */
        .panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #81c784;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Ba≈ülƒ±klar */
        .panel-header { width: 100%; text-align: center; padding: 10px 0; font-size: 1.2rem; font-weight: bold; color: white; }
        .p1-head { background: #ff7043; }
        .p2-head { background: #42a5f5; }
        .p3-head { background: #66bb6a; }

        /* BUTONLAR */
        .top-controls {
            display: flex;
            gap: 8px;
            padding: 10px;
            width: 100%;
            justify-content: center;
            background: #f1f8e9;
            border-bottom: 1px solid #c8e6c9;
        }
        .action-btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; font-size: 0.9rem; }
        .btn-play { background: #558b2f; flex: 2; }
        .btn-quick { background: #fbc02d; color: #333; flex: 1; }
        .btn-reset { background: #90a4ae; width: 40px; }
        .action-btn:disabled { opacity: 0.5; cursor: default; }

        /* SETUP */
        .setup-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            width: 100%;
            border-bottom: 1px dashed #ccc;
        }
        .num-input { font-size: 1.3rem; padding: 5px; width: 120px; text-align: center; border: 2px solid #ccc; border-radius: 6px; font-weight: bold; }
        .preset-btns { display: flex; gap: 4px; width: 100%; justify-content: center; }
        .pre-btn { padding: 6px; font-size: 0.85rem; border: none; border-radius: 4px; cursor: pointer; color: white; opacity: 0.8; flex: 1; }
        .pre-btn:hover { opacity: 1; }
        .active-preset { opacity: 1; transform: scale(1.05); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* GRID YAPISI */
        .grid-wrapper {
            flex-grow: 1;
            width: 100%;
            overflow: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
        }

        .math-grid {
            display: grid;
            /* H√ºcre boyutu sabit: 30px */
            grid-template-columns: repeat(20, 30px); 
            grid-auto-rows: 40px;
            position: relative;
        }

        /* H√úCRE TASARIMI */
        .cell {
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.5rem;
            font-weight: bold;
            color: #37474f;
            z-index: 2;
        }

        /* H√úCRE RENKLERƒ∞ */
        .hl-dividend { color: #333; }
        .hl-divisor { color: #1565c0; }
        .hl-quotient { color: #2e7d32; font-weight: 900; }
        .hl-product { color: #c62828; border-bottom: 2px solid #d32f2f; } /* √áƒ±kan sayƒ± + √áizgi */
        .hl-diff { color: #333; } /* Kalan */
        .hl-bringdown { color: #1976d2; } /* ƒ∞nen sayƒ± */

        /* T√úRK USUL√ú √áƒ∞ZGƒ∞LER (GRID √úZERƒ∞NE √áƒ∞Zƒ∞LECEK) */
        .vertical-line {
            background-color: #333;
            width: 3px;
            position: absolute;
            /* Grid koordinatlarƒ±na g√∂re JS ile yerle≈üecek */
        }
        .horizontal-line {
            background-color: #333;
            height: 3px;
            position: absolute;
        }
        
        .minus-sign {
            position: absolute;
            left: -15px;
            color: #d32f2f;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* ANƒ∞MASYON */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <h1>üìè Kusursuz Hizalƒ± B√∂lme Tahtasƒ±</h1>

    <div class="stage-container">
        </div>

    <script>
        const container = document.querySelector('.stage-container');
        
        // --- 3 PANEL OLU≈ûTUR ---
        for(let i=1; i<=3; i++) {
            let pColor = i===1 ? 'p1-head' : (i===2 ? 'p2-head' : 'p3-head');
            let html = `
            <div class="panel">
                <div class="panel-header ${pColor}">SORU ${i}</div>
                
                <div class="top-controls">
                    <button class="action-btn btn-play" id="btn-play-${i}" onclick="playStep(${i})" disabled>‚ñ∂ BA≈ûLAT</button>
                    <button class="action-btn btn-quick" id="btn-quick-${i}" onclick="quickShow(${i})" disabled>‚ö° CEVAP</button>
                    <button class="action-btn btn-reset" onclick="reset(${i})">‚Ü∫</button>
                </div>

                <div class="setup-area" id="setup-${i}">
                    <input type="number" id="inp-${i}" class="num-input" value="${12 + i*8}">
                    <div class="preset-btns">
                        <button class="pre-btn" style="background:#ef6c00" onclick="setMode(${i}, 5, this)">x5</button>
                        <button class="pre-btn" style="background:#2e7d32" onclick="setMode(${i}, 25, this)">x25</button>
                        <button class="pre-btn" style="background:#1565c0" onclick="setMode(${i}, 50, this)">x50</button>
                        <button class="pre-btn" style="background:#6a1b9a" onclick="setMode(${i}, 125, this)">x125</button>
                    </div>
                </div>

                <div class="grid-wrapper">
                    <div class="math-grid" id="grid-${i}"></div>
                </div>
            </div>`;
            container.innerHTML += html;
        }

        // --- GLOBAL STATE ---
        const states = {
            1: { steps: [], idx: 0, dividendLen: 0, divVal: 0 },
            2: { steps: [], idx: 0, dividendLen: 0, divVal: 0 },
            3: { steps: [], idx: 0, dividendLen: 0, divVal: 0 }
        };

        const rules = {
            5: { div: 2, zeros: "0" },
            25: { div: 4, zeros: "00" },
            50: { div: 2, zeros: "00" },
            125: { div: 8, zeros: "000" }
        };

        // --- KURULUM ---
        function setMode(pid, factor, btn) {
            // Buton stili
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
            btn.classList.add('active-preset');

            const inpVal = document.getElementById(`inp-${pid}`).value;
            if(!inpVal) return;

            const rule = rules[factor];
            const fullNumStr = inpVal + rule.zeros;
            const dividend = parseInt(fullNumStr);
            const divisor = rule.div;

            // State Hazƒ±rla
            states[pid].dividendLen = fullNumStr.length;
            states[pid].divVal = divisor;
            states[pid].idx = 0;
            // ƒ∞≈ülem adƒ±mlarƒ±nƒ± hesapla
            states[pid].steps = calculateSteps(fullNumStr, divisor);

            // Ba≈ülangƒ±√ß √áizimi (Sadece Soru)
            drawInitialLayout(pid, fullNumStr, divisor);

            // Kontrolleri a√ß
            document.getElementById(`btn-play-${pid}`).disabled = false;
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-quick-${pid}`).disabled = false;
        }

        // --- G√ñRSEL √áƒ∞Zƒ∞M (LAYOUT) ---
        function drawInitialLayout(pid, dividendStr, divisor) {
            const grid = document.getElementById(`grid-${pid}`);
            grid.innerHTML = '';
            
            // GRID KOORDƒ∞NAT Sƒ∞STEMƒ∞:
            // Satƒ±r 1: B√∂l√ºnen | B√∂len
            // Satƒ±r 2: √áizgi Altƒ± (B√∂l√ºm Yeri)
            
            // 1. B√ñL√úNEN (Row 1, Col 1'den ba≈ülar)
            for(let i=0; i<dividendStr.length; i++) {
                drawCell(grid, dividendStr[i], 1, i+1, 'hl-dividend');
            }

            // 2. Dƒ∞KEY √áƒ∞ZGƒ∞ (B√∂l√ºnenin hemen saƒüƒ±ndaki bo≈üluktan ge√ßer)
            // Konum: dividendLen + 1 hizasƒ± (Grid gap √ºzeri)
            const lineCol = dividendStr.length + 1;
            const vLine = document.createElement('div');
            vLine.className = 'vertical-line';
            // CSS Grid'de dikey √ßizgiyi belirli bir kolona yaslamak i√ßin:
            vLine.style.gridColumn = lineCol; 
            vLine.style.gridRow = "1 / span 10"; // A≈üaƒüƒ± kadar uzasƒ±n (≈üimdilik 10)
            vLine.style.height = "100%"; 
            vLine.id = `vline-${pid}`;
            grid.appendChild(vLine);

            // 3. B√ñLEN (Row 1, Col: lineCol + 1)
            const divisorStr = divisor.toString();
            for(let i=0; i<divisorStr.length; i++) {
                drawCell(grid, divisorStr[i], 1, lineCol + 1 + i, 'hl-divisor');
            }

            // 4. YATAY √áƒ∞ZGƒ∞ (B√∂lenin Altƒ±)
            // Row 1'in alt kenarƒ± gibi davranmalƒ±
            const hLine = document.createElement('div');
            hLine.className = 'horizontal-line';
            hLine.style.gridColumn = `${lineCol + 1} / span ${divisorStr.length + 1}`; // B√∂len kadar geni≈ü
            hLine.style.gridRow = "1"; 
            hLine.style.alignSelf = "end"; // H√ºcrenin dibine yasla
            hLine.style.width = "100%";
            grid.appendChild(hLine);
        }

        function drawCell(grid, content, row, col, styleClass, isAnim=false) {
            const cell = document.createElement('div');
            cell.className = `cell ${styleClass}`;
            if(isAnim) cell.classList.add('fade-in');
            cell.innerText = content;
            cell.style.gridRow = row;
            cell.style.gridColumn = col;
            grid.appendChild(cell);
            return cell;
        }

        // --- HESAPLAMA MOTORU ---
        function calculateSteps(sDividend, divisor) {
            const steps = [];
            let remainder = 0;
            let currentRow = 2; // ƒ∞≈ülemler 2. satƒ±rdan ba≈ülar

            // B√∂l√ºm String'i (Quotient) birikerek gidecek
            let quotientStr = "";

            for(let i=0; i<sDividend.length; i++) {
                let digit = parseInt(sDividend[i]);
                
                // A≈üaƒüƒ± indirme (Bring Down)
                // ƒ∞lk basamak hari√ß, veya i≈ülem sƒ±rasƒ±ndaki indirme
                let currentVal = remainder * 10 + digit;

                // B√∂l√ºm√º Bul
                let q = Math.floor(currentVal / divisor);
                quotientStr += q.toString();
                
                // B√∂l√ºm Adƒ±mƒ±
                steps.push({ type: 'quotient', val: q, qIndex: i });

                let product = q * divisor;
                let diff = currentVal - product;

                // √áarpƒ±m Adƒ±mƒ± (Sadece anlamlƒ±ysa veya g√∂rsel b√ºt√ºnl√ºk i√ßin)
                // Hizalama: i. kolonda bitmeli
                steps.push({ type: 'product', val: product, row: currentRow, endCol: i + 1 });

                // √áƒ±karma Adƒ±mƒ± (Kalan)
                // Kalanƒ± yazarken bir sonraki basamaƒüƒ± yanƒ±na indirme (g√∂rselle≈ütirme)
                // Bir sonraki rakam var mƒ±?
                let nextDigit = (i < sDividend.length - 1) ? sDividend[i+1] : null;

                steps.push({ 
                    type: 'diff_bring', 
                    val: diff, 
                    nextVal: nextDigit, 
                    row: currentRow + 1, 
                    endCol: i + 1 
                });

                remainder = diff;
                currentRow += 2; // Her d√∂ng√º 2 satƒ±r yer (√áarpƒ±m satƒ±rƒ±, Kalan satƒ±rƒ±)
            }
            return steps;
        }

        // --- OYNATICI ---
        function playStep(pid) {
            const state = states[pid];
            const btn = document.getElementById(`btn-play-${pid}`);
            const btnQ = document.getElementById(`btn-quick-${pid}`);

            if(state.idx >= state.steps.length) return;

            btn.disabled = true;
            btnQ.disabled = true;

            const step = state.steps[state.idx];
            renderStep(pid, step, state.dividendLen);

            state.idx++;

            setTimeout(() => {
                if(state.idx < state.steps.length) {
                    btn.disabled = false;
                    btn.innerText = "DEVAM ET";
                    btnQ.disabled = false;
                } else {
                    btn.innerText = "Bƒ∞TTƒ∞";
                    btn.disabled = true;
                    // Dikey √ßizgiyi uzat (g√∂rsel d√ºzeltme)
                    adjustVerticalLine(pid);
                }
            }, 500);
        }

        function quickShow(pid) {
            const state = states[pid];
            while(state.idx < state.steps.length) {
                renderStep(pid, state.steps[state.idx], state.dividendLen, true);
                state.idx++;
            }
            document.getElementById(`btn-play-${pid}`).innerText = "Bƒ∞TTƒ∞";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
            adjustVerticalLine(pid);
        }

        // --- RENDER ---
        function renderStep(pid, step, dividendLen, instant=false) {
            const grid = document.getElementById(`grid-${pid}`);
            const divLineCol = dividendLen + 1; // Dikey √ßizgi kolonu

            if(step.type === 'quotient') {
                // B√∂l√ºm: Satƒ±r 2, Dikey √áizginin Saƒüƒ±
                // S√ºtun: divLineCol + 1 + step.qIndex
                drawCell(grid, step.val, 2, divLineCol + 1 + step.qIndex, 'hl-quotient', !instant);
            }

            if(step.type === 'product') {
                // √áƒ±kan sayƒ± (Product)
                // Hizalama: endCol s√ºtununda bitmeli.
                let sVal = step.val.toString();
                let startCol = step.endCol - sVal.length + 1;

                for(let k=0; k<sVal.length; k++) {
                    let c = drawCell(grid, sVal[k], step.row, startCol + k, 'hl-product', !instant);
                    // Eksi i≈üareti (Sadece sayƒ±nƒ±n en soluna)
                    if(k === 0) {
                        let mn = document.createElement('span');
                        mn.innerText = '-';
                        mn.className = 'minus-sign';
                        c.appendChild(mn);
                    }
                }
            }

            if(step.type === 'diff_bring') {
                // Fark (Kalan)
                let sVal = step.val.toString(); // Kalan (√ñrn: 2)
                
                // Farkƒ± Yaz: endCol hizasƒ±nda biter
                let startCol = step.endCol - sVal.length + 1;

                for(let k=0; k<sVal.length; k++) {
                    drawCell(grid, sVal[k], step.row, startCol + k, 'hl-diff', !instant);
                }

                // A≈üaƒüƒ± ƒ∞ndirme (Bring Down)
                // Kalanƒ±n hemen saƒüƒ±na (endCol + 1)
                if(step.nextVal !== null) {
                    drawCell(grid, step.nextVal, step.row, step.endCol + 1, 'hl-bringdown', !instant);
                }
            }
        }

        function adjustVerticalLine(pid) {
            // Grid y√ºksekliƒüine g√∂re dikey √ßizgiyi uzat
            const grid = document.getElementById(`grid-${pid}`);
            const vLine = document.getElementById(`vline-${pid}`);
            // Otomatik y√ºkseklik hesaplama yerine basit√ße √ßok uzun yapalƒ±m, CSS Grid halleder
            vLine.style.gridRow = "1 / span 50";
        }

        function reset(pid) {
            document.getElementById(`grid-${pid}`).innerHTML = '';
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
        }

    </script>
</body>
</html>
