<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√ºrk Usul√º B√∂lme Paneli</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f1f8e9;
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #333;
        }

        h1 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1.6rem;
            color: #33691e;
            text-transform: uppercase;
        }

        .stage-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 15px;
            padding-bottom: 5px;
            box-sizing: border-box;
        }

        /* PANEL */
        .panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #aed581;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        /* Ba≈ülƒ±klar */
        .panel-header {
            width: 100%;
            text-align: center;
            padding: 8px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        .p1-head { background: #ff7043; }
        .p2-head { background: #42a5f5; }
        .p3-head { background: #66bb6a; }

        /* BUTON GRUBU (EN √úSTTE) */
        .top-controls {
            display: flex;
            gap: 8px;
            padding: 10px;
            width: 100%;
            justify-content: center;
            background: #f9fbe7;
            border-bottom: 1px solid #dcedc8;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: 0.2s;
        }
        .btn-play { background: #558b2f; flex: 2; }
        .btn-quick { background: #fbc02d; color: #333; flex: 1; }
        .btn-reset { background: #90a4ae; width: 40px; font-size: 1.2rem; }

        .action-btn:disabled { opacity: 0.5; cursor: default; }
        .action-btn:active { transform: translateY(2px); }

        /* AYAR ALANI */
        .setup-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            width: 100%;
            border-bottom: 1px dashed #ccc;
        }

        .num-input {
            font-size: 1.3rem;
            padding: 5px;
            width: 120px;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 6px;
            font-weight: bold;
            color: #455a64;
        }

        .preset-btns { display: flex; gap: 4px; width: 100%; justify-content: center; }
        .pre-btn {
            padding: 6px;
            font-size: 0.85rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            opacity: 0.8;
            flex: 1;
        }
        .pre-btn:hover { opacity: 1; }
        .active-preset { opacity: 1; transform: scale(1.05); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* GRID ALANI (SONSUZ KAƒûIT) */
        .grid-wrapper {
            flex-grow: 1;
            width: 100%;
            overflow: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .math-grid {
            display: grid;
            /* Grid ≈üablonu JS ile dinamik ayarlanacak */
            gap: 0; /* √áizgiler biti≈üik olsun */
            visibility: hidden;
        }

        /* H√úCRE TASARIMI */
        .cell {
            width: 30px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Roboto Mono', monospace; /* Hizalama i√ßin ≈üart */
            font-size: 1.5rem;
            font-weight: bold;
            color: #37474f;
            position: relative;
        }

        /* T√úRK USUL√ú √áƒ∞ZGƒ∞LER */
        .border-left-wall {
            border-left: 3px solid #333;
        }
        
        .border-bottom-wall {
            border-bottom: 3px solid #333;
        }

        .subtraction-line {
            border-bottom: 2px solid #d32f2f; /* Kƒ±rmƒ±zƒ± √ßƒ±karma √ßizgisi */
        }

        /* RENKLER VE EFEKTLER */
        .hl-dividend { color: #333; }
        .hl-divisor { color: #1565c0; }
        .hl-quotient { color: #2e7d32; font-weight: 900; background-color: #e8f5e9; }
        .hl-sub { color: #c62828; } /* √áƒ±kan sayƒ± */
        .hl-rem { color: #333; font-weight: bold; } /* Kalan */
        
        .cell-anim {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Eksi ƒ∞≈üareti */
        .minus-sign {
            position: absolute;
            left: -15px;
            color: #d32f2f;
            font-size: 1.2rem;
        }

    </style>
</head>
<body>

    <h1>üìè T√ºrk Usul√º B√∂lme Tahtasƒ±</h1>

    <div class="stage-container">
        </div>

    <script>
        const container = document.querySelector('.stage-container');
        
        // 3 Tane Panel Olu≈ütur
        for(let i=1; i<=3; i++) {
            let pColor = i===1 ? 'p1-head' : (i===2 ? 'p2-head' : 'p3-head');
            
            let html = `
            <div class="panel">
                <div class="panel-header ${pColor}">SORU ${i}</div>
                
                <div class="top-controls">
                    <button class="action-btn btn-play" id="btn-play-${i}" onclick="playStep(${i})" disabled>‚ñ∂ BA≈ûLAT</button>
                    <button class="action-btn btn-quick" id="btn-quick-${i}" onclick="quickShow(${i})" disabled>‚ö° CEVAP</button>
                    <button class="action-btn btn-reset" onclick="reset(${i})">‚Ü∫</button>
                </div>

                <div class="setup-area" id="setup-${i}">
                    <input type="number" id="inp-${i}" class="num-input" value="${12 + i*4}">
                    <div class="preset-btns">
                        <button class="pre-btn" style="background:#ef6c00" onclick="setMode(${i}, 5, this)">x5</button>
                        <button class="pre-btn" style="background:#2e7d32" onclick="setMode(${i}, 25, this)">x25</button>
                        <button class="pre-btn" style="background:#1565c0" onclick="setMode(${i}, 50, this)">x50</button>
                        <button class="pre-btn" style="background:#6a1b9a" onclick="setMode(${i}, 125, this)">x125</button>
                    </div>
                </div>

                <div class="grid-wrapper">
                    <div class="math-grid" id="grid-${i}"></div>
                </div>
            </div>
            `;
            container.innerHTML += html;
        }

        // --- GLOBAL DEƒûƒ∞≈ûKENLER ---
        const states = {
            1: { steps: [], idx: 0 },
            2: { steps: [], idx: 0 },
            3: { steps: [], idx: 0 }
        };

        const rules = {
            5: { div: 2, zeros: "0" },
            25: { div: 4, zeros: "00" },
            50: { div: 2, zeros: "00" },
            125: { div: 8, zeros: "000" }
        };

        // --- OYUN KURULUMU ---
        function setMode(pid, factor, btn) {
            // Buton aktifliƒüi
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
            btn.classList.add('active-preset');

            const inpVal = document.getElementById(`inp-${pid}`).value;
            if(!inpVal) return;

            // Hesaplamalar
            const rule = rules[factor];
            const fullNumStr = inpVal + rule.zeros;
            const dividend = parseInt(fullNumStr);
            const divisor = rule.div;

            // Grid'i Temizle ve Hazƒ±rla
            states[pid].steps = calculateTurkishDivision(dividend, divisor);
            states[pid].idx = 0;
            
            drawSkeleton(pid, fullNumStr, divisor);

            // Kontrolleri A√ß
            document.getElementById(`btn-play-${pid}`).disabled = false;
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-quick-${pid}`).disabled = false;
        }

        // --- ƒ∞SKELET √áƒ∞Zƒ∞Mƒ∞ (B√∂l√ºnen | B√∂len) ---
        function drawSkeleton(pid, dividendStr, divisor) {
            const grid = document.getElementById(`grid-${pid}`);
            grid.innerHTML = '';
            grid.style.visibility = 'visible';

            // Grid S√ºtun Yapƒ±sƒ±: [Rakamlar...] [Duvar] [B√∂len/B√∂l√ºm]
            const digitCols = dividendStr.length;
            const totalCols = digitCols + 2; // +1 Duvar, +1 B√∂len Alanƒ±
            
            grid.style.gridTemplateColumns = `repeat(${digitCols}, 30px) 10px 60px`;

            // 1. SATIR: B√∂l√ºnen Rakamlarƒ± | B√∂len
            // Rakamlar
            for(let char of dividendStr) {
                let cell = createCell(char, 'hl-dividend');
                grid.appendChild(cell);
            }
            
            // Duvar (Dikey √áizgi)
            let wall = createCell('');
            wall.classList.add('border-left-wall'); // Soluna √ßizgi √ßek
            // Duvar, b√∂l√ºnen ile b√∂len arasƒ±nda kalƒ±r.
            // B√∂lenin altƒ±na kadar uzamasƒ± i√ßin, sonraki satƒ±rlarda da bu duvarƒ± √ßizeceƒüiz.
            grid.appendChild(wall);

            // B√∂len
            let divCell = createCell(divisor, 'hl-divisor');
            divCell.classList.add('border-bottom-wall'); // Altƒ±na √ßizgi √ßek
            grid.appendChild(divCell);
        }

        // --- HESAPLAMA MOTORU ---
        function calculateTurkishDivision(dividend, divisor) {
            const steps = [];
            const sDividend = dividend.toString();
            let remainder = 0;
            let currentVal = 0; // ƒ∞≈ülem g√∂ren kƒ±sƒ±m
            
            // Satƒ±r mantƒ±ƒüƒ± gridde biraz farklƒ± i≈üleyecek.
            // B√∂l√ºm (Quotient) -> Row 2, en saƒü kolon.
            // ƒ∞≈ülemler -> Row 2'den itibaren sol kolonlar.

            for (let i = 0; i < sDividend.length; i++) {
                let digit = parseInt(sDividend[i]);
                currentVal = remainder * 10 + digit;

                // Adƒ±m 1: B√∂l√ºm Rakamƒ±
                let q = Math.floor(currentVal / divisor);
                steps.push({ type: 'quotient', val: q });

                // Adƒ±m 2: √áarpma ve √áƒ±karma (Sadece 0 deƒüilse veya i≈ülem bitiyorsa √ßizelim)
                // T√ºrk usul√ºnde 0 olsa bile bazen yazƒ±lƒ±r ama genelde "i√ßinde yoksa 0 at ge√ß" yapƒ±lƒ±r.
                // Biz klasik tam g√∂sterim yapalƒ±m (√áarp -> Yaz -> √áƒ±kar).
                
                let product = q * divisor;
                let diff = currentVal - product;

                // √áarpƒ±m Sonucunu Yaz (Product)
                // Hizalama: Hangi basamaktaysak (i), oraya hizalƒ± bitmeli.
                steps.push({ type: 'product', val: product, colIndex: i });

                // √áƒ±karma Sonucu (Remainder)
                steps.push({ type: 'diff', val: diff, colIndex: i });

                remainder = diff;
            }
            return steps;
        }

        // --- ADIM OYNATICI ---
        function playStep(pid) {
            const state = states[pid];
            const btn = document.getElementById(`btn-play-${pid}`);
            const btnQ = document.getElementById(`btn-quick-${pid}`);
            
            if(state.idx >= state.steps.length) return;

            btn.disabled = true;
            btnQ.disabled = true;

            const step = state.steps[state.idx];
            renderStep(pid, step);

            state.idx++;

            setTimeout(() => {
                if(state.idx < state.steps.length) {
                    btn.disabled = false;
                    btn.innerText = "DEVAM ET";
                    btnQ.disabled = false;
                } else {
                    btn.innerText = "Bƒ∞TTƒ∞";
                    btn.disabled = true;
                }
            }, 500);
        }

        function quickShow(pid) {
            const state = states[pid];
            while(state.idx < state.steps.length) {
                renderStep(pid, state.steps[state.idx], true);
                state.idx++;
            }
            document.getElementById(`btn-play-${pid}`).innerText = "Bƒ∞TTƒ∞";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
        }

        // --- RENDER MOTORU ---
        function renderStep(pid, step, instant = false) {
            const grid = document.getElementById(`grid-${pid}`);
            const cols = grid.style.gridTemplateColumns.split(' ').length; // Toplam kolon sayƒ±sƒ±
            const dividendCols = cols - 2; // Sadece rakam alanƒ±

            // B√ñL√úM (QUOTIENT)
            if (step.type === 'quotient') {
                // B√∂l√ºm h√ºcresi: Saƒüdaki en son kolonun i√ßinde birikmeli.
                // Grid yapƒ±mƒ±zda statik bir b√∂l√ºm h√ºcresi yok, dinamik ekliyoruz.
                // √á√∂z√ºm: ƒ∞lk b√∂l√ºm adƒ±mƒ±nda, b√∂lenin altƒ±na bir kapsayƒ±cƒ± a√ßalƒ±m, sonra oraya ekleyelim.
                
                let quotientArea = document.getElementById(`q-area-${pid}`);
                if (!quotientArea) {
                    // Hen√ºz yoksa olu≈ütur (Absolute ile b√∂lenin altƒ±na koymak en temizi)
                    // Grid h√ºcresini bul: Row 1, Last Col.
                    // Bu grid yapƒ±sƒ±nda Row 1 zaten dolu.
                    // Biz grid'e append ediyoruz, yani yeni satƒ±rlar olu≈üuyor.
                    
                    // Grid'in en saƒü kolonundaki (B√∂lenin altƒ±) h√ºcreyi hedefleyelim.
                    // Basit yol: Gridin 2. satƒ±r, son h√ºcresine yazmaya ba≈üla.
                    // Ama product adƒ±mlarƒ± da satƒ±r ekliyor.
                    
                    // T√ºrk usul√ºnde B√∂l√ºm sabit durur.
                    // Bu y√ºzden B√∂l√ºm alanƒ±nƒ± "Absolute" yapalƒ±m, grid akƒ±≈üƒ±ndan etkilenmesin.
                    
                    quotientArea = document.createElement('div');
                    quotientArea.id = `q-area-${pid}`;
                    quotientArea.style.position = 'absolute';
                    // Konumlandƒ±rma (B√∂len h√ºcresini bul)
                    const divisorCell = grid.children[dividendCols + 1]; // Son h√ºcre
                    quotientArea.style.top = (divisorCell.offsetTop + divisorCell.offsetHeight) + 'px';
                    quotientArea.style.left = divisorCell.offsetLeft + 'px';
                    quotientArea.style.width = divisorCell.offsetWidth + 'px';
                    quotientArea.style.height = '40px';
                    quotientArea.style.display = 'flex';
                    quotientArea.style.alignItems = 'center';
                    quotientArea.style.justifyContent = 'center';
                    quotientArea.className = 'hl-quotient';
                    grid.parentNode.appendChild(quotientArea); // Grid wrapper'a ekle
                }
                
                quotientArea.innerText += step.val;
                if(!instant) quotientArea.classList.add('cell-anim');
            }

            // √áARPIM ve √áIKARMA (PRODUCT & DIFF)
            // Bunlar yeni satƒ±rlar gerektirir.
            if (step.type === 'product' || step.type === 'diff') {
                // Yeni bir satƒ±r olu≈ütur (cols kadar bo≈ü h√ºcre)
                for(let i=0; i<cols; i++) {
                    let cell = createCell('');
                    
                    // Duvarƒ± devam ettir (Sondan 2. kolon)
                    if (i === dividendCols) {
                        cell.classList.add('border-left-wall');
                    }
                    
                    // ƒ∞√ßerik var mƒ±?
                    // step.colIndex hizasƒ±nda bitmeli.
                    let valStr = step.val.toString();
                    let startCol = step.colIndex - valStr.length + 1;
                    
                    if (i >= startCol && i <= step.colIndex) {
                        // Rakamƒ± bul
                        let charIndex = i - startCol;
                        cell.innerText = valStr[charIndex];
                        
                        if(step.type === 'product') {
                            cell.classList.add('hl-sub');
                            cell.classList.add('subtraction-line'); // Altƒ± √ßizili
                            if(charIndex === 0) { // ƒ∞lk rakamƒ±n soluna eksi
                                let minus = document.createElement('span');
                                minus.innerText = '-';
                                minus.className = 'minus-sign';
                                cell.appendChild(minus);
                            }
                        } else {
                            cell.classList.add('hl-rem');
                        }
                        
                        if(!instant) cell.classList.add('cell-anim');
                    }

                    grid.appendChild(cell);
                }
            }
        }

        function createCell(content, extraClass='') {
            const div = document.createElement('div');
            div.className = 'cell ' + extraClass;
            div.innerText = content;
            return div;
        }

        function reset(pid) {
            const grid = document.getElementById(`grid-${pid}`);
            grid.innerHTML = '';
            // Varsa quotient alanƒ±nƒ± sil
            const qArea = document.getElementById(`q-area-${pid}`);
            if(qArea) qArea.remove();
            
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
            
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
        }

    </script>
</body>
</html>
