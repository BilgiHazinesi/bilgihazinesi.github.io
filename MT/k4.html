<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klasik B√∂lme: Kutu Kutu Y√∂ntem</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f4c3; /* Yumu≈üak bir arka plan */
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #333;
        }

        h1 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1.6rem;
            color: #558b2f;
            text-transform: uppercase;
        }

        .stage-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 15px;
            padding-bottom: 5px;
            box-sizing: border-box;
        }

        /* PANEL */
        .panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #c5e1a5;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Ba≈ülƒ±k */
        .panel-header {
            width: 100%;
            text-align: center;
            padding: 8px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        .p1-head { background: #ff7043; }
        .p2-head { background: #42a5f5; }
        .p3-head { background: #66bb6a; }

        /* BUTON GRUBU (√úSTTE) */
        .top-controls {
            display: flex;
            gap: 10px;
            padding: 10px;
            width: 100%;
            justify-content: center;
            background: #f1f8e9;
            border-bottom: 1px solid #dcedc8;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: 0.2s;
        }
        .btn-play { background: #558b2f; flex: 2; }
        .btn-quick { background: #ffca28; color: #333; flex: 1; }
        .btn-reset { background: #bdbdbd; width: 40px; }

        .action-btn:disabled { opacity: 0.5; cursor: default; }
        .action-btn:active { transform: translateY(2px); }

        /* Gƒ∞Rƒ∞≈û ALANI (SETUP) */
        .setup-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            width: 100%;
            border-bottom: 1px dashed #ccc;
        }

        .num-input {
            font-size: 1.2rem;
            padding: 5px;
            width: 100px;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 6px;
            font-weight: bold;
        }

        .preset-btns { display: flex; gap: 5px; }
        .pre-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            opacity: 0.7;
        }
        .pre-btn:hover { opacity: 1; }
        .active-preset { opacity: 1; box-shadow: 0 0 5px rgba(0,0,0,0.3); transform: scale(1.05); }

        /* GRID ALANI (SONSUZ DEFTER KAƒûIDI Gƒ∞Bƒ∞) */
        .grid-wrapper {
            flex-grow: 1;
            width: 100%;
            overflow: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .math-grid {
            display: grid;
            /* Dinamik kolon sayƒ±sƒ± JS ile verilecek */
            gap: 2px; 
            visibility: hidden;
        }

        /* H√úCRE TASARIMI */
        .cell {
            width: 35px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: #455a64;
            background: white;
            border: 1px solid #cfd8dc; /* Hafif √ßer√ßeve */
            border-radius: 4px;
        }

        .cell-empty {
            background: transparent;
            border: none;
        }

        /* KLASƒ∞K B√ñLME √áƒ∞ZGƒ∞LERƒ∞ (√ñZEL H√úCRELER ƒ∞√áƒ∞N) */
        /* B√∂l√ºnen ile B√∂len arasƒ±ndaki dikey √ßizgi */
        .border-right-thick {
            border-right: 3px solid #333 !important;
        }
        /* B√∂len altƒ±ndaki yatay √ßizgi */
        .border-bottom-thick {
            border-bottom: 3px solid #333 !important;
        }
        /* √áƒ±karma √ßizgisi */
        .border-sub-line {
            border-bottom: 2px solid #d32f2f !important;
        }

        /* RENKLER VE ANƒ∞MASYONLAR */
        .highlight-dividend { background-color: #fff9c4; border-color: #fbc02d; }
        .highlight-product { color: #d32f2f; }
        .highlight-quotient { color: #2e7d32; background-color: #e8f5e9; font-weight: 800; }
        .highlight-bringdown { color: #1565c0; animation: dropIn 0.5s; }

        @keyframes dropIn {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body>

    <h1>üìè Klasik B√∂lme Tahtasƒ±</h1>

    <div class="stage-container">
        </div>

    <script>
        // HTML ≈ûablonunu Olu≈ütur
        const container = document.querySelector('.stage-container');
        const colors = ['#ff7043', '#42a5f5', '#66bb6a']; // Turuncu, Mavi, Ye≈üil

        for(let i=1; i<=3; i++) {
            let pColor = i===1 ? 'p1-head' : (i===2 ? 'p2-head' : 'p3-head');
            
            let html = `
            <div class="panel">
                <div class="panel-header ${pColor}">SORU ${i}</div>
                
                <div class="top-controls">
                    <button class="action-btn btn-play" id="btn-play-${i}" onclick="playStep(${i})" disabled>‚ñ∂ BA≈ûLAT</button>
                    <button class="action-btn btn-quick" id="btn-quick-${i}" onclick="quickShow(${i})" disabled>‚ö° SONU√á</button>
                    <button class="action-btn btn-reset" onclick="reset(${i})">‚Ü∫</button>
                </div>

                <div class="setup-area" id="setup-${i}">
                    <input type="number" id="inp-${i}" class="num-input" value="${12 + i*5}">
                    <div class="preset-btns">
                        <button class="pre-btn" style="background:#ef6c00" onclick="setMode(${i}, 5, this)">x5</button>
                        <button class="pre-btn" style="background:#2e7d32" onclick="setMode(${i}, 25, this)">x25</button>
                        <button class="pre-btn" style="background:#1565c0" onclick="setMode(${i}, 50, this)">x50</button>
                        <button class="pre-btn" style="background:#6a1b9a" onclick="setMode(${i}, 125, this)">x125</button>
                    </div>
                </div>

                <div class="grid-wrapper">
                    <div class="math-grid" id="grid-${i}"></div>
                </div>
            </div>
            `;
            container.innerHTML += html;
        }

        // --- VERƒ∞ YAPISI ---
        const states = {
            1: { steps: [], idx: 0, div: 0, num: 0 },
            2: { steps: [], idx: 0, div: 0, num: 0 },
            3: { steps: [], idx: 0, div: 0, num: 0 }
        };

        const rules = {
            5: { div: 2, zeros: "0" },
            25: { div: 4, zeros: "00" },
            50: { div: 2, zeros: "00" },
            125: { div: 8, zeros: "000" }
        };

        // --- KURULUM ---
        function setMode(pid, factor, btn) {
            // Buton stili
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
            btn.classList.add('active-preset');

            const inpVal = document.getElementById(`inp-${pid}`).value;
            if(!inpVal) return;

            // Mantƒ±k
            const rule = rules[factor];
            const fullNumStr = inpVal + rule.zeros;
            const fullNum = parseInt(fullNumStr);
            const divisor = rule.div;

            // Hazƒ±rlƒ±k
            states[pid].num = fullNum;
            states[pid].div = divisor;
            states[pid].steps = calculateDivisionSteps(fullNum, divisor);
            states[pid].idx = 0;

            // Butonlarƒ± a√ß
            document.getElementById(`btn-play-${pid}`).disabled = false;
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-quick-${pid}`).disabled = false;

            // Grid'i ƒ∞lk Haliyle √áiz (Sadece Soru Kƒ±smƒ±)
            drawInitialGrid(pid, fullNumStr, divisor);
        }

        // --- ADIM HESAPLAMA MOTORU ---
        function calculateDivisionSteps(dividend, divisor) {
            const sDividend = dividend.toString();
            const sDivisor = divisor.toString();
            const steps = [];

            // Grid Koordinat Sistemi
            // Col 0...N: B√∂l√ºnen Rakamlarƒ±
            // Col N+1: Duvar (|)
            // Col N+2...: B√∂len / B√∂l√ºm
            
            // Satƒ±r 0: Soru Satƒ±rƒ± (B√∂l√ºnen | B√∂len)
            // Satƒ±r 1: B√∂l√ºm √áizgisi Altƒ± (_______)
            // Satƒ±r 2+: ƒ∞≈ülemler

            let remainder = 0;
            let currentRow = 2; // ƒ∞≈ülemler 2. satƒ±rdan (index) ba≈ülar

            for (let i = 0; i < sDividend.length; i++) {
                let digit = parseInt(sDividend[i]);
                
                // Adƒ±m: A≈üaƒüƒ± ƒ∞ndir (ƒ∞lk rakam hari√ß)
                if (i > 0) {
                    steps.push({ type: 'bring_down', val: digit, row: currentRow, col: i });
                }

                // Mevcut deƒüer (Kalan + ƒ∞nen Rakam)
                let currentVal = remainder * 10 + digit;
                let q = Math.floor(currentVal / divisor);
                let prod = q * divisor;
                let newRem = currentVal - prod;

                // Adƒ±m: B√∂l√ºme Yaz
                steps.push({ type: 'quotient', val: q, qIndex: i });

                // Adƒ±m: √áarp ve Yaz (Altƒ±na)
                // Dikkat: √áift haneli √ßarpƒ±m hizalamasƒ±
                steps.push({ type: 'product', val: prod, row: currentRow + 1, col: i });

                // Adƒ±m: √áƒ±kar ve Kalanƒ± Yaz
                steps.push({ type: 'remainder', val: newRem, row: currentRow + 3, col: i });

                remainder = newRem;
                currentRow += 3; // Her blok 3 satƒ±r yer kaplar (√áƒ±kan, √áizgi, Kalan)
            }
            return steps;
        }

        // --- √áƒ∞Zƒ∞M FONKSƒ∞YONLARI ---
        function drawInitialGrid(pid, dividendStr, divisor) {
            const grid = document.getElementById(`grid-${pid}`);
            grid.innerHTML = '';
            grid.style.visibility = 'visible';

            // Grid Boyutlarƒ±nƒ± Hesapla
            // S√ºtun Sayƒ±sƒ±: B√∂l√ºnen Uzunluƒüu + 1 (√áizgi) + B√∂len Uzunluƒüu (En az 3)
            const colCount = dividendStr.length + 1 + 3;
            grid.style.gridTemplateColumns = `repeat(${colCount}, 35px)`;

            // SATIR 0: [B√∂l√ºnen Rakamlarƒ±] [|] [B√∂len]
            // B√∂l√ºnen
            for(let char of dividendStr) {
                grid.appendChild(createCell(char));
            }
            
            // Duvar
            let wall = createCell('');
            wall.classList.add('border-right-thick'); // Saƒü tarafa kalƒ±n √ßizgi
            grid.appendChild(wall);

            // B√∂len
            let divCell = createCell(divisor);
            divCell.classList.add('border-bottom-thick'); // Altƒ±na kalƒ±n √ßizgi
            grid.appendChild(divCell);

            // Geri kalan bo≈üluk (varsa)
            fillEmptyCells(grid, colCount - (dividendStr.length + 2));
        }

        function playStep(pid) {
            const state = states[pid];
            const btn = document.getElementById(`btn-play-${pid}`);
            const btnQ = document.getElementById(`btn-quick-${pid}`);

            if(state.idx >= state.steps.length) return;

            btn.disabled = true;
            btnQ.disabled = true;

            const step = state.steps[state.idx];
            const grid = document.getElementById(`grid-${pid}`);
            const colCount = parseInt(grid.style.gridTemplateColumns.split('(')[1]);
            const dividendLen = states[pid].num.toString().length;

            // Animasyonlu ƒ∞≈ülem
            if(step.type === 'quotient') {
                // B√∂l√ºm h√ºcresini bulmak biraz trickli √ß√ºnk√º grid akƒ±≈ükan.
                // Ama b√∂l√ºm yeri sabit: Satƒ±r 1, Duvarƒ±n saƒüƒ±.
                // Biz grid'e append yaparak gittiƒüimiz i√ßin, aslƒ±nda b√∂l√ºm satƒ±rƒ±nƒ± en ba≈üta olu≈üturmadƒ±k.
                // Dinamik olarak belirli bir pozisyona div eklemek gridde zor (absolute gerekir).
                // √á√ñZ√úM: B√∂l√ºm i√ßin ayrƒ± bir alan tanƒ±mlamak yerine, gridin saƒü tarafƒ±nƒ± kullanacaƒüƒ±z.
                // B√∂l√ºm her zaman B√∂len'in altƒ±ndadƒ±r.
                
                // √ñnceki satƒ±rlarƒ± doldurarak "B√∂l√ºm Satƒ±rƒ±na" (Satƒ±r 1) gelelim
                // B√∂len Satƒ±r 0'daydƒ±.
                // Grid'e sadece append yaparsak alt alta gider. 
                // Biz burada JS ile spesifik bir h√ºcreye m√ºdahale etmeyeceƒüiz, yeni h√ºcreler ekleyeceƒüiz.
                // Ama bu "Klasik grid" yapƒ±sƒ±nda zor.
                
                // D√úZELTME: B√∂l√ºm rakamlarƒ±nƒ±, en ba≈ütaki b√∂lenin altƒ±na (Satƒ±r 1, saƒü s√ºtunlar) eklemeliyiz.
                // Bunu yapmak i√ßin "Position Absolute" kullanarak mevcut gridin √ºzerine koymak en temiz g√∂rsel √ß√∂z√ºmd√ºr.
                // Veya grid'i ba≈ütan N satƒ±rlƒ± olu≈üturmak gerekir.
                
                // PRATƒ∞K √á√ñZ√úM: B√∂l√ºm kutucuƒüunu, B√∂len kutucuƒüunun hemen altƒ±na "append" edemeyiz √ß√ºnk√º grid flow var.
                // Bu y√ºzden basit bir hile: B√∂l√ºm rakamlarƒ±nƒ± gridin en saƒüƒ±na eklenen yeni bir "sonu√ß paneli" gibi g√∂stereceƒüiz
                // YA DA: Grid'i ba≈ütan b√ºy√ºk kuracaƒüƒ±z. (En saƒülƒ±klƒ±sƒ±)
                
                // Kod karma≈üasƒ±nƒ± √∂nlemek i√ßin: 
                // Quotient deƒüeri geldiƒüinde, B√∂len'in olduƒüu h√ºcrenin (√∂rneƒüin 5. √ßocuk) altƒ±na bir span ekleyelim veya
                // Grid yapƒ±sƒ±nƒ± deƒüi≈ütirelim:
            }
            
            // YENƒ∞ STRATEJƒ∞: Grid yerine Absolute Positioning kullanan "Sanal Grid".
            // Hayƒ±r, Grid ile devam edelim ama "Satƒ±r Ekleme" mantƒ±ƒüƒ±yla.
            
            renderDynamicStep(pid, step, colCount, dividendLen);

            state.idx++;

            setTimeout(() => {
                if(state.idx < state.steps.length) {
                    btn.disabled = false;
                    btn.innerText = "DEVAM ET";
                    btnQ.disabled = false;
                } else {
                    btn.innerText = "Bƒ∞TTƒ∞";
                    btn.disabled = true;
                }
            }, 600); // Animasyon s√ºresi
        }

        function quickShow(pid) {
            const state = states[pid];
            const grid = document.getElementById(`grid-${pid}`);
            const colCount = parseInt(grid.style.gridTemplateColumns.split('(')[1]);
            const dividendLen = states[pid].num.toString().length;

            while(state.idx < state.steps.length) {
                renderDynamicStep(pid, state.steps[state.idx], colCount, dividendLen, true); // true = no animation
                state.idx++;
            }
            document.getElementById(`btn-play-${pid}`).innerText = "Bƒ∞TTƒ∞";
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-quick-${pid}`).disabled = true;
        }

        // Dƒ∞NAMƒ∞K RENDER MOTORU (Satƒ±r Satƒ±r Ekleyen)
        function renderDynamicStep(pid, step, totalCols, dividendLen, instant = false) {
            const grid = document.getElementById(`grid-${pid}`);
            
            // Eƒüer grid bo≈üsa (ilk adƒ±m), sadece b√∂l√ºm satƒ±rƒ±nƒ± hazƒ±rlarƒ±z.
            // B√∂l√ºm satƒ±rƒ± (Satƒ±r 1) hen√ºz yoksa olu≈üturmak lazƒ±m mƒ±?
            // Mevcut yapƒ±da: Satƒ±r 0 var.
            
            // --- B√ñL√úM (QUOTIENT) YAZMA ---
            if (step.type === 'quotient') {
                // B√∂l√ºm, B√∂len'in hemen altƒ±na yazƒ±lƒ±r.
                // Grid'de bu h√ºcre: Satƒ±r 1, S√ºtun = (dividendLen + 1).
                // Ama rakamlar yan yana dizilmeli.
                // Bu y√ºzden Satƒ±r 1'deki ilgili h√ºcreyi hedeflemeliyiz.
                
                // Basitlik i√ßin: B√∂l√ºm rakamlarƒ±nƒ± gridin i√ßinde "B√∂len"in altƒ±na denk gelen yere eklemek yerine
                // absolute position ile "yapƒ±≈ütƒ±ralƒ±m". Bu g√∂rsel olarak en kolayƒ±dƒ±r ve gridi bozmaz.
                
                const divisorCell = grid.children[dividendLen + 1]; // B√∂len h√ºcresi
                const qSpan = document.createElement('div');
                qSpan.innerText = step.val;
                qSpan.className = 'highlight-quotient';
                qSpan.style.position = 'absolute';
                qSpan.style.width = '35px';
                qSpan.style.height = '40px';
                qSpan.style.display = 'flex';
                qSpan.style.justifyContent = 'center';
                qSpan.style.alignItems = 'center';
                qSpan.style.border = '1px solid #2e7d32';
                qSpan.style.borderRadius = '4px';
                
                // Konum Hesapla: B√∂lenin Altƒ± + Saƒüa doƒüru kayma (step.qIndex * 35px)
                const rect = divisorCell.getBoundingClientRect();
                const gridRect = grid.getBoundingClientRect();
                
                qSpan.style.top = (rect.bottom - gridRect.top + 2) + 'px'; // Hemen altƒ±
                qSpan.style.left = (rect.left - gridRect.left + (step.qIndex * 35)) + 'px'; // Yan yana dizilsin
                
                if(!instant) qSpan.style.animation = "dropIn 0.5s";
                grid.appendChild(qSpan);
                return;
            }

            // --- ƒ∞≈ûLEM BASAMAKLARI (GRID SATIRI EKLEME) ---
            // Her i≈ülem i√ßin yeni satƒ±rlar eklememiz gerekmiyor, grid otomatik akar.
            // Ama bo≈üluklarƒ± (padding cells) doldurmalƒ±yƒ±z ki hizalama tutsun.
            
            // Hangi satƒ±rdayƒ±z? step.row
            // Grid'deki mevcut eleman sayƒ±sƒ±ndan ≈üu anki satƒ±rƒ± bulabiliriz.
            let currentCells = grid.children.length;
            // Absolute elemanlarƒ± sayma
            let staticCells = 0;
            for(let c of grid.children) { if(c.style.position !== 'absolute') staticCells++; }
            
            let currentRow = Math.ceil(staticCells / totalCols);
            
            // Hedef satƒ±ra kadar bo≈ü h√ºcre bas
            while(currentRow < step.row) {
                for(let i=0; i<totalCols; i++) {
                    // Dikey √ßizgiyi koru (dividendLen + 1. s√ºtun)
                    let cell = createCell('', false);
                    if(i === dividendLen) cell.classList.add('border-right-thick');
                    else cell.classList.add('cell-empty');
                    grid.appendChild(cell);
                }
                currentRow++;
            }

            // ≈ûimdi hedef satƒ±rdayƒ±z (step.row). 
            // ƒ∞lgili kolona kadar bo≈üluk bas.
            // step.col: Hangi basamak hizasƒ±na yazacaƒüƒ±z?
            
            // √áARPIM YAZMA
            if (step.type === 'product') {
                // Hizalama: step.col hizasƒ±nda bitmeli.
                // Sayƒ± (step.val) tek veya √ßift haneli olabilir.
                let valStr = step.val.toString();
                let startCol = step.col - valStr.length + 1;
                
                // Ba≈ülangƒ±√ß kolonuna kadar bo≈üluk
                for(let i=0; i<startCol; i++) {
                     grid.appendChild(createCell('', true, (i===dividendLen)));
                }
                
                // Rakamlarƒ± yaz
                for(let char of valStr) {
                    let cell = createCell(char);
                    cell.style.borderBottom = "2px solid #d32f2f"; // √áƒ±karma √ßizgisi
                    cell.classList.add('highlight-product');
                    grid.appendChild(cell);
                }
                
                // "-" i≈üareti (bir soluna)
                // Grid mantƒ±ƒüƒ±nda zordur, pas ge√ßelim veya sol h√ºcreye ekleyelim.
                
                // Satƒ±rƒ±n geri kalanƒ±nƒ± doldur
                let filled = startCol + valStr.length;
                fillRowRest(grid, filled, totalCols, dividendLen);
            }

            // √áIKARMA SONUCU (KALAN)
            if (step.type === 'remainder') {
                let valStr = step.val.toString();
                let startCol = step.col - valStr.length + 1;

                for(let i=0; i<startCol; i++) {
                     grid.appendChild(createCell('', true, (i===dividendLen)));
                }
                for(let char of valStr) {
                    grid.appendChild(createCell(char));
                }
                let filled = startCol + valStr.length;
                fillRowRest(grid, filled, totalCols, dividendLen);
            }

            // A≈ûAƒûI ƒ∞NDƒ∞RME
            if (step.type === 'bring_down') {
                // Bu adƒ±m aslƒ±nda 'remainder' adƒ±mƒ±nƒ±n yanƒ±na eklenir g√∂rsel olarak.
                // Ama bizim kodumuz satƒ±r satƒ±r gidiyor.
                // Bu y√ºzden, az √∂nce eklenen 'remainder' satƒ±rƒ±na m√ºdahale etmeliyiz veya
                // yeni satƒ±r a√ßƒ±p oraya yazmalƒ±yƒ±z.
                
                // En temiz yol: "bring_down" type'ƒ±nƒ± remainder ile birle≈ütirmek veya
                // Remainder'ƒ± yazdƒ±ktan sonra, aynƒ± satƒ±rdaki bir sonraki h√ºcreye bu sayƒ±yƒ± koymak.
                
                // JS Grid'de son eklenen h√ºcreleri bulup yanƒ±na ekleyelim.
                // Bu biraz karma≈üƒ±k, o y√ºzden g√∂rsel hile yapalƒ±m:
                // Remainder satƒ±rƒ±nƒ± yazarken (yukarƒ±daki blok), eƒüer o adƒ±mda 'bring_down' da varsa onu da yazmalƒ±ydƒ±k.
                
                // Pratik √ß√∂z√ºm: Absolute div ile sayƒ±yƒ± yukarƒ±dan a≈üaƒüƒ± kaydƒ±ralƒ±m.
                // Hedef: step.row (yani remainder satƒ±rƒ±), step.col.
                
                // Hedef h√ºcreyi bulmak zor. 
                // Grid'in son satƒ±rƒ±ndaki step.col indeksli h√ºcreyi bulalƒ±m.
                // Grid √ßocuklarƒ±nƒ± tersten tara.
                
                // Basitlik adƒ±na: Remainder'dan sonra yeni satƒ±r a√ßmadan, 
                // bir √∂nceki Remainder i≈ülemindeki bo≈üluk h√ºcresini bulup i√ßeriƒüini deƒüi≈ütirelim.
                
                // Veya: Yeni bir satƒ±r a√ßalƒ±m, sadece inen sayƒ±yƒ± yazalƒ±m? Hayƒ±r, yan yana olmalƒ±.
                
                // En iyisi: Remainder kutusunun yanƒ±na "absolute" olarak ekleyelim.
                const allCells = grid.querySelectorAll('.cell');
                const lastCell = allCells[allCells.length - (totalCols - step.col)]; // Matematiksel tahmin
                
                // Bu √ßok kƒ±rƒ±lgan. O y√ºzden "Absolute" en iyisi.
                // S√ºtun ba≈ülƒ±ƒüƒ±ndaki (B√∂l√ºnen) ilgili rakamƒ± bul.
                const topDigit = grid.children[step.col]; // B√∂l√ºnen satƒ±rƒ±ndaki rakam
                const targetRowTop = grid.lastElementChild.offsetTop; // Son satƒ±rƒ±n konumu
                
                const dropCell = document.createElement('div');
                dropCell.innerText = step.val;
                dropCell.className = 'cell highlight-bringdown';
                dropCell.style.position = 'absolute';
                dropCell.style.left = topDigit.offsetLeft + 'px';
                dropCell.style.top = targetRowTop + 'px';
                
                grid.appendChild(dropCell);
            }
        }

        // --- YARDIMCILAR ---
        function createCell(content, isEmpty=false, hasRightBorder=false) {
            const div = document.createElement('div');
            div.className = isEmpty ? 'cell cell-empty' : 'cell';
            div.innerText = content;
            if(hasRightBorder) div.classList.add('border-right-thick');
            return div;
        }

        function fillEmptyCells(grid, count) {
            for(let i=0; i<count; i++) grid.appendChild(createCell('', true));
        }
        
        function fillRowRest(grid, filledCount, totalCols, divLineIdx) {
            for(let i=filledCount; i<totalCols; i++) {
                let cell = createCell('', true);
                if(i === divLineIdx) cell.classList.add('border-right-thick');
                grid.appendChild(cell);
            }
        }

        function reset(pid) {
            document.getElementById(`grid-${pid}`).innerHTML = '';
            document.getElementById(`btn-play-${pid}`).disabled = true;
            document.getElementById(`btn-play-${pid}`).innerText = "‚ñ∂ BA≈ûLAT";
            document.getElementById(`btn-quick-${pid}`).disabled = true;
            const allBtns = document.querySelectorAll(`#setup-${pid} .pre-btn`);
            allBtns.forEach(b => b.classList.remove('active-preset'));
        }

    </script>
</body>
</html>
